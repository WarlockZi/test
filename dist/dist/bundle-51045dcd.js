var T=Object.defineProperty;var C=(n,t,e)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var d=(n,t,e)=>(C(n,typeof t!="symbol"?t+"":t,e),e);class v{constructor(t,e,s){this.deadline=e,this.callback=s,this.$days=t.querySelector(".days"),this.$hours=t.querySelector(".hours"),this.$minutes=t.querySelector(".minutes"),this.$seconds=t.querySelector(".seconds"),this.timerId=null,this.countdownTimer.call(this),this.timerId=setInterval(this.countdownTimer.bind(this),1e3)}countdownTimer(){const t=this.deadline;let e=new Date(t)-new Date;e<=0&&(clearInterval(this.timerId),this.callback&&this.callback());const s=e>0?Math.floor(e/1e3/60/60/24):0,i=e>0?Math.floor(e/1e3/60/60)%24:0,o=e>0?Math.floor(e/1e3/60)%60:0,a=e>0?Math.floor(e/1e3)%60:0;this.$days.textContent=s<10?"0"+s:s,this.$hours.textContent=i<10?"0"+i:i,this.$minutes.textContent=o<10?"0"+o:o,this.$seconds.textContent=a<10?"0"+a:a,this.$days.dataset.title=this.declensionNum(s,["день","дня","дней"]),this.$hours.dataset.title=this.declensionNum(i,["час","часа","часов"]),this.$minutes.dataset.title=this.declensionNum(o,["минута","минуты","минут"]),this.$seconds.dataset.title=this.declensionNum(a,["секунда","секунды","секунд"])}reset(t){this.deadline=t,this.countdownTimer.call(this),this.timerId=setInterval(this.countdownTimer.bind(this),1e3)}declensionNum(t,e){return e[t%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]}}function E(n){let t=r(".adm-content")[0];if(!t)return;let e=document.createElement("div");e.classList.add("message"),e.classList.add("error"),e.innerText=n,t.prepend(e),setTimeout(s.bind(this),3e3);function s(){function i(){e.remove()}e.style.scale=0,setTimeout(i.bind(this),500)}}const _=()=>{const n=document.documentElement.scrollTop||document.body.scrollTop;n>0&&(window.requestAnimationFrame(_),window.scrollTo(0,n-n/8))},S=(n,t=700)=>{let e;return function(){const s=()=>n.apply(this,arguments);clearTimeout(e),e=setTimeout(s,t)}};function q(n){try{JSON.parse(n)}catch{return!1}return!0}let O={show:function(n,t){let e=this.el("div","popup__close");e.innerText="X";let s=this.el("div","popup__item");s.innerText=n,s.append(e);let i=r(".popup")[0];i||(i=this.el("div","popup")),i.append(s),i.addEventListener("click",this.close,!0),document.body.append(i);let o=5e3;setTimeout(()=>{s.classList.remove("popup__item"),s.classList.add("popup-hide")},o);let a=o+950;setTimeout(()=>{s.remove(),t&&t()},a)},close:function(n){n.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(n,t){let e=document.createElement(n);return e.classList.add(t),e}};function b(){return document.querySelector('meta[name="token"]').getAttribute("content")??null}function g(n,t="",e=""){let s=document.createElement(n);return t&&s.classList.add(t),s.innerText=e||"",s}class h{constructor(){this.attributes=[]}tag(t){return this.tag=t,this}className(t){return this._className=t,this}field(t){return this._field=t,this}text(t){return this._text=t,this}html(t){debugger;return this._html=t,this}attr(t,e){return this.attributes.push([t,e]),this}get(){let t=document.createElement(this.tag);return this._text&&(t.innerText=this._text),this._html&&(t.innerHTML=this._html),this._className&&t.classList.add(this._className),this._field&&(t.dataset.field=this._field),this.attributes.forEach((e,s)=>{t.setAttribute(e[0],e[1])}),t}}const $={m:60,h:60*60,d:60*60*24,mMs:60*1e3,hMs:60*60*1e3,dMs:60*60*24*1e3};async function u(n,t={}){return new Promise(async function(e,s){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?i.send(t):(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send("param="+JSON.stringify(t))),i.onerror=function(o){s(Error("Network Error"+o.message))},i.onload=function(){var o,a;try{if(!q(i.response)){console.log(i.response);return}const l=JSON.parse(i.response);let c=r(".message")[0];l!=null&&l.popup||(o=l==null?void 0:l.arr)!=null&&o.popup?O.show(l.popup??((a=l==null?void 0:l.arr)==null?void 0:a.popup)):l.msg?c&&(c.innerHTML=l.msg,r(c).removeClass("success"),r(c).removeClass("error")):l.success?c&&(c.innerHTML=l.success,r(c).addClass("success"),r(c).removeClass("error")):l.error&&(c.innerHTML=l.error,r(c).addClass("error"),r(c).removeClass("success"),E(l.error)),e(l)}catch{return console.log("////////////********* REQUEST ERROR ***********//////////////////////"),console.log(i.response),!1}}})}class L extends Array{constructor(){super(...arguments);d(this,"value",function(){return this[0].getAttribute("value")});d(this,"first",function(){return this[0]});d(this,"attr",function(e,s){return s&&this[0].setAttribute(e,s),this[0].getAttribute(e)});d(this,"selectedIndexValue",function(){if(this.length)return this[0].selectedOptions[0].value});d(this,"options",function(){if(this.length)return this[0].options});d(this,"count",function(){return this.length});d(this,"text",function(){if(this.length)return this[0].innerText});d(this,"checked",function(){if(this.length)return this[0].checked});d(this,"getWithStyle",function(e,s){let i=[];return this.forEach(o=>{o.style[e]===s&&i.push(o)}),i});d(this,"addClass",function(e){this.forEach(s=>{s.classList.add(e)})});d(this,"removeClass",function(e){this.forEach(s=>{s.classList.remove(e)})});d(this,"hasClass",function(e){if(this.classList.contains(e))return!0});d(this,"append",function(e){this[0].appendChild(e)});d(this,"find",function(e){return typeof e=="string"?this[0].querySelector(e):this[0].filter(i=>i===e)[0]});d(this,"findAll",function(e){if(typeof e=="string")return this[0].querySelectorAll(e)});d(this,"css",function(e,s){if(!s)return this[0].style[e];this.forEach(i=>{i.style[e]=s})})}on(e,s,i){typeof s=="function"?this.forEach(o=>o.addEventListener(e,s)):this[0].querySelectorAll(s).forEach(a=>{a.addEventListener(e,i)})}ready(e){this.some(i=>i.readyState!=null&&i.readyState!="loading")?e():document.addEventListener("DOMContentLoaded",e)}}function r(n){return typeof n=="string"||n instanceof String?new L(...document.querySelectorAll(n)):new L(n)}function M(n){return D(n)&&(document.cookie=n+"=; Max-Age=-1;"),!1}function D(n){return!!document.cookie.match("(^|;)?"+n+"=([^;]*)")}function I(){let n=r(".slider").first();if(!n)return!1;n.onclick=function({target:t}){if(t.classList.contains("slide")){let e=n.querySelector(".wrap");e.style.height?e.style.height="":e.style.height=e.scrollHeight+"px"}}}class A{constructor(){let t={get_cookie:function(s){let i=document.cookie.match("(^|;) ?"+s+"=([^;]*)(;|$)");return i?unescape(i[2]):null},delete_cookie:function(s){let i=new Date;i.setTime(i.getTime()-1),document.cookie=s+="=; expires="+i.toGMTString()},set_cookie:function(s,i,o,a,l,c,f,p){let m=s+"="+escape(i);if(o){let w=new Date(o,a,l);m+="; expires="+w.toGMTString()}c&&(m+="; path="+escape(c)),f&&(m+="; domain="+escape(f)),p&&(m+="; secure"),document.cookie=m}},e={get:(s,i)=>i in s?s[i]:t.get_cookie(i),set:(s,i,o)=>o?t.set_cookie(i,o):t.delete_cookie(i)};this.cookie=new Proxy(t,e)}}class k{constructor(t){this.modal=r("[data-modal='default']").first(),this.modal&&t.button&&(this.button=t.button,this.data=t.data,this.callback=t.callback,this.fieldsObj={},this.closeEl=r(this.modal).find(".modal-close"),this.title=r(this.modal).find(".title"),this.box=r(this.modal).find(".modal-box"),this.content=r(this.modal).find(".content"),this.footer=r(this.modal).find(".footer"),this.overlay=r(this.modal).find(".overlay"),this.check=r(".checkmark").first(),this.button.addEventListener("click",this.show.bind(this)),this.closeEl.addEventListener("click",this.close.bind(this)),this.overlay.addEventListener("click",this.close.bind(this)))}async show(){this.$submit=new h().tag("div").attr("type","submit").attr("class","button").attr("id","submit").text(this.data.submitText).get(),this.$submit.addEventListener("click",this.submit.bind(this)),this.content.innerHTML="",this.renderTitle(),this.renderFields(),this.renderContent(),this.renderFooter(),this.renderSubmitText(),this.modal.style.display="flex",setTimeout((function(){this.overlay.style.opacity=1,this.box.style.opacity=1,this.box.classList.remove("transform-out"),this.box.classList.add("transform-in")}).bind(this),1)}async renderFields(){let t=this.data.fields;for(let e in t)this.fieldsObj[e]=t[e].querySelector("input"),this.content.appendChild(t[e])}async renderContent(){for(let t in this.data.content)this.content.appendChild(this.data.content[t])}async renderFooter(){for(let t in this.data.footer)this.footer.appendChild(this.data.footer[t]);this.footer.appendChild(this.$submit)}renderTitle(){this.title.innerText=this.data.title??"Заголовок"}renderSubmitText(){this.$submit.innerText=this.data.submitText??"ok"}async submit(){this.callback(this.fieldsObj,this)}close(){this.box.classList.remove("transform-in"),this.box.classList.add("transform-out"),this.overlay.style.opacity=0,this.box.style.opacity=0,setTimeout((function(){this.modal.style.display="none",this.footer.innerHTML=""}).bind(this),500)}}let x=class{constructor(){this.title="Заголовок",this.submitText="OK",this.footer=[],this.content=[],this.fields=[]}};class F extends x{constructor(){super(),this.title="Заказ принят в обработку",this.submitText="Успешно"}setFooter(){this.footer.push(new h().tag("div").attr("id","submit").attr("class","button").text("ok").get())}setContent(){this.content.push(new h().tag("div").attr("class","text").text("Какое-то сообщение").get())}}class R{constructor(t){const{_type:e,_className:s,_hidden:i,_required:o,_name:a,_autocomplete:l,_pattern:c,_badgeWidth:f,_id:p,_placeholder:m,_errorEl:w}=t;return this.container=document.createElement("div"),this.container.classList.add("input-container"),this.input=document.createElement("input"),e&&(this.input.type=e),this.input.placeholder=" ",s&&this.input.classList.add(s),i&&(this.input.hidden=i),o&&(this.input.required=o),l&&(this.input.autocomplete=l),a&&(this.input.name=a),c&&(this.input.pattern=c),this.input.id=p,this.labelBadge=document.createElement("div"),this.labelBadge.classList.add("badge"),this.labelBadge.style.width=f,this.label=document.createElement("label"),this.label.innerText=m,this.label.htmlFor=p,this.container.append(this.input),this.container.append(this.labelBadge),this.container.append(this.label),w&&this.container.append(w),this.container}}class y{constructor(t){this._type="text",this._required=!1,this._badgeWidth="50px",this._id="name",this._placeholder="email",this._autocomplete=!1}id(t){return this._id=t,this}type(t){return this._type=t,this}hidden(){return this._hidden=!0,this}required(){return this._required=!0,this}name(t){return this._name=t,this}autocomplete(){return this._autocomplete=!0,this}placeholder(t){return this._placeholder=t,this}class(t){return this._class=t,this}pattern(t){let e=new RegExp(t);return this._pattern=e.source,this}badgeWidth(t){return this._badgeWidth=t,this}errorEl(t){return this._errorEl=t,this}get(){return new R(this)}}class H extends x{constructor(){super(),this.title="Вход",this.submitText="Войти",this.setFields()}setFields(){let t=new y().id("email").required().name("email").autocomplete().badgeWidth("55px").type("email").placeholder("email").get(),e=new y().id("password").required().name("password").autocomplete().pattern("[a-zA-Z0-9-_()]{6,}").badgeWidth("65px").placeholder("пароль").get();this.fields={email:t,password:e}}}class N extends x{constructor(){super(),this.title="Данные для связи",this.submitText="отправить данные",this.setFields(),this.setFooter()}setFooter(){this.footer.push(new h().tag("div").attr("class","button").text("Отправляя данные, вы соглашаетесь на обработку персональных данных").get())}setFields(){let t=new y().id("name").badgeWidth("150px").required().placeholder("как к Вам обращаться").pattern("[а-яА-Я]{1,}").get(),e=new y().id("phone").badgeWidth("130px").required().placeholder("сотовый для связи").pattern("[0-9-+_()]{6,17}").get(),s=new y().id("company").badgeWidth("175px").required().placeholder("название Вашей компании").pattern("[a-zA-Zа-яА-я\\s()]{3,}").get();this.fields={name:t,phone:e,company:s}}}class W{constructor(){let t=r(".user-content .cart .content").first();t&&(this.container=t,this.model=r(this.container).find("[data-model]").dataset.model,new k({button:r("#cartLead").first(),data:new N,callback:this.modalLeadCallback.bind(this)}),new k({button:r("#cartLogin").first(),data:new H,callback:this.modalLoginCallback.bind(this)}),new k({button:r("#cartSuccess").first(),data:new F,callback:this.modalcartSuccessCallback.bind(this)}),this.total=t.querySelector(".total span"),this.$cartEmptyText=document.querySelector(".empty-cart"),this.rows=t.querySelectorAll(".row"),this.container.onclick=this.handleClick.bind(this),this.container.onchange=this.rerenderSums.bind(this),this.cookie=new A,this.counterEl=r("#counter").first(),this.cartLifeMs=$.mMs*30,this.counterEl&&this.counterStart(),this.rerenderSums())}async modalLeadCallback(t,e){let s=t.name.value,i=t.phone.value,o=t.company.value,a=b(),l=await u("/cart/lead",{name:s,phone:i,company:o,sess:a});e.close(),l&&location.reload()}async modalcartSuccessCallback(t,e){e.close()}async modalLoginCallback(t,e){let s=t.email.value,i=t.password.value,o=b(),a=await u("/cart/login",{email:s,password:i,sess:o});e.close(),a&&location.reload()}rerenderSums(){if(!this.rows.length)return!1;let t=new Intl.NumberFormat("ru-RU"),e=[].reduce.call(this.rows,(s,i,o,a)=>{let l=i.querySelector(".price").dataset.price,c=i.querySelector("input").value,f=i.querySelector("[data-multiplier]").value,p=l*c*f;return i.querySelector(".sum").innerText=t.format(p.toFixed(2)).replace(/,/g,"."),s+=p,s},0);this.total.innerText=t.format(e.toFixed(2)).replace(/,/g,".")}counterStart(){if(r(this.container).find(".row")){let e=+this.cookie.cookie.get_cookie("cartDeadline");if(e-Date.now()>=0)this.cookie.cookie.set_cookie("cartDeadline",e),this.counter=new v(this.counterEl,e,this.counterCallback.bind(this));else{let i=this.getDeadline();this.cookie.cookie.set_cookie("cartDeadline",i),this.counter=new v(this.counterEl,i,this.counterCallback.bind(this))}}else this.counterCallback()}getDeadline(){return this.cartLifeMs+Date.now()}counterCallback(){this.nullifyCookie(),this.dropCart()}nullifyCookie(){M("cartDeadline")}counterReset(){let t=this.getDeadline();this.cookie.cookie.set_cookie("cartDeadline",t),this.counter?this.counter.reset(t):this.counter=new v(this.counterEl,t,this.counterCallback.bind(this))}async dropCart(){var s;let t=b(),e=await u("/cart/drop",{cartToken:t});(s=e==null?void 0:e.arr)!=null&&s.ok&&this.showEmptyCart()}orderItemDTO(t){let e=t.closest(".row");return{sess:b(),product_id:e.dataset.productId}}getRows(){return[].map.call(this.rows,e=>({id:e.querySelector(".name").dataset["1sid"],count:e.querySelector(".count").value}))}async handleClick({target:t}){if(t.classList.contains("del"))this.deleteOItem(t);else if(t.classList.contains("count"))this.rerenderSums(),this.updateOItem(t);else if(t.classList.contains("plus")){let e=t.closest(".step-field").querySelector("input");e.value++,this.rerenderSums()}else if(t.classList.contains("minus")){let e=t.closest(".step-field").querySelector("input");e.value--,this.rerenderSums()}}async deleteOItem(t){var i;let e=this.orderItemDTO(t),s=await u(`/adminsc/${this.model}/delete`,{...e});(i=s==null?void 0:s.arr)!=null&&i.ok&&(t.closest(".row").remove(),this.countRows()<1&&this.showEmptyCart())}countRows(){return document.querySelectorAll(".row").length}showEmptyCart(){this.container.innerHTML="",this.$cartEmptyText.classList.remove("none")}async updateOItem(t){let e=t.closest(".row").dataset.productId,s=t.value,i=b();await u("/adminsc/orderItem/updateOrCreate",{sess:i,product_id:e,count:s})}}let P=r(".category").first();P&&B();function B(){I();let n=r(".hoist").first();n&&(n.onclick=function(){_()});let t=r(".filters .wrap").first();if(!t)return!1;t.onchange=({target:e})=>{let o=e.closest(".filter").querySelector("input").id;new V(o)}}class V{constructor(t){this.instoreEls=document.querySelectorAll(".product[data-instore='0']"),this.priceEls=document.querySelectorAll(".product[data-price='0']"),this.func={instore:"instore",price:"price"},this._init(t)}_init(t){this[this.func[t]]()}instore(){this.instoreEls.forEach(t=>{t.classList.toggle("show")})}price(){this.priceEls.forEach(t=>{t.classList.toggle("show")})}}class U{constructor(t=!1){this.admin=t;let e=r(".utils .search").first(),s=r(".search-panel").first();!e||!s||(this.button=e,this.panel=s,this.text=r(s).find(".text"),this.result=r(s).find(".result"),this.closeBtn=r(s).find(".close"),this.button.onclick=this.showPanel.bind(this),this.panel.onclick=this.closePanel.bind(this),this.debouncedKeyUp=S(this.find,800),this.text.onkeyup=this.debouncedKeyUp.bind(this),this.closeBtn.onklick=this.closePanel.bind(this))}showPanel(){this.panel.classList.toggle("show"),this.result.innerHTML="",this.text.value=""}closePanel({target:t}){(t.classList.contains("search-panel")||t.classList.contains("close"))&&(this.panel.classList.toggle("show"),this.result.innerHTML="",this.text.value="")}async find({target:t}){var i,o;this.result.innerHTML="";let e=t.value;if(!e)return!1;let s=await u("/search",{text:e});(i=s==null?void 0:s.arr)!=null&&i.found&&(this.result.style.display="initial",this.makeString((o=s==null?void 0:s.arr)==null?void 0:o.found))}makeString(t){t.map(e=>{this.result.append(this.createLi(e))})}composeHref(t){return this.admin?`/adminsc/product/edit/${t.id}`:`/product/${t.slug}`}createLi(t){let e=g("li"),s=g("a");s.href=this.composeHref(t),e.appendChild(s);let i=g("div","name",t.name),o=g("div","art",t.art),a=g("img");return a.src=t.mainImagePath,s.append(o),s.append(i),s.append(a),e.append(s),e}}class J{constructor(t){var e,s;t&&(this.options=j(t.querySelectorAll("option")),this.sel=new h().tag("div").className(t==null?void 0:t.className).field(t.dataset.field).attr("select-new","").attr("data-value",((e=this==null?void 0:this.selectedOption)==null?void 0:e.value)??"").attr("tabindex","0").get(),t.after(this.sel),this.label=document.createElement("span"),this.sel.append(this.label),this.space=new h().tag("div").attr("class","space").text((s=this==null?void 0:this.selectedOption)==null?void 0:s.label).get(),this.label.append(this.space),this.arrow=new h().tag("div").attr("class","arrow").get(),this.label.append(this.arrow),this.ul=new h().tag("ul").attr("class","options").get(),this.options.forEach(i=>{X(i,this)}),this.sel.append(this.ul),this.label.onclick=()=>this.ul.classList.toggle("show"),this.sel.onblur=()=>this.ul.classList.remove("show"),this.sel.onkeydown=this.keyDownhandler,t.remove())}onchange(t){this.callback=t}keyDownhandler(t){let e,s="";if(t.code==="Space")select.ul.classList.toggle("show");else if(t.code==="ArrowUp"){const i=select.options[select.selectedOptionIndex-1];i&&select.selectValue(i.value)}else if(t.code==="ArrowDown"){const i=select.options[select.selectedOptionIndex+1];i&&select.selectValue(i.value)}else if(t.code==="Enter"||t.code==="Escape")select.ul.classList.remove("show");else{clearTimeout(e),s+=t.key,e=setTimeout(()=>{s=""},500);const i=t.target.options.find(o=>o.label.toLowerCase().startsWith(s));i&&select.selectValue(i.value)}}get selectedOption(){return this.options.find(t=>t.selected)}get selectedOptionIndex(){return this.options.indexOf(this.selectedOption)}selectValue(t){const e=this.options.find(i=>i.value===t),s=this.selectedOption;s.selected=!1,e.selected=!0,this.space.innerText=e.label,this.sel.dataset.value=e.value,s.element.classList.remove("selected"),e.element.classList.add("selected"),e.element.scrollIntoView({block:"nearest"}),this.sel.dispatchEvent(new CustomEvent("customSelect.changed",{bubbles:!0,detail:{next:e,prev:s,target:this.sel}}))}}function X(n,t){const e=new h().tag("li").text(n.label).attr("data-value",n.value).get();n.selected&&e.classList.add("selected"),e.onclick=({target:s})=>{t.selectValue(n.value),t.ul.classList.remove("show")},t.ul.append(e)}function j(n){return[...n].map(t=>({value:t.value,label:t.label,selected:t.selected,element:t}))}class K{constructor(){if(this.$promotion=r(".promotion-edit").first(),!this.$promotion)return;this.id=r(this.$promotion).find("[data-field='id']").innerText,this.$activeTill=r("[data-field='active-till']").first(),this.$activeTill.onchange=this.activetillChanged.bind(this),this.$unit=r("[select-new].unit").first(),new J(this.$unit),r('[data-field="unit"]').first().addEventListener("customSelect.changed",this.unitChanged.bind(this))}unitChanged(t){let e=this.dto(this);e.unit_id=t.detail.next.value,u("/adminsc/promotion/updateOrCreate",e)}activetillChanged({target:t}){let e=this.dto(this);e.active_till=t.value,u("/adminsc/promotion/updateOrCreate",e)}dto(t){return{id:t.id}}}document.addEventListener("DOMContentLoaded",function(){r(".gamburger")[0]&&r(".gamburger").on("click",t),new K;function t(e){e.target.closest(".utils").querySelector(".mobile-menu").classList.toggle("show")}new U,new W});
