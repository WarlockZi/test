<?php

use app\view\components\CustomCatalogItem\CustomCatalogItem;

if ($item) {
	return getHtml($item, $this);
} else {
	return noElement($this);
}


function getHtml($item, \app\controller\Controller $controller)
{
	$options = getOptions($item, $controller);
	$t = new CustomCatalogItem($options);
	return $t->html;
}


function getOptions($item, $model)
{
	$options = [
		'item' => $item,
		'modelName' => $model->model,
		'tableClassName' => $model->table,
		'pageTitle' => '',

//    'tabs' => [
//      ['title' => 'Права',
//        'html' => getRights($item),
//        'field' => 'rights'
//      ]
//    ],

		'fields' => [
			'id' => [
				'className' => 'id',
				'field' => 'id',
				'name' => 'ID',
				'contenteditable' => false,
				'data-type' => 'number',
			],

		  'isTest' => [
				'className' => 'id',
				'field' => 'id',
				'name' => $item['isTest']?'Тест':'Папка',
				'contenteditable' => false,
				'data-type' => 'string',
			],

			'name' => [
				'className' => 'name',
				'field' => 'name',
				'name' => 'Имя',
				'contenteditable' => 'contenteditable',
				'data-type' => 'string',
			],
//			'isTest' => [
//				'className' => 'isTest',
//				'field' => 'isTest',
//				'name' => $item['isTest'],
//				'contenteditable' => false,
//				'data-type' => 'number',
//			],

			'enable' => [
				'className' => 'enable',
				'field' => 'enable',
				'name' => 'Показывать пользователю',
				'contenteditable' => 'select',
				'html' => getEbabled($item),
				'data-type' => 'select',
			],
			'parent' => [
				'className' => 'enable',
				'field' => 'opentest_id',
				'name' => 'Лежит в папке',
				'contenteditable' => 'select',
				'html' => getParent($item),
				'data-type' => 'select',
			],
		],
		'delBttn' => true,
		'saveBttn' => true,
//		'toListBttn' => true,
	];

//  if (User::can($item, ['role_admin'])) {
//    $options['fields'] = $options['fields'] + getConfirmRow($item);
//    $options['fields'] = $options['fields'] + getHiredRow($item);
//    $options['fields'] = $options['fields'] + getFiredRow($item);
//  }

	return $options;
}

function getEbabled($item)
{
	$enable = new \app\view\components\CustomSelect\CustomSelect([
		'className' => 'value',
		'title' => '',
		'field' => 'enable',
		'optionName' => 'name',
		'tree' => ['0' => 'не показывать', '1' => 'показывать'],
		'selected' => $item['enable'],
	]);
	return $enable->html;
}

function getParent($item)
{
	$r = new \app\model\Opentest();
	$s = $r::findAllWhere('isTest', '0');
	$r->data = $s;
	$tree = $r->tree('opentest_id');

	$parent = new \app\view\components\CustomSelect\CustomSelect([
		'className' => 'value',
		'title' => '',
		'field' => 'opentest_id',
		'optionName' => 'name',
		'initialOption' => true,
		'initialOptionValue' => 0,
		'tree' => $tree,
		'selected' => $item['opentest_id'],
	]);
	return $parent->html;
}


function noElement($controller)
{
	ob_start();
	?>
	<div class="no-element">
		<div class="error">Тест не найден</div>
	</div>
	<?
	return ob_get_clean();
}



