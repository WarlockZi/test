<?php

namespace app\controller\Admin;

use app\controller\AppController;
use app\core\Auth;
use app\core\Response;
use app\model\Openquestion;
use app\model\Opentestresult;
use app\model\User;
use app\Repository\OpenTestRepository;

class OpentestresultController extends AppController
{
   public function __construct()
   {
      parent::__construct();

   }

   public function actionFinish()
   {
      if (!$this->ajax) Response::exitWithPopup('Нет данных');
      if (Opentestresult::create($this->ajax)) {
         Response::exitWithPopup('ok');
      }
   }

   public function actionGetAnswers(): void
   {
      $id = $this->ajax['id'];
      $questions = OpenTestRepository::getAnswers($id);

      if ($questions) {
         Response::exitJson($questions);
      }
   }

   public function actionIndex(): void
   {
      $res = Opentestresult::all()->toArray();
      $del = User::can(Auth::getUser(), ['test-results_del']) ? 'del' : '';
      $this->set(compact('res','del'));
   }

   public function actionResult()
   {
      $id = $this->route['id'];
      $res = Opentestresult::where('id', $id)->get()->toArray();
      $this->set(compact('res'));
//		exit($res['html']);
   }


   public function actionDelete(): void
   {
      $id = $this->ajax['id'];

      Opentestresult::delete($id);
      Response::exitWithPopup('ok');
   }

}
