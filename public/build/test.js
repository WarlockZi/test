/*! For license information please see test.js.LICENSE.txt */
(()=>{"use strict";var e={"./public/jscss/Test/do.js":(e,t,a)=>{a.r(t);a("./public/jscss/common.js"),a("./public/jscss/Test/do.scss");window.onload=function(){}},"./public/jscss/Test/edit/edit.js":(e,t,a)=>{a.r(t);a("./public/jscss/Test/edit/edit.scss");window.onload=function(){$("body").on("click",".add-test, .test-params",(function(){document.querySelector(".testParamsBorder")&&$(".testParamsBorder").remove();var e=$(this).data("testid");$.ajax({url:PROJ+"/test/edit",type:"POST",data:{testId:e,action:"testParams"},success:function(e){$(".wrap").after(e),$(".overlay").add(".testParamsBorder").fadeIn()}})})),$("body").on("click","#TestParamsDEL",(function(){var e=+$(".testId").text();$.ajax({url:PROJ+"/test/edit",type:"POST",data:{tId:e,action:"tDel"},cache:!1,success:function(t){confirm("Удалить тест?")&&($(".testParamsBorder").hide(100,(function(){$(this).remove(),$("body .test-params[data-testid ="+e+"]").parent().add(".overlay").remove()})),$('[href="/test/edit/'+e+'"]').parent().remove())},error:function(){alert("Тест не удалился.")}})})),$("body").on("click","#saveTestParmsCansel, .overlay",(function(){$(".testParamsBorder").add(".overlay").fadeOut(400,(function(){$(this).remove()}))})),$("body").on("click","#saveTestParamsOK",(function(){var e=+$(".testId").text(),t=$("#saveTestName").val(),a=+$("#selectParenTest option:selected").val(),s=+$("#isTest option:selected").val(),n=+$(".sort input").val(),i=$("input[data-test-id]").prop("checked")?1:0;if($("input[data-test-id]").prop("checked"))i=1;else i=0;if(e)$.ajax({url:PROJ+"/test/edit",type:"POST",data:{action:"tUpd",testId:e,testName:t,parentTest:a,isTest:s,sort:n,enable:i},cache:!1,success:function(t){t?($('a[href="'+PROJ+"/edit/"+e+'"]').text(t),$(".test-name").text("Тест - "+t),$(".testParamsBorder").add(".overlay").hide(100,(function(){$(this).remove()}))):window.alert("Заполнитe название")},error:function(){window.alert("Обновление не прошло")}});else{if(!t)return void window.alert("Укажите название теста");$.ajax({url:PROJ+"/test/edit",type:"POST",data:{action:"tAdd",testId:e,test_name:t,parentTest:a,isTest:s,sort:n,enable:i},success:function(e){var t=JSON.parse(e);if($(".test-name")){var a='<p class="test-name" name = "test_id" value = "1">Тест - '+t.testName+"</p>"+t.pagination+t.question+t.answer;$(".content").html(a),$(".content .block").show()}else $("div.block").remove(),$(".test-name").after(t.answer),$(".test-name").after(t.question);$(".testParamsBorder").add(".overlay").fadeOut(150),$(".menu").append(t.menuItem)},error:function(){}})}})),$("body").on("change","input[data-q-sort]",(function(){t("save_q",null,+$(this).data("q-sort"))})),$("body").on("change","textarea[data-question-id]",(function(){t("save_q",null,+$(this).data("question-id"))})),$("body").on("change","textarea[data-answer-id]",(function(){t("save_a",$(this).data("answer-id"))})),$("body").on("change","input[data-answer]",(function(){t("save_a",$(this).data("answer"))})),$(".add-question").on("click",(function(){var e=+$(".test-name").attr("value"),t=document.querySelectorAll(".pagination>[class$='active']").length-1;$.ajax({url:`${PROJ}/test/edit`,type:"POST",data:{action:"qAdd",testid:e,questQnt:t+1},cache:!1,success:function(e){var t=JSON.parse(e);$(".pagination>.nav-active").removeClass("nav-active").addClass("p-no-active"),$(".pagination>a:last").before(t.pagination),$(".pagination>a:last").text("+"),$(".block:visible").hide(),$(".block:last").after(t.block),$(".content .block:last").show(200),a()},error:function(){alert("Произошел сбой.")}})})),$("body").on("click",".add-answer",(function(){var e=+$(this).data("id");$.ajax({url:PROJ+"/test/edit",type:"POST",data:{action:"aAdd",qid:e},cache:!1,success:function(t){document.querySelectorAll(".holder"),$('.e-block-q[id = "'+e+'q"]').siblings(".e-block-a").last().after(t);setTimeout((function(){a()}),150)},error:function(){}}),a()}));var e=$(".pagination").find(".nav-active").attr("href");function t(e,a,s,n,i){var o="test";if(window.location.pathname.indexOf("freetest")+1&&(o="freetest"),"save_q"==e){var r=$('#imq[data-id = "'+s+'"]').attr("src"),c=$.trim($('textarea[name = "'+s+'q"]').val()),d=$.trim($("input[data-q-sort = "+s+"]").val()),l=($.trim($("input[data-q-sort = "+s+"]").val()),{action:"qUpd",data:l,qid:s,qpic:r,qtext:c,sort:d}),u=`${PROJ}/${o}/edit`;$.ajax({url:u,type:"POST",data:l})}else if("save_a"==e){var p=$('#ima[data-id = "'+a+'"]').attr("src"),m=(c=$.trim($("textarea[name = "+a+"]").val()),$("#right_answer"+a).prop("checked")?"1":"0");u=PROJ+`/${o}/edit`;$.ajax({url:u,type:"POST",data:{action:"aUpd",aid:a,apic:p,atext:c,right_answer:m},cache:!1})}else if("delete_a"==e){u=PROJ+"/test/edit";$.ajax({url:u,type:"POST",data:{aid:a,qid:s,action:e},cache:!1,success:function(e){if(+e>1)confirm("Удалить ответ?")&&$("#"+a).slideUp(200,(function(){$(this).remove()}));else{if(!confirm("Это последний ответ для данного вопроса. Если его удалите, удалится и весь вопрос. Удалять?"))return;t("delete_q_a",a,s)}},error:function(){alert("Ошибка при удалении")}})}else if("delete_q_a"==e){$(".pagination>a.nav-active ").text();$.ajax({url:PROJ+"/test/edit",type:"POST",data:{action:"delete_q_a",aid:a,qid:s},cache:!1,success:function(e){$("#"+s+"q").parent().add(".pagination>a.nav-active ").slideUp(400,(function(){$(this).remove(),$(".pagination>a").each((function(e,t){e++,$(this).text(""+e)}))}))},error:function(){alert("Ошибка при удалении")}})}else"del_a_q_pic"==e&&$.ajax({url:`${PROJ}/${o}/edit`,type:"POST",data:{action:"aqPicDel",aid:a,qid:s},cache:!1,success:function(e){$("#ima"+a).remove(),$("#imq"+s).remove()},error:function(){alert("Ошибка при удалении")}})}function a(){var e=document.getElementsByClassName("holder"),t={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest},a={filereader:document.querySelectorAll(".filereader"),formdata:document.querySelectorAll(".formdata"),progress:document.querySelectorAll(".progress")},s={"image/png":!0,"image/jpeg":!0,"image/gif":!0},n=(document.getElementById("uploadprogress"),document.getElementById("upload")),o="filereader formdata progress".split(" ");for(var r in o)if(!1===t[o[r]])a[o[r]].className="fail";else{collItem=a[o[r]];for(var c=0;c<collItem.length;++c){collItem[c].className="hidden"}}if(t.dnd)for(i=0;i<e.length;i++)e[i].ondragover=function(){return this.className="hover",!1},e[i].ondragleave=function(){return this.className="holder",!1},e[i].ondrop=function(e){this.className="holder",e.preventDefault(),l(e.dataTransfer.files,this)};else n.className="hidden",n.querySelector("input").onchange=function(){l(this.files)};function d(a,n){if(!0===t.filereader&&!0===s[a.type]){var i=n,o=new FileReader;o.onload=function(e){0==!i.getElementsByTagName("img").length&&i.getElementsByTagName("img")[0].remove();var t=new Image;"q"==i.getAttribute("data-prefix")?t.id="imq"+i.getAttribute("id"):"a"==i.getAttribute("data-prefix")&&(t.id="ima"+i.getAttribute("id")),t.src=e.target.result,t.width=150,i.appendChild(t)},o.readAsDataURL(a)}else e.innerHTML+="<p>Загружен "+a.name+" "+(a.size?(a.size/1024|0)+"K":""),console.log(a)}function l(e,a){for(var s=t.formdata?new FormData:null,n=0;n<e.length;n++){var i=a.getAttribute("data-prefix"),o=a.id;t.formdata&&(s.append("file",e[n]),d(e[n],a))}if(s.append("pref",i),s.append("fid",o),t.formdata){var r=new XMLHttpRequest,c="test";window.location.pathname.indexOf("freetest")+1&&(c="freetest"),r.open("POST",`${PROJ}/${c}/edit`,!0),r.send(s),r.onreadystatechange=function(){4==r.readyState&&200!=r.status&&alert(r.status+": Ошибка"+r.statusText)}}}}$(".content").add(".test-data").find(e).show(),$(".pagination").on("click",".p-no-active",(function(){if("nav-active"==$(this).attr("class"))return!1;var e=$(this).attr("href"),t=$(".pagination>a.nav-active ").attr("href");return $(".pagination>.nav-active").removeClass("nav-active").addClass("p-no-active"),$(this).removeClass("p-no-active").addClass("nav-active"),0!==$(t)?$(t).fadeOut(100,(function(){"#"!=e&&$(e).fadeIn(100)})):$(e).fadeIn(100),!1})),$("body").on("click",".pic-del",(function(){t("del_a_q_pic",$(this).data("a"),$(this).data("q"))})),a()}},"./public/jscss/common.js":(e,t,a)=>{a.r(t),a.d(t,{post:()=>i,get:()=>n,uniq:()=>s});const s=e=>Array.from(new Set(e));async function n(e){var t=window.location.search;return!!(t=t.match(new RegExp(e+"=([^&=]+)")))&&t[1]}async function i(e,t){return new Promise((function(a,s){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send("param="+JSON.stringify(t)),n.onerror=function(){s(Error("Network Error"))},n.onload=function(){a(n.response)}}))}},"./public/jscss/components/header/autocomplete.js":(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});a("./public/jscss/components/header/autocomplete.sass");async function s(e){if(e.length<1)s.innerHTML="";else{var t=await async function(e){let t=await fetch("/search?q="+e);return await t.json()}(e),a="<ul>";t.forEach((e=>{a+=`<li><a href = '${e.alias}'><img src='/pic/${e.preview_pic}' alt='${e.name}'>`+e.name+"</a></li>"})),a+="</ul>";var s=document.querySelector(".result-search");s.innerHTML=a,document.querySelector("body").addEventListener("click",(function(e){const t=document.querySelector(".result-search ul");document.querySelector(".result-search ul")&&e.target!==t&&t.remove()}))}}window.onload=function(){document.querySelector("#autocomplete").addEventListener("input",(function(){s(this.value)}))};const n=s},"./public/jscss/components/header/header.js":(e,t,a)=>{a.r(t);a("./public/jscss/components/header/top.sass"),a("./public/jscss/components/header/middle.sass"),a("./public/jscss/components/header/header-menu.sass"),a("./public/jscss/components/header/header.sass"),a("./public/jscss/components/header/autocomplete.js"),a("./public/jscss/components/header/header-panel.sass")},"./public/jscss/components/test-pagination/test-pagination.js":(e,t,a)=>{a.r(t);a("./public/jscss/components/test-pagination/test-pagination.scss");window.onload=function(){document.querySelector(".test-data .question:first-child").style.display="flex",document.querySelector("[data-pagination]:first-child").classList.add("nav-active"),document.querySelector(".pagination").addEventListener("click",(function(e){let t=e.target;if(t.classList.contains("pagination"))return;let a=t.closest("[data-pagination]");if(a.classList.contains("nav-active"))return;let s=document.querySelector(".pagination .nav-active");s.classList.remove("nav-active"),a.classList.add("nav-active");let n=`.question[data-id="${s.dataset.pagination}"]`;document.querySelector(n).style.display="none";let i=`.question[data-id="${a.dataset.pagination}"]`;document.querySelector(i).style.display="flex"}))}},"./public/jscss/Test/do.scss":(e,t,a)=>{a.r(t)},"./public/jscss/Test/edit/edit.scss":(e,t,a)=>{a.r(t)},"./public/jscss/components/footer/footer.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/autocomplete.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/header-menu.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/header-panel.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/header.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/middle.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/header/top.sass":(e,t,a)=>{a.r(t)},"./public/jscss/components/test-pagination/test-pagination.scss":(e,t,a)=>{a.r(t)}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{a.r(s);a("./public/jscss/Test/do.js"),a("./public/jscss/Test/edit/edit.js"),a("./public/jscss/components/header/header.js"),a("./public/jscss/components/test-pagination/test-pagination.js"),a("./public/jscss/components/footer/footer.sass")})()})();
//# sourceMappingURL=test.js.map