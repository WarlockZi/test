{"version":3,"file":"catalog-item-pvgq4YRa.js","sources":["../../src/components/date/date.js","../../src/components/checkbox/checkbox.js","../../src/Admin/RelationDTO.js","../../src/Admin/components/catalog-item/catalog-item.js"],"sourcesContent":["import { fragmentDate } from \"../../common\";\r\nimport \"./date.scss\";\r\nimport { ael } from \"@src/constants.js\";\r\n\r\nexport default class CustomDate {\r\n  constructor(date) {\r\n    this.date = date;\r\n    this.date[ael](\"change\", this.onChange.bind(this));\r\n  }\r\n\r\n  onChange({ target }) {\r\n    const { yyyy, mm, dd } = fragmentDate(target.value);\r\n    const formated = `${yyyy}-${mm}-${dd}`;\r\n    target.setAttribute(\"data-value\", formated);\r\n    const customEvent = new CustomEvent(\"date.changed\", {\r\n      bubbles: true,\r\n      cancelable: true,\r\n      detail: { value: formated },\r\n    });\r\n    target.dispatchEvent(customEvent);\r\n  }\r\n}\r\n","import { ael } from \"@src/constants.js\";\r\n\r\nexport default class Checkbox {\r\n  constructor(checkbox) {\r\n    this.id = checkbox.id;\r\n    this.checkbox = checkbox;\r\n    // this.field = checkbox?.dataset?.field ?? null;\r\n    checkbox[ael](\"change\", this.changed.bind(this));\r\n  }\r\n\r\n  async changed({ target }) {\r\n    target.dataset.pivotValue = +target.checked;\r\n    this.checkbox.dispatchEvent(\r\n      new CustomEvent(\"checkbox.changed\", {\r\n        bubbles: true,\r\n        detail: target.checked,\r\n      }),\r\n    );\r\n  }\r\n}\r\n","export default class RelationDTO {\r\n  constructor(target, prev) {\r\n    if (!target) return;\r\n    this.target = target;\r\n    //model\r\n    this.id = target?.closest(\".item-wrap\")?.dataset?.id;\r\n\r\n    // this.fields = target?.dataset?.field ?? false\r\n\r\n    this.relation =\r\n      target?.dataset?.relation ??\r\n      target?.closest(\"[data-relation]\")?.dataset?.relation ??\r\n      false;\r\n\r\n    this.pivot =\r\n      target?.dataset?.pivot ?? target?.parentNode?.dataset?.pivot ?? false;\r\n    this.attach =\r\n      !!this.target?.closest(\"[custom-table]\")?.dataset?.relationtype;\r\n\r\n    if (this.fields) {\r\n      this.fields = {\r\n        [target?.dataset?.field]:\r\n          target?.dataset?.value ?? target?.checked ?? target?.innerText,\r\n      };\r\n    }\r\n\r\n    if (this.relation) {\r\n      const name = this.relation;\r\n      this.relation = {};\r\n      this.relation.name = name;\r\n      this.relation.id =\r\n        target?.dataset?.value ??\r\n        target?.dataset?.id ??\r\n        0 ??\r\n        target?.closest(\"[data-relation]\")?.dataset?.relation ??\r\n        0;\r\n\r\n      if (this.attach && !this.pivot) {\r\n        this.relation.attach =\r\n          this.target?.dataset?.id ?? this.target?.dataset.value;\r\n        this.relation.detach = prev ?? null;\r\n      } else if (this.pivot) {\r\n        delete this.attach;\r\n        this.relation.pivot = {};\r\n        this.relation.pivot[target?.dataset?.pivot] =\r\n          target?.dataset?.value ?? target?.checked ?? target?.innerText;\r\n      } else {\r\n        this.relation.fields = {};\r\n        const fieldName = target?.dataset?.field ?? target?.dataset.pivot;\r\n        this.relation.fields[fieldName] =\r\n          target?.dataset?.value ?? target?.checked ?? target?.innerText;\r\n      }\r\n    }\r\n    if (!this.fields) delete this.fields;\r\n    if (!this.relation) delete this.relation;\r\n    delete this.attach;\r\n    delete this.pivot;\r\n    delete this.target;\r\n  }\r\n}\r\n","import \"./catalog-item.scss\";\r\nimport { $, debounce, post } from \"../../../common.js\";\r\nimport { ael } from \"../../../constants.js\";\r\nimport DTO from \"../../../Admin/DTO.js\";\r\nimport Checkbox from \"../../../components/checkbox/checkbox.js\";\r\nimport SelectNew from \"../../../components/select/SelectNew.js\";\r\nimport CustomDate from \"../../../components/date/date.js\";\r\nimport RelationDTO from \"@src/Admin/RelationDTO.js\";\r\n\r\nexport default class CatalogItem {\r\n  constructor(catalogItem) {\r\n    if (!catalogItem) return false;\r\n\r\n    this.model = catalogItem.dataset.model;\r\n    this.id = +catalogItem.dataset.id;\r\n    this.setCheckboxes();\r\n    this.setSelects();\r\n    this.setDates();\r\n\r\n    catalogItem[ael](\"click\", this.handleClick.bind(this));\r\n    catalogItem[ael](\"keyup\", debounce(this.handleKeyup.bind(this)));\r\n    catalogItem[ael](\"date.changed\", this.handleDateChange.bind(this));\r\n    catalogItem[ael](\r\n      \"customSelect.changed\",\r\n      this.handleSelectChange.bind(this),\r\n    );\r\n    if (this.model) {\r\n      catalogItem[ael](\"checkbox.changed\", this.handleChexboxChange.bind(this));\r\n    }\r\n  }\r\n\r\n  setCheckboxes() {\r\n    const checks = $(\"[my-checkbox]\");\r\n    [].forEach.call(checks, function (check) {\r\n      new Checkbox(check);\r\n    });\r\n  }\r\n\r\n  setDates() {\r\n    const dates = $(\"[custom-date]\");\r\n    [].forEach.call(dates, function (date) {\r\n      new CustomDate(date);\r\n    });\r\n  }\r\n\r\n  setSelects() {\r\n    const selects = $(\"[select-new]:has(option)\");\r\n    [].forEach.call(selects, function (select) {\r\n      if (!select.parentNode.hasAttribute(\"hidden\")) new SelectNew(select);\r\n    });\r\n  }\r\n\r\n  handleChexboxChange({ target }) {\r\n    if (target.closest(\"[custom-table]\")) return;\r\n    this.update(target);\r\n  }\r\n\r\n  async handleSelectChange({ target }) {\r\n    if (target.closest(\"[custom-table]\")) return;\r\n    this.update(target);\r\n  }\r\n\r\n  async handleDateChange({ target }) {\r\n    this.update(target);\r\n  }\r\n\r\n  async handleKeyup({ target }) {\r\n    if (target.closest(\".custom-table\")) return false;\r\n    if (!target.hasAttribute(\"contenteditable\") || !target.dataset.field)\r\n      return false;\r\n    let dto = {};\r\n    if (target.dataset.relation) {\r\n      dto = new RelationDTO(target);\r\n    } else {\r\n      dto = new DTO(this.id, target);\r\n    }\r\n    const res = await post(`/adminsc/${this.model}/updateOrCreate`, dto);\r\n    if (res) {\r\n      target.dispatchEvent(\r\n        new CustomEvent(\"catalogItem.changed\", {\r\n          bubbles: true,\r\n          detail: { res },\r\n        }),\r\n      );\r\n    }\r\n  }\r\n\r\n  async handleClick({ target }) {\r\n    if (target.classList.contains(\"tab\")) {\r\n      this.handleTabClick(target);\r\n    }\r\n  }\r\n\r\n  handleTabClick(target) {\r\n    $(`[data-tab].show`).first().classList.toggle(\"show\");\r\n    $(`[data-tab='${target.dataset.tabId}']`).first().classList.toggle(\"show\");\r\n    $(`.tab.active`).first().classList.toggle(\"active\");\r\n    target.classList.toggle(\"active\");\r\n  }\r\n\r\n  async update(target) {\r\n    if (target.closest(\"[custom-table]\")) return;\r\n    const dto = new DTO(this.id, target);\r\n    const res = await post(`/adminsc/${this.model}/updateorcreate`, dto);\r\n  }\r\n}\r\n"],"names":["CustomDate","date","ael","target","yyyy","mm","dd","fragmentDate","formated","customEvent","Checkbox","checkbox","RelationDTO","prev","name","fieldName","CatalogItem","catalogItem","debounce","checks","$","check","dates","selects","select","SelectNew","dto","DTO","res","post"],"mappings":"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"}