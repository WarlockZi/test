{"version":3,"file":"SelectNew-BqDwYFQX.js","sources":["../../src/components/select/SelectNew.js"],"sourcesContent":["import './selectNew.scss'\r\n\r\nimport {$, createElement} from \"../../common\";\r\n\r\nexport default class SelectNew {\r\n   constructor(el) {\r\n      if (!el | !$(el).find('option')) return;\r\n\r\n      this.ul = (new createElement()).tag(\"ul\").attr('class', \"options\").get();\r\n      this.label = (new createElement()).tag(\"span\").get();\r\n\r\n      this.options = this.getFormattedOptions(el.querySelectorAll(\"option\"));\r\n\r\n      this.space = (new createElement()).tag(\"div\").attr('class', \"space\").text(this?.selectedOption?.label).get();\r\n      this.arrow = (new createElement()).tag(\"div\").attr('class', \"arrow\").get();\r\n      this.sel = this.createSelectTag(el)\r\n\r\n\r\n      el.after(this.sel);\r\n      this.label.append(this.space);\r\n      this.label.append(this.arrow);\r\n      this.sel.append(this.label);\r\n      this.sel.append(this.ul);\r\n      el.remove()\r\n\r\n      this.ul.addEventListener('click', this.handleUlClick.bind(this));\r\n      this.label.addEventListener('click', this.handleLabelClick.bind(this));\r\n      this.sel.addEventListener('blur', this.handleSelectBlur.bind(this))\r\n      this.sel.addEventListener('keydown', this.handleSelectKeydown.bind(this))\r\n\r\n      return this;\r\n   }\r\n\r\n   getFormattedOptions(options) {\r\n      return [...options].map(option => {\r\n         const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\r\n         if (option.selected) li.classList.add(\"selected\");\r\n         this.ul.append(li)\r\n\r\n         return {\r\n            value: option.value,\r\n            label: option.label,\r\n            selected: option.selected,\r\n            element: li,\r\n            option: option,\r\n         }\r\n      })\r\n   }\r\n\r\n   createSelectTag(el) {\r\n      const selectTag = this.setSelectTag(el)\r\n      if (el.hasAttribute('data-field')) selectTag.attr('data-field', el.dataset.field)\r\n      if (el.hasAttribute('name')) selectTag.attr('name', el.name)\r\n      if (el.hasAttribute('data-relation')) selectTag.attr('data-relation', el.dataset.relation)\r\n      if (el.hasAttribute('data-pivot')) selectTag.attr('data-pivot', el.dataset.pivot)\r\n      if (el.firstElementChild.hasAttribute('data-relation')) selectTag.attr('data-relation', el.firstChild.dataset.relation)\r\n      if (el.firstElementChild.hasAttribute('data-relationmodel')) selectTag.attr('data-relationmodel', el.firstChild.dataset.relationmodel)\r\n\r\n      return selectTag.get();\r\n   }\r\n\r\n   setSelectTag(el) {\r\n      return (new createElement())\r\n         .tag(\"div\")\r\n         .className(el?.className)\r\n         .field(el.dataset.field)\r\n         .attr(\"select-new\", '')\r\n         .attr(\"data-value\", this?.selectedOption?.value ?? '')\r\n         .attr('tabindex', '0')\r\n   }\r\n\r\n   handleSelectBlur() {\r\n      this.ul.classList.remove(\"show\");\r\n   }\r\n\r\n   handleLabelClick() {\r\n      this.ul.classList.toggle(\"show\");\r\n   }\r\n\r\n   handleUlClick({target}) {\r\n      target.classList.add(\"selected\")\r\n      this.selectedOption.element.classList.remove(\"selected\")\r\n\r\n      this.selectValue(target.dataset.value);\r\n      this.ul.classList.remove(\"show\");\r\n   }\r\n\r\n   onchange(callback) {\r\n      this.callback = callback\r\n   }\r\n\r\n   handleSelectKeydown(e) {\r\n      let debounceTimeout;\r\n      let searchTerm = \"\";\r\n\r\n      if (e.code === \"Space\") {\r\n         select.ul.classList.toggle(\"show\");\r\n      } else if (e.code === \"ArrowUp\") {\r\n         const prevOption = select.options[select.selectedOptionIndex - 1];\r\n         if (prevOption) {\r\n            select.selectValue(prevOption.value)\r\n         }\r\n      } else if (e.code === \"ArrowDown\") {\r\n         const nextOption = select.options[select.selectedOptionIndex + 1];\r\n         if (nextOption) {\r\n            select.selectValue(nextOption.value)\r\n         }\r\n      } else if (e.code === \"Enter\" || e.code === \"Escape\") {\r\n         select.ul.classList.remove(\"show\");\r\n      } else {\r\n         clearTimeout(debounceTimeout);\r\n         searchTerm += e.key;\r\n         debounceTimeout = setTimeout(() => {\r\n            searchTerm = \"\"\r\n         }, 500);\r\n         const searchedOption = this.options.find(option => {\r\n            return option.label.toLowerCase().includes(searchTerm)\r\n         });\r\n         if (searchedOption) {\r\n            this.sel.selectValue(searchedOption.value)\r\n         }\r\n      }\r\n   }\r\n\r\n   get selectedOption() {\r\n      return this.options.find(option => option.selected)\r\n   }\r\n\r\n   get selectedOptionIndex() {\r\n      return this.options.indexOf(this.selectedOption)\r\n   }\r\n\r\n   selectValue(value) {\r\n      const next = this.options.find(option => {\r\n         return option.value === value\r\n      });\r\n      const prev = this.selectedOption;\r\n\r\n      prev.selected = false;\r\n      next.selected = true;\r\n\r\n      this.space.innerText = next.label;\r\n\r\n      this.sel.dataset['value'] = next.value;\r\n      prev.element.classList.remove('selected');\r\n\r\n      next.element.classList.add('selected');\r\n      next.element.scrollIntoView({block: \"nearest\"});\r\n\r\n      this.sel.dispatchEvent(new CustomEvent('customSelect.changed', {\r\n         bubbles: true,\r\n         detail: {next, prev, target: this.sel}\r\n      }));\r\n   }\r\n\r\n   // setOption(option) {\r\n   //    const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\r\n   //\r\n   //    if (option.selected) li.classList.add(\"selected\");\r\n   //    // li.onclick = ({target}) => {\r\n   //    //   select.selectValue(option.value);\r\n   //    //   select.ul.classList.remove(\"show\");\r\n   //    // };\r\n   //    this.ul.append(li)\r\n   // }\r\n}"],"names":["SelectNew","el","$","createElement","options","option","li","selectTag","target","callback","debounceTimeout","searchTerm","prevOption","nextOption","searchedOption","value","next","prev"],"mappings":"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"}