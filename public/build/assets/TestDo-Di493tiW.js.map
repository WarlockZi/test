{"version":3,"file":"TestDo-Di493tiW.js","sources":["../../src/Admin/Test/TestDo/TestDo.js"],"sourcesContent":["import './TestDo.scss'\r\nimport {$, cachePage, post} from '@src/common.js'\r\nimport {qa} from \"@src/constants.js\";\r\n\r\nexport default class TestDo {\r\n   constructor(test) {\r\n      this.navs = $('[data-pagination]') ?? ''\r\n      this.finishBtn = $('.finish-test').first();\r\n\r\n      $('.question').first().classList.add(\"show\")\r\n      this.inactivateFinishBtn();\r\n      test.addEventListener('click', this.handleClick.bind(this))\r\n   }\r\n\r\n   handleClick({target}) {\r\n      const id = +$('.question.show').first()?.dataset.id ?? 0;\r\n      const navIndex = this.navs.findIndex(el => el.classList.contains('active')) ?? 0;\r\n\r\n      if (target.type === \"checkbox\") {\r\n         this.handleCheckboxChange(target)\r\n         target.labels[0].classList.toggle('pushed')\r\n      } else if (target.id === 'prev') {\r\n         this.prevQ(id, navIndex)\r\n      } else if (target.id === 'next') {\r\n         this.nextQ(id, navIndex)\r\n      } else if (target === this.finishBtn) {\r\n         this.finishTest(target).then()\r\n      }\r\n   }\r\n\r\n   handleCheckboxChange(target) {\r\n      const checkboxes = target.closest('.question')[qa](`[type='checkbox']`);\r\n      const checkedCheckboxes = [].filter.call(checkboxes, check => check.checked === true)\r\n\r\n      const questionId = target.closest('.question').dataset.id\r\n      const navItem = $('.navigation').find(`[data-pagination=\"${questionId}\"]`)\r\n      if (checkedCheckboxes) {\r\n         navItem.classList.add('filled')\r\n      } else {\r\n         navItem.classList.remove('filled')\r\n      }\r\n   }\r\n\r\n   prevQ(id, navIndex) {\r\n      if (navIndex < 1) return false;\r\n      const aimId = +this.navs[navIndex - 1].dataset.pagination;\r\n      this.pushNav(id, aimId);\r\n      this.pushQ(aimId)\r\n   }\r\n\r\n   nextQ(id, navIndex) {\r\n      if (navIndex + 1 === this.navs.length) return false;\r\n      const aimId = +this.navs[navIndex + 1].dataset.pagination;\r\n\r\n      this.pushNav(id, aimId);\r\n      this.pushQ(aimId)\r\n   }\r\n\r\n   pushNav(currentId, aimNavId) {\r\n      $(`[data-pagination=\"${currentId}\"]`).first().classList.toggle('active');\r\n      $(`[data-pagination=\"${aimNavId}\"]`).first().classList.toggle('active');\r\n   }\r\n\r\n   pushQ(aimId) {\r\n      $('.question.show').first().classList.toggle('show')\r\n      $(`.question[data-id=\"${aimId}\"]`).first().classList.toggle('show');\r\n   }\r\n\r\n   async finishTest(target) {\r\n\r\n      if (target.innerText === \"ПРОЙТИ ТЕСТ ЗАНОВО\") {\r\n         location.reload();\r\n         return;\r\n      }\r\n      target.innerText = \"ПРОЙТИ ТЕСТ ЗАНОВО\";\r\n      target.classList.add('inactive');\r\n\r\n      const corrAnswers = await post('/adminsc/test/getCorrectAnswers', {});\r\n      this.colorView(corrAnswers.arr);\r\n      const errorCnt = $('.redShadow').length;\r\n\r\n      const data = this.DTO(errorCnt);\r\n      const res = await post('/adminsc/testresult/create', data);\r\n      if (res) {\r\n         target.href = location.href;\r\n         target.innerText = \"ПРОЙТИ ТЕСТ ЗАНОВО\"\r\n      }\r\n   }\r\n\r\n   DTO(errorCnt) {\r\n      return {\r\n         questionCnt: $('.question').length,\r\n         errorCnt: errorCnt,\r\n         html: cachePage('.test-do .content'),\r\n         testid: $('[data-test-id]')[0].dataset.testId,\r\n         testname: $('.test-name')[0].innerText,\r\n         user: $('.user-menu .fio')[0].innerText,\r\n      }\r\n   }\r\n\r\n\r\n   colorView(correctAnswers) {\r\n      let questions = $('.question');\r\n      [].map.call(questions, (question) => {\r\n         let errors = this.colorQuestions(question, correctAnswers);\r\n         this.colorPgination(question, errors)\r\n      })\r\n   }\r\n\r\n   colorPgination(question, errors) {\r\n      const id = question.dataset['id'];\r\n      const paginItem = $(`.pagination [data-pagination='${+id}']`)[0];\r\n      if (errors.length) {\r\n         $(paginItem).addClass('redShadow')\r\n      } else {\r\n         $(paginItem).addClass('greenShadow')\r\n      }\r\n   }\r\n\r\n   colorQuestions(question, correctAnswers) {\r\n      const answers = question.querySelectorAll('.a');\r\n      const errors = [];\r\n      [].map.call(answers, (answer) => {\r\n         const input = $(answer).find('input');\r\n         const id = answer.dataset.id;\r\n         const error = this.checkCorrectAnswers(id, correctAnswers, input, answer);\r\n         if (error) errors.push(true)\r\n      });\r\n      return errors\r\n   }\r\n\r\n   checkCorrectAnswers(id, correctAnswers, input, answer) {\r\n      const correctAnser = correctAnswers.indexOf(+id) !== -1;\r\n      const checked = input.checked;\r\n      let error = false;\r\n\r\n      if (checked && correctAnser) {// checkbox нажат. а в correct answer нету. в correct_answers есть, его всегда подсвечиваем зеленым\r\n         answer.classList.add('done'); //green check зеленый значек\r\n      } else if (checked && !correctAnser) {// checkbox нажат,и есть в correct answer. в correct_answers нет, кнопка не нажата\r\n         error = true\r\n      } else if (!checked && correctAnser) {// кнопка не нажата, в correct_answers есть\r\n         answer.classList.add('done'); //green check зеленый значек\r\n         error = true\r\n      } else if (!checked && !correctAnser) {// кнопка не нажата, в correct_answers нет\r\n      }\r\n      return error\r\n   }\r\n\r\n   inactivateFinishBtn() {\r\n      if (window.location.pathname.match('^/test/result/.?')) {\r\n         this.finishBtn.classList.add('inactive')\r\n      }\r\n   }\r\n}"],"names":["TestDo","test","$","target","id","navIndex","el","checkboxes","qa","checkedCheckboxes","check","questionId","navItem","aimId","currentId","aimNavId","corrAnswers","post","errorCnt","data","cachePage","correctAnswers","questions","question","errors","paginItem","answers","answer","input","correctAnser","checked","error"],"mappings":"qJAIe,MAAMA,CAAO,CACzB,YAAYC,EAAM,CACf,KAAK,KAAOC,EAAE,mBAAmB,GAAK,GACtC,KAAK,UAAYA,EAAE,cAAc,EAAE,MAAK,EAExCA,EAAE,WAAW,EAAE,MAAO,EAAC,UAAU,IAAI,MAAM,EAC3C,KAAK,oBAAmB,EACxBD,EAAK,iBAAiB,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,CAC5D,CAED,YAAY,CAAC,OAAAE,CAAM,EAAG,CACnB,MAAMC,EAAK,CAACF,EAAE,gBAAgB,EAAE,SAAS,QAAQ,GAC3CG,EAAW,KAAK,KAAK,UAAUC,GAAMA,EAAG,UAAU,SAAS,QAAQ,CAAC,GAAK,EAE3EH,EAAO,OAAS,YACjB,KAAK,qBAAqBA,CAAM,EAChCA,EAAO,OAAO,CAAC,EAAE,UAAU,OAAO,QAAQ,GAClCA,EAAO,KAAO,OACtB,KAAK,MAAMC,EAAIC,CAAQ,EACfF,EAAO,KAAO,OACtB,KAAK,MAAMC,EAAIC,CAAQ,EACfF,IAAW,KAAK,WACxB,KAAK,WAAWA,CAAM,EAAE,KAAM,CAEnC,CAED,qBAAqBA,EAAQ,CAC1B,MAAMI,EAAaJ,EAAO,QAAQ,WAAW,EAAEK,CAAE,EAAE,mBAAmB,EAChEC,EAAoB,GAAG,OAAO,KAAKF,EAAYG,GAASA,EAAM,UAAY,EAAI,EAE9EC,EAAaR,EAAO,QAAQ,WAAW,EAAE,QAAQ,GACjDS,EAAUV,EAAE,aAAa,EAAE,KAAK,qBAAqBS,CAAU,IAAI,EACrEF,EACDG,EAAQ,UAAU,IAAI,QAAQ,EAE9BA,EAAQ,UAAU,OAAO,QAAQ,CAEtC,CAED,MAAMR,EAAIC,EAAU,CACjB,GAAIA,EAAW,EAAG,MAAO,GACzB,MAAMQ,EAAQ,CAAC,KAAK,KAAKR,EAAW,CAAC,EAAE,QAAQ,WAC/C,KAAK,QAAQD,EAAIS,CAAK,EACtB,KAAK,MAAMA,CAAK,CAClB,CAED,MAAMT,EAAIC,EAAU,CACjB,GAAIA,EAAW,IAAM,KAAK,KAAK,OAAQ,MAAO,GAC9C,MAAMQ,EAAQ,CAAC,KAAK,KAAKR,EAAW,CAAC,EAAE,QAAQ,WAE/C,KAAK,QAAQD,EAAIS,CAAK,EACtB,KAAK,MAAMA,CAAK,CAClB,CAED,QAAQC,EAAWC,EAAU,CAC1Bb,EAAE,qBAAqBY,CAAS,IAAI,EAAE,MAAK,EAAG,UAAU,OAAO,QAAQ,EACvEZ,EAAE,qBAAqBa,CAAQ,IAAI,EAAE,MAAK,EAAG,UAAU,OAAO,QAAQ,CACxE,CAED,MAAMF,EAAO,CACVX,EAAE,gBAAgB,EAAE,MAAO,EAAC,UAAU,OAAO,MAAM,EACnDA,EAAE,sBAAsBW,CAAK,IAAI,EAAE,MAAK,EAAG,UAAU,OAAO,MAAM,CACpE,CAED,MAAM,WAAWV,EAAQ,CAEtB,GAAIA,EAAO,YAAc,qBAAsB,CAC5C,SAAS,OAAM,EACf,MACF,CACDA,EAAO,UAAY,qBACnBA,EAAO,UAAU,IAAI,UAAU,EAE/B,MAAMa,EAAc,MAAMC,EAAK,kCAAmC,CAAE,CAAA,EACpE,KAAK,UAAUD,EAAY,GAAG,EAC9B,MAAME,EAAWhB,EAAE,YAAY,EAAE,OAE3BiB,EAAO,KAAK,IAAID,CAAQ,EAClB,MAAMD,EAAK,6BAA8BE,CAAI,IAEtDhB,EAAO,KAAO,SAAS,KACvBA,EAAO,UAAY,qBAExB,CAED,IAAIe,EAAU,CACX,MAAO,CACJ,YAAahB,EAAE,WAAW,EAAE,OAC5B,SAAUgB,EACV,KAAME,EAAU,mBAAmB,EACnC,OAAQlB,EAAE,gBAAgB,EAAE,CAAC,EAAE,QAAQ,OACvC,SAAUA,EAAE,YAAY,EAAE,CAAC,EAAE,UAC7B,KAAMA,EAAE,iBAAiB,EAAE,CAAC,EAAE,SAChC,CACH,CAGD,UAAUmB,EAAgB,CACvB,IAAIC,EAAYpB,EAAE,WAAW,EAC7B,CAAA,EAAG,IAAI,KAAKoB,EAAYC,GAAa,CAClC,IAAIC,EAAS,KAAK,eAAeD,EAAUF,CAAc,EACzD,KAAK,eAAeE,EAAUC,CAAM,CAC7C,CAAO,CACH,CAED,eAAeD,EAAUC,EAAQ,CAC9B,MAAMpB,EAAKmB,EAAS,QAAQ,GACtBE,EAAYvB,EAAE,iCAAiC,CAACE,CAAE,IAAI,EAAE,CAAC,EAC3DoB,EAAO,OACRtB,EAAEuB,CAAS,EAAE,SAAS,WAAW,EAEjCvB,EAAEuB,CAAS,EAAE,SAAS,aAAa,CAExC,CAED,eAAeF,EAAUF,EAAgB,CACtC,MAAMK,EAAUH,EAAS,iBAAiB,IAAI,EACxCC,EAAS,CAAA,EACf,OAAA,EAAG,IAAI,KAAKE,EAAUC,GAAW,CAC9B,MAAMC,EAAQ1B,EAAEyB,CAAM,EAAE,KAAK,OAAO,EAC9BvB,EAAKuB,EAAO,QAAQ,GACZ,KAAK,oBAAoBvB,EAAIiB,EAAgBO,EAAOD,CAAM,GAC7DH,EAAO,KAAK,EAAI,CACpC,CAAO,EACMA,CACT,CAED,oBAAoBpB,EAAIiB,EAAgBO,EAAOD,EAAQ,CACpD,MAAME,EAAeR,EAAe,QAAQ,CAACjB,CAAE,IAAM,GAC/C0B,EAAUF,EAAM,QACtB,IAAIG,EAAQ,GAEZ,OAAID,GAAWD,EACZF,EAAO,UAAU,IAAI,MAAM,EACnBG,GAAW,CAACD,EACpBE,EAAQ,GACA,CAACD,GAAWD,IACpBF,EAAO,UAAU,IAAI,MAAM,EAC3BI,EAAQ,IAGJA,CACT,CAED,qBAAsB,CACf,OAAO,SAAS,SAAS,MAAM,kBAAkB,GAClD,KAAK,UAAU,UAAU,IAAI,UAAU,CAE5C,CACJ"}