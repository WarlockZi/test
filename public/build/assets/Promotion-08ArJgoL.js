import{e as n,$ as a,p as o}from"./constants-D6t7YzCi.js";class d{constructor(e){var t,i;if(e)return this.options=h(e.querySelectorAll("option")),this.sel=new n().tag("div").className(e==null?void 0:e.className).field(e.dataset.field).attr("select-new","").attr("data-value",((t=this==null?void 0:this.selectedOption)==null?void 0:t.value)??"").attr("tabindex","0").get(),e.after(this.sel),this.label=document.createElement("span"),this.sel.append(this.label),this.space=new n().tag("div").attr("class","space").text((i=this==null?void 0:this.selectedOption)==null?void 0:i.label).get(),this.label.append(this.space),this.arrow=new n().tag("div").attr("class","arrow").get(),this.label.append(this.arrow),this.ul=new n().tag("ul").attr("class","options").get(),this.options.forEach(s=>{r(s,this)}),this.sel.append(this.ul),this.label.onclick=()=>this.ul.classList.toggle("show"),this.sel.onblur=()=>this.ul.classList.remove("show"),this.sel.onkeydown=this.keyDownhandler.bind(this),e.remove(),this}onchange(e){this.callback=e}keyDownhandler(e){let t,i="";if(e.code==="Space")select.ul.classList.toggle("show");else if(e.code==="ArrowUp"){const s=select.options[select.selectedOptionIndex-1];s&&select.selectValue(s.value)}else if(e.code==="ArrowDown"){const s=select.options[select.selectedOptionIndex+1];s&&select.selectValue(s.value)}else if(e.code==="Enter"||e.code==="Escape")select.ul.classList.remove("show");else{clearTimeout(t),i+=e.key,t=setTimeout(()=>{i=""},500);const s=this.options.find(c=>c.label.toLowerCase().includes(i));s&&this.sel.selectValue(s.value)}}get selectedOption(){return this.options.find(e=>e.selected)}get selectedOptionIndex(){return this.options.indexOf(this.selectedOption)}selectValue(e){const t=this.options.find(s=>s.value===e),i=this.selectedOption;i.selected=!1,t.selected=!0,this.space.innerText=t.label,this.sel.dataset.value=t.value,i.element.classList.remove("selected"),t.element.classList.add("selected"),t.element.scrollIntoView({block:"nearest"}),this.sel.dispatchEvent(new CustomEvent("customSelect.changed",{bubbles:!0,detail:{next:t,prev:i,target:this.sel}}))}}function r(l,e){const t=new n().tag("li").text(l.label).attr("data-value",l.value).get();l.selected&&t.classList.add("selected"),t.onclick=({target:i})=>{e.selectValue(l.value),e.ul.classList.remove("show")},e.ul.append(t)}function h(l){return[...l].map(e=>({value:e.value,label:e.label,selected:e.selected,element:e}))}class u{constructor(){this.$promotion=a(".promotion-edit").first(),this.$promotion&&(this.updateUrl="/adminsc/promotion/updateOrCreate",this.id=a(this.$promotion).find("[data-field='id']").innerText,this.$count=a("[data-field='count']").first(),this.$unit=a("[select-new].unit").first(),new d(this.$unit),a('[data-field="unit"]').first().addEventListener("customSelect.changed",this.unitChanged.bind(this)),this.$newPrice=a('[data-field="new_price"]').first(),this.$activeTill=a("[data-field='active-till']").first(),this.$activeTill.addEventListener("change",this.activetillChanged.bind(this)))}unitChanged(e){let t=this.dto(this);t.unit_id=e.detail.next.value,o(this.updateUrl,t)}async activetillChanged({target:e}){let t=this.dto(this);t.active_till=e.value,await o(this.updateUrl,t)}dto(e){return{id:this.id}}}const f=Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}));export{u as P,d as S,f as a};
