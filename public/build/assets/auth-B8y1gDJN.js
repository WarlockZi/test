import{$ as s,post as c}from"./common-CWUZwUnI.js";import"./cookie-DzHlFVza.js";let o=s(".search input").first();o&&o.addEventListener("input",function(){d(o)});async function d(t){let n=t.parentNode,e=s(n).find(".search__result");if(t.value.length<1){e&&(e.innerHTML="");return}let a=await fetch("/search?q="+t.value);a=await a.json(a),e.childNodes.length!==0&&(e.innerHTML=""),a.map(r=>{let i=document.createElement("a");i.href=r.alias,i.innerHTML=`<img src='/pic/${r.preview_pic}' alt='${r.name}'>`+r.name,e.appendChild(i)}),s("body").on("click",function(r){e&&r.target!==e&&(e.innerHTML="")})}function u(){s(".password-control")&&s(".password-control").on("click",n);function n({target:e}){const a=e.parentNode.querySelector("input");a.getAttribute("type")==="password"?a.setAttribute("type","text"):a.setAttribute("type","password"),e.classList.toggle("view")}}s(".changepassword").on("click",async function(t){let n={old_password:s('[name="old_password"]')[0].value,new_password:s('[name="new_password"]')[0].value},e=s(".message")[0],a=await c("/auth/changepassword",n);a.success?(e.innerText=a.success,s(e).addClass("success"),s(e).removeClass("error")):a.error&&(e.innerText=a.error,s(e).addClass("error"),s(e).removeClass("success"))});let l=s("[data-auth='register']")[0];l&&s(l).on("click",m);function m({target:t}){p(email,password)}async function p(t,n){const e=s(".message")[0],a={email:t,password:n,surName:s("[name='surName']")[0].value,name:s("[name='name']")[0].value},r=await c("/auth/register",a);r?.arr?.success==="confirm"?(e.classList.remove("error"),e.classList.add("success"),e.innerHTML="-Пользователь зарегистрирован.<br>-Для подтверждения регистрации зайдите на почту, <bold>email</bold>.<br> -Перейдите по ссылке в письме."):r.msg==="mail exists"?(e.innerHTML="Эта почта уже зарегистрирована. Войдите в систему по кнопке внизу Войти или, если не помните пароль, восстановите пароль по кнопке Забыл пароль",e.classList.remove("success"),e.classList.add("error")):(e.innerHTML=r.msg,e.classList.remove("success"),e.classList.add("error"))}s("#save").on("click",async function(t){t.preventDefault();let n={name:s('[name = "name"]')[0].value,surName:s('[name = "surName"]')[0].value,middleName:s('[name = "middleName"]')[0].value,birthDate:s('[name = "birthDate"]')[0].value,phone:s('[name = "phone"]')[0].value,sex:void 0};await c("/user/edit",n)});s("[data-auth='login']").first();s(".modal").first();u();
//# sourceMappingURL=auth-B8y1gDJN.js.map
