{"version":3,"file":"catalog-item-D9PCVcdH.js","sources":["../../src/components/date/date.js","../../src/components/checkbox/checkbox.js","../../src/Admin/RelationDTO.js","../../src/Admin/components/catalog-item/catalog-item.js"],"sourcesContent":["import { fragmentDate } from \"../../common\";\nimport \"./date.scss\";\nimport { ael } from \"@src/constants.js\";\n\nexport default class CustomDate {\n  constructor(date) {\n    this.date = date;\n    this.date[ael](\"change\", this.onChange.bind(this));\n  }\n\n  onChange({ target }) {\n    const { yyyy, mm, dd } = fragmentDate(target.value);\n    const formated = `${yyyy}-${mm}-${dd}`;\n    target.setAttribute(\"data-value\", formated);\n    const customEvent = new CustomEvent(\"date.changed\", {\n      bubbles: true,\n      cancelable: true,\n      detail: { value: formated },\n    });\n    target.dispatchEvent(customEvent);\n  }\n}\n","import { ael } from \"@src/constants.js\";\n\nexport default class Checkbox {\n  constructor(checkbox) {\n    this.id = checkbox.id;\n    this.checkbox = checkbox;\n    // this.field = checkbox?.dataset?.field ?? null;\n    checkbox[ael](\"change\", this.changed.bind(this));\n  }\n\n  async changed({ target }) {\n    target.dataset.pivotValue = +target.checked;\n    this.checkbox.dispatchEvent(\n      new CustomEvent(\"checkbox.changed\", {\n        bubbles: true,\n        detail: target.checked,\n      }),\n    );\n  }\n}\n","export default class RelationDTO {\n  constructor(target, prev) {\n    if (!target) return;\n    this.target = target;\n    //model\n    this.id = target?.closest(\".item-wrap\")?.dataset?.id;\n\n    // this.fields = target?.dataset?.field ?? false\n\n    this.relation =\n      target?.dataset?.relation ??\n      target?.closest(\"[data-relation]\")?.dataset?.relation ??\n      false;\n\n    this.pivot =\n      target?.dataset?.pivot ?? target?.parentNode?.dataset?.pivot ?? false;\n    this.attach =\n      !!this.target?.closest(\"[custom-table]\")?.dataset?.relationtype;\n\n    if (this.fields) {\n      this.fields = {\n        [target?.dataset?.field]:\n          target?.dataset?.value ?? target?.checked ?? target?.innerText,\n      };\n    }\n\n    if (this.relation) {\n      const name = this.relation;\n      this.relation = {};\n      this.relation.name = name;\n      this.relation.id =\n        target?.dataset?.value ??\n        target?.dataset?.id ??\n        0 ??\n        target?.closest(\"[data-relation]\")?.dataset?.relation ??\n        0;\n\n      if (this.attach && !this.pivot) {\n        this.relation.attach =\n          this.target?.dataset?.id ?? this.target?.dataset.value;\n        this.relation.detach = prev ?? null;\n      } else if (this.pivot) {\n        delete this.attach;\n        this.relation.pivot = {};\n        this.relation.pivot[target?.dataset?.pivot] =\n          target?.dataset?.value ?? target?.checked ?? target?.innerText;\n      } else {\n        this.relation.fields = {};\n        const fieldName = target?.dataset?.field ?? target?.dataset.pivot;\n        this.relation.fields[fieldName] =\n          target?.dataset?.value ?? target?.checked ?? target?.innerText;\n      }\n    }\n    if (!this.fields) delete this.fields;\n    if (!this.relation) delete this.relation;\n    delete this.attach;\n    delete this.pivot;\n    delete this.target;\n  }\n}\n","import \"./catalog-item.scss\";\nimport { $, debounce, post } from \"../../../common.js\";\nimport { ael } from \"../../../constants.js\";\nimport DTO from \"../../../Admin/DTO.js\";\nimport Checkbox from \"../../../components/checkbox/checkbox.js\";\nimport SelectNew from \"../../../components/select/SelectNew.js\";\nimport CustomDate from \"../../../components/date/date.js\";\nimport RelationDTO from \"@src/Admin/RelationDTO.js\";\n\nexport default class CatalogItem {\n  constructor(catalogItem) {\n    if (!catalogItem) return false;\n\n    this.model = catalogItem.dataset.model;\n    this.id = +catalogItem.dataset.id;\n    this.setCheckboxes();\n    this.setSelects();\n    this.setDates();\n\n    catalogItem[ael](\"click\", this.handleClick.bind(this));\n    catalogItem[ael](\"keyup\", debounce(this.handleKeyup.bind(this)));\n    catalogItem[ael](\"date.changed\", this.handleDateChange.bind(this));\n    catalogItem[ael](\n      \"customSelect.changed\",\n      this.handleSelectChange.bind(this),\n    );\n    if (this.model) {\n      catalogItem[ael](\"checkbox.changed\", this.handleChexboxChange.bind(this));\n    }\n  }\n\n  setCheckboxes() {\n    const checks = $(\"[my-checkbox]\");\n    [].forEach.call(checks, function (check) {\n      new Checkbox(check);\n    });\n  }\n\n  setDates() {\n    const dates = $(\"[custom-date]\");\n    [].forEach.call(dates, function (date) {\n      new CustomDate(date);\n    });\n  }\n\n  setSelects() {\n    const selects = $(\"[select-new]:has(option)\");\n    [].forEach.call(selects, function (select) {\n      if (!select.parentNode.hasAttribute(\"hidden\")) new SelectNew(select);\n    });\n  }\n\n  handleChexboxChange({ target }) {\n    if (target.closest(\"[custom-table]\")) return;\n    this.update(target);\n  }\n\n  async handleSelectChange({ target }) {\n    if (target.closest(\"[custom-table]\")) return;\n    this.update(target);\n  }\n\n  async handleDateChange({ target }) {\n    this.update(target);\n  }\n\n  async handleKeyup({ target }) {\n    if (target.closest(\".custom-table\")) return false;\n    if (!target.hasAttribute(\"contenteditable\") || !target.dataset.field)\n      return false;\n    let dto = {};\n    if (target.dataset.relation) {\n      dto = new RelationDTO(target);\n    } else {\n      dto = new DTO(this.id, target);\n    }\n    const res = await post(`/adminsc/${this.model}/updateOrCreate`, dto);\n    if (res) {\n      target.dispatchEvent(\n        new CustomEvent(\"catalogItem.changed\", {\n          bubbles: true,\n          detail: { res },\n        }),\n      );\n    }\n  }\n\n  async handleClick({ target }) {\n    if (target.classList.contains(\"tab\")) {\n      this.handleTabClick(target);\n    }\n  }\n\n  handleTabClick(target) {\n    $(`[data-tab].show`).first().classList.toggle(\"show\");\n    $(`[data-tab='${target.dataset.tabId}']`).first().classList.toggle(\"show\");\n    $(`.tab.active`).first().classList.toggle(\"active\");\n    target.classList.toggle(\"active\");\n  }\n\n  async update(target) {\n    if (target.closest(\"[custom-table]\")) return;\n    const dto = new DTO(this.id, target);\n    const res = await post(`/adminsc/${this.model}/updateorcreate`, dto);\n  }\n}\n"],"names":["CustomDate","date","ael","target","yyyy","mm","dd","fragmentDate","formated","customEvent","Checkbox","checkbox","RelationDTO","prev","name","fieldName","CatalogItem","catalogItem","debounce","checks","$","check","dates","selects","select","SelectNew","dto","DTO","res","post"],"mappings":"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"}