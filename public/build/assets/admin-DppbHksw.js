const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-tHOJzCCU.js","assets/search-DF5JQ23V.js","assets/search-CgsZ06fR.css","assets/modal-DU8U9Qic.css","assets/index-CgYDEsmk.js","assets/index-DmAyeOWP.css","assets/chartjs-CHNF-Ruf.js","assets/chartjs-Dap-k2NF.css","assets/card_panel-CopNMo0D.js","assets/card_panel-UF59AJVy.css","assets/Product-BegBD6W6.js","assets/MyQuill-C7O5XRWK.js","assets/MyQuill-GClCj9AP.css","assets/Promotion-CuyBY8mM.js","assets/Promotion--2U3bzhI.css","assets/Product-C9KtOBb-.css","assets/catalog-item-LHEq4vUc.js","assets/catalog-item-CC5C5WoE.css","assets/order-Bn_sAYrE.js","assets/order-D46ScIno.css","assets/Category-DyJeLgSW.js"])))=>i.map(i=>d[i]);
import{$ as i,p as f,q as c,a as d,b as h,S as p,d as _,c as E,_ as u}from"./search-DF5JQ23V.js";import{M as L}from"./MyQuill-C7O5XRWK.js";import k from"./Promotion-CuyBY8mM.js";class T{constructor(t){this.$sync=t,this.$log_content=i(t).find("#log_content"),this.$sync.onclick=this.handleClick.bind(this)}async handleClick({target:t}){if(t.classList.contains("button")){let e=await f(`/adminsc/sync/${t.id}`);e?.arr?.success&&(this.$log_content.innerText=e.arr?.content)}}}let g=i(".sync").first();g&&new T(g);class S{constructor(t){t&&(this.wrap=t,this.panel=t[c](".list-filter"),this.url="/adminsc/report/filter",this.wrap[d]("click",this.handleClick.bind(this)),this.setSelects())}setSelects(){const t=this.wrap[h]("[select-new]");[].map.call(t,e=>{new p(e)})}async handleClick(t){if(t.target.classList.contains("filter-button")){t.preventDefault();const s=this.getClickedFilters(),n=await f(this.url,s);this.renderDataFromResponce(n)}}getClickedFilters(){const t={},e=this.wrap[h]("[select-new]");[].map.call(e,n=>(t[n.getAttribute("name")]=n.dataset.value,null));const s=this.panel[h]("[type='checkbox']:checked");return[].forEach.call(s,n=>{t[n.name]="on"}),t}renderDataFromResponce(t){i(".used-filters").first().innerHTML=t?.arr?.filterString,i(".list-filter").first().innerHTML=t?.arr?.filterPanel;const e=i("[custom-table]").first();e.innerHTML=t?.arr?.productsTable,this.setSelects()}}class m{constructor(t,e){if(t){if(this.target=t,this.id=t?.closest(".item-wrap")?.dataset?.id??t?.parentNode?.dataset?.id,this.fields=t?.dataset?.field??!1,this.relation=t?.dataset?.relation??t?.closest("[data-relation]")?.dataset?.relation??!1,this.pivot=t?.dataset?.pivot??t?.parentNode?.dataset?.pivot??!1,this.attach=!!this.target?.closest("[custom-table]")?.dataset?.relationtype,this.fields&&(this.fields={[t?.dataset?.field]:t?.dataset?.value??t?.checked??t?.innerText}),this.relation){const s=this.relation;if(this.relation={},this.relation.name=s,this.relation.id=t?.dataset?.value??t?.dataset?.id??0??t?.closest("[data-relation]")?.dataset?.relation??0,this.attach&&!this.pivot)this.relation.attach=this.target?.dataset?.id??this.target?.dataset.value,this.relation.detach=e??null;else if(this.pivot)delete this.attach,this.relation.pivot={},this.relation.pivot[t?.dataset?.pivot]=t?.dataset?.value??t?.checked??t?.innerText;else{this.relation.field={};const n=t?.dataset?.field??t?.dataset.pivot;this.relation.field[n]=t?.dataset?.value??t?.checked??t?.innerText}}this.fields||delete this.fields,delete this.attach,delete this.pivot,delete this.target}}}class x{constructor(t){this.table=t,this.model=t.dataset.model??t.closest("[data-model]")?.dataset.model,this.modelId=t.dataset.id??t.closest("[data-model]")?.dataset.id,this.relation=t.dataset.relation??null,this.relationType=t.dataset.relationtype??null,this.updateOrCreateUrl=`/adminsc/${this.model}/updateOrCreate`,this.headers=i(".head"),this.inputs=i("[data-search]"),this.hidden=this.table[h]("[hidden]"),this.table[d]("click",this.handleClick.bind(this)),this.table[d]("keyup",_(this.handleKeyup.bind(this)).bind(this)),this.table[d]("paste",this.handlePaste.bind(this)),this.table[d]("customSelect.changed",this.selectChange.bind(this)),this.relation||(this.table[d]("customSelect.changed",this.selectChange.bind(this)),this.table[d]("checkbox.changed",this.checkboxChange.bind(this))),this.setCheckboxes(),this.setSelects(),this.setSortables()}async checkboxChange(t){const e=new m(t.target);await f(this.updateOrCreateUrl,e)}async selectChange({detail:t}){const e=t.target,s=new m(e,t?.prev?.value);if((await f(`/adminsc/${this.model}/updateorcreate`,s))?.arr?.detach){const l=this.table[h](`[data-id='${t.prev.value}']`);for(let a of l)a.dataset.id=t.next.value}else{const l=this.table[h]("[data-id='0']:not([hidden])");for(let a of l)a.dataset.id=t.next.value}}async update(t,e){const s=new m(e);await f(`/adminsc/${this.model}/updateorcreate`,s)}async handleClick(t){const e=t.target;if(e.className==="add-model")this.copyEmptyRow();else if(e.classList.contains("edit"))this.edit(e);else if(e.classList.contains("del")&&!e.classList.contains("head"))this.modelDel(e);else if(e.classList.contains("head")||e.classList.contains("icon")){const s=e.closest(".head");if(s.hasAttribute("data-sort")){const n=[].findIndex.call(this.sortables,(l,a,r)=>l===s);this.sortColumn(n)}}}edit(t){if(t.classList.contains("head"))return!1;const e=this.relation?this.relationModel:this.model,s=this.relation?t.dataset.id:this.modelId??t.dataset.id;window.location=`/adminsc/${e}/edit/${s}`}getIds(){const t=i(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,function(e){return e.dataset.id!=="0"})}handlePaste(t){t.target.innerText=t.clipboardData.getData("text/plain"),this.handleInput(t.target),t.target.innerText=""}async handleKeyup({target:t}){if(t.hasAttribute("data-search"))this.search(t);else if(t.hasAttribute("contenteditable")){const e=await f(this.updateOrCreateUrl,new m(t));e?.arr?.id&&this.newRow(e?.arr.id)}}async modelDel(t){if(!confirm("Удалить?"))return;const e=this.modelId,s=t.dataset.id,n=this.relationType??null,l=this.relation??null,a=await f(`/adminsc/${this.model}/delete`,{id:e,relationName:l,relationType:n,relationId:s});a?.arr?.deleted&&this.delRow(a?.arr?.deleted)}async updateOrcreate(t){const e=await f(this.updateOrCreateUrl,new m(t));e?.arr?.success?this.copyEmptyRow(t):this.newRow(e?.arr.id)}copyEmptyRow(){[].forEach.call(this.hidden,t=>{const e=t.cloneNode(!0);e.removeAttribute("hidden"),this.addSelectInNewRow(e),this.table[h](".custom-table")[0].append(e)})}newRow(t){[].forEach.call(this.hidden,function(e){const s=e.cloneNode(!0);s.removeAttribute("hidden"),this.addSelectInNewRow(s),i(this.table).find(".custom-table").appendChild(s),["id"].includes(s.dataset.field)?s.innerText=t:["del","edit","save"].includes(s.className)||s.hasChildNodes("select")||(s.innerText=""),s.dataset.id=t}.bind(this))}addSelectInNewRow(t){if(t[c]("[select-new]")){const e=t[c]("[select-new]");this.removeUsedSelectOptions(e),new p(e)}}removeUsedSelectOptions(t){const e=this.table[h]("[data-attach]");[].forEach.call(e,s=>{[].forEach.call(t.options,n=>{n.value===s.dataset.id&&n.remove()})})}search(t,e){const s=this.fillRows();[].forEach.call(s,a=>{[].forEach.call(a,r=>r.style.display="flex")}),[].forEach.call(this.inputs,a=>{a!==t&&(a.value="")});const n=t.closest(".head"),l=[].findIndex.call(this.headers,a=>a===n);[].forEach.call(s,function(a){const r=a[l].innerText,w=new RegExp(`${t.value}`,"gi");r.match(w)||[].forEach.call(a,b=>{b.style.display="none"})})}fillRows(){const t=[],e=this.getIds();for(let s=0;s<e.length;s++){let n=e[s].dataset.id,l=i(this.table)[0].querySelectorAll(`[data-id='${n}']`);t.push(l)}return t}sortColumn(t){const e=this.fillRows(),s=this.directions[t]||"asc",n=s==="asc"?1:-1,l=Array.from(e);l.sort(function(a,r){const w=a[t].innerHTML,b=r[t].innerHTML,v=this.transform(t,w),y=this.transform(t,b);switch(!0){case v>y:return 1*n;case v<y:return-1*n;case v===y:return 0}}.bind(this)),[].forEach.call(e,function(a){[].forEach.call(a,r=>{r.remove()})}),this.directions[t]=s==="asc"?"desc":"asc",l.forEach(function(a){a=Array.from(a),a.reverse(),[].forEach.call(a,r=>{this.headers[this.headers.length-1].after(r)})}.bind(this))}transform(t,e){return this.sortables[t]?this.sortables[t].getAttribute("data-type")==="number"?parseFloat(e):e:void 0}delRow(t){const e=i(`[data-id='${t}']`);[].forEach.call(e,function(s){s.remove()})}setSortables(){this.sortables=i("[data-sort]"),this.directions=Array.from(this.sortables).map(function(t){return""})}setSelects(){const t=i("[select-new]:has(option)");[].forEach.call(t,e=>{e.parentNode.hasAttribute("hidden")||new p(e)})}setCheckboxes(){const t=this.table[h]("[my-checkbox]");[].forEach.call(t,e=>{e[d]("change",this.checkboxChange.bind(this))})}}const C=i("[custom-table]");C&&[].forEach.call(C,function(o){new x(o)});function A(){const o=i(".admin-panel").first();document.addEventListener("scroll",t.bind(o),{passive:!0});function t(){o&&(window.scrollY>40?o.classList.add("fixed"):o.classList.remove("fixed"))}}class I{constructor(){const t=window.location.pathname;/\/adminsc\/settings/.test(t)||/\/adminsc\/right\/list/.test(t)||/\/adminsc\/post\/list/.test(t)||/\/adminsc\/todo\/list/.test(t)?i("[settings]").addClass("current"):/\/auth\/profile/.test(t)||(/\/adminsc\/crm/.test(t)?i("[crm]").addClass("current"):/\/adminsc\/planning/.test(t)?i("[plan]").addClass("current"):/\/adminsc\/category/.test(t)||/\/adminsc\/product/.test(t)?i("[catalog]").addClass("current"):/\/test/.test(t)||/\/opentest/.test(t)||/\/adminsc\/opentest/.test(t)||/\/adminsc\/test/.test(t)?i("[test]").addClass("current"):i("[href='/adminsc']").addClass("current"))}}class R{constructor(){this.setTabs(),this.setPages(),this.setQuils()}setTabs(){const t=i(".tab");t[0].classList.add("active"),[].forEach.call(t,e=>{e.addEventListener("click",s=>{const n=s.target.dataset.id;i(".page.active").first().classList.remove("active"),i(`.page[data-id='${n}']`).first().classList.add("active"),i(".tab.active").first().classList.remove("active"),s.target.classList.add("active")})})}setPages(){i(".page")[0].classList.add("active")}setQuils(){const t=i(".quill[data-id]");t[0].classList.add("active"),[].forEach.call(t,e=>{this.id=e.dataset.id,new L(`.quill[data-id='${this.id}']`,!0,!0,!0,"snow",this.dto.bind(this))})}dto(t){return{id:this.id,model:"pages",fields:{content:t}}}}class P{constructor(){if(!i('[data-model="user"]')[0])return!1;this.setSelects()}setSelects(){const t=i("[select-new]:has(option)");[].forEach.call(t,e=>{new p(e)})}setRights(){let t=rights().replace(/,$/,""),e=i("[data-field='rights']")[0];e.dataset.value=t}rights(){let t=i(".right:checked"),e="";return[].map.call(t,s=>{let n=s.previousElementSibling.innerText+",";e+=n},e),e}confirm(){const t=i("#conf option");for(let e of t)if(e.selected)return e.value;return"0"}}class O{constructor(t){if(!t)return!1;this.sidebar=t,this.sidebar[d]("click",this.handleClick.bind(this)),this.burger=document[c](".burger"),this.burger[d]("click",this.handleClick.bind(this))}handleClick({target:t}){t===this.burger?this.sidebar.classList.toggle("show"):this.openUl(t)}openUl(t){const e=t.closest("li");e&&(e?.classList?.contains("open")||this.closeUls(),e.classList.toggle("open"),this.rotateArrow(e))}closeUls(){const t=i(this.sidebar).find(".open");t&&(t[c](".rotate").classList.toggle("rotate"),t.classList.toggle("open"))}rotateArrow(t){const e=i(t).find(".arrow");e&&e.classList.toggle("rotate")}}i(document).ready(async function(){if(document.body.classList.remove("preload"),!window.location.pathname.includes("adminsc"))return!1;if(new E(!0),new I,A(),new O(i(".sidebar").first()),new k,document[c](".modal")){const{default:l}=await u(async()=>{const{default:a}=await import("./modal-tHOJzCCU.js");return{default:a}},__vite__mapDeps([0,1,2,3]));new l}if(window.location.pathname==="/adminsc/pages"?new R:window.location.pathname==="/adminsc/user"||(window.location.pathname.startsWith("/adminsc/user/edit")?new P:window.location.href.includes("/test")?await u(async()=>{const{default:l}=await import("./index-CgYDEsmk.js").then(a=>a.i);return{default:l}},__vite__mapDeps([4,1,2,5])):window.location.pathname==="/adminsc"?await u(async()=>{const{default:l}=await import("./chartjs-CHNF-Ruf.js");return{default:l}},__vite__mapDeps([6,7])):window.location.pathname==="/adminsc/report/filter"&&new S(i(".products-filter").first())),document[c](".card-panel")){const{default:l}=await u(async()=>{const{default:a}=await import("./card_panel-CopNMo0D.js");return{default:a}},__vite__mapDeps([8,1,2,9]));new l}if(document[c](".item-wrap[data-model='product']")){const{default:l}=await u(async()=>{const{default:a}=await import("./Product-BegBD6W6.js");return{default:a}},__vite__mapDeps([10,1,2,11,12,13,14,15]));new l}const s=document[c](".item-wrap");if(s){const{default:l}=await u(async()=>{const{default:a}=await import("./catalog-item-LHEq4vUc.js");return{default:a}},__vite__mapDeps([16,1,2,17]));new l(s)}if(document[c](".order-edit")){const{default:l}=await u(async()=>{const{default:a}=await import("./order-Bn_sAYrE.js");return{default:a}},__vite__mapDeps([18,1,2,19]));new l}const n=document[c](".item-wrap[data-model='category']");if(n){const{default:l}=await u(async()=>{const{default:a}=await import("./Category-DyJeLgSW.js");return{default:a}},__vite__mapDeps([20,1,2,11,12,13,14]));new l(n)}});
//# sourceMappingURL=admin-DppbHksw.js.map
