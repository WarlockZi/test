{"version":3,"file":"search-DgdaroTd.js","sources":["../../src/Admin/DTO.js","../../src/components/search/search.js"],"sourcesContent":["export default class DTO {\n  constructor(id = 0, target = null) {\n    this.id = id ?? target?.parentNode?.dataset?.id ?? 0;\n    this.attach = target?.parentNode?.dataset?.attach ?? false;\n    this.fields = {\n      [target?.dataset?.field]:\n        target?.dataset?.value ?? target?.checked ?? target?.innerText,\n    };\n    const relFields = target?.dataset?.field;\n    const fields = relFields\n      ? {\n          [relFields]:\n            target?.dataset?.value ?? target.innerText ?? target.checked,\n        }\n      : {};\n    this.relation = {\n      name:\n        target?.dataset?.relation ??\n        target?.closest(\"[data-relation]\")?.dataset?.relation ??\n        \"\",\n      id: target?.dataset?.value ?? target?.dataset?.id ?? 0,\n      fields,\n      pivot: {\n        field:\n          target?.dataset?.pivotField ?? target?.parentNode?.dataset?.pivot,\n        value: target?.dataset?.pivotValue ?? target?.innerText,\n      },\n    };\n  }\n}\n","import \"./search.scss\";\nimport { $, createEl, debounce, post } from \"../../common.js\";\nimport { ael } from \"../../constants.js\";\n\nexport default class Search {\n  constructor(admin = false) {\n    this.admin = admin;\n    const openBtn = $(\".utils .search\").first();\n    const panel = $(\".search-panel\").first();\n\n    if (!openBtn || !panel) return;\n\n    this.openBtn = openBtn;\n    this.panel = panel;\n\n    this.text = $(panel).find(\".text\");\n    this.result = $(panel).find(\".result\");\n    this.closeBtn = $(panel).find(\".close\");\n\n    this.debouncedKeyUp = debounce(this.find, 800);\n\n    this.text[ael](\"keyup\", this.debouncedKeyUp.bind(this));\n    this.openBtn[ael](\"click\", this.togglePanel.bind(this));\n    this.closeBtn[ael](\"click\", this.togglePanel.bind(this));\n  }\n\n  togglePanel() {\n    if (!undefined == window.ym) {\n      YM(\"click_search\");\n    }\n    this.panel.classList.toggle(\"show\");\n    this.result.innerHTML = \"\";\n    this.text.value = \"\";\n  }\n\n  async find({ target }) {\n    this.result.innerHTML = \"\";\n\n    const text = target.value;\n    if (!text) return false;\n    const res = await post(\"/search\", { text });\n    if (res?.arr?.found) {\n      this.result.style.display = \"initial\";\n      res?.arr?.found.map((row) => {\n        this.result.append(this.createLi(row));\n      });\n    }\n  }\n\n  createLi(row) {\n    const li = createEl(\"li\");\n\n    const a = createEl(\"a\");\n    a.href = this.admin\n      ? `/adminsc/product/edit/${row.id}`\n      : `/product/${row.slug}`;\n    if (row.deleted_at) {\n      a.classList.add(\"deleted\");\n    }\n    li.appendChild(a);\n    const name = createEl(\"div\", \"name\", row.name);\n    const art = createEl(\"div\", \"art\", row.art);\n    const img = createEl(\"img\");\n    img.src = row.mainImage;\n    a.append(art);\n    a.append(name);\n    a.append(img);\n    li.append(a);\n    return li;\n  }\n}\n"],"names":["DTO","id","target","relFields","fields","Search","admin","openBtn","$","panel","debounce","ael","text","res","post","row","li","createEl","a","name","art","img"],"mappings":"+vBAAe,MAAMA,CAAI,CACvB,YAAYC,EAAK,EAAGC,EAAS,KAAM,CACjC,KAAK,GAAKD,GAAMC,GAAQ,YAAY,SAAS,IAAM,EACnD,KAAK,OAASA,GAAQ,YAAY,SAAS,QAAU,GACrD,KAAK,OAAS,CACZ,CAACA,GAAQ,SAAS,KAAK,EACrBA,GAAQ,SAAS,OAASA,GAAQ,SAAWA,GAAQ,SACxD,EACD,MAAMC,EAAYD,GAAQ,SAAS,MAC7BE,EAASD,EACX,CACE,CAACA,CAAS,EACRD,GAAQ,SAAS,OAASA,EAAO,WAAaA,EAAO,OACjE,EACQ,CAAE,EACN,KAAK,SAAW,CACd,KACEA,GAAQ,SAAS,UACjBA,GAAQ,QAAQ,iBAAiB,GAAG,SAAS,UAC7C,GACF,GAAIA,GAAQ,SAAS,OAASA,GAAQ,SAAS,IAAM,EACrD,OAAAE,EACA,MAAO,CACL,MACEF,GAAQ,SAAS,YAAcA,GAAQ,YAAY,SAAS,MAC9D,MAAOA,GAAQ,SAAS,YAAcA,GAAQ,SAC/C,CACF,CACL,CACA,CCzBe,MAAMG,CAAO,CAC1B,YAAYC,EAAQ,GAAO,CACzB,KAAK,MAAQA,EACb,MAAMC,EAAUC,EAAE,gBAAgB,EAAE,MAAO,EACrCC,EAAQD,EAAE,eAAe,EAAE,MAAO,EAEpC,CAACD,GAAW,CAACE,IAEjB,KAAK,QAAUF,EACf,KAAK,MAAQE,EAEb,KAAK,KAAOD,EAAEC,CAAK,EAAE,KAAK,OAAO,EACjC,KAAK,OAASD,EAAEC,CAAK,EAAE,KAAK,SAAS,EACrC,KAAK,SAAWD,EAAEC,CAAK,EAAE,KAAK,QAAQ,EAEtC,KAAK,eAAiBC,EAAS,KAAK,KAAM,GAAG,EAE7C,KAAK,KAAKC,CAAG,EAAE,QAAS,KAAK,eAAe,KAAK,IAAI,CAAC,EACtD,KAAK,QAAQA,CAAG,EAAE,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,EACtD,KAAK,SAASA,CAAG,EAAE,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,EAC3D,CAEE,aAAc,CACM,OAAO,IAArB,IACF,GAAG,cAAc,EAEnB,KAAK,MAAM,UAAU,OAAO,MAAM,EAClC,KAAK,OAAO,UAAY,GACxB,KAAK,KAAK,MAAQ,EACtB,CAEE,MAAM,KAAK,CAAE,OAAAT,GAAU,CACrB,KAAK,OAAO,UAAY,GAExB,MAAMU,EAAOV,EAAO,MACpB,GAAI,CAACU,EAAM,MAAO,GAClB,MAAMC,EAAM,MAAMC,EAAK,UAAW,CAAE,KAAAF,CAAI,CAAE,EACtCC,GAAK,KAAK,QACZ,KAAK,OAAO,MAAM,QAAU,UAC5BA,GAAK,KAAK,MAAM,IAAKE,GAAQ,CAC3B,KAAK,OAAO,OAAO,KAAK,SAASA,CAAG,CAAC,CAC7C,CAAO,EAEP,CAEE,SAASA,EAAK,CACZ,MAAMC,EAAKC,EAAS,IAAI,EAElBC,EAAID,EAAS,GAAG,EACtBC,EAAE,KAAO,KAAK,MACV,yBAAyBH,EAAI,EAAE,GAC/B,YAAYA,EAAI,IAAI,GACpBA,EAAI,YACNG,EAAE,UAAU,IAAI,SAAS,EAE3BF,EAAG,YAAYE,CAAC,EAChB,MAAMC,EAAOF,EAAS,MAAO,OAAQF,EAAI,IAAI,EACvCK,EAAMH,EAAS,MAAO,MAAOF,EAAI,GAAG,EACpCM,EAAMJ,EAAS,KAAK,EAC1B,OAAAI,EAAI,IAAMN,EAAI,UACdG,EAAE,OAAOE,CAAG,EACZF,EAAE,OAAOC,CAAI,EACbD,EAAE,OAAOG,CAAG,EACZL,EAAG,OAAOE,CAAC,EACJF,CACX,CACA"}