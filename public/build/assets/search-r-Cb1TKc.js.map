{"version":3,"file":"search-r-Cb1TKc.js","sources":["../../src/Admin/DTO.js","../../src/components/search/search.js"],"sourcesContent":["export default class DTO {\r\n  constructor(id = 0, target = null) {\r\n    this.id = id ?? target?.parentNode?.dataset?.id ?? 0;\r\n    this.attach = target?.parentNode?.dataset?.attach ?? false;\r\n    this.fields = {\r\n      [target?.dataset?.field]:\r\n        target?.dataset?.value ?? target?.checked ?? target?.innerText,\r\n    };\r\n    const relFields = target?.dataset?.field;\r\n    const fields = relFields\r\n      ? {\r\n          [relFields]:\r\n            target?.dataset?.value ?? target.innerText ?? target.checked,\r\n        }\r\n      : {};\r\n    this.relation = {\r\n      name:\r\n        target?.dataset?.relation ??\r\n        target?.closest(\"[data-relation]\")?.dataset?.relation ??\r\n        \"\",\r\n      id: target?.dataset?.value ?? target?.dataset?.id ?? 0,\r\n      fields,\r\n      pivot: {\r\n        field:\r\n          target?.dataset?.pivotField ?? target?.parentNode?.dataset?.pivot,\r\n        value: target?.dataset?.pivotValue ?? target?.innerText,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import \"./search.scss\";\r\nimport { $, createEl, debounce, post } from \"../../common.js\";\r\nimport { ael } from \"../../constants.js\";\r\n\r\nexport default class Search {\r\n  constructor(admin = false) {\r\n    this.admin = admin;\r\n    const openBtn = $(\".utils .search\").first();\r\n    const panel = $(\".search-panel\").first();\r\n\r\n    if (!openBtn || !panel) return;\r\n\r\n    this.openBtn = openBtn;\r\n    this.panel = panel;\r\n\r\n    this.text = $(panel).find(\".text\");\r\n    this.result = $(panel).find(\".result\");\r\n    this.closeBtn = $(panel).find(\".close\");\r\n\r\n    this.debouncedKeyUp = debounce(this.find, 800);\r\n\r\n    this.text[ael](\"keyup\", this.debouncedKeyUp.bind(this));\r\n    this.openBtn[ael](\"click\", this.togglePanel.bind(this));\r\n    this.closeBtn[ael](\"click\", this.togglePanel.bind(this));\r\n  }\r\n\r\n  togglePanel() {\r\n    if (!undefined == window.ym) {\r\n      YM(\"click_search\");\r\n    }\r\n    this.panel.classList.toggle(\"show\");\r\n    this.result.innerHTML = \"\";\r\n    this.text.value = \"\";\r\n  }\r\n\r\n  async find({ target }) {\r\n    this.result.innerHTML = \"\";\r\n\r\n    const text = target.value;\r\n    if (!text) return false;\r\n    const res = await post(\"/search\", { text });\r\n    if (res?.arr?.found) {\r\n      this.result.style.display = \"initial\";\r\n      res?.arr?.found.map((row) => {\r\n        this.result.append(this.createLi(row));\r\n      });\r\n    }\r\n  }\r\n\r\n  createLi(row) {\r\n    const li = createEl(\"li\");\r\n\r\n    const a = createEl(\"a\");\r\n    a.href = this.admin\r\n      ? `/adminsc/product/edit/${row.id}`\r\n      : `/product/${row.slug}`;\r\n    if (row.deleted_at) {\r\n      a.classList.add(\"deleted\");\r\n    }\r\n    li.appendChild(a);\r\n    const name = createEl(\"div\", \"name\", row.name);\r\n    const art = createEl(\"div\", \"art\", row.art);\r\n    const img = createEl(\"img\");\r\n    img.src = row.mainImage;\r\n    a.append(art);\r\n    a.append(name);\r\n    a.append(img);\r\n    li.append(a);\r\n    return li;\r\n  }\r\n}\r\n"],"names":["DTO","id","target","relFields","fields","Search","admin","openBtn","$","panel","debounce","ael","text","res","post","row","li","createEl","a","name","art","img"],"mappings":"qGAAe,MAAMA,CAAI,CACvB,YAAYC,EAAK,EAAGC,EAAS,KAAM,CACjC,KAAK,GAAKD,GAAMC,GAAQ,YAAY,SAAS,IAAM,EACnD,KAAK,OAASA,GAAQ,YAAY,SAAS,QAAU,GACrD,KAAK,OAAS,CACZ,CAACA,GAAQ,SAAS,KAAK,EACrBA,GAAQ,SAAS,OAASA,GAAQ,SAAWA,GAAQ,SAC7D,EACI,MAAMC,EAAYD,GAAQ,SAAS,MAC7BE,EAASD,EACX,CACE,CAACA,CAAS,EACRD,GAAQ,SAAS,OAASA,EAAO,WAAaA,EAAO,OACxD,EACD,GACJ,KAAK,SAAW,CACd,KACEA,GAAQ,SAAS,UACjBA,GAAQ,QAAQ,iBAAiB,GAAG,SAAS,UAC7C,GACF,GAAIA,GAAQ,SAAS,OAASA,GAAQ,SAAS,IAAM,EACrD,OAAAE,EACA,MAAO,CACL,MACEF,GAAQ,SAAS,YAAcA,GAAQ,YAAY,SAAS,MAC9D,MAAOA,GAAQ,SAAS,YAAcA,GAAQ,SAC/C,CACP,CACG,CACH,CCzBe,MAAMG,CAAO,CAC1B,YAAYC,EAAQ,GAAO,CACzB,KAAK,MAAQA,EACb,MAAMC,EAAUC,EAAE,gBAAgB,EAAE,MAAK,EACnCC,EAAQD,EAAE,eAAe,EAAE,MAAK,EAElC,CAACD,GAAW,CAACE,IAEjB,KAAK,QAAUF,EACf,KAAK,MAAQE,EAEb,KAAK,KAAOD,EAAEC,CAAK,EAAE,KAAK,OAAO,EACjC,KAAK,OAASD,EAAEC,CAAK,EAAE,KAAK,SAAS,EACrC,KAAK,SAAWD,EAAEC,CAAK,EAAE,KAAK,QAAQ,EAEtC,KAAK,eAAiBC,EAAS,KAAK,KAAM,GAAG,EAE7C,KAAK,KAAKC,CAAG,EAAE,QAAS,KAAK,eAAe,KAAK,IAAI,CAAC,EACtD,KAAK,QAAQA,CAAG,EAAE,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,EACtD,KAAK,SAASA,CAAG,EAAE,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,EACxD,CAED,aAAc,CACM,OAAO,IAArB,IACF,GAAG,cAAc,EAEnB,KAAK,MAAM,UAAU,OAAO,MAAM,EAClC,KAAK,OAAO,UAAY,GACxB,KAAK,KAAK,MAAQ,EACnB,CAED,MAAM,KAAK,CAAE,OAAAT,GAAU,CACrB,KAAK,OAAO,UAAY,GAExB,MAAMU,EAAOV,EAAO,MACpB,GAAI,CAACU,EAAM,MAAO,GAClB,MAAMC,EAAM,MAAMC,EAAK,UAAW,CAAE,KAAAF,CAAM,CAAA,EACtCC,GAAK,KAAK,QACZ,KAAK,OAAO,MAAM,QAAU,UAC5BA,GAAK,KAAK,MAAM,IAAKE,GAAQ,CAC3B,KAAK,OAAO,OAAO,KAAK,SAASA,CAAG,CAAC,CAC7C,CAAO,EAEJ,CAED,SAASA,EAAK,CACZ,MAAMC,EAAKC,EAAS,IAAI,EAElBC,EAAID,EAAS,GAAG,EACtBC,EAAE,KAAO,KAAK,MACV,yBAAyBH,EAAI,EAAE,GAC/B,YAAYA,EAAI,IAAI,GACpBA,EAAI,YACNG,EAAE,UAAU,IAAI,SAAS,EAE3BF,EAAG,YAAYE,CAAC,EAChB,MAAMC,EAAOF,EAAS,MAAO,OAAQF,EAAI,IAAI,EACvCK,EAAMH,EAAS,MAAO,MAAOF,EAAI,GAAG,EACpCM,EAAMJ,EAAS,KAAK,EAC1B,OAAAI,EAAI,IAAMN,EAAI,UACdG,EAAE,OAAOE,CAAG,EACZF,EAAE,OAAOC,CAAI,EACbD,EAAE,OAAOG,CAAG,EACZL,EAAG,OAAOE,CAAC,EACJF,CACR,CACH"}