{"version":3,"file":"catalog-item-CfUbc5r-.js","sources":["../../src/components/date/date.js","../../src/components/checkbox/checkbox.js","../../src/Admin/RelationDTO.js","../../src/Admin/components/catalog-item/catalog-item.js"],"sourcesContent":["import {fragmentDate} from '../../common'\r\nimport './date.scss'\r\nimport {ael} from \"@src/constants.js\";\r\n\r\nexport default class CustomDate {\r\n   constructor(date) {\r\n      this.date = date;\r\n      this.date[ael]('change', this.onChange.bind(this));\r\n   }\r\n\r\n   onChange({target}) {\r\n      const {yyyy, mm, dd} = fragmentDate(target.value)\r\n      const formated = `${yyyy}-${mm}-${dd}`\r\n      target.setAttribute('data-value', formated)\r\n      const customEvent =\r\n         new CustomEvent('date.changed',\r\n            {bubbles: true, cancelable: true, detail: {value: formated}}\r\n         )\r\n      target.dispatchEvent(customEvent)\r\n   }\r\n}\r\n","import {ael} from \"@src/constants.js\";\r\n\r\nexport default class Checkbox {\r\n   constructor(checkbox) {\r\n      this.id = checkbox.id;\r\n      this.checkbox = checkbox;\r\n      // this.field = checkbox?.dataset?.field ?? null;\r\n      checkbox[ael]('change', this.changed.bind(this));\r\n   }\r\n\r\n   async changed({target}) {\r\n      target.dataset.pivotValue = +target.checked\r\n      this.checkbox.dispatchEvent(\r\n         new CustomEvent('checkbox.changed', {\r\n            bubbles: true,\r\n            detail: target.checked\r\n         })\r\n      );\r\n   }\r\n}","export default class RelationDTO {\r\n   constructor(target, prev) {\r\n      if (!target) return\r\n      this.target = target;\r\n//model\r\n      this.id = target?.closest('.item-wrap')?.dataset?.id\r\n\r\n      // this.fields = target?.dataset?.field ?? false\r\n\r\n      this.relation = target?.dataset?.relation\r\n         ?? target?.closest('[data-relation]')?.dataset?.relation\r\n         ?? false\r\n\r\n      this.pivot = target?.dataset?.pivot\r\n         ?? target?.parentNode?.dataset?.pivot\r\n         ?? false\r\n      this.attach = !!this.target?.closest('[custom-table]')?.dataset?.relationtype\r\n\r\n      if (this.fields) {\r\n         this.fields = {[target?.dataset?.field]: target?.dataset?.value ?? target?.checked ?? target?.innerText}\r\n      }\r\n\r\n      if (this.relation) {\r\n         const name = this.relation\r\n         this.relation = {}\r\n         this.relation.name = name\r\n         this.relation.id = target?.dataset?.value\r\n            ?? target?.dataset?.id\r\n            ?? 0\r\n            ?? target?.closest('[data-relation]')?.dataset?.relation\r\n            ?? 0\r\n\r\n\r\n         if (this.attach && !this.pivot) {\r\n            this.relation.attach = this.target?.dataset?.id\r\n               ?? this.target?.dataset.value\r\n            this.relation.detach = prev ?? null\r\n         } else if (this.pivot) {\r\n            delete this.attach\r\n            this.relation.pivot = {}\r\n            this.relation.pivot[target?.dataset?.pivot] =\r\n               target?.dataset?.value ?? target?.checked ?? target?.innerText\r\n         } else {\r\n            this.relation.fields = {}\r\n            const fieldName = target?.dataset?.field ?? target?.dataset.pivot\r\n            this.relation.fields[fieldName] =\r\n               target?.dataset?.value ?? target?.checked ?? target?.innerText\r\n         }\r\n      }\r\n      if (!this.fields) delete this.fields\r\n      if (!this.relation) delete this.relation\r\n      delete this.attach\r\n      delete this.pivot\r\n      delete this.target\r\n\r\n   }\r\n}","import './catalog-item.scss';\r\nimport {$, debounce, post} from '../../../common.js';\r\nimport {ael} from \"../../../constants.js\";\r\nimport DTO from \"../../../Admin/DTO.js\";\r\nimport Checkbox from \"../../../components/checkbox/checkbox.js\";\r\nimport SelectNew from \"../../../components/select/SelectNew.js\";\r\nimport CustomDate from \"../../../components/date/date.js\";\r\nimport RelationDTO from \"@src/Admin/RelationDTO.js\";\r\n\r\nexport default class CatalogItem {\r\n   constructor(catalogItem) {\r\n      if (!catalogItem) return false\r\n\r\n      this.model = catalogItem.dataset.model;\r\n      this.id = +catalogItem.dataset.id;\r\n      this.setCheckboxes()\r\n      this.setSelects()\r\n      this.setDates()\r\n\r\n      catalogItem[ael]('click', this.handleClick.bind(this))\r\n      catalogItem[ael]('keyup', debounce(this.handleKeyup.bind(this)))\r\n      catalogItem[ael]('date.changed', this.handleDateChange.bind(this))\r\n      catalogItem[ael]('customSelect.changed', this.handleSelectChange.bind(this))\r\n      if (this.model) {\r\n         catalogItem[ael]('checkbox.changed', this.handleChexboxChange.bind(this))\r\n      }\r\n   }\r\n\r\n   setCheckboxes() {\r\n      const checks = $('[my-checkbox]');\r\n      [].forEach.call(checks, function (check) {\r\n         new Checkbox(check)\r\n      })\r\n   }\r\n\r\n   setDates() {\r\n      const dates = $('[custom-date]');\r\n      [].forEach.call(dates, function (date) {\r\n         new CustomDate(date)\r\n      })\r\n   }\r\n\r\n   setSelects() {\r\n      const selects = $('[select-new]:has(option)');\r\n      [].forEach.call(selects, function (select) {\r\n         if (!select.parentNode.hasAttribute('hidden'))\r\n            new SelectNew(select)\r\n      })\r\n   }\r\n\r\n   handleChexboxChange({target}) {\r\n      if (target.closest('[custom-table]')) return\r\n      this.update(target)\r\n   }\r\n\r\n   async handleSelectChange({target}) {\r\n      if (target.closest('[custom-table]')) return\r\n      this.update(target)\r\n   }\r\n\r\n   async handleDateChange({target}) {\r\n      this.update(target)\r\n   }\r\n\r\n   async handleKeyup({target}) {\r\n      if (target.closest('.custom-table')) return false\r\n      if (!target.hasAttribute('contenteditable') ||\r\n         !target.dataset.field) return false\r\n      let dto = {}\r\n      if (target.dataset.relation) {\r\n         dto = new RelationDTO(target)\r\n      } else {\r\n         dto = new DTO(this.id, target)\r\n      }\r\n      const res = await post(`/adminsc/${this.model}/updateOrCreate`, dto)\r\n      if (res) {\r\n         target.dispatchEvent(new CustomEvent('catalogItem.changed',\r\n            {bubbles: true, detail: {res}})\r\n         )\r\n      }\r\n   }\r\n\r\n   async handleClick({target}) {\r\n      if ((target.classList.contains('tab'))) {\r\n         this.handleTabClick(target)\r\n      }\r\n   }\r\n\r\n   handleTabClick(target) {\r\n      $(`[data-tab].show`).first().classList.toggle('show');\r\n      $(`[data-tab='${target.dataset.tabId}']`).first().classList.toggle('show');\r\n      $(`.tab.active`).first().classList.toggle('active');\r\n      target.classList.toggle('active')\r\n   }\r\n\r\n   async update(target) {\r\n      if (target.closest('[custom-table]')) return\r\n      const dto = new DTO(this.id, target)\r\n      const res = await post(`/adminsc/${this.model}/updateorcreate`, dto)\r\n   }\r\n}"],"names":["CustomDate","date","ael","target","yyyy","mm","dd","fragmentDate","formated","customEvent","Checkbox","checkbox","RelationDTO","prev","name","fieldName","CatalogItem","catalogItem","debounce","checks","$","check","dates","selects","select","SelectNew","dto","DTO","res","post"],"mappings":"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"}