import{c as l,$ as a,p as n}from"./common-DGD66q32.js";class c{constructor(t){if(t)return this.ul=new l().tag("ul").attr("class","options").get(),this.label=new l().tag("span").get(),this.options=this.getFormattedOptions(t.querySelectorAll("option")),this.space=new l().tag("div").attr("class","space").text(this?.selectedOption?.label).get(),this.arrow=new l().tag("div").attr("class","arrow").get(),this.sel=this.createSelectTag(t),t.after(this.sel),this.label.append(this.space),this.label.append(this.arrow),this.sel.append(this.label),this.sel.append(this.ul),t.remove(),this.ul.addEventListener("click",this.handleUlClick.bind(this)),this.label.addEventListener("click",this.handleLabelClick.bind(this)),this.sel.addEventListener("blur",this.handleSelectBlur.bind(this)),this.sel.addEventListener("keydown",this.handleSelectKeydown.bind(this)),this}getFormattedOptions(t){return[...t].map(e=>{const s=new l().tag("li").text(e.label).attr("data-value",e.value).get();return e.selected&&s.classList.add("selected"),this.ul.append(s),{value:e.value,label:e.label,selected:e.selected,element:s,option:e}})}createSelectTag(t){const e=this.setSelectTag(t);return t.hasAttribute("data-field")&&e.attr("data-field",t.dataset.field),t.hasAttribute("data-relation")&&e.attr("data-relation",t.dataset.relation),t.hasAttribute("data-pivot")&&e.attr("data-pivot",t.dataset.pivot),t.firstElementChild.hasAttribute("data-relation")&&e.attr("data-relation",t.firstChild.dataset.relation),t.firstElementChild.hasAttribute("data-relationmodel")&&e.attr("data-relationmodel",t.firstChild.dataset.relationmodel),e.get()}setSelectTag(t){return new l().tag("div").className(t?.className).field(t.dataset.field).attr("select-new","").attr("data-value",this?.selectedOption?.value??"").attr("tabindex","0")}handleSelectBlur(){this.ul.classList.remove("show")}handleLabelClick(){this.ul.classList.toggle("show")}handleUlClick({target:t}){t.classList.add("selected"),this.selectedOption.element.classList.remove("selected"),this.selectValue(t.dataset.value),this.ul.classList.remove("show")}onchange(t){this.callback=t}handleSelectKeydown(t){let e,s="";if(t.code==="Space")select.ul.classList.toggle("show");else if(t.code==="ArrowUp"){const i=select.options[select.selectedOptionIndex-1];i&&select.selectValue(i.value)}else if(t.code==="ArrowDown"){const i=select.options[select.selectedOptionIndex+1];i&&select.selectValue(i.value)}else if(t.code==="Enter"||t.code==="Escape")select.ul.classList.remove("show");else{clearTimeout(e),s+=t.key,e=setTimeout(()=>{s=""},500);const i=this.options.find(r=>r.label.toLowerCase().includes(s));i&&this.sel.selectValue(i.value)}}get selectedOption(){return this.options.find(t=>t.selected)}get selectedOptionIndex(){return this.options.indexOf(this.selectedOption)}selectValue(t){const e=this.options.find(i=>i.value===t),s=this.selectedOption;s.selected=!1,e.selected=!0,this.space.innerText=e.label,this.sel.dataset.value=e.value,s.element.classList.remove("selected"),e.element.classList.add("selected"),e.element.scrollIntoView({block:"nearest"}),this.sel.dispatchEvent(new CustomEvent("customSelect.changed",{bubbles:!0,detail:{next:e,prev:s,target:this.sel}}))}}class o{constructor(){this.$promotion=a(".promotion-edit").first(),this.$promotion&&(this.updateUrl="/adminsc/promotion/updateOrCreate",this.id=a(this.$promotion).find("[data-field='id']").innerText,this.$count=a("[data-field='count']").first(),this.$unit=a("[select-new].unit").first(),new c(this.$unit),a('[data-field="unit"]').first().addEventListener("customSelect.changed",this.unitChanged.bind(this)),this.$newPrice=a('[data-field="new_price"]').first(),this.$activeTill=a("[data-field='active-till']").first(),this.$activeTill.addEventListener("change",this.activetillChanged.bind(this)))}unitChanged(t){let e=this.dto(this);e.unit_id=t.detail.next.value,n(this.updateUrl,e)}async activetillChanged({target:t}){let e=this.dto(this);e.active_till=t.value,await n(this.updateUrl,e)}dto(t){return{id:this.id}}}const u=Object.freeze(Object.defineProperty({__proto__:null,default:o},Symbol.toStringTag,{value:"Module"}));export{o as P,c as S,u as a};
//# sourceMappingURL=Promotion-CK6VXB02.js.map
