{"version":3,"file":"login-DlOdihQm.js","sources":["../../src/Auth/login.js"],"sourcesContent":["import {$, post, validate} from \"../common\";\r\n\r\nexport default class Login {\r\n    constructor() {\r\n        this.loginForm = $(\"[data-auth='login']\").first();\r\n        if (!this.loginForm) return false\r\n        this.loginForm.addEventListener('click', this.sendData.bind(this))\r\n        this.email = $('input[type = email]')[0];\r\n        this.pass = $('input[name= password]')[0];\r\n        this.msg = $('.message')[0];\r\n    }\r\n\r\n    async sendData({target}) {\r\n        if (target.classList.contains('submit__button')) {\r\n            let data = {\r\n                \"email\": this.email.value,\r\n                \"password\": this.pass.value,\r\n            };\r\n            if (this.validateData()) {\r\n                const res = await this.send(data)\r\n                await this.parseLoginResponse(res)\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    validateData() {\r\n        let error = validate.email(this.email.value);\r\n        if (error) {\r\n            this.msg.innerText = '';\r\n            this.msg.innerText = error;\r\n            $(this.msg).addClass('error');\r\n            return false\r\n        }\r\n        const suemail = env?.VITE_SU_EMAIL;\r\n        const su = suemail === this.email.value;\r\n        if (!su) {\r\n            error = validate.password(this.pass.value);\r\n            if (error) {\r\n                this.msg.innerText = '';\r\n                this.msg.innerText = error;\r\n                $(this.msg).addClass('error');\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    async send(data) {\r\n        return await post('/auth/login', data);\r\n    }\r\n\r\n    async parseLoginResponse(res) {\r\n        const id = res?.arr?.id\r\n        localStorage.setItem('id', id)\r\n        if (res?.arr?.role === 'employee') {\r\n            window.location = '/adminsc'\r\n        } else if (res?.arr?.role === 'user') {\r\n            window.location = '/auth/profile'\r\n        } else if (res?.error) {\r\n\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n"],"names":["Login","$","target","data","res","error","validate","post","id"],"mappings":"uDAEe,MAAMA,CAAM,CACvB,aAAc,CAEV,GADA,KAAK,UAAYC,EAAE,qBAAqB,EAAE,MAAK,EAC3C,CAAC,KAAK,UAAW,MAAO,GAC5B,KAAK,UAAU,iBAAiB,QAAS,KAAK,SAAS,KAAK,IAAI,CAAC,EACjE,KAAK,MAAQA,EAAE,qBAAqB,EAAE,CAAC,EACvC,KAAK,KAAOA,EAAE,uBAAuB,EAAE,CAAC,EACxC,KAAK,IAAMA,EAAE,UAAU,EAAE,CAAC,CAC7B,CAED,MAAM,SAAS,CAAC,OAAAC,CAAM,EAAG,CACrB,GAAIA,EAAO,UAAU,SAAS,gBAAgB,EAAG,CAC7C,IAAIC,EAAO,CACP,MAAS,KAAK,MAAM,MACpB,SAAY,KAAK,KAAK,KACtC,EACY,GAAI,KAAK,eAAgB,CACrB,MAAMC,EAAM,MAAM,KAAK,KAAKD,CAAI,EAChC,MAAM,KAAK,mBAAmBC,CAAG,CACpC,CACJ,CACJ,CAGD,cAAe,CACX,IAAIC,EAAQC,EAAS,MAAM,KAAK,MAAM,KAAK,EAC3C,OAAID,GACA,KAAK,IAAI,UAAY,GACrB,KAAK,IAAI,UAAYA,EACrBJ,EAAE,KAAK,GAAG,EAAE,SAAS,OAAO,EACrB,IAIP,EAFY,KAAK,gBACE,KAAK,MAAM,SAE9BI,EAAQC,EAAS,SAAS,KAAK,KAAK,KAAK,EACrCD,IACA,KAAK,IAAI,UAAY,GACrB,KAAK,IAAI,UAAYA,EACrBJ,EAAE,KAAK,GAAG,EAAE,SAAS,OAAO,EACrB,IAGR,EACV,CAED,MAAM,KAAKE,EAAM,CACb,OAAO,MAAMI,EAAK,cAAeJ,CAAI,CACxC,CAED,MAAM,mBAAmBC,EAAK,CAC1B,MAAMI,EAAKJ,GAAK,KAAK,GACrB,aAAa,QAAQ,KAAMI,CAAE,EACzBJ,GAAK,KAAK,OAAS,WACnB,OAAO,SAAW,WACXA,GAAK,KAAK,OAAS,OAC1B,OAAO,SAAW,gBACXA,GAAK,KAGnB,CAEL"}