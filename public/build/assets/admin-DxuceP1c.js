const __vite__fileDeps=["assets/index-D6yZjWhN.js","assets/common-mpP3SXMn.js","assets/index-Du3s5jNk.css","assets/accordion-ElzkfWrb.js","assets/constants-Clh-pk9Y.js","assets/search-DsFt8jV2.js","assets/search-CSsocALt.css","assets/Promotion-wHnIeNLc.js","assets/Promotion-C-yV3o17.css","assets/quill.snow-DpC92mTv.js","assets/quill-BS3afWzt.css","assets/Product-Br6AGZCg.js","assets/quill-oEZV8zch.js","assets/Product-g_McCRne.css","assets/product-BjfEtDHX.css","assets/order-ClxgSy-l.js","assets/order-B2jhaEIF.css","assets/modal-BHcfbFZS.js","assets/modal-aJpmGEvw.css","assets/Category-Cx3Y9SM7.js","assets/Category-zDh5mQwT.css","assets/AdminAccordion-DEItYKst.js","assets/chartjs-D8I9db7I.js","assets/chartjs-BPcd8uUI.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{$ as a,l as g,p as c,d as w,_ as r}from"./common-mpP3SXMn.js";import v from"./search-DsFt8jV2.js";import{q as h}from"./constants-Clh-pk9Y.js";import{P as E}from"./Promotion-wHnIeNLc.js";import"./quill.snow-DpC92mTv.js";let m=a("[custom-date]");if(m)for(let n of m)n.onchange=function({target:t}){let{yyyy:e,mm:s,dd:i}=g(t.value),o=`${e}-${s}-${i}`;t.value,t.setAttribute("data-value",o)};class C{constructor(t){this.$sync=t,this.$log_content=a(t).find("#log_content"),this.$sync.onclick=this.handleClick.bind(this)}async handleClick({target:t}){if(t.classList.contains("button")){let e=await c(`/adminsc/sync/${t.id}`);e?.arr?.success&&(this.$log_content.innerText=e.arr?.content)}}}let p=a(".sync").first();p&&new C(p);const A=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function k(n){/\/adminsc\/settings/.test(n)||/\/adminsc\/right\/list/.test(n)||/\/adminsc\/post\/list/.test(n)||/\/adminsc\/todo\/list/.test(n)?a("[settings]").addClass("current"):/\/auth\/profile/.test(n)||(/\/adminsc\/crm/.test(n)?a("[crm]").addClass("current"):/\/adminsc\/planning/.test(n)?a("[plan]").addClass("current"):/\/adminsc\/category/.test(n)||/\/adminsc\/product/.test(n)?a("[catalog]").addClass("current"):/\/test/.test(n)||/\/opentest/.test(n)||/\/adminsc\/opentest/.test(n)||/\/adminsc\/test/.test(n)?a("[test]").addClass("current"):a("[href='/adminsc']").addClass("current"))}class T{constructor(t){this.table=t,this.model=t.dataset.model??t.closest("[data-model]")?.dataset.model,this.modelId=t.dataset.id??t.closest("[data-model]")?.dataset.id,this.relation=t.dataset.relation??null,this.relationModel=t.dataset.relationmodel??null,this.url=`/adminsc/${this.model}/updateOrCreate`,this.headers=a(".head"),this.inputs=a(".head input"),this.hidden=a("[hidden]"),this.editable=a("[contenteditable]"),this.sortables=a("[data-sort]"),this.ids=this.getIds(),this.rows=this.fillRows(),this.WSSelects=a("[custom-select]"),[].forEach.call(this.WSSelects,e=>{e.onchange=this.customSelectChange}),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=w(this.handleInput),this.directions=Array.from(this.sortables).map(function(e){return""})}async handleClick(t){const e=t.target;if(e.className==="add-model")this.createModel(e);else if(e.className===".del:not(.head)"||e.closest(".del:not(.head)"))this.modelDel(e.closest(".del:not(.head)"));else if(e.className==="edit:not(.head)"||e.closest(".edit:not(.head)"))t.preventDefault(),this.edit(e);else if(e.type==="checkbox"){const s=e.dataset.func,i=e.checked,o=e.dataset["1sid"],l={base_is_shippable:i,product_1s_id:o};await c(`/adminsc/${this.model}/${s}`,l)}else if(e.classList.contains("head")||e.classList.contains("icon")){const s=e.closest(".head");if(s.hasAttribute("data-sort")){const i=[].findIndex.call(sortables,(o,l,d)=>o===s);this.sortColumn(i)}}}edit(t){const e=this.relation?this.relationModel:this.model,s=this.relation?t.dataset.id:this.modelId??t.dataset.id;window.location=`/adminsc/${e}/edit/${s}`}async customSelectChange({target:t}){if(!t.closest("[data-model]"))return!1;const s=t.options.selectedIndex,i=t.options[s].value,o={[this.field]:i,id:this.modelId};await c(this.url,o)}getIds(){let t=a(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,function(e){return e.dataset.id!=="0"})}handlePaste(t){t.target.innerText=t.clipboardData.getData("text/plain"),this.handleInput(t.target),t.target.innerText=""}handleKeyUp(t){let e=t.target;if(t.cancelBubble=!0,e.hasAttribute("contenteditable"))this.debouncedInput(e);else if(e.closest(".head")){const s=e.closest(".head"),i=[].findIndex.call(this.headers,(o,l,d)=>o===s);this.search(i,e)}}async handleInput(t){const e=this.createModel(t),s=await c(this.url,e);s.arr.id&&this.newRow(s?.arr.id).bind(this)}async modelDel(t){if(!confirm("Удалить?"))return;let e=t.dataset.id;await c(`/adminsc/${this.model}/delete`,{id:e})&&delView(e)}createModel(t){return{model:this.model,id:this.modelId,relation:this.relation,fields:this.relationDTO(t)}}relationDTO(t){return this.relation?{id:t.dataset.id,[t.dataset.field]:t.innerText}:null}newRow(t){[].forEach.call(this.hidden,function(e){const s=e.cloneNode(!0);s.removeAttribute("hidden"),a(this.table).find(".custom-table").appendChild(s),["id"].includes(s.dataset.field)?s.innerText=t:["del","edit","save"].includes(s.className)||s.hasChildNodes("select")||(s.innerText=""),s.dataset.id=t}.bind(this))}showAllRows(){[].forEach.call(this.rows,t=>{[].forEach.call(t,e=>{e.style.display="flex"})})}search(t,e){this.showAllRows();const s=e.value;[].forEach.call(this.inputs,i=>{i!==e&&(i.value="")}),[].forEach.call(this.rows,function(i){const o=i[t].innerText,l=new RegExp(`${s}`,"gi");o.match(l)||[].forEach.call(i,d=>{d.style.display="none"})})}fillRows(){let t=[];for(let e=0;e<this.ids.length;e++){let s=this.ids[e].dataset.id,i=a(this.table)[0].querySelectorAll(`[data-id='${s}']`);t.push(i)}return t}sortColumn(t){const e=this.fillRows(),s=this.directions[t]||"asc",i=s==="asc"?1:-1,o=Array.from(e);o.sort(function(l,d){const _=l[t].innerHTML,y=d[t].innerHTML,u=this.transform(t,_),f=this.transform(t,y);switch(!0){case u>f:return 1*i;case u<f:return-1*i;case u===f:return 0}}),[].forEach.call(e,function(l){[].forEach.call(l,d=>{d.remove()})}),this.directions[t]=s==="asc"?"desc":"asc",o.forEach(function(l){l=Array.from(l),l.reverse(),[].forEach.call(l,d=>{this.headers[this.headers.length-1].after(d)})})}transform(t,e){return this.sortables[t]?this.sortables[t].getAttribute("data-type")==="number"?parseFloat(e):e:void 0}save(t){return c(this.url,t.model)}makeServerModel(t){const e=this.model;return{model:{id:t.dataset.id,[t.dataset.field]:t.innerText},modelName:e}}delView(t){const e=a(`[data-id='${t}']`);[].forEach.call(e,function(s){s.remove()})}}const b=a("[custom-table]");b&&[].forEach.call(b,function(n){new T(n)});class I{constructor(t,e){return this.container=a(t).first(),this.container?(this.data={},this.setContext(e),this):null}getValue(){let t=[...a("input[type='checkbox']")].filter(e=>e.checked).map(e=>e.dataset.id);if(t)return t.join(",")}setContext(t){return this.model=t.model,this.data.id=t.id,this}onChange(t){this.container&&(this.container.onchange=function(){let e=this.getValue();this.container.dataset.value=e,this.data[this.container.dataset.field]=e,t.call(this)}.bind(this))}}function $(){return new I(...arguments)}class L{constructor(t,e){a("[my-checkbox]").on("change",this.changeHandle.bind(t))}async changeHandle({target:t}){let e=t?.dataset.field,s={id:this.id,[e]:+t.checked};await c(`/adminsc/${this.model}/updateOrCreate`,s)}}function x(){return new L(...arguments)}class D{constructor(t){if(!t)return!1;this.model=t.dataset.model,this.id=+t.dataset.id,$("[checkboxes]",this.dto()).onChange(this.update),x(this.dto()),t.onclick=this.handleClick.bind(this),t.onkeyup=w(this.handleKeyup.bind(this))}dto(){return{model:this.model,id:this.id}}async handleKeyup({target:t}){if(!t.hasAttribute("contenteditable")||!t.dataset.field)return!1;const e=t.dataset.field,s=t.dataset.relation,i=this.dto();i.relation=s??null,i.fields={[e]:t.innerText};const o=await c(`/adminsc/${this.model}/updateOrCreate`,i);o&&t.dispatchEvent(new CustomEvent("catalogItem.changed",{bubbles:!0,detail:{res:o}}))}async handleClick({target:t}){t.closest(".save")||t.closest(".detach")||(t.hasAttribute("soft-del")?softDel(this):t.classList.contains("tab")?this.handleTabClick(t):t.getAttribute("type"))}handleTabClick(t){const e=t.dataset.tabId;a("[data-tab].show").first().classList.toggle("show"),a(`[data-tab='${e}']`).first().classList.toggle("show"),a(".tab.active").first().classList.toggle("active"),t.classList.toggle("active")}async softDel(t){let e=`/adminsc/${t.model}/updateorcreate`,s=new Date().toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,minute:"2-digit"});debugger;let i={deleted_at:s,id:t.id};await c(e,i)&&console.log("lk------")}async update(){await c(`/adminsc/${this.model}/updateorcreate`,this.data)}}document.addEventListener("scroll",n=>{const t=document.querySelector(".admin-panel");if(!t)return!1;window.scrollY>30&&(t.style.position="fixed",t.style.top="0"),window.scrollY<20&&(t.style.position="relative")},{passive:!0});a(document).ready(async function(){window.location.href.includes("/test")&&await r(()=>import("./index-D6yZjWhN.js").then(d=>d.i),__vite__mapDeps([0,1,2]));const t=a(".admin-sidebar").first();if(t){const{default:d}=await r(()=>import("./accordion-ElzkfWrb.js"),__vite__mapDeps([3,1,4,5,6,7,8,9,10]));new d(t)}const{default:e}=await r(()=>import("./Product-Br6AGZCg.js"),__vite__mapDeps([11,1,7,8,4,12,9,10,13,14]));if(new e,document[h](".order-edit")){const{default:d}=await r(()=>import("./order-ClxgSy-l.js"),__vite__mapDeps([15,7,1,8,16]));new d}if(document[h](".modal-wrapper")){const{default:d}=await r(()=>import("./modal-BHcfbFZS.js"),__vite__mapDeps([17,1,18]));new d}const s=document[h](".item-wrap[data-model='category']");if(s){const{default:d}=await r(()=>import("./Category-Cx3Y9SM7.js"),__vite__mapDeps([19,1,7,8,4,20,14]));new d(s)}if(new E,new v(!0),document[h](".admin_sidebar")){const{default:d}=await r(()=>import("./AdminAccordion-DEItYKst.js"),__vite__mapDeps([21,1,4]));new d}k(window.location.pathname);const i=a(".item-wrap")[0];i&&new D(i),document.getElementById("income")&&await r(()=>import("./chartjs-D8I9db7I.js"),__vite__mapDeps([22,23])),window.location.pathname==="/adminsc/settings"&&await r(()=>Promise.resolve().then(()=>A),void 0)});
