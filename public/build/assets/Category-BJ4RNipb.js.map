{"version":3,"file":"Category-BJ4RNipb.js","sources":["../../src/Admin/Category/PropertyTable.js","../../src/Admin/Category/Category.js"],"sourcesContent":["import { $, post } from \"../../common.js\";\r\nimport SelectNew from \"../../components/select/SelectNew\";\r\nimport { ael, qa, qs } from \"../../constants.js\";\r\n\r\nexport default class PropertyTable {\r\n  constructor(el) {\r\n    this.el = el;\r\n    // this.rowsWrap = this.el[qs]('.rows');\r\n    // this.rows = this.el[qa]('.rows>.row');\r\n    this.$addBtn = this.el[qs](\".add-property\");\r\n\r\n    if (this.$addBtn) this.$addBtn[ael](\"click\", this.newRow.bind(this));\r\n  }\r\n\r\n  async handleClick({ target }) {\r\n    {\r\n      if (target.classList.contains(\"del\")) {\r\n        this.deleteRow(target);\r\n      } else if (target.classList.contains(\"edit\")) {\r\n        this.editProperty(target);\r\n      }\r\n    }\r\n  }\r\n\r\n  async editProperty(target) {\r\n    let id = target.closest(\".row\").querySelector(\"[select-new]\").dataset.value;\r\n    location.href = `/adminsc/property/edit/${id}`;\r\n  }\r\n\r\n  async deleteRow(target) {\r\n    let $row = target.closest(\".row\");\r\n    let $selector = $($row).find(\"[select-new]\");\r\n    let id = +$selector.dataset.value;\r\n    let data = this.dto();\r\n    data.morphed.new_id = 0;\r\n    data.morphed.old_id = id;\r\n    let res = await post(`/adminsc/category/changeProperty`, data);\r\n    if (res?.ok) $row.remove();\r\n  }\r\n\r\n  async propertyChange(obj) {\r\n    {\r\n      let data = this.dto(obj);\r\n      let res = await post(`/adminsc/category/changeProperty`, data);\r\n    }\r\n  }\r\n\r\n  dto(obj = {}) {\r\n    return {\r\n      category_id: this.el.closest(`[data-model=\"category\"]`).dataset.id,\r\n      morphed: {\r\n        old_id: +obj?.detail?.prev?.value,\r\n        new_id: +obj?.detail?.next?.value,\r\n      },\r\n    };\r\n  }\r\n\r\n  newRow() {\r\n    let $clone = this.rowsWrap.querySelector(\".none .row\").cloneNode(true);\r\n    new SelectNew($($clone).find(\"[custom-select]\"));\r\n    this.rowsWrap.append($clone);\r\n  }\r\n}\r\n","import \"../Product/product.scss\";\r\nimport \"./category.scss\";\r\nimport PropertyTable from \"./PropertyTable\";\r\nimport { $, post } from \"../../common.js\";\r\nimport SelectNew from \"../../components/select/SelectNew\";\r\nimport QuillFactory from \"@src/components/quill/QuillFactory.js\";\r\nimport { QuillConst } from \"@src/components/quill/QuillConstans.js\";\r\n\r\nexport default class Category {\r\n  constructor(el) {\r\n    this.el = el;\r\n    this.id = el.dataset.id;\r\n    this.setCategoryId();\r\n    this.setProperties();\r\n    QuillFactory.create(\"#seo-article\", QuillConst.ADMIN_CATEGORY_SEO_ARTICLE);\r\n  }\r\n\r\n  setCategoryId() {\r\n    const el = $(`[data-field='category_id']`).first();\r\n    const parentSelector = new SelectNew(el);\r\n  }\r\n\r\n  setProperties() {\r\n    new PropertyTable(this.el.querySelector(`[data-relation=\"properties\"]`));\r\n  }\r\n\r\n  dto(change) {\r\n    return {\r\n      id: this.id,\r\n      relation: \"ownProperties\",\r\n      fields: {\r\n        seo_article: change,\r\n      },\r\n    };\r\n  }\r\n\r\n  attachCategory({ detail }) {\r\n    const data = {\r\n      id: this.id,\r\n      relation: detail.target.dataset.relationmodel,\r\n      fields: {\r\n        category_id: +detail.next.value,\r\n      },\r\n    };\r\n    post(`/adminsc/category/updateOrCreate`, data);\r\n  }\r\n}\r\n"],"names":["PropertyTable","el","qs","ael","target","id","$row","$","data","post","obj","$clone","SelectNew","Category","QuillFactory","QuillConst","change","detail"],"mappings":"4RAIe,MAAMA,CAAc,CACjC,YAAYC,EAAI,CACd,KAAK,GAAKA,EAGV,KAAK,QAAU,KAAK,GAAGC,CAAE,EAAE,eAAe,EAEtC,KAAK,SAAS,KAAK,QAAQC,CAAG,EAAE,QAAS,KAAK,OAAO,KAAK,IAAI,CAAC,CACpE,CAED,MAAM,YAAY,CAAE,OAAAC,GAAU,CAEtBA,EAAO,UAAU,SAAS,KAAK,EACjC,KAAK,UAAUA,CAAM,EACZA,EAAO,UAAU,SAAS,MAAM,GACzC,KAAK,aAAaA,CAAM,CAG7B,CAED,MAAM,aAAaA,EAAQ,CACzB,IAAIC,EAAKD,EAAO,QAAQ,MAAM,EAAE,cAAc,cAAc,EAAE,QAAQ,MACtE,SAAS,KAAO,0BAA0BC,CAAE,EAC7C,CAED,MAAM,UAAUD,EAAQ,CACtB,IAAIE,EAAOF,EAAO,QAAQ,MAAM,EAE5BC,EAAK,CADOE,EAAED,CAAI,EAAE,KAAK,cAAc,EACvB,QAAQ,MACxBE,EAAO,KAAK,MAChBA,EAAK,QAAQ,OAAS,EACtBA,EAAK,QAAQ,OAASH,GACZ,MAAMI,EAAK,mCAAoCD,CAAI,IACpD,IAAIF,EAAK,OAAM,CACzB,CAED,MAAM,eAAeI,EAAK,CACxB,CACE,IAAIF,EAAO,KAAK,IAAIE,CAAG,EACb,MAAMD,EAAK,mCAAoCD,CAAI,CAC9D,CACF,CAED,IAAIE,EAAM,GAAI,CACZ,MAAO,CACL,YAAa,KAAK,GAAG,QAAQ,yBAAyB,EAAE,QAAQ,GAChE,QAAS,CACP,OAAQ,CAACA,GAAK,QAAQ,MAAM,MAC5B,OAAQ,CAACA,GAAK,QAAQ,MAAM,KAC7B,CACP,CACG,CAED,QAAS,CACP,IAAIC,EAAS,KAAK,SAAS,cAAc,YAAY,EAAE,UAAU,EAAI,EACrE,IAAIC,EAAUL,EAAEI,CAAM,EAAE,KAAK,iBAAiB,CAAC,EAC/C,KAAK,SAAS,OAAOA,CAAM,CAC5B,CACH,CCtDe,MAAME,CAAS,CAC5B,YAAYZ,EAAI,CACd,KAAK,GAAKA,EACV,KAAK,GAAKA,EAAG,QAAQ,GACrB,KAAK,cAAa,EAClB,KAAK,cAAa,EAClBa,EAAa,OAAO,eAAgBC,EAAW,0BAA0B,CAC1E,CAED,eAAgB,CACd,MAAMd,EAAKM,EAAE,4BAA4B,EAAE,MAAK,EACzB,IAAIK,EAAUX,CAAE,CACxC,CAED,eAAgB,CACd,IAAID,EAAc,KAAK,GAAG,cAAc,8BAA8B,CAAC,CACxE,CAED,IAAIgB,EAAQ,CACV,MAAO,CACL,GAAI,KAAK,GACT,SAAU,gBACV,OAAQ,CACN,YAAaA,CACd,CACP,CACG,CAED,eAAe,CAAE,OAAAC,GAAU,CACzB,MAAMT,EAAO,CACX,GAAI,KAAK,GACT,SAAUS,EAAO,OAAO,QAAQ,cAChC,OAAQ,CACN,YAAa,CAACA,EAAO,KAAK,KAC3B,CACP,EACIR,EAAK,mCAAoCD,CAAI,CAC9C,CACH"}