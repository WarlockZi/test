const __vite__fileDeps=["assets/admin-COoE6xP1.js","assets/preload-helper-DaGCtZ-7.js","assets/constants-D6t7YzCi.js","assets/search-DQiu1Dxx.js","assets/search-CLyZNsQw.css","assets/quill.snow-BxDoWBhC.js","assets/quill-BS3afWzt.css","assets/Promotion-DhzIVehj.js","assets/Promotion-DAohbegZ.css","assets/admin-sdlmCktC.css","assets/Fields-3Sx1T6lW.js","assets/Values-DnWevYHb.js","assets/product-DQYvEQKo.css","assets/card_panel-CTzoWkTg.js","assets/card_panel-COc34v_C.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as o}from"./preload-helper-DaGCtZ-7.js";/* empty css                */import{$ as n,e as l,g as f,i as w,p as r,q as u,o as v}from"./constants-D6t7YzCi.js";import{S as h}from"./Promotion-DhzIVehj.js";class _{constructor(e){this.$table=n(e).first(),this.$table&&(this.product1sId=n("[data-field='1s_id']").first().innerText,this.$baseUnit=n("[data-field='base_unit']").first(),this.$addUnit=n(".add-unit").first(),this.$rows=n(".rows").first(),this.$emtyRow=n(this.$rows).find(".none"),this.$addUnit.onclick=this.createRow.bind(this),this.$rows.onchange=this.handleChange.bind(this),this.$rows.onkeyup=this.handleKeyUp.bind(this),this.$rows.onclick=this.clickRow.bind(this),this.$rows.addEventListener("customSelect.changed",this.unitChanged.bind(this)),this.initSelects(),setTimeout(this.deleteSelected.bind(this),800))}initSelects(){this.$rows.querySelectorAll("[select-new]").forEach(e=>{new h(e)})}deleteSelected(){let e=this.$rows.querySelectorAll(".selected");e=Array.from(e).map(t=>{if(+t.dataset.value)return t.dataset.value}),this.$table.querySelectorAll("[custom-select]").forEach(function(t){t.querySelectorAll("li").forEach(function(a){e.includes(a.dataset.value)&&a.remove()})})}createSelect(e){const t=new l().tag("select").attr("new-select").className("name").get();return[...e[f]("li")].map(a=>{const s=new l().tag("option").attr("value",a.dataset.value).text(a[w]).get();t.append(s)}),t}createRow(){let e=this.$baseUnit.selectedOptions[0].innerText,t=new l().tag("div").attr("class","row").get();const a=this.createSelect(this.$emtyRow);let s=new l().attr("type","number").tag("input").attr("value",10).className("multiplier").get(),i=new l().tag("div").attr("class","base-unit").text(e).get(),d=new l().tag("div").className("shippable").get(),c=new l().tag("input").attr("type","checkbox").get(),m=new l().tag("div").attr("class","del").text("X").get();t.append(a),t.append(s),t.append(i),d.append(c),t.append(d),t.append(m),new h(a),this.$rows.append(t)}async unitChanged(e){let t=this.dto(e.target.closest(".row"));t.morphed.new_id=e.detail.next.value,t.morphed.old_id=e.detail.prev.value,e.detail.next.value&&this.deleteSelectedUnitFromSelects(e.detail.next.value),e.detail.prev.value&&this.addDeletedUnitToSelects(e.detail.prev),await r("/adminsc/product/changeUnit",t)}deleteSelectedUnitFromSelects(e){this.$table.querySelectorAll("[custom-select]").forEach(function(t){t.querySelectorAll("li").forEach(function(s){s.dataset.value===e&&s.remove()})})}addDeletedUnitToSelects(){this.$table.querySelectorAll("[custom-select]").forEach(function(e){e.querySelectorAll("li").forEach(function(a){a.dataset.value===value&&a.remove()})})}async clickRow({target:e}){var t;if(e.classList.contains("del")){let a=e.closest(".row"),s=this.dto(a),i=await r("/adminsc/product/deleteUnit",s);(t=i==null?void 0:i.arr)!=null&&t.ok&&a.remove()}}handleKeyUp(e){let t=+e.target.value;/\d+/.test(t)&&this.update(e,this)}async handleChange({target:e}){if(e.type==="checkbox"&&e.hasAttribute("data-isbase")){const t=+e.checked,s={product_1s_id:this.product1sId,base_is_shippable:t};await r("/adminsc/product/changeBaseIsShippable",s)}else this.update(e,this)}async update(e,t){let a=e.closest(".row");if(!+n(a).find("[select-new]").dataset.value)return!1;let i=t.dto(a);i.morphed.new_id=i.morphed.old_id,await r("/adminsc/product/changeUnit",i)}dto(e){let t={product_id:this.product1sId,multiplier:+n(e).find(".multiplier").value,is_shippable:n(e).find(".shippable input").checked?1:null},a={new_id:0,old_id:+this.getUnitId(e),detach:0};return{baseUnitId:this.getBaseUnitId(),pivot:t,morphed:a}}getBaseUnitId(){return+this.$baseUnit.options[this.$baseUnit.selectedIndex].value}getUnitId(e){return e.querySelector("[select-new]").dataset.value??0}}let g=n(".units").first();g&&new _(".units");class ${constructor(e){if(!e)return!1;this.product=e,this.setValues(),this.setFields(),this.setDragNDrop(),this.setCardPanel()}async setDragNDrop(){const e=document[u]("[dnd]");if(e){const{default:t}=await o(()=>import("./admin-COoE6xP1.js").then(a=>a.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));new t(e,this.addMainImage)}}async setFields(){const{default:e}=await o(()=>import("./Fields-3Sx1T6lW.js"),__vite__mapDeps([10,7,2,8]));new e(this.product)}async setValues(){const{default:e}=await o(()=>import("./Values-DnWevYHb.js"),__vite__mapDeps([11,2,7,8,1,12]));new e(this.product)}async setCardPanel(){if(document[u](".cardPanel")){const{default:t}=await o(()=>import("./card_panel-CTzoWkTg.js"),__vite__mapDeps([13,2,14]));new t}}async addMainImage(e,t){const a={productId:t.closest(".item-wrap").dataset.id};let s=v(a,e[0]),i=await r("/adminsc/product/saveMainImage",s),d=i==null?void 0:i.arr[0];if(d){const c=t.closest(".dnd-container").querySelector("img");c.removeAttribute("src"),c.setAttribute("src",d)}}}export{$ as default};
