const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/card_panel-C8i2A5fw.js","assets/common-Boy4RmlM.js","assets/card_panel-ebMfmDJg.css","assets/index-DoOvCtdl.js","assets/index-CJybINCP.css","assets/AdminSidebar-FgG4vK2a.js","assets/constants-Clh-pk9Y.js","assets/AdminSidebar-UzyVTL-J.css","assets/Product-C1zsV8jb.js","assets/Promotion-2rFPK4NU.js","assets/Promotion-B7FCyWX3.css","assets/MyQuill-BEp9jv_H.js","assets/quill.bubble--vF6heEE.js","assets/quill-GClCj9AP.css","assets/search-CFft0GjV.js","assets/Product-DvaS-sGn.css","assets/popup-Dv_TwhNX.css","assets/catalog-item-B1KffBNp.js","assets/order-DsqbVL-n.js","assets/order-CPFFkws8.css","assets/modal-Cmk2ACTR.js","assets/modal-D2zHcDFg.css","assets/Category-C_YXAXOu.js","assets/chartjs-BuzzFIH-.js","assets/chartjs-h9gw8S8u.css"])))=>i.map(i=>d[i]);
import{$ as i,f as b,p as f,d as E,_ as h}from"./common-Boy4RmlM.js";import{q as u}from"./constants-Clh-pk9Y.js";import"./quill.bubble--vF6heEE.js";import{P as v}from"./Promotion-2rFPK4NU.js";import g from"./search-CFft0GjV.js";/* empty css              */let w=i("[custom-date]");if(w)for(let s of w)s.onchange=function({target:t}){let{yyyy:e,mm:a,dd:n}=b(t.value),o=`${e}-${a}-${n}`;t.value,t.setAttribute("data-value",o)};class I{constructor(t){this.$sync=t,this.$log_content=i(t).find("#log_content"),this.$sync.onclick=this.handleClick.bind(this)}async handleClick({target:t}){if(t.classList.contains("button")){let e=await f(`/adminsc/sync/${t.id}`);e?.arr?.success&&(this.$log_content.innerText=e.arr?.content)}}}let _=i(".sync").first();_&&new I(_);function C(s){/\/adminsc\/settings/.test(s)||/\/adminsc\/right\/list/.test(s)||/\/adminsc\/post\/list/.test(s)||/\/adminsc\/todo\/list/.test(s)?i("[settings]").addClass("current"):/\/auth\/profile/.test(s)||(/\/adminsc\/crm/.test(s)?i("[crm]").addClass("current"):/\/adminsc\/planning/.test(s)?i("[plan]").addClass("current"):/\/adminsc\/category/.test(s)||/\/adminsc\/product/.test(s)?i("[catalog]").addClass("current"):/\/test/.test(s)||/\/opentest/.test(s)||/\/adminsc\/opentest/.test(s)||/\/adminsc\/test/.test(s)?i("[test]").addClass("current"):i("[href='/adminsc']").addClass("current"))}class A{constructor(t){this.table=t,this.model=t.dataset.model??t.closest("[data-model]")?.dataset.model,this.modelId=t.dataset.id??t.closest("[data-model]")?.dataset.id,this.relation=t.dataset.relation??null,this.relationModel=t.dataset.relationmodel??null,this.url=`/adminsc/${this.model}/updateOrCreate`,this.headers=i(".head"),this.inputs=i(".head input"),this.hidden=i("[hidden]"),this.editable=i("[contenteditable]"),this.sortables=i("[data-sort]"),this.ids=this.getIds(),this.rows=this.fillRows(),this.WSSelects=i("[custom-select]"),[].forEach.call(this.WSSelects,e=>{e.onchange=this.customSelectChange}),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=E(this.handleInput),this.directions=Array.from(this.sortables).map(function(e){return""})}async handleClick(t){const e=t.target;if(e.className==="add-model")this.createModel(e);else if(e.className===".del:not(.head)"||e.closest(".del:not(.head)"))this.modelDel(e.closest(".del:not(.head)"));else if(e.className==="edit:not(.head)"||e.closest(".edit:not(.head)"))t.preventDefault(),this.edit(e);else if(e.type==="checkbox"){const a=e.dataset.func,n=e.checked,o=e.dataset["1sid"],l={base_is_shippable:n,product_1s_id:o};await f(`/adminsc/${this.model}/${a}`,l)}else if(e.classList.contains("head")||e.classList.contains("icon")){const a=e.closest(".head");if(a.hasAttribute("data-sort")){const n=[].findIndex.call(sortables,(o,l,r)=>o===a);this.sortColumn(n)}}}edit(t){const e=this.relation?this.relationModel:this.model,a=this.relation?t.dataset.id:this.modelId??t.dataset.id;window.location=`/adminsc/${e}/edit/${a}`}async customSelectChange({target:t}){if(!t.closest("[data-model]"))return!1;const a=t.options.selectedIndex,n=t.options[a].value,o={[this.field]:n,id:this.modelId};await f(this.url,o)}getIds(){let t=i(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,function(e){return e.dataset.id!=="0"})}handlePaste(t){t.target.innerText=t.clipboardData.getData("text/plain"),this.handleInput(t.target),t.target.innerText=""}handleKeyUp(t){let e=t.target;if(t.cancelBubble=!0,e.hasAttribute("contenteditable"))this.debouncedInput(e);else if(e.closest(".head")){const a=e.closest(".head"),n=[].findIndex.call(this.headers,(o,l,r)=>o===a);this.search(n,e)}}async handleInput(t){const e=this.createModel(t),a=await f(this.url,e);a.arr.id&&this.newRow(a?.arr.id).bind(this)}async modelDel(t){if(!confirm("Удалить?"))return;let e=t.dataset.id;await f(`/adminsc/${this.model}/delete`,{id:e})&&delView(e)}createModel(t){return{model:this.model,id:this.modelId,relation:this.relation,fields:this.relationDTO(t)}}relationDTO(t){return this.relation?{id:t.dataset.id,[t.dataset.field]:t.innerText}:null}newRow(t){[].forEach.call(this.hidden,function(e){const a=e.cloneNode(!0);a.removeAttribute("hidden"),i(this.table).find(".custom-table").appendChild(a),["id"].includes(a.dataset.field)?a.innerText=t:["del","edit","save"].includes(a.className)||a.hasChildNodes("select")||(a.innerText=""),a.dataset.id=t}.bind(this))}showAllRows(){[].forEach.call(this.rows,t=>{[].forEach.call(t,e=>{e.style.display="flex"})})}search(t,e){this.showAllRows();const a=e.value;[].forEach.call(this.inputs,n=>{n!==e&&(n.value="")}),[].forEach.call(this.rows,function(n){const o=n[t].innerText,l=new RegExp(`${a}`,"gi");o.match(l)||[].forEach.call(n,r=>{r.style.display="none"})})}fillRows(){let t=[];for(let e=0;e<this.ids.length;e++){let a=this.ids[e].dataset.id,n=i(this.table)[0].querySelectorAll(`[data-id='${a}']`);t.push(n)}return t}sortColumn(t){const e=this.fillRows(),a=this.directions[t]||"asc",n=a==="asc"?1:-1,o=Array.from(e);o.sort(function(l,r){const d=l[t].innerHTML,c=r[t].innerHTML,m=this.transform(t,d),p=this.transform(t,c);switch(!0){case m>p:return 1*n;case m<p:return-1*n;case m===p:return 0}}),[].forEach.call(e,function(l){[].forEach.call(l,r=>{r.remove()})}),this.directions[t]=a==="asc"?"desc":"asc",o.forEach(function(l){l=Array.from(l),l.reverse(),[].forEach.call(l,r=>{this.headers[this.headers.length-1].after(r)})})}transform(t,e){return this.sortables[t]?this.sortables[t].getAttribute("data-type")==="number"?parseFloat(e):e:void 0}save(t){return f(this.url,t.model)}makeServerModel(t){const e=this.model;return{model:{id:t.dataset.id,[t.dataset.field]:t.innerText},modelName:e}}delView(t){const e=i(`[data-id='${t}']`);[].forEach.call(e,function(a){a.remove()})}}const y=i("[custom-table]");y&&[].forEach.call(y,function(s){new A(s)});function T(){const s=i(".admin-panel").first();document.addEventListener("scroll",t.bind(s),{passive:!0});function t(){s&&(window.scrollY>40?s.classList.add("fixed"):s.classList.remove("fixed"))}}i(document).ready(async function(){if(document[u](".card-panel")){const{default:d}=await h(async()=>{const{default:c}=await import("./card_panel-C8i2A5fw.js");return{default:c}},__vite__mapDeps([0,1,2]));new d}if(T(),!window.location.pathname.includes("adminsc"))return!1;window.location.href.includes("/test")&&await h(async()=>{const{default:d}=await import("./index-DoOvCtdl.js").then(c=>c.i);return{default:d}},__vite__mapDeps([3,1,4]));const a=i(".sidebar").first();if(a){const{default:d}=await h(async()=>{const{default:c}=await import("./AdminSidebar-FgG4vK2a.js");return{default:c}},__vite__mapDeps([5,1,6,7]));new d(a)}if(document[u](".item-wrap[data-model='product']")){const{default:d}=await h(async()=>{const{default:c}=await import("./Product-C1zsV8jb.js");return{default:c}},__vite__mapDeps([8,1,9,10,6,11,12,13,14,15,16]));new d}const o=document[u](".item-wrap");if(o){const{default:d}=await h(async()=>{const{default:c}=await import("./catalog-item-B1KffBNp.js");return{default:c}},__vite__mapDeps([17,1,6,12,13,9,10,14,16]));new d(o)}if(document[u](".order-edit")){const{default:d}=await h(async()=>{const{default:c}=await import("./order-DsqbVL-n.js");return{default:c}},__vite__mapDeps([18,9,1,10,19]));new d}if(document[u](".modal-wrapper")){const{default:d}=await h(async()=>{const{default:c}=await import("./modal-Cmk2ACTR.js");return{default:c}},__vite__mapDeps([20,1,21]));new d}const l=document[u](".item-wrap[data-model='category']");if(l){const{default:d}=await h(async()=>{const{default:c}=await import("./Category-C_YXAXOu.js");return{default:c}},__vite__mapDeps([22,1,9,10,6,11,12,13,14,16]));new d(l)}new v,new g(!0),C(window.location.pathname),document.getElementById("income")&&await h(async()=>{const{default:d}=await import("./chartjs-BuzzFIH-.js");return{default:d}},__vite__mapDeps([23,24]))});
