const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/login-CX5EeMGt.js","assets/common-BEiZe_HE.js","assets/modal-2CIG3n3z.js","assets/modal-CsdT2GQ5.css"])))=>i.map(i=>d[i]);
import{$ as s,g as u,s as m,p as c,_ as d}from"./common-BEiZe_HE.js";let i=s(".search input").first();i&&i.addEventListener("input",function(){f(i)});async function f(a){let n=a.parentNode,e=s(n).find(".search__result");if(a.value.length<1){e&&(e.innerHTML="");return}let t=await fetch("/search?q="+a.value);t=await t.json(t),e.childNodes.length!==0&&(e.innerHTML=""),t.map(o=>{let r=document.createElement("a");r.href=o.alias,r.innerHTML=`<img src='/pic/${o.preview_pic}' alt='${o.name}'>`+o.name,e.appendChild(r)}),s("body").on("click",function(o){e&&o.target!==e&&(e.innerHTML="")})}function p(){s(".password-control")&&s(".password-control").on("click",n);function n({target:e}){const t=e.parentNode.querySelector("input");t.getAttribute("type")==="password"?t.setAttribute("type","text"):t.setAttribute("type","password"),e.classList.toggle("view")}}w("cn");s("#cn-accept-chatLocalStorage").on("click",g);function w(a){u(a)?s("#chatLocalStorage-notice").css("bottom","-100%"):s("#chatLocalStorage-notice").css("bottom","0")}function g(){m("cn",1,3),s("#chatLocalStorage-notice").css("bottom","-100%")}s(".changepassword").on("click",async function(a){let n={old_password:s('[name="old_password"]')[0].value,new_password:s('[name="new_password"]')[0].value},e=s(".message")[0],t=await c("/auth/changepassword",n);t.success?(e.innerText=t.success,s(e).addClass("success"),s(e).removeClass("error")):t.error&&(e.innerText=t.error,s(e).addClass("error"),s(e).removeClass("success"))});let l=s("[data-auth='register']")[0];l&&s(l).on("click",h);function h({target:a}){v(email,password)}async function v(a,n){const e=s(".message")[0],t={email:a,password:n,surName:s("[name='surName']")[0].value,name:s("[name='name']")[0].value},o=await c("/auth/register",t);o?.arr?.success==="confirm"?(e.classList.remove("error"),e.classList.add("success"),e.innerHTML="-Пользователь зарегистрирован.<br>-Для подтверждения регистрации зайдите на почту, <bold>email</bold>.<br> -Перейдите по ссылке в письме."):o.msg==="mail exists"?(e.innerHTML="Эта почта уже зарегистрирована. Войдите в систему по кнопке внизу Войти или, если не помните пароль, восстановите пароль по кнопке Забыл пароль",e.classList.remove("success"),e.classList.add("error")):(e.innerHTML=o.msg,e.classList.remove("success"),e.classList.add("error"))}s("#save").on("click",async function(a){a.preventDefault();let n={name:s('[name = "name"]')[0].value,surName:s('[name = "surName"]')[0].value,middleName:s('[name = "middleName"]')[0].value,birthDate:s('[name = "birthDate"]')[0].value,phone:s('[name = "phone"]')[0].value,sex:void 0};await c("/user/edit",n)});const L=s("[data-auth='login']").first();if(L){const{default:a}=await d(async()=>{const{default:n}=await import("./login-CX5EeMGt.js");return{default:n}},__vite__mapDeps([0,1]));new a}if(s(".modal").first()){const{default:a}=await d(async()=>{const{default:n}=await import("./modal-2CIG3n3z.js").then(e=>e.m);return{default:n}},__vite__mapDeps([2,1,3]));new a}p();
//# sourceMappingURL=auth-CqvqqCjG.js.map
