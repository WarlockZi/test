import"./search-Z_be1yRK.js";import{$ as n,c as l}from"./common-NvRRxPie.js";class o{constructor(e){if(!(!e|!n(e).find("option")))return this.ul=new l().tag("ul").attr("class","options").get(),this.label=new l().tag("span").get(),this.options=this.getFormattedOptions(e.querySelectorAll("option")),this.space=new l().tag("div").attr("class","space").text(this?.selectedOption?.label).get(),this.arrow=new l().tag("div").attr("class","arrow").get(),this.sel=this.createSelectTag(e),e.after(this.sel),this.label.append(this.space),this.label.append(this.arrow),this.sel.append(this.label),this.sel.append(this.ul),e.remove(),this.ul.addEventListener("click",this.handleUlClick.bind(this)),this.label.addEventListener("click",this.handleLabelClick.bind(this)),this.sel.addEventListener("blur",this.handleSelectBlur.bind(this)),this.sel.addEventListener("keydown",this.handleSelectKeydown.bind(this)),this}getFormattedOptions(e){return[...e].map(t=>{const s=new l().tag("li").text(t.label).attr("data-value",t.value).get();return t.selected&&s.classList.add("selected"),this.ul.append(s),{value:t.value,label:t.label,selected:t.selected,element:s,option:t}})}createSelectTag(e){const t=this.setSelectTag(e);return e.hasAttribute("data-field")&&t.attr("data-field",e.dataset.field),e.hasAttribute("name")&&t.attr("name",e.name),e.hasAttribute("data-relation")&&t.attr("data-relation",e.dataset.relation),e.hasAttribute("data-pivot")&&t.attr("data-pivot",e.dataset.pivot),e.firstElementChild.hasAttribute("data-relation")&&t.attr("data-relation",e.firstChild.dataset.relation),e.firstElementChild.hasAttribute("data-relationmodel")&&t.attr("data-relationmodel",e.firstChild.dataset.relationmodel),t.get()}setSelectTag(e){return new l().tag("div").className(e?.className).field(e.dataset.field).attr("select-new","").attr("data-value",this?.selectedOption?.value??"").attr("tabindex","0")}handleSelectBlur(){this.ul.classList.remove("show")}handleLabelClick(){this.ul.classList.toggle("show")}handleUlClick({target:e}){e.classList.add("selected"),this.selectedOption.element.classList.remove("selected"),this.selectValue(e.dataset.value),this.ul.classList.remove("show")}onchange(e){this.callback=e}handleSelectKeydown(e){let t,s="";if(e.code==="Space")select.ul.classList.toggle("show");else if(e.code==="ArrowUp"){const a=select.options[select.selectedOptionIndex-1];a&&select.selectValue(a.value)}else if(e.code==="ArrowDown"){const a=select.options[select.selectedOptionIndex+1];a&&select.selectValue(a.value)}else if(e.code==="Enter"||e.code==="Escape")select.ul.classList.remove("show");else{clearTimeout(t),s+=e.key,t=setTimeout(()=>{s=""},500);const a=this.options.find(i=>i.label.toLowerCase().includes(s));a&&this.sel.selectValue(a.value)}}get selectedOption(){return this.options.find(e=>e.selected)}get selectedOptionIndex(){return this.options.indexOf(this.selectedOption)}selectValue(e){const t=this.options.find(a=>a.value===e),s=this.selectedOption;s.selected=!1,t.selected=!0,this.space.innerText=t.label,this.sel.dataset.value=t.value,s.element.classList.remove("selected"),t.element.classList.add("selected"),t.element.scrollIntoView({block:"nearest"}),this.sel.dispatchEvent(new CustomEvent("customSelect.changed",{bubbles:!0,detail:{next:t,prev:s,target:this.sel}}))}}export{o as S};
//# sourceMappingURL=SelectNew-K3rnvVtj.js.map
