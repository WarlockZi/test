{"version":3,"file":"SelectNew-Ddq9kzI4.js","sources":["../../src/components/select/SelectNew.js"],"sourcesContent":["import \"./SelectNew.scss\";\r\n\r\nimport { $, createElement } from \"../../common\";\r\n\r\nexport default class SelectNew {\r\n  constructor(el) {\r\n    if (!el | !$(el).find(\"option\")) return;\r\n\r\n    this.ul = new createElement().tag(\"ul\").attr(\"class\", \"options\").get();\r\n    this.label = new createElement().tag(\"span\").get();\r\n\r\n    this.options = this.getFormattedOptions(el.querySelectorAll(\"option\"));\r\n\r\n    this.space = new createElement()\r\n      .tag(\"div\")\r\n      .attr(\"class\", \"space\")\r\n      .text(this?.selectedOption?.label)\r\n      .get();\r\n    this.arrow = new createElement().tag(\"div\").attr(\"class\", \"arrow\").get();\r\n    this.sel = this.createSelectTag(el);\r\n\r\n    el.after(this.sel);\r\n    this.label.append(this.space);\r\n    this.label.append(this.arrow);\r\n    this.sel.append(this.label);\r\n    this.sel.append(this.ul);\r\n    el.remove();\r\n\r\n    this.ul.addEventListener(\"click\", this.handleUlClick.bind(this));\r\n    this.label.addEventListener(\"click\", this.handleLabelClick.bind(this));\r\n    this.sel.addEventListener(\"blur\", this.handleSelectBlur.bind(this));\r\n    this.sel.addEventListener(\"keydown\", this.handleSelectKeydown.bind(this));\r\n\r\n    return this;\r\n  }\r\n\r\n  getFormattedOptions(options) {\r\n    return [...options].map((option) => {\r\n      const li = new createElement()\r\n        .tag(\"li\")\r\n        .text(option.label)\r\n        .attr(\"data-value\", option.value)\r\n        .get();\r\n      if (option.selected) li.classList.add(\"selected\");\r\n      this.ul.append(li);\r\n\r\n      return {\r\n        value: option.value,\r\n        label: option.label,\r\n        selected: option.selected,\r\n        element: li,\r\n        option: option,\r\n      };\r\n    });\r\n  }\r\n\r\n  createSelectTag(el) {\r\n    const selectTag = this.setSelectTag(el);\r\n    if (el.hasAttribute(\"data-field\"))\r\n      selectTag.attr(\"data-field\", el.dataset.field);\r\n    if (el.hasAttribute(\"name\")) selectTag.attr(\"name\", el.name);\r\n    if (el.hasAttribute(\"data-relation\"))\r\n      selectTag.attr(\"data-relation\", el.dataset.relation);\r\n    if (el.hasAttribute(\"data-pivot\"))\r\n      selectTag.attr(\"data-pivot\", el.dataset.pivot);\r\n    if (el.firstElementChild.hasAttribute(\"data-relation\"))\r\n      selectTag.attr(\"data-relation\", el.firstChild.dataset.relation);\r\n    if (el.firstElementChild.hasAttribute(\"data-relationmodel\"))\r\n      selectTag.attr(\"data-relationmodel\", el.firstChild.dataset.relationmodel);\r\n\r\n    return selectTag.get();\r\n  }\r\n\r\n  setSelectTag(el) {\r\n    return new createElement()\r\n      .tag(\"div\")\r\n      .className(el?.className)\r\n      .field(el.dataset.field)\r\n      .attr(\"select-new\", \"\")\r\n      .attr(\"data-value\", this?.selectedOption?.value ?? \"\")\r\n      .attr(\"tabindex\", \"0\");\r\n  }\r\n\r\n  handleSelectBlur() {\r\n    this.ul.classList.remove(\"show\");\r\n  }\r\n\r\n  handleLabelClick() {\r\n    this.ul.classList.toggle(\"show\");\r\n  }\r\n\r\n  handleUlClick({ target }) {\r\n    target.classList.add(\"selected\");\r\n    this.selectedOption.element.classList.remove(\"selected\");\r\n\r\n    this.selectValue(target.dataset.value);\r\n    this.ul.classList.remove(\"show\");\r\n  }\r\n\r\n  onchange(callback) {\r\n    this.callback = callback;\r\n  }\r\n\r\n  handleSelectKeydown(e) {\r\n    let debounceTimeout;\r\n    let searchTerm = \"\";\r\n\r\n    if (e.code === \"Space\") {\r\n      select.ul.classList.toggle(\"show\");\r\n    } else if (e.code === \"ArrowUp\") {\r\n      const prevOption = select.options[select.selectedOptionIndex - 1];\r\n      if (prevOption) {\r\n        select.selectValue(prevOption.value);\r\n      }\r\n    } else if (e.code === \"ArrowDown\") {\r\n      const nextOption = select.options[select.selectedOptionIndex + 1];\r\n      if (nextOption) {\r\n        select.selectValue(nextOption.value);\r\n      }\r\n    } else if (e.code === \"Enter\" || e.code === \"Escape\") {\r\n      select.ul.classList.remove(\"show\");\r\n    } else {\r\n      clearTimeout(debounceTimeout);\r\n      searchTerm += e.key;\r\n      debounceTimeout = setTimeout(() => {\r\n        searchTerm = \"\";\r\n      }, 500);\r\n      const searchedOption = this.options.find((option) => {\r\n        return option.label.toLowerCase().includes(searchTerm);\r\n      });\r\n      if (searchedOption) {\r\n        this.sel.selectValue(searchedOption.value);\r\n      }\r\n    }\r\n  }\r\n\r\n  get selectedOption() {\r\n    return this.options.find((option) => option.selected);\r\n  }\r\n\r\n  get selectedOptionIndex() {\r\n    return this.options.indexOf(this.selectedOption);\r\n  }\r\n\r\n  selectValue(value) {\r\n    const next = this.options.find((option) => {\r\n      return option.value === value;\r\n    });\r\n    const prev = this.selectedOption;\r\n\r\n    prev.selected = false;\r\n    next.selected = true;\r\n\r\n    this.space.innerText = next.label;\r\n\r\n    this.sel.dataset[\"value\"] = next.value;\r\n    prev.element.classList.remove(\"selected\");\r\n\r\n    next.element.classList.add(\"selected\");\r\n    next.element.scrollIntoView({ block: \"nearest\" });\r\n\r\n    this.sel.dispatchEvent(\r\n      new CustomEvent(\"customSelect.changed\", {\r\n        bubbles: true,\r\n        detail: { next, prev, target: this.sel },\r\n      }),\r\n    );\r\n  }\r\n\r\n  // setOption(option) {\r\n  //    const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\r\n  //\r\n  //    if (option.selected) li.classList.add(\"selected\");\r\n  //    // li.onclick = ({target}) => {\r\n  //    //   select.selectValue(option.value);\r\n  //    //   select.ul.classList.remove(\"show\");\r\n  //    // };\r\n  //    this.ul.append(li)\r\n  // }\r\n}\r\n"],"names":["SelectNew","el","$","createElement","options","option","li","selectTag","target","callback","debounceTimeout","searchTerm","prevOption","nextOption","searchedOption","value","next","prev"],"mappings":"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"}