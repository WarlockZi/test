{"version":3,"file":"SelectNew-Ddq9kzI4.js","sources":["../../src/components/select/SelectNew.js"],"sourcesContent":["import \"./SelectNew.scss\";\n\nimport { $, createElement } from \"../../common\";\n\nexport default class SelectNew {\n  constructor(el) {\n    if (!el | !$(el).find(\"option\")) return;\n\n    this.ul = new createElement().tag(\"ul\").attr(\"class\", \"options\").get();\n    this.label = new createElement().tag(\"span\").get();\n\n    this.options = this.getFormattedOptions(el.querySelectorAll(\"option\"));\n\n    this.space = new createElement()\n      .tag(\"div\")\n      .attr(\"class\", \"space\")\n      .text(this?.selectedOption?.label)\n      .get();\n    this.arrow = new createElement().tag(\"div\").attr(\"class\", \"arrow\").get();\n    this.sel = this.createSelectTag(el);\n\n    el.after(this.sel);\n    this.label.append(this.space);\n    this.label.append(this.arrow);\n    this.sel.append(this.label);\n    this.sel.append(this.ul);\n    el.remove();\n\n    this.ul.addEventListener(\"click\", this.handleUlClick.bind(this));\n    this.label.addEventListener(\"click\", this.handleLabelClick.bind(this));\n    this.sel.addEventListener(\"blur\", this.handleSelectBlur.bind(this));\n    this.sel.addEventListener(\"keydown\", this.handleSelectKeydown.bind(this));\n\n    return this;\n  }\n\n  getFormattedOptions(options) {\n    return [...options].map((option) => {\n      const li = new createElement()\n        .tag(\"li\")\n        .text(option.label)\n        .attr(\"data-value\", option.value)\n        .get();\n      if (option.selected) li.classList.add(\"selected\");\n      this.ul.append(li);\n\n      return {\n        value: option.value,\n        label: option.label,\n        selected: option.selected,\n        element: li,\n        option: option,\n      };\n    });\n  }\n\n  createSelectTag(el) {\n    const selectTag = this.setSelectTag(el);\n    if (el.hasAttribute(\"data-field\"))\n      selectTag.attr(\"data-field\", el.dataset.field);\n    if (el.hasAttribute(\"name\")) selectTag.attr(\"name\", el.name);\n    if (el.hasAttribute(\"data-relation\"))\n      selectTag.attr(\"data-relation\", el.dataset.relation);\n    if (el.hasAttribute(\"data-pivot\"))\n      selectTag.attr(\"data-pivot\", el.dataset.pivot);\n    if (el.firstElementChild.hasAttribute(\"data-relation\"))\n      selectTag.attr(\"data-relation\", el.firstChild.dataset.relation);\n    if (el.firstElementChild.hasAttribute(\"data-relationmodel\"))\n      selectTag.attr(\"data-relationmodel\", el.firstChild.dataset.relationmodel);\n\n    return selectTag.get();\n  }\n\n  setSelectTag(el) {\n    return new createElement()\n      .tag(\"div\")\n      .className(el?.className)\n      .field(el.dataset.field)\n      .attr(\"select-new\", \"\")\n      .attr(\"data-value\", this?.selectedOption?.value ?? \"\")\n      .attr(\"tabindex\", \"0\");\n  }\n\n  handleSelectBlur() {\n    this.ul.classList.remove(\"show\");\n  }\n\n  handleLabelClick() {\n    this.ul.classList.toggle(\"show\");\n  }\n\n  handleUlClick({ target }) {\n    target.classList.add(\"selected\");\n    this.selectedOption.element.classList.remove(\"selected\");\n\n    this.selectValue(target.dataset.value);\n    this.ul.classList.remove(\"show\");\n  }\n\n  onchange(callback) {\n    this.callback = callback;\n  }\n\n  handleSelectKeydown(e) {\n    let debounceTimeout;\n    let searchTerm = \"\";\n\n    if (e.code === \"Space\") {\n      select.ul.classList.toggle(\"show\");\n    } else if (e.code === \"ArrowUp\") {\n      const prevOption = select.options[select.selectedOptionIndex - 1];\n      if (prevOption) {\n        select.selectValue(prevOption.value);\n      }\n    } else if (e.code === \"ArrowDown\") {\n      const nextOption = select.options[select.selectedOptionIndex + 1];\n      if (nextOption) {\n        select.selectValue(nextOption.value);\n      }\n    } else if (e.code === \"Enter\" || e.code === \"Escape\") {\n      select.ul.classList.remove(\"show\");\n    } else {\n      clearTimeout(debounceTimeout);\n      searchTerm += e.key;\n      debounceTimeout = setTimeout(() => {\n        searchTerm = \"\";\n      }, 500);\n      const searchedOption = this.options.find((option) => {\n        return option.label.toLowerCase().includes(searchTerm);\n      });\n      if (searchedOption) {\n        this.sel.selectValue(searchedOption.value);\n      }\n    }\n  }\n\n  get selectedOption() {\n    return this.options.find((option) => option.selected);\n  }\n\n  get selectedOptionIndex() {\n    return this.options.indexOf(this.selectedOption);\n  }\n\n  selectValue(value) {\n    const next = this.options.find((option) => {\n      return option.value === value;\n    });\n    const prev = this.selectedOption;\n\n    prev.selected = false;\n    next.selected = true;\n\n    this.space.innerText = next.label;\n\n    this.sel.dataset[\"value\"] = next.value;\n    prev.element.classList.remove(\"selected\");\n\n    next.element.classList.add(\"selected\");\n    next.element.scrollIntoView({ block: \"nearest\" });\n\n    this.sel.dispatchEvent(\n      new CustomEvent(\"customSelect.changed\", {\n        bubbles: true,\n        detail: { next, prev, target: this.sel },\n      }),\n    );\n  }\n\n  // setOption(option) {\n  //    const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\n  //\n  //    if (option.selected) li.classList.add(\"selected\");\n  //    // li.onclick = ({target}) => {\n  //    //   select.selectValue(option.value);\n  //    //   select.ul.classList.remove(\"show\");\n  //    // };\n  //    this.ul.append(li)\n  // }\n}\n"],"names":["SelectNew","el","$","createElement","options","option","li","selectTag","target","callback","debounceTimeout","searchTerm","prevOption","nextOption","searchedOption","value","next","prev"],"mappings":"6EAIe,MAAMA,CAAU,CAC7B,YAAYC,EAAI,CACd,GAAI,GAACA,EAAK,CAACC,EAAED,CAAE,EAAE,KAAK,QAAQ,GAE9B,YAAK,GAAK,IAAIE,EAAa,EAAG,IAAI,IAAI,EAAE,KAAK,QAAS,SAAS,EAAE,IAAK,EACtE,KAAK,MAAQ,IAAIA,EAAa,EAAG,IAAI,MAAM,EAAE,IAAK,EAElD,KAAK,QAAU,KAAK,oBAAoBF,EAAG,iBAAiB,QAAQ,CAAC,EAErE,KAAK,MAAQ,IAAIE,EAAa,EAC3B,IAAI,KAAK,EACT,KAAK,QAAS,OAAO,EACrB,KAAK,MAAM,gBAAgB,KAAK,EAChC,IAAK,EACR,KAAK,MAAQ,IAAIA,EAAa,EAAG,IAAI,KAAK,EAAE,KAAK,QAAS,OAAO,EAAE,IAAK,EACxE,KAAK,IAAM,KAAK,gBAAgBF,CAAE,EAElCA,EAAG,MAAM,KAAK,GAAG,EACjB,KAAK,MAAM,OAAO,KAAK,KAAK,EAC5B,KAAK,MAAM,OAAO,KAAK,KAAK,EAC5B,KAAK,IAAI,OAAO,KAAK,KAAK,EAC1B,KAAK,IAAI,OAAO,KAAK,EAAE,EACvBA,EAAG,OAAQ,EAEX,KAAK,GAAG,iBAAiB,QAAS,KAAK,cAAc,KAAK,IAAI,CAAC,EAC/D,KAAK,MAAM,iBAAiB,QAAS,KAAK,iBAAiB,KAAK,IAAI,CAAC,EACrE,KAAK,IAAI,iBAAiB,OAAQ,KAAK,iBAAiB,KAAK,IAAI,CAAC,EAClE,KAAK,IAAI,iBAAiB,UAAW,KAAK,oBAAoB,KAAK,IAAI,CAAC,EAEjE,IACX,CAEE,oBAAoBG,EAAS,CAC3B,MAAO,CAAC,GAAGA,CAAO,EAAE,IAAKC,GAAW,CAClC,MAAMC,EAAK,IAAIH,EAAa,EACzB,IAAI,IAAI,EACR,KAAKE,EAAO,KAAK,EACjB,KAAK,aAAcA,EAAO,KAAK,EAC/B,IAAK,EACR,OAAIA,EAAO,UAAUC,EAAG,UAAU,IAAI,UAAU,EAChD,KAAK,GAAG,OAAOA,CAAE,EAEV,CACL,MAAOD,EAAO,MACd,MAAOA,EAAO,MACd,SAAUA,EAAO,SACjB,QAASC,EACT,OAAQD,CACT,CACP,CAAK,CACL,CAEE,gBAAgBJ,EAAI,CAClB,MAAMM,EAAY,KAAK,aAAaN,CAAE,EACtC,OAAIA,EAAG,aAAa,YAAY,GAC9BM,EAAU,KAAK,aAAcN,EAAG,QAAQ,KAAK,EAC3CA,EAAG,aAAa,MAAM,GAAGM,EAAU,KAAK,OAAQN,EAAG,IAAI,EACvDA,EAAG,aAAa,eAAe,GACjCM,EAAU,KAAK,gBAAiBN,EAAG,QAAQ,QAAQ,EACjDA,EAAG,aAAa,YAAY,GAC9BM,EAAU,KAAK,aAAcN,EAAG,QAAQ,KAAK,EAC3CA,EAAG,kBAAkB,aAAa,eAAe,GACnDM,EAAU,KAAK,gBAAiBN,EAAG,WAAW,QAAQ,QAAQ,EAC5DA,EAAG,kBAAkB,aAAa,oBAAoB,GACxDM,EAAU,KAAK,qBAAsBN,EAAG,WAAW,QAAQ,aAAa,EAEnEM,EAAU,IAAK,CAC1B,CAEE,aAAaN,EAAI,CACf,OAAO,IAAIE,EAAa,EACrB,IAAI,KAAK,EACT,UAAUF,GAAI,SAAS,EACvB,MAAMA,EAAG,QAAQ,KAAK,EACtB,KAAK,aAAc,EAAE,EACrB,KAAK,aAAc,MAAM,gBAAgB,OAAS,EAAE,EACpD,KAAK,WAAY,GAAG,CAC3B,CAEE,kBAAmB,CACjB,KAAK,GAAG,UAAU,OAAO,MAAM,CACnC,CAEE,kBAAmB,CACjB,KAAK,GAAG,UAAU,OAAO,MAAM,CACnC,CAEE,cAAc,CAAE,OAAAO,GAAU,CACxBA,EAAO,UAAU,IAAI,UAAU,EAC/B,KAAK,eAAe,QAAQ,UAAU,OAAO,UAAU,EAEvD,KAAK,YAAYA,EAAO,QAAQ,KAAK,EACrC,KAAK,GAAG,UAAU,OAAO,MAAM,CACnC,CAEE,SAASC,EAAU,CACjB,KAAK,SAAWA,CACpB,CAEE,oBAAoB,EAAG,CACrB,IAAIC,EACAC,EAAa,GAEjB,GAAI,EAAE,OAAS,QACb,OAAO,GAAG,UAAU,OAAO,MAAM,UACxB,EAAE,OAAS,UAAW,CAC/B,MAAMC,EAAa,OAAO,QAAQ,OAAO,oBAAsB,CAAC,EAC5DA,GACF,OAAO,YAAYA,EAAW,KAAK,CAE3C,SAAe,EAAE,OAAS,YAAa,CACjC,MAAMC,EAAa,OAAO,QAAQ,OAAO,oBAAsB,CAAC,EAC5DA,GACF,OAAO,YAAYA,EAAW,KAAK,CAE3C,SAAe,EAAE,OAAS,SAAW,EAAE,OAAS,SAC1C,OAAO,GAAG,UAAU,OAAO,MAAM,MAC5B,CACL,aAAaH,CAAe,EAC5BC,GAAc,EAAE,IAChBD,EAAkB,WAAW,IAAM,CACjCC,EAAa,EACd,EAAE,GAAG,EACN,MAAMG,EAAiB,KAAK,QAAQ,KAAMT,GACjCA,EAAO,MAAM,YAAW,EAAG,SAASM,CAAU,CACtD,EACGG,GACF,KAAK,IAAI,YAAYA,EAAe,KAAK,CAEjD,CACA,CAEE,IAAI,gBAAiB,CACnB,OAAO,KAAK,QAAQ,KAAMT,GAAWA,EAAO,QAAQ,CACxD,CAEE,IAAI,qBAAsB,CACxB,OAAO,KAAK,QAAQ,QAAQ,KAAK,cAAc,CACnD,CAEE,YAAYU,EAAO,CACjB,MAAMC,EAAO,KAAK,QAAQ,KAAMX,GACvBA,EAAO,QAAUU,CACzB,EACKE,EAAO,KAAK,eAElBA,EAAK,SAAW,GAChBD,EAAK,SAAW,GAEhB,KAAK,MAAM,UAAYA,EAAK,MAE5B,KAAK,IAAI,QAAQ,MAAWA,EAAK,MACjCC,EAAK,QAAQ,UAAU,OAAO,UAAU,EAExCD,EAAK,QAAQ,UAAU,IAAI,UAAU,EACrCA,EAAK,QAAQ,eAAe,CAAE,MAAO,SAAS,CAAE,EAEhD,KAAK,IAAI,cACP,IAAI,YAAY,uBAAwB,CACtC,QAAS,GACT,OAAQ,CAAE,KAAAA,EAAM,KAAAC,EAAM,OAAQ,KAAK,GAAK,CAChD,CAAO,CACF,CACL,CAYA"}