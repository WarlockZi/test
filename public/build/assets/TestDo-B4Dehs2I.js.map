{"version":3,"file":"TestDo-B4Dehs2I.js","sources":["../../src/Admin/Test/TestDo/TestDo.js"],"sourcesContent":["import \"./TestDo.scss\";\nimport { $, cachePage, post } from \"@src/common.js\";\nimport { qa } from \"@src/constants.js\";\n\nexport default class TestDo {\n  constructor(test) {\n    this.navs = $(\"[data-pagination]\") ?? \"\";\n    this.finishBtn = $(\".finish-test\").first();\n\n    $(\".question\").first().classList.add(\"show\");\n    this.inactivateFinishBtn();\n    test.addEventListener(\"click\", this.handleClick.bind(this));\n  }\n\n  handleClick({ target }) {\n    const id = +$(\".question.show\").first()?.dataset.id ?? 0;\n    const navIndex =\n      this.navs.findIndex((el) => el.classList.contains(\"active\")) ?? 0;\n\n    if (target.type === \"checkbox\") {\n      this.handleCheckboxChange(target);\n      target.labels[0].classList.toggle(\"pushed\");\n    } else if (target.id === \"prev\") {\n      this.prevQ(id, navIndex);\n    } else if (target.id === \"next\") {\n      this.nextQ(id, navIndex);\n    } else if (target === this.finishBtn) {\n      this.finishTest(target).then();\n    }\n  }\n\n  handleCheckboxChange(target) {\n    const checkboxes = target.closest(\".question\")[qa](`[type='checkbox']`);\n    const checkedCheckboxes = [].filter.call(\n      checkboxes,\n      (check) => check.checked === true,\n    );\n\n    const questionId = target.closest(\".question\").dataset.id;\n    const navItem = $(\".navigation\").find(`[data-pagination=\"${questionId}\"]`);\n    if (checkedCheckboxes) {\n      navItem.classList.add(\"filled\");\n    } else {\n      navItem.classList.remove(\"filled\");\n    }\n  }\n\n  prevQ(id, navIndex) {\n    if (navIndex < 1) return false;\n    const aimId = +this.navs[navIndex - 1].dataset.pagination;\n    this.pushNav(id, aimId);\n    this.pushQ(aimId);\n  }\n\n  nextQ(id, navIndex) {\n    if (navIndex + 1 === this.navs.length) return false;\n    const aimId = +this.navs[navIndex + 1].dataset.pagination;\n\n    this.pushNav(id, aimId);\n    this.pushQ(aimId);\n  }\n\n  pushNav(currentId, aimNavId) {\n    $(`[data-pagination=\"${currentId}\"]`).first().classList.toggle(\"active\");\n    $(`[data-pagination=\"${aimNavId}\"]`).first().classList.toggle(\"active\");\n  }\n\n  pushQ(aimId) {\n    $(\".question.show\").first().classList.toggle(\"show\");\n    $(`.question[data-id=\"${aimId}\"]`).first().classList.toggle(\"show\");\n  }\n\n  async finishTest(target) {\n    if (target.innerText === \"ПРОЙТИ ТЕСТ ЗАНОВО\") {\n      location.reload();\n      return;\n    }\n    target.innerText = \"ПРОЙТИ ТЕСТ ЗАНОВО\";\n    target.classList.add(\"inactive\");\n\n    const corrAnswers = await post(\"/adminsc/test/getCorrectAnswers\", {});\n    this.colorView(corrAnswers.arr);\n    const errorCnt = $(\".redShadow\").length;\n\n    const data = this.DTO(errorCnt);\n    const res = await post(\"/adminsc/testresult/create\", data);\n    if (res) {\n      target.href = location.href;\n      target.innerText = \"ПРОЙТИ ТЕСТ ЗАНОВО\";\n    }\n  }\n\n  DTO(errorCnt) {\n    return {\n      questionCnt: $(\".question\").length,\n      errorCnt: errorCnt,\n      html: cachePage(\".test-do .content\"),\n      testid: $(\"[data-test-id]\")[0].dataset.testId,\n      testname: $(\".test-name\")[0].innerText,\n      user: $(\".user-menu .fio\")[0].innerText,\n    };\n  }\n\n  colorView(correctAnswers) {\n    let questions = $(\".question\");\n    [].map.call(questions, (question) => {\n      let errors = this.colorQuestions(question, correctAnswers);\n      this.colorPgination(question, errors);\n    });\n  }\n\n  colorPgination(question, errors) {\n    const id = question.dataset[\"id\"];\n    const paginItem = $(`.pagination [data-pagination='${+id}']`)[0];\n    if (errors.length) {\n      $(paginItem).addClass(\"redShadow\");\n    } else {\n      $(paginItem).addClass(\"greenShadow\");\n    }\n  }\n\n  colorQuestions(question, correctAnswers) {\n    const answers = question.querySelectorAll(\".a\");\n    const errors = [];\n    [].map.call(answers, (answer) => {\n      const input = $(answer).find(\"input\");\n      const id = answer.dataset.id;\n      const error = this.checkCorrectAnswers(id, correctAnswers, input, answer);\n      if (error) errors.push(true);\n    });\n    return errors;\n  }\n\n  checkCorrectAnswers(id, correctAnswers, input, answer) {\n    const correctAnser = correctAnswers.indexOf(+id) !== -1;\n    const checked = input.checked;\n    let error = false;\n\n    if (checked && correctAnser) {\n      // checkbox нажат. а в correct answer нету. в correct_answers есть, его всегда подсвечиваем зеленым\n      answer.classList.add(\"done\"); //green check зеленый значек\n    } else if (checked && !correctAnser) {\n      // checkbox нажат,и есть в correct answer. в correct_answers нет, кнопка не нажата\n      error = true;\n    } else if (!checked && correctAnser) {\n      // кнопка не нажата, в correct_answers есть\n      answer.classList.add(\"done\"); //green check зеленый значек\n      error = true;\n    } else if (!checked && !correctAnser) {\n      // кнопка не нажата, в correct_answers нет\n    }\n    return error;\n  }\n\n  inactivateFinishBtn() {\n    if (window.location.pathname.match(\"^/test/result/.?\")) {\n      this.finishBtn.classList.add(\"inactive\");\n    }\n  }\n}\n"],"names":["TestDo","test","$","target","id","navIndex","el","checkboxes","qa","checkedCheckboxes","check","questionId","navItem","aimId","currentId","aimNavId","corrAnswers","post","errorCnt","data","cachePage","correctAnswers","questions","question","errors","paginItem","answers","answer","input","correctAnser","checked","error"],"mappings":"mGAIe,MAAMA,CAAO,CAC1B,YAAYC,EAAM,CAChB,KAAK,KAAOC,EAAE,mBAAmB,GAAK,GACtC,KAAK,UAAYA,EAAE,cAAc,EAAE,MAAO,EAE1CA,EAAE,WAAW,EAAE,MAAO,EAAC,UAAU,IAAI,MAAM,EAC3C,KAAK,oBAAqB,EAC1BD,EAAK,iBAAiB,QAAS,KAAK,YAAY,KAAK,IAAI,CAAC,CAC9D,CAEE,YAAY,CAAE,OAAAE,GAAU,CACtB,MAAMC,EAAK,CAACF,EAAE,gBAAgB,EAAE,SAAS,QAAQ,GAC3CG,EACJ,KAAK,KAAK,UAAWC,GAAOA,EAAG,UAAU,SAAS,QAAQ,CAAC,GAAK,EAE9DH,EAAO,OAAS,YAClB,KAAK,qBAAqBA,CAAM,EAChCA,EAAO,OAAO,CAAC,EAAE,UAAU,OAAO,QAAQ,GACjCA,EAAO,KAAO,OACvB,KAAK,MAAMC,EAAIC,CAAQ,EACdF,EAAO,KAAO,OACvB,KAAK,MAAMC,EAAIC,CAAQ,EACdF,IAAW,KAAK,WACzB,KAAK,WAAWA,CAAM,EAAE,KAAM,CAEpC,CAEE,qBAAqBA,EAAQ,CAC3B,MAAMI,EAAaJ,EAAO,QAAQ,WAAW,EAAEK,CAAE,EAAE,mBAAmB,EAChEC,EAAoB,GAAG,OAAO,KAClCF,EACCG,GAAUA,EAAM,UAAY,EAC9B,EAEKC,EAAaR,EAAO,QAAQ,WAAW,EAAE,QAAQ,GACjDS,EAAUV,EAAE,aAAa,EAAE,KAAK,qBAAqBS,CAAU,IAAI,EACrEF,EACFG,EAAQ,UAAU,IAAI,QAAQ,EAE9BA,EAAQ,UAAU,OAAO,QAAQ,CAEvC,CAEE,MAAMR,EAAIC,EAAU,CAClB,GAAIA,EAAW,EAAG,MAAO,GACzB,MAAMQ,EAAQ,CAAC,KAAK,KAAKR,EAAW,CAAC,EAAE,QAAQ,WAC/C,KAAK,QAAQD,EAAIS,CAAK,EACtB,KAAK,MAAMA,CAAK,CACpB,CAEE,MAAMT,EAAIC,EAAU,CAClB,GAAIA,EAAW,IAAM,KAAK,KAAK,OAAQ,MAAO,GAC9C,MAAMQ,EAAQ,CAAC,KAAK,KAAKR,EAAW,CAAC,EAAE,QAAQ,WAE/C,KAAK,QAAQD,EAAIS,CAAK,EACtB,KAAK,MAAMA,CAAK,CACpB,CAEE,QAAQC,EAAWC,EAAU,CAC3Bb,EAAE,qBAAqBY,CAAS,IAAI,EAAE,QAAQ,UAAU,OAAO,QAAQ,EACvEZ,EAAE,qBAAqBa,CAAQ,IAAI,EAAE,QAAQ,UAAU,OAAO,QAAQ,CAC1E,CAEE,MAAMF,EAAO,CACXX,EAAE,gBAAgB,EAAE,MAAO,EAAC,UAAU,OAAO,MAAM,EACnDA,EAAE,sBAAsBW,CAAK,IAAI,EAAE,QAAQ,UAAU,OAAO,MAAM,CACtE,CAEE,MAAM,WAAWV,EAAQ,CACvB,GAAIA,EAAO,YAAc,qBAAsB,CAC7C,SAAS,OAAQ,EACjB,MACN,CACIA,EAAO,UAAY,qBACnBA,EAAO,UAAU,IAAI,UAAU,EAE/B,MAAMa,EAAc,MAAMC,EAAK,kCAAmC,CAAA,CAAE,EACpE,KAAK,UAAUD,EAAY,GAAG,EAC9B,MAAME,EAAWhB,EAAE,YAAY,EAAE,OAE3BiB,EAAO,KAAK,IAAID,CAAQ,EAClB,MAAMD,EAAK,6BAA8BE,CAAI,IAEvDhB,EAAO,KAAO,SAAS,KACvBA,EAAO,UAAY,qBAEzB,CAEE,IAAIe,EAAU,CACZ,MAAO,CACL,YAAahB,EAAE,WAAW,EAAE,OAC5B,SAAUgB,EACV,KAAME,EAAU,mBAAmB,EACnC,OAAQlB,EAAE,gBAAgB,EAAE,CAAC,EAAE,QAAQ,OACvC,SAAUA,EAAE,YAAY,EAAE,CAAC,EAAE,UAC7B,KAAMA,EAAE,iBAAiB,EAAE,CAAC,EAAE,SAC/B,CACL,CAEE,UAAUmB,EAAgB,CACxB,IAAIC,EAAYpB,EAAE,WAAW,EAC7B,CAAA,EAAG,IAAI,KAAKoB,EAAYC,GAAa,CACnC,IAAIC,EAAS,KAAK,eAAeD,EAAUF,CAAc,EACzD,KAAK,eAAeE,EAAUC,CAAM,CAC1C,CAAK,CACL,CAEE,eAAeD,EAAUC,EAAQ,CAC/B,MAAMpB,EAAKmB,EAAS,QAAQ,GACtBE,EAAYvB,EAAE,iCAAiC,CAACE,CAAE,IAAI,EAAE,CAAC,EAC3DoB,EAAO,OACTtB,EAAEuB,CAAS,EAAE,SAAS,WAAW,EAEjCvB,EAAEuB,CAAS,EAAE,SAAS,aAAa,CAEzC,CAEE,eAAeF,EAAUF,EAAgB,CACvC,MAAMK,EAAUH,EAAS,iBAAiB,IAAI,EACxCC,EAAS,CAAE,EACjB,OAAA,EAAG,IAAI,KAAKE,EAAUC,GAAW,CAC/B,MAAMC,EAAQ1B,EAAEyB,CAAM,EAAE,KAAK,OAAO,EAC9BvB,EAAKuB,EAAO,QAAQ,GACZ,KAAK,oBAAoBvB,EAAIiB,EAAgBO,EAAOD,CAAM,GAC7DH,EAAO,KAAK,EAAI,CACjC,CAAK,EACMA,CACX,CAEE,oBAAoBpB,EAAIiB,EAAgBO,EAAOD,EAAQ,CACrD,MAAME,EAAeR,EAAe,QAAQ,CAACjB,CAAE,IAAM,GAC/C0B,EAAUF,EAAM,QACtB,IAAIG,EAAQ,GAEZ,OAAID,GAAWD,EAEbF,EAAO,UAAU,IAAI,MAAM,EAClBG,GAAW,CAACD,EAErBE,EAAQ,GACC,CAACD,GAAWD,IAErBF,EAAO,UAAU,IAAI,MAAM,EAC3BI,EAAQ,IAIHA,CACX,CAEE,qBAAsB,CAChB,OAAO,SAAS,SAAS,MAAM,kBAAkB,GACnD,KAAK,UAAU,UAAU,IAAI,UAAU,CAE7C,CACA"}