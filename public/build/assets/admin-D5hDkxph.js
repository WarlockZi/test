const __vite__fileDeps=["assets/index-D6yZjWhN.js","assets/common-mpP3SXMn.js","assets/index-Du3s5jNk.css","assets/AdminSidebar-C_b0c-Rp.js","assets/constants-Clh-pk9Y.js","assets/AdminSidebar-Cg7ldI_K.css","assets/Product-D17RuiO0.js","assets/Promotion-pGe4t7t6.js","assets/Promotion-C-yV3o17.css","assets/quill-oEZV8zch.js","assets/quill.snow-DpC92mTv.js","assets/quill-BS3afWzt.css","assets/Product-g_McCRne.css","assets/product-BjfEtDHX.css","assets/catalog-item-DKXjPmTa.js","assets/search-8dUqjTIi.js","assets/search-dbEvGbvK.css","assets/order-C3jNLQZo.js","assets/order-B2jhaEIF.css","assets/modal-BHcfbFZS.js","assets/modal-aJpmGEvw.css","assets/Category-B5SeZx8m.js","assets/Category-BpqyPztA.css","assets/chartjs-D8I9db7I.js","assets/chartjs-BPcd8uUI.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{$ as a,l as y,p as h,d as E,_ as r}from"./common-mpP3SXMn.js";import{q as u}from"./constants-Clh-pk9Y.js";import v from"./search-8dUqjTIi.js";import{P as g}from"./Promotion-pGe4t7t6.js";import"./quill.snow-DpC92mTv.js";let p=a("[custom-date]");if(p)for(let n of p)n.onchange=function({target:t}){let{yyyy:e,mm:s,dd:i}=y(t.value),o=`${e}-${s}-${i}`;t.value,t.setAttribute("data-value",o)};class I{constructor(t){this.$sync=t,this.$log_content=a(t).find("#log_content"),this.$sync.onclick=this.handleClick.bind(this)}async handleClick({target:t}){if(t.classList.contains("button")){let e=await h(`/adminsc/sync/${t.id}`);e?.arr?.success&&(this.$log_content.innerText=e.arr?.content)}}}let w=a(".sync").first();w&&new I(w);const A=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function T(n){/\/adminsc\/settings/.test(n)||/\/adminsc\/right\/list/.test(n)||/\/adminsc\/post\/list/.test(n)||/\/adminsc\/todo\/list/.test(n)?a("[settings]").addClass("current"):/\/auth\/profile/.test(n)||(/\/adminsc\/crm/.test(n)?a("[crm]").addClass("current"):/\/adminsc\/planning/.test(n)?a("[plan]").addClass("current"):/\/adminsc\/category/.test(n)||/\/adminsc\/product/.test(n)?a("[catalog]").addClass("current"):/\/test/.test(n)||/\/opentest/.test(n)||/\/adminsc\/opentest/.test(n)||/\/adminsc\/test/.test(n)?a("[test]").addClass("current"):a("[href='/adminsc']").addClass("current"))}class C{constructor(t){this.table=t,this.model=t.dataset.model??t.closest("[data-model]")?.dataset.model,this.modelId=t.dataset.id??t.closest("[data-model]")?.dataset.id,this.relation=t.dataset.relation??null,this.relationModel=t.dataset.relationmodel??null,this.url=`/adminsc/${this.model}/updateOrCreate`,this.headers=a(".head"),this.inputs=a(".head input"),this.hidden=a("[hidden]"),this.editable=a("[contenteditable]"),this.sortables=a("[data-sort]"),this.ids=this.getIds(),this.rows=this.fillRows(),this.WSSelects=a("[custom-select]"),[].forEach.call(this.WSSelects,e=>{e.onchange=this.customSelectChange}),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=E(this.handleInput),this.directions=Array.from(this.sortables).map(function(e){return""})}async handleClick(t){const e=t.target;if(e.className==="add-model")this.createModel(e);else if(e.className===".del:not(.head)"||e.closest(".del:not(.head)"))this.modelDel(e.closest(".del:not(.head)"));else if(e.className==="edit:not(.head)"||e.closest(".edit:not(.head)"))t.preventDefault(),this.edit(e);else if(e.type==="checkbox"){const s=e.dataset.func,i=e.checked,o=e.dataset["1sid"],d={base_is_shippable:i,product_1s_id:o};await h(`/adminsc/${this.model}/${s}`,d)}else if(e.classList.contains("head")||e.classList.contains("icon")){const s=e.closest(".head");if(s.hasAttribute("data-sort")){const i=[].findIndex.call(sortables,(o,d,c)=>o===s);this.sortColumn(i)}}}edit(t){const e=this.relation?this.relationModel:this.model,s=this.relation?t.dataset.id:this.modelId??t.dataset.id;window.location=`/adminsc/${e}/edit/${s}`}async customSelectChange({target:t}){if(!t.closest("[data-model]"))return!1;const s=t.options.selectedIndex,i=t.options[s].value,o={[this.field]:i,id:this.modelId};await h(this.url,o)}getIds(){let t=a(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,function(e){return e.dataset.id!=="0"})}handlePaste(t){t.target.innerText=t.clipboardData.getData("text/plain"),this.handleInput(t.target),t.target.innerText=""}handleKeyUp(t){let e=t.target;if(t.cancelBubble=!0,e.hasAttribute("contenteditable"))this.debouncedInput(e);else if(e.closest(".head")){const s=e.closest(".head"),i=[].findIndex.call(this.headers,(o,d,c)=>o===s);this.search(i,e)}}async handleInput(t){const e=this.createModel(t),s=await h(this.url,e);s.arr.id&&this.newRow(s?.arr.id).bind(this)}async modelDel(t){if(!confirm("Удалить?"))return;let e=t.dataset.id;await h(`/adminsc/${this.model}/delete`,{id:e})&&delView(e)}createModel(t){return{model:this.model,id:this.modelId,relation:this.relation,fields:this.relationDTO(t)}}relationDTO(t){return this.relation?{id:t.dataset.id,[t.dataset.field]:t.innerText}:null}newRow(t){[].forEach.call(this.hidden,function(e){const s=e.cloneNode(!0);s.removeAttribute("hidden"),a(this.table).find(".custom-table").appendChild(s),["id"].includes(s.dataset.field)?s.innerText=t:["del","edit","save"].includes(s.className)||s.hasChildNodes("select")||(s.innerText=""),s.dataset.id=t}.bind(this))}showAllRows(){[].forEach.call(this.rows,t=>{[].forEach.call(t,e=>{e.style.display="flex"})})}search(t,e){this.showAllRows();const s=e.value;[].forEach.call(this.inputs,i=>{i!==e&&(i.value="")}),[].forEach.call(this.rows,function(i){const o=i[t].innerText,d=new RegExp(`${s}`,"gi");o.match(d)||[].forEach.call(i,c=>{c.style.display="none"})})}fillRows(){let t=[];for(let e=0;e<this.ids.length;e++){let s=this.ids[e].dataset.id,i=a(this.table)[0].querySelectorAll(`[data-id='${s}']`);t.push(i)}return t}sortColumn(t){const e=this.fillRows(),s=this.directions[t]||"asc",i=s==="asc"?1:-1,o=Array.from(e);o.sort(function(d,c){const l=d[t].innerHTML,b=c[t].innerHTML,m=this.transform(t,l),f=this.transform(t,b);switch(!0){case m>f:return 1*i;case m<f:return-1*i;case m===f:return 0}}),[].forEach.call(e,function(d){[].forEach.call(d,c=>{c.remove()})}),this.directions[t]=s==="asc"?"desc":"asc",o.forEach(function(d){d=Array.from(d),d.reverse(),[].forEach.call(d,c=>{this.headers[this.headers.length-1].after(c)})})}transform(t,e){return this.sortables[t]?this.sortables[t].getAttribute("data-type")==="number"?parseFloat(e):e:void 0}save(t){return h(this.url,t.model)}makeServerModel(t){const e=this.model;return{model:{id:t.dataset.id,[t.dataset.field]:t.innerText},modelName:e}}delView(t){const e=a(`[data-id='${t}']`);[].forEach.call(e,function(s){s.remove()})}}const _=a("[custom-table]");_&&[].forEach.call(_,function(n){new C(n)});document.addEventListener("scroll",n=>{const t=document.querySelector(".admin-panel");if(!t)return!1;window.scrollY>30&&(t.classList.add("fixed"),setTimeout(()=>{t.style.top="0"},1)),window.scrollY<20&&t.classList.remove("fixed")},{passive:!0});a(document).ready(async function(){if(!window.location.pathname.includes("adminsc"))return!1;window.location.href.includes("/test")&&await r(()=>import("./index-D6yZjWhN.js").then(l=>l.i),__vite__mapDeps([0,1,2]));const e=a(".admin-sidebar").first();if(e){const{default:l}=await r(()=>import("./AdminSidebar-C_b0c-Rp.js"),__vite__mapDeps([3,1,4,5]));new l(e)}if(document[u](".item-wrap[data-model='product']")){const{default:l}=await r(()=>import("./Product-D17RuiO0.js"),__vite__mapDeps([6,1,7,8,4,9,10,11,12,13]));new l}const i=document[u](".item-wrap");if(i){const{default:l}=await r(()=>import("./catalog-item-DKXjPmTa.js"),__vite__mapDeps([14,1,4,15,16,7,8,10,11]));new l(i)}if(document[u](".order-edit")){const{default:l}=await r(()=>import("./order-C3jNLQZo.js"),__vite__mapDeps([17,7,1,8,18]));new l}if(document[u](".modal-wrapper")){const{default:l}=await r(()=>import("./modal-BHcfbFZS.js"),__vite__mapDeps([19,1,20]));new l}const o=document[u](".item-wrap[data-model='category']");if(o){const{default:l}=await r(()=>import("./Category-B5SeZx8m.js"),__vite__mapDeps([21,1,7,8,4,22,13]));new l(o)}new g,new v(!0),T(window.location.pathname),document.getElementById("income")&&await r(()=>import("./chartjs-D8I9db7I.js"),__vite__mapDeps([23,24])),window.location.pathname==="/adminsc/settings"&&await r(()=>Promise.resolve().then(()=>A),void 0)});
