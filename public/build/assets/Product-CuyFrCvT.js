const __vite__fileDeps=["assets/admin-BbB-bfei.js","assets/preload-helper-DaGCtZ-7.js","assets/constants-D6t7YzCi.js","assets/search-DQiu1Dxx.js","assets/search-CLyZNsQw.css","assets/quill.snow-BxDoWBhC.js","assets/quill-BS3afWzt.css","assets/Promotion-08ArJgoL.js","assets/Promotion-DnuCazsS.css","assets/admin-CDvGjXX9.css","assets/Fields-DSRcsbUz.js","assets/Values-Dv0GdoRr.js","assets/product-DQYvEQKo.css","assets/card_panel-CTzoWkTg.js","assets/card_panel-COc34v_C.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as o}from"./preload-helper-DaGCtZ-7.js";/* empty css                */import{$ as l,e as n,g as f,i as w,p as c,q as u,o as v}from"./constants-D6t7YzCi.js";import{S as h}from"./Promotion-08ArJgoL.js";class _{constructor(e){this.$table=l(e).first(),this.$table&&(this.product1sId=l("[data-field='1s_id']").first().innerText,this.$baseUnit=l("select").first(),this.$addUnit=l(".add-unit").first(),this.$rows=l(".rows").first(),this.$emtyRow=l(this.$rows).find(".none"),this.$addUnit.onclick=this.createRow.bind(this),this.$rows.onchange=this.handleChange.bind(this),this.$rows.onkeyup=this.handleKeyUp.bind(this),this.$rows.onclick=this.clickRow.bind(this),this.$rows.addEventListener("customSelect.changed",this.unitChanged.bind(this)),this.initSelects(),setTimeout(this.deleteSelected.bind(this),800))}initSelects(){this.$rows.querySelectorAll("[custom-select]").forEach(e=>{new h(e)})}deleteSelected(){let e=this.$rows.querySelectorAll(".selected");e=Array.from(e).map(t=>{if(+t.dataset.value)return t.dataset.value}),this.$table.querySelectorAll("[custom-select]").forEach(function(t){t.querySelectorAll("li").forEach(function(s){e.includes(s.dataset.value)&&s.remove()})})}createSelect(e){const t=new n().tag("select").attr("new-select").className("name").get();return[...e[f]("li")].map(s=>{const a=new n().tag("option").attr("value",s.dataset.value).text(s[w]).get();t.append(a)}),t}createRow(){let e=this.$baseUnit.selectedOptions[0].innerText,t=new n().tag("div").attr("class","row").get();const s=this.createSelect(this.$emtyRow);let a=new n().attr("type","number").tag("input").attr("value",10).className("multiplier").get(),i=new n().tag("div").attr("class","base-unit").text(e).get(),d=new n().tag("div").className("shippable").get(),r=new n().tag("input").attr("type","checkbox").get(),m=new n().tag("div").attr("class","del").text("X").get();t.append(s),t.append(a),t.append(i),d.append(r),t.append(d),t.append(m),new h(s),this.$rows.append(t)}async unitChanged(e){let t=this.dto(e.target.closest(".row"));t.morphed.new_id=e.detail.next.value,t.morphed.old_id=e.detail.prev.value,e.detail.next.value&&this.deleteSelectedUnitFromSelects(e.detail.next.value),e.detail.prev.value&&this.addDeletedUnitToSelects(e.detail.prev),await c("/adminsc/product/changeUnit",t)}deleteSelectedUnitFromSelects(e){this.$table.querySelectorAll("[custom-select]").forEach(function(t){t.querySelectorAll("li").forEach(function(a){a.dataset.value===e&&a.remove()})})}addDeletedUnitToSelects(){this.$table.querySelectorAll("[custom-select]").forEach(function(e){e.querySelectorAll("li").forEach(function(s){s.dataset.value===value&&s.remove()})})}async clickRow({target:e}){var t;if(e.classList.contains("del")){let s=e.closest(".row"),a=this.dto(s),i=await c("/adminsc/product/deleteUnit",a);(t=i==null?void 0:i.arr)!=null&&t.ok&&s.remove()}}handleKeyUp(e){let t=+e.target.value;/\d+/.test(t)&&this.update(e,this)}async handleChange({target:e}){if(e.type==="checkbox"&&e.hasAttribute("data-isbase")){const t=+e.checked,a={product_1s_id:this.product1sId,base_is_shippable:t};await c("/adminsc/product/changeBaseIsShippable",a)}else this.update(e,this)}async update(e,t){let s=e.closest(".row");if(!+l(s).find("[select-new]").dataset.value)return!1;let i=t.dto(s);i.morphed.new_id=i.morphed.old_id,await c("/adminsc/product/changeUnit",i)}dto(e){let t={product_id:this.product1sId,multiplier:+l(e).find(".multiplier").value,is_shippable:l(e).find(".shippable input").checked?1:null},s={new_id:0,old_id:+this.getUnitId(e),detach:0};return{baseUnitId:this.getBaseUnitId(),pivot:t,morphed:s}}getBaseUnitId(){return+this.$baseUnit.options[this.$baseUnit.selectedIndex].value}getUnitId(e){return e.querySelector("[select-new]").dataset.value??0}}let g=l(".units").first();g&&new _(".units");class ${constructor(e){if(!e)return!1;this.product=e,this.setValues(),this.setFields(),this.setDragNDrop(),this.setCardPanel()}async setDragNDrop(){const e=document[u]("[dnd]");if(e){const{default:t}=await o(()=>import("./admin-BbB-bfei.js").then(s=>s.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));new t(e,this.addMainImage)}}async setFields(){const{default:e}=await o(()=>import("./Fields-DSRcsbUz.js"),__vite__mapDeps([10,7,2,8]));new e(this.product)}async setValues(){const{default:e}=await o(()=>import("./Values-Dv0GdoRr.js"),__vite__mapDeps([11,2,7,8,1,12]));new e(this.product)}async setCardPanel(){if(document[u](".cardPanel")){const{default:t}=await o(()=>import("./card_panel-CTzoWkTg.js"),__vite__mapDeps([13,2,14]));new t}}async addMainImage(e,t){const s={productId:t.closest(".item-wrap").dataset.id};let a=v(s,e[0]),i=await c("/adminsc/product/saveMainImage",a),d=i==null?void 0:i.arr[0];if(d){const r=t.closest(".dnd-container").querySelector("img");r.removeAttribute("src"),r.setAttribute("src",d)}}}export{$ as default};
