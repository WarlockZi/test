const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-lUlAePYS.js","assets/common-CBISCspz.js","assets/index-CJybINCP.css","assets/AdminSidebar-DwCaYd22.js","assets/constants-Clh-pk9Y.js","assets/AdminSidebar-hw3qDqLA.css","assets/Product-G_EDCEcD.js","assets/Promotion-CIo3W8Ce.js","assets/Promotion-V7cBE6F4.css","assets/quill-B63QAYlY.js","assets/quill.snow-CLSoiTIt.js","assets/quill-DGlT3_NJ.css","assets/search-BN4A0_iS.js","assets/Product-B1-2uUyD.css","assets/popup-Dv_TwhNX.css","assets/catalog-item-COIe2rcX.js","assets/order-DUyT4Xu3.js","assets/order-DwQyIllq.css","assets/modal-BbFiYG_4.js","assets/modal-4S_CipEQ.css","assets/Category-eo0Imhz6.js","assets/chartjs-BIs0YqqL.js","assets/chartjs-CF7yMAqi.css"])))=>i.map(i=>d[i]);
import{$ as d,f as b,p as h,d as E,_ as r}from"./common-CBISCspz.js";import{q as u}from"./constants-Clh-pk9Y.js";import"./quill.snow-CLSoiTIt.js";import{P as v}from"./Promotion-CIo3W8Ce.js";import g from"./search-BN4A0_iS.js";/* empty css              */let p=d("[custom-date]");if(p)for(let a of p)a.onchange=function({target:t}){let{yyyy:e,mm:s,dd:n}=b(t.value),o=`${e}-${s}-${n}`;t.value,t.setAttribute("data-value",o)};class I{constructor(t){this.$sync=t,this.$log_content=d(t).find("#log_content"),this.$sync.onclick=this.handleClick.bind(this)}async handleClick({target:t}){if(t.classList.contains("button")){let e=await h(`/adminsc/sync/${t.id}`);e?.arr?.success&&(this.$log_content.innerText=e.arr?.content)}}}let w=d(".sync").first();w&&new I(w);function A(a){/\/adminsc\/settings/.test(a)||/\/adminsc\/right\/list/.test(a)||/\/adminsc\/post\/list/.test(a)||/\/adminsc\/todo\/list/.test(a)?d("[settings]").addClass("current"):/\/auth\/profile/.test(a)||(/\/adminsc\/crm/.test(a)?d("[crm]").addClass("current"):/\/adminsc\/planning/.test(a)?d("[plan]").addClass("current"):/\/adminsc\/category/.test(a)||/\/adminsc\/product/.test(a)?d("[catalog]").addClass("current"):/\/test/.test(a)||/\/opentest/.test(a)||/\/adminsc\/opentest/.test(a)||/\/adminsc\/test/.test(a)?d("[test]").addClass("current"):d("[href='/adminsc']").addClass("current"))}class C{constructor(t){this.table=t,this.model=t.dataset.model??t.closest("[data-model]")?.dataset.model,this.modelId=t.dataset.id??t.closest("[data-model]")?.dataset.id,this.relation=t.dataset.relation??null,this.relationModel=t.dataset.relationmodel??null,this.url=`/adminsc/${this.model}/updateOrCreate`,this.headers=d(".head"),this.inputs=d(".head input"),this.hidden=d("[hidden]"),this.editable=d("[contenteditable]"),this.sortables=d("[data-sort]"),this.ids=this.getIds(),this.rows=this.fillRows(),this.WSSelects=d("[custom-select]"),[].forEach.call(this.WSSelects,e=>{e.onchange=this.customSelectChange}),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=E(this.handleInput),this.directions=Array.from(this.sortables).map(function(e){return""})}async handleClick(t){const e=t.target;if(e.className==="add-model")this.createModel(e);else if(e.className===".del:not(.head)"||e.closest(".del:not(.head)"))this.modelDel(e.closest(".del:not(.head)"));else if(e.className==="edit:not(.head)"||e.closest(".edit:not(.head)"))t.preventDefault(),this.edit(e);else if(e.type==="checkbox"){const s=e.dataset.func,n=e.checked,o=e.dataset["1sid"],l={base_is_shippable:n,product_1s_id:o};await h(`/adminsc/${this.model}/${s}`,l)}else if(e.classList.contains("head")||e.classList.contains("icon")){const s=e.closest(".head");if(s.hasAttribute("data-sort")){const n=[].findIndex.call(sortables,(o,l,i)=>o===s);this.sortColumn(n)}}}edit(t){const e=this.relation?this.relationModel:this.model,s=this.relation?t.dataset.id:this.modelId??t.dataset.id;window.location=`/adminsc/${e}/edit/${s}`}async customSelectChange({target:t}){if(!t.closest("[data-model]"))return!1;const s=t.options.selectedIndex,n=t.options[s].value,o={[this.field]:n,id:this.modelId};await h(this.url,o)}getIds(){let t=d(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,function(e){return e.dataset.id!=="0"})}handlePaste(t){t.target.innerText=t.clipboardData.getData("text/plain"),this.handleInput(t.target),t.target.innerText=""}handleKeyUp(t){let e=t.target;if(t.cancelBubble=!0,e.hasAttribute("contenteditable"))this.debouncedInput(e);else if(e.closest(".head")){const s=e.closest(".head"),n=[].findIndex.call(this.headers,(o,l,i)=>o===s);this.search(n,e)}}async handleInput(t){const e=this.createModel(t),s=await h(this.url,e);s.arr.id&&this.newRow(s?.arr.id).bind(this)}async modelDel(t){if(!confirm("Удалить?"))return;let e=t.dataset.id;await h(`/adminsc/${this.model}/delete`,{id:e})&&delView(e)}createModel(t){return{model:this.model,id:this.modelId,relation:this.relation,fields:this.relationDTO(t)}}relationDTO(t){return this.relation?{id:t.dataset.id,[t.dataset.field]:t.innerText}:null}newRow(t){[].forEach.call(this.hidden,function(e){const s=e.cloneNode(!0);s.removeAttribute("hidden"),d(this.table).find(".custom-table").appendChild(s),["id"].includes(s.dataset.field)?s.innerText=t:["del","edit","save"].includes(s.className)||s.hasChildNodes("select")||(s.innerText=""),s.dataset.id=t}.bind(this))}showAllRows(){[].forEach.call(this.rows,t=>{[].forEach.call(t,e=>{e.style.display="flex"})})}search(t,e){this.showAllRows();const s=e.value;[].forEach.call(this.inputs,n=>{n!==e&&(n.value="")}),[].forEach.call(this.rows,function(n){const o=n[t].innerText,l=new RegExp(`${s}`,"gi");o.match(l)||[].forEach.call(n,i=>{i.style.display="none"})})}fillRows(){let t=[];for(let e=0;e<this.ids.length;e++){let s=this.ids[e].dataset.id,n=d(this.table)[0].querySelectorAll(`[data-id='${s}']`);t.push(n)}return t}sortColumn(t){const e=this.fillRows(),s=this.directions[t]||"asc",n=s==="asc"?1:-1,o=Array.from(e);o.sort(function(l,i){const c=l[t].innerHTML,y=i[t].innerHTML,f=this.transform(t,c),m=this.transform(t,y);switch(!0){case f>m:return 1*n;case f<m:return-1*n;case f===m:return 0}}),[].forEach.call(e,function(l){[].forEach.call(l,i=>{i.remove()})}),this.directions[t]=s==="asc"?"desc":"asc",o.forEach(function(l){l=Array.from(l),l.reverse(),[].forEach.call(l,i=>{this.headers[this.headers.length-1].after(i)})})}transform(t,e){return this.sortables[t]?this.sortables[t].getAttribute("data-type")==="number"?parseFloat(e):e:void 0}save(t){return h(this.url,t.model)}makeServerModel(t){const e=this.model;return{model:{id:t.dataset.id,[t.dataset.field]:t.innerText},modelName:e}}delView(t){const e=d(`[data-id='${t}']`);[].forEach.call(e,function(s){s.remove()})}}const _=d("[custom-table]");_&&[].forEach.call(_,function(a){new C(a)});function T(){const a=d(".admin-panel").first();document.addEventListener("scroll",t.bind(a),{passive:!0});function t(){a&&(window.scrollY>40?a.classList.add("fixed"):a.classList.remove("fixed"))}}d(document).ready(async function(){if(T(),!window.location.pathname.includes("adminsc"))return!1;window.location.href.includes("/test")&&await r(async()=>{const{default:i}=await import("./index-lUlAePYS.js").then(c=>c.i);return{default:i}},__vite__mapDeps([0,1,2]));const e=d(".sidebar").first();if(e){const{default:i}=await r(async()=>{const{default:c}=await import("./AdminSidebar-DwCaYd22.js");return{default:c}},__vite__mapDeps([3,1,4,5]));new i(e)}if(document[u](".item-wrap[data-model='product']")){const{default:i}=await r(async()=>{const{default:c}=await import("./Product-G_EDCEcD.js");return{default:c}},__vite__mapDeps([6,1,7,8,4,9,10,11,12,13,14]));new i}const n=document[u](".item-wrap");if(n){const{default:i}=await r(async()=>{const{default:c}=await import("./catalog-item-COIe2rcX.js");return{default:c}},__vite__mapDeps([15,1,4,10,11,7,8,12,14]));new i(n)}if(document[u](".order-edit")){const{default:i}=await r(async()=>{const{default:c}=await import("./order-DUyT4Xu3.js");return{default:c}},__vite__mapDeps([16,7,1,8,17]));new i}if(document[u](".modal-wrapper")){const{default:i}=await r(async()=>{const{default:c}=await import("./modal-BbFiYG_4.js");return{default:c}},__vite__mapDeps([18,1,19]));new i}const o=document[u](".item-wrap[data-model='category']");if(o){const{default:i}=await r(async()=>{const{default:c}=await import("./Category-eo0Imhz6.js");return{default:c}},__vite__mapDeps([20,1,7,8,4,10,11,12,14]));new i(o)}new v,new g(!0),A(window.location.pathname),document.getElementById("income")&&await r(async()=>{const{default:i}=await import("./chartjs-BIs0YqqL.js");return{default:i}},__vite__mapDeps([21,22]))});
