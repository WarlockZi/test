import {$, popup, post} from '../../../../common.js'

export default class _test {

  constructor() {
    this.model = 'opentest'
  }

  async create() {
    let test = _test.serverModel()
    test.id = 0
    test.isTest = 1
    debugger
    let url = `/${this.model}/updateOrCreate`
    let res = await post(url, test)
    if (res) {
      window.location.href = `/adminsc/${model}/edit/${res.id}`
    }
  }

  id() {
    return id ?? $('.test-name')[0].dataset.testid
  }

  children() {
    let childrenLenght = $('.children').length
    if (childrenLenght)
      return childrenLenght
    return false
  }

  async path_create() {
    let test_path = _test.serverModel()
    test_path.id = 0
    test_path.isTest = 0
    let url = `/adminsc/${model}/create`
    let res = await post(url, test_path)
    if (res) {
      window.location.href = `/adminsc/${model}/edit/${res.id - 1}`
    }
  }

  name() {
    return $('.test-name')[0].innerText
  }

  async update() {
    let model = _test.serverModel()
    let url = `/adminsc/${model}/update/${model.id}`
    let res = await post(url, model)
    if (res) {
      window.location.href = `/adminsc/${model}/edit/${model.id}`
    }
  }

  async del() {
    if (_test.children()) {
      popup.show('Сначала удалите все тесты из папки')
      return false
    }

    let id = _test.id()
    let res = await post('/adminsc/${model}/delete', {id})
    if (res.notAdmin) {
      popup.show('Видимость теста скрыта. Чтобы удалить полностью - обратитесь к ГД')
      setTimeout(() => {
        window.location = `/adminsc/${model}/edit/400`
      }, 4000)
    } else {
      window.location = `/adminsc/${model}/edit/400`
    }

  }

}