import {$, popup, post} from '../../../common'

export let _answer = {

  async create(button) {

    let question = button.closest('.question-edit')
    let openquestion_id = question.id
    let sort = question.querySelectorAll('.answer').length + 1
    let res = await post('/openanswer/updateOrCreate',
      {openquestion_id, sort})
    res = JSON.parse(res)
    let id = res.id
    if (id) {
      let html = res.html
      button.insertAdjacentHTML("beforebegin", html)
    } else {
      popup.show('Сохранено')
    }
  },

  async del(target) {
    let del_button = target.closest('.delete')
    if (!del_button) return false
    if (confirm("Удалить этот ответ?")) {
      let answer = del_button.closest('.answer')
      let id = +answer.dataset['answerId']
      let res = await post('/openanswer/delete', {id})
      res = JSON.parse(res)
      if (res.msg === 'ok') {
        answer.remove()
        popup.show('Ответ удален')
      }
    }
  },
}
