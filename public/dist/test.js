!function(){"use strict";var e={721:function(e,t,n){var i=n(317);[...(0,i.$)(".search input").el].map((e=>{e&&e.addEventListener("input",(function(){!async function(e){let t=e.parentNode,n=(0,i.$)(t).find(".search__result");if(e.value.length<1)return void(n&&(n.innerHTML=""));let s=await fetch("/search?q="+e.value);s=await s.json(s),0!==n.childNodes.length&&(n.innerHTML=""),s.map((e=>{let t=document.createElement("a");t.href=e.alias,t.innerHTML=`<img src='/pic/${e.preview_pic}' alt='${e.name}'>`+e.name,n.appendChild(t)})),(0,i.$)("body").on("click",(function(e){n&&e.target!==n&&(n.innerHTML="")}))}(e)}),!0)})),n(291),document.cookie.match("(^|;)?cn=([^;]*)")?(0,i.$)("#cookie-notice").css("bottom","-100%"):(0,i.$)("#cookie-notice").css("bottom","0"),(0,i.$)("#cn-accept-cookie").on("click",(function(){(function(){const e=new Date;e.setTime(e.getTime()+864e5),document.cookie="cn=1; expires="+e+"path=/; SameSite=lax"})(),(0,i.$)("#cookie-notice").css("bottom","-100%")}));var s=n(697),a=n(74);(0,i.$)(".test-do__menu-slider").on("click",(function(e){let t=e.target.closest(".test-do__menu-slider");(0,i.$)(t).find(".menu").classList.toggle("menu-open")})),(0,i.$)(".question").removeClass("flex1"),(0,i.$)(".question:first-child").addClass("flex1"),(0,a.nl)(),(0,i.$)('[type="checkbox"]').on("click",(function(e){e.target.labels[0].classList.toggle("pushed")})),(0,i.$)("#prev").on("click",s.h.prevQ),(0,i.$)("#next").on("click",s.h.nextQ),window.location.pathname.match(/result/)&&(0,i.$)(".test-do__finish-btn").el[0].classList.add("inactive"),(0,i.$)(".test-do__finish-btn").on("click",(async function(e){let t=e.target;if(t.classList.contains("inactive"))return!1;if("btnn"!==t.id)return!1;if("ПРОЙТИ ТЕСТ ЗАНОВО"==t.text)return void location.reload();let n=await(0,i.v_)("/test/getCorrectAnswers",{});n=JSON.parse(n);let s=function(e){let t={token:document.querySelector('meta[name="token"]').getAttribute("content"),questionCnt:(0,i.$)(".question").el.length,errorCnt:e,pageCache:`<!DOCTYPE ${document.doctype.name}>`+document.documentElement.outerHTML,testId:(0,i.$)("[data-test-id]").el[0].dataset.testId,test_name:(0,i.$)(".test-name").el[0].innerText,userName:(0,i.$)(".user-menu__fio").el[0].innerText},n=new FormData;return n.append("token",t.token),n.append("questionCnt",t.questionCnt),n.append("errorCnt",t.errorCnt),n.append("pageCache",t.pageCache),n.append("testId",t.testId),n.append("test_name",t.test_name),n.append("userName",t.userName),n}(function(e){let t=(0,i.$)(".question").el;return Array.from(t).map(((t,n)=>{let s=t.querySelectorAll(".a"),a=[];Array.from(s).map((t=>{let n=t.getElementsByTagName("input")[0],i=n.id.replace("answer-",""),s=t.getElementsByTagName("label")[0];(function(e,t,n){return t.checked&&e?(n.classList.add("done"),!0):!(t.checked&&!e)&&(!t.checked&&e?(n.classList.add("done"),n.classList.add("done"),!1):!t.checked&&!e||void 0)})(-1!==e.indexOf(i),n,s)||a.push(!0)}));let o=+t.dataset.id,r=(0,i.$)('.pagination [data-pagination="'+o+'"]').el[0];a.length?(0,i.$)(r).addClass("redShadow"):(0,i.$)(r).addClass("greenShadow")})),(0,i.$)(".redShadow").el.length}(n));await(0,i.v_)("/test/cachePageSendEmail",s)&&((0,i.$)("#btnn").el[0].href=location.href,(0,i.$)("#btnn").el[0].text="ПРОЙТИ ТЕСТ ЗАНОВО")}))},576:function(e,t,n){n.d(t,{V:function(){return s}});var i=n(317);let s={el:e=>{let t=e.parentNode.querySelectorAll(".answer"),n=0;t.length&&(n=+(0,i.$)(t[t.length-1]).find(".answer__sort").innerText);let a=(0,i.$)(".answer__create").find(".answer").cloneNode(!0);return a.classList.add("answer"),a.classList.remove("answer__create"),{el:a,id:"new",q_id:+e.closest(".question-edit").id,previous_sort:n,sort:(0,i.$)(a).find(".answer__sort"),checked:(0,i.$)(a).find("input"),text:(0,i.$)(a).find(".answer__text"),delete:(0,i.$)((0,i.$)(a).find(".answer__delete")).on("click",(function(){s.del(this)}))}},getModelForServer:e=>({answer:"",parent_question:e.q_id,correct_answer:0,pica:""}),async create(e){let t=e.target,n=await async function(e){let t=s.getModelForServer(s.el(e)),n=await(0,i.v_)("/answer/create",t);return n=JSON.parse(n),n.id}(t);!function(e){let n=s.el(t);n.checked.checked=!1,n.el.dataset.answerId=e,n.text.innerText="",n.sort.innerText=n.previous_sort+1,n.el.style.display="flex",t.before(n.el),n.el.style.opacity=1}(n)},async del(e){let t=e.target;confirm("Удалить этот ответ?")&&(await async function(e){let t=+e.closest(".answer").dataset.answerId,n=await(0,i.v_)("/answer/delete",{a_id:t});n=JSON.parse(n),"ok"===n.msg&&i.gk.show("Ответ удален")}(t),function(e){e.closest(".answer").remove()}(t))}}},456:function(e,t,n){n.d(t,{A:function(){return a}});var i=n(317),s=n(576);let a={sort:async function(e){let t=[...a.questions()].filter((function(t,n){if(n+1<e)return t})),n=t.map((e=>e.id)),s=await(0,i.v_)("/question/sort",{toChange:n});s=JSON.parse(s),s.msg&&i.gk.show(s.msg),t.map(((e,t)=>{(0,i.$)(e).find(".question__sort").innerText=t+1}))},showTip:(e,t)=>{let n=t.target;document.createElement("div"),"save"===e&&(0,i.Z$)(n,"сохранить")},showFirst:()=>{let e=a.cloneEmptyModel();if(!e)return;let t=a.viewModel(e);t.sort.innerText="1",(0,i.$)(t.save).on("click",a.save),(0,i.$)(t.del).on("click",a.delete),(0,i.$)(e).addClass("question-edit"),(0,i.$)(e).removeClass("question__create"),(0,i.$)(".questions").el[0].prepend(e)},cloneEmptyModel:()=>{let e=(0,i.$)(".questions .question__create .question-edit").el[0];if(e)return e.cloneNode(!0)},showAnswers:e=>{let t=e.target,n=t.parentNode.parentNode,s=(0,i.$)(n).find(".question__answers");s.classList.toggle("height"),s.classList.toggle("scale"),t.classList.toggle("rotate")},viewModel:e=>({id:+e.id,el:e,sort:e.querySelector(".question__sort"),save:e.querySelector(".question__save"),text:e.querySelector(".question__text"),del:e.querySelector(".question__delete"),createAnswerButton:e.querySelector(".answer__create-button"),addButton:(0,i.$)((0,i.$)(".questions").el[0]).find(".question__create-button")}),serverModel:()=>({question:{id:null,qustion:"",parent:+window.location.href.split("/").pop(),sort:a.questionsCount()}}),questions:()=>(0,i.$)(".questions>.question-edit").el,questionsCount:()=>(0,i.$)(".questions>.question-edit").el.length,create:async e=>{let t=await a.createOnServer(e);t&&a.createOnView(t)},createOnServer:async()=>{let e=a.serverModel(),t=await(0,i.v_)("/question/updateOrCreate",{question:e.question,answers:{}});return t=await JSON.parse(t),t.id},createOnView:e=>{let t=a.cloneEmptyModel(),n=a.viewModel(t);(0,i.$)(n.save).on("click",a.save),(0,i.$)(n.del).on("click",a.delete),(0,i.$)(n.text).on("click",a.showAnswers),(0,i.$)(n.createAnswerButton).on("click",s.V.create),n.sort.innerText=a.questions().length+1,n.text.innerText="",n.el.id=e,n.addButton.before(t)},save:async e=>{let t=e.target.closest(".question-edit"),n=await(0,i.v_)("/question/UpdateOrCreate",{question:a.getModelForServer(t),answers:a.getAnswers(t)});n=await JSON.parse(n),i.gk.show(n.msg)},delete:async e=>{if(confirm("Удалить вопрос со всеми его ответами?")){let t=a.viewModel(e.target.closest(".question-edit")),n=t.id,s=await a.deleteFromServer(n);s&&(a.deleteFromView(t),i.gk.show(s.msg))}},deleteFromView:async e=>{e.el.remove()},deleteFromServer:async e=>{let t=await(0,i.v_)("/question/delete",{q_id:e});return JSON.parse(t)},getModelForServer:e=>({id:+e.id,parent:+(0,i.$)(".test-name").el[0].getAttribute("value"),picq:"",qustion:(0,i.$)(e).find(".question__text").innerText,sort:+(0,i.$)(e).find(".question__sort").innerText}),getAnswers:e=>[...e.querySelectorAll(".answer")].map((t=>({id:+t.dataset.answerId,answer:t.querySelector(".answer__text").innerText,correct_answer:+t.querySelector('[type="checkbox"]').checked,parent_question:+e.id,pica:""})),e)}},697:function(e,t,n){n.d(t,{h:function(){return s}});var i=n(317);const s={markCurrentInMenu:()=>{let e=(0,i.$)(".test-name").el[0];if(e){e=+e.getAttribute("value");let t=(0,i.$)(".accordion a").el;Array.from(t).filter((t=>{+t.dataset.id===e&&t.classList.add("current")}))}},nextQ:()=>{let e=s.currentQ();if(e.id>e.navLength-2)return!1;let t=s.aimNavIdFunction(e.id,"next"),n=s.aimQElFunction(e,"next");s.pushNav(e.id,t),s.pushQ(e.QEl,n)},prevQ:()=>{let e=s.currentQ();if(e.id<1)return!1;let t=s.aimNavIdFunction(e.id,"back"),n=s.aimQElFunction(e,"back");s.pushNav(e.id,t),s.pushQ(e.QEl,n)},pushNav:(e,t)=>{(0,i.$)("[data-pagination]").el[e].classList.toggle("nav-active"),(0,i.$)("[data-pagination]").el[t].classList.toggle("nav-active")},pushQ:(e,t)=>{e.classList.toggle("flex1"),t.classList.toggle("flex1")},aimNavIdFunction:(e,t)=>{let n=e;switch(!0){case"next"===t:return n+1;case"back"===t:return n-1}},aimQElFunction:(e,t)=>{switch(!0){case"next"===t:return e.QNextEl;case"back"===t:return e.QPrevc}},currentQ:()=>({id:(0,i.$)(".nav-active").el[0].innerText-1,QEl:(0,i.$)(".question.flex1").el[0],navLength:(0,i.$)("[data-pagination]").el.length,QPrevc:(0,i.$)(".question.flex1").el[0].previousElementSibling,QNextEl:(0,i.$)(".question.flex1").el[0].nextElementSibling}),serverModel:()=>({id:+window.location.href.split("/").pop(),test_name:(0,i.$)("#test_name").el[0].value,enable:+(0,i.$)("#enable").el[0].checked,isTest:+(0,i.$)("[isTest]").el[0].getAttribute("isTest"),parent:(0,i.$)("select").selectedIndexValue()}),viewModel:()=>({id:+window.location.href.split("/").pop(),test_name:(0,i.$)("#test_name").text(),enable:(0,i.$)("#enable").el[0],parent:(0,i.$)("select").selectedIndexValue()}),id:e=>e??(0,i.$)(".test-name").value(),children:()=>{let e=(0,i.$)(".children").el;return"не содержит"===!e[0].innerText&&e.length},path_create:async()=>{let e=s.serverModel();e.id=0,e.isTest=0;let t=await(0,i.v_)("/test/create",e);t=await JSON.parse(t),t&&(window.location.href="/adminsc/test/edit/"+(t.id-1))},name:()=>(0,i.$)(".test-name").el[0].innerText,create:async()=>{let e=s.serverModel();e.id=0,e.isTest=1;let t=await(0,i.v_)("/test/updateOrCreate",e);t=await JSON.parse(t),t&&(window.location.href="/adminsc/test/edit/"+(t.id-1))},update:async()=>{let e=s.serverModel(),t=`/adminsc/test/update/${e.id}`,n=await(0,i.v_)(t,e);n=await JSON.parse(n),n&&(window.location.href=`/adminsc/test/edit/${e.id}`)},delete:async function(){if(s.children())return i.gk.show("Сначала удалите все тесты из папки"),!1;s.viewModel().enable.checked=!1;let e=s.serverModel(),t=await(0,i.v_)("/test/delete",{test:e});t=await JSON.parse(t),t.notAdmin?(i.gk.show("Видимость теста скрыта. Чтобы удалить полностью - обратитесь к ГД"),setTimeout((()=>{window.location="/adminsc/test/edit/400"}),4e3)):window.location="/adminsc/test/edit/400"}}},317:function(e,t,n){n.d(t,{Z$:function(){return r},gk:function(){return i},v_:function(){return s},$:function(){return o}});let i={show:function(e,t){let n=this.el("div","popup__close");n.innerText="X";let i=this.el("div","popup__item");i.innerText=e,i.append(n);let s=o(".popup").el[0];s||(s=this.el("div","popup")),s.append(i),s.addEventListener("click",this.close,!0),document.body.append(s),setTimeout((()=>{i.classList.remove("popup__item"),i.classList.add("popup-hide")}),5e3),setTimeout((()=>{i.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let n=document.createElement(e);return n.classList.add(t),n}};async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,i){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?s.send(t):(s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("param="+JSON.stringify(t))),s.onerror=function(){i(Error("Network Error"))},s.onload=async function(){n(s.response)}}))}function a(e){this.el=e,this.elType={}.toString.call(e),this.on=function(t,n){this.el&&("[object HTMLDivElement]"===this.elType&&this.el.addEventListener(t,n,!0),"[object NodeList]"===this.elType&&e.forEach((e=>e.addEventListener(t,n,!0))))},this.value=function(){return this.el[0].getAttribute("value")},this.attr=function(e,t){return t&&this.el[0].setAttribute(e,t),this.el[0].getAttribute(e)},this.selectedIndexValue=function(){if(this.el.length)return this.el[0].selectedOptions[0].value},this.options=function(){if(this.el.length)return this.el[0].options},this.count=function(){return this.el.length},this.text=function(){if(this.el.length)return this.el[0].innerText},this.checked=function(){if(this.el.length)return this.el[0].checked},this.getWithStyle=function(t,n){let i=[];return e.forEach((e=>{e.style[t]===n&&i.push(e)})),i},this.addClass=function(e){"[object HTMLDivElement]"===this.elType&&this.el.classList.add(e),["[object NodeList]","[object Array]"].includes(this.elType)&&this.el.forEach((t=>{t.classList.add(e)}))},this.removeClass=function(e){"[object HTMLDivElement]"===this.elType&&this.el.classList.remove(e),["[object NodeList]","[object Array]"].includes(this.elType)&&this.el.forEach((t=>{t.classList.remove(e)}))},this.hasClass=function(e){if(this.el.classList.contains(e))return!0},this.append=function(e){this.el[0].appendChild(e)},this.find=function(e){return["[object HTMLDivElement]","[object HTMLInputElement]","[object HTMLLIElement]"].includes(this.elType)?this.el.querySelector(e):["[object NodeList]","[object Array]"].includes(this.elType)?this.el[0].querySelector(e):void 0},this.css=function(t,n){if(!n)return this.el[0].style[t];"[object HTMLDivElement]"===this.elType&&(this.el.style[t]=n),"[object NodeList]"===this.elType&&e.forEach((e=>{e.style[t]=n}))}}function o(e){let t="";return t="string"==typeof e?document.querySelectorAll(e):e,new a(t)}function r(e){[...e.els].map((t=>{t.onmouseenter=function(){let n=document.createElement("div");o(n).addClass("tip"),n.innerText=e.message,t.append(n),n.addEventListener("mousemove",(()=>n.remove()).bind(n),!0)}.bind(e),t.onmouseleave=()=>{t.querySelector(".tip").remove()}}),[e])}},291:function(e,t,n){var i=n(317);function s(e,t,n){e.style.maxHeight="0px",n&&n()}(0,i.$)(".accordion label").on("click",(function(e){let t=e.target.previousElementSibling,n=t.closest("ul"),a=(0,i.$)(t.parentNode).find("ul");if(t.checked)s(a);else{n.style.height="auto",function(e,t){e.style.maxHeight=e.scrollHeight+"px"}(a);let e=function(e){return e.scrollHeight}(a);!function(e,t){if(!e.classList.contains("accordion")){let n=parseInt(e.style.maxHeight)+t;e.style.maxHeight=n+"px"}}(n,e),function(e){Array.from(e.children).map((e=>{Array.from(e.children).map((e=>{e.type&&"checkbox"===e.type&&e.checked&&s((0,i.$)(e.parentNode).find("ul"),0,(function(){e.checked=!1}))}))}))}(n)}})),window.onload=function(){let e=(0,i.$)(".admin-layout__sidebar.accordion input[type=checkbox]").el;e&&[...e].filter((e=>{e.checked=!1}))}},74:function(e,t,n){n.d(t,{nl:function(){return a}});var i=n(317),s=n(456);function a(){let e=(0,i.$)("[data-pagination]").el;if(!e[0])return!1;Array.from(e).map((e=>{e.classList.remove("nav-active")})),e[0].classList.add("nav-active")}n(576),(0,i.$)("[data-pagination]:first-child").addClass("nav-active"),(0,i.$)(".test-edit__content").addClass("flex1"),(0,i.$)(".pagination").on("click",(function(e){e.target.classList.contains("add-question")?async function(e){let t=+(0,i.$)(".test-name").value(),n=(0,i.$)("[data-pagination]").count(),a=await(0,i.v_)("/question/show",{testid:t,questCount:n});a=JSON.parse(a);let o=a.block;(0,i.$)(".blocks").el[0].insertAdjacentHTML("afterBegin",o);let r=(0,i.$)(".blocks .block:first-child").el[0];document.querySelector(".flex1").classList.remove("flex1"),(0,i.$)(r).addClass("flex1");let l=(0,i.$)(r).find(".question__save");(0,i.$)(l).on("click",(0,s.A)().save)}():e.target.getAttribute("data-pagination")&&function(e){if(e.classList.contains("nav-active"))return;let t=(0,i.$)(".pagination .nav-active").el[0];t.classList.remove("nav-active"),e.classList.add("nav-active");let n=t.dataset.pagination;(0,i.$)(`#question-${n}`).removeClass("flex1");let s=e.dataset.pagination;(0,i.$)(`#question-${s}`).addClass("flex1")}(e.target)}))}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n(721),n(74),(0,n(317).$)(".gamburger").on("click",(function(e){e.target.closest(".utils").querySelector(".mobile-menu").classList.toggle("show")}))}();