{"version":3,"file":"989.js","mappings":"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","sources":["webpack://my-webpack-project/./public/src/Admin/Product/units.js","webpack://my-webpack-project/./public/src/Admin/Product/UnitTable.js","webpack://my-webpack-project/./public/src/Admin/Product/Product.js","webpack://my-webpack-project/./public/src/Admin/Product/Values.js"],"sourcesContent":["import './units.scss'\r\nimport {$} from '../../common'\r\nimport UnitTable from './UnitTable'\r\n\r\n  let $units = $('.units').first();\r\n  if ($units) {\r\n    // $(`[data-tab='3']`).first().classList.toggle('show');\r\n    // $(`[data-tab='1']`).first().classList.toggle('show');\r\n\r\n    new UnitTable('.units')\r\n\r\n}\r\n","import {$, createElement, post} from '../../common'\r\nimport SelectNew from \"../../components/select/SelectNew\";\r\nimport {it, qa} from '../../constants'\r\n\r\n\r\nexport default class UnitTable {\r\n   constructor(tableClass) {\r\n      this.$table = $(tableClass).first();\r\n      if (!this.$table) return;\r\n\r\n      this.product1sId = $(`[data-field='1s_id']`).first().innerText;\r\n\r\n      this.$baseUnit = $(`[data-field='base_unit']`).first();\r\n      // this.baseUnitId = this.$baseUnit.options[this.$baseUnit.selectedIndex].value;\r\n\r\n      this.$addUnit = $('.add-unit').first();\r\n      this.$rows = $('.rows').first();\r\n      // this.$selector = $(this.$rows).find('[select-new]');\r\n      this.$emtyRow = $(this.$rows).find('.none');\r\n\r\n      this.$addUnit.onclick = this.createRow.bind(this);\r\n      this.$rows.onchange = this.handleChange.bind(this);\r\n      this.$rows.onkeyup = this.handleKeyUp.bind(this);\r\n      this.$rows.onclick = this.clickRow.bind(this);\r\n      this.$rows.addEventListener('customSelect.changed', this.unitChanged.bind(this));\r\n\r\n      this.initSelects();\r\n      setTimeout(this.deleteSelected.bind(this), 800)\r\n   }\r\n\r\n   initSelects() {\r\n      this.$rows.querySelectorAll('[custom-select]').forEach((s) => {\r\n         new SelectNew(s)\r\n      })\r\n   }\r\n\r\n   deleteSelected() {\r\n      let selected = this.$rows.querySelectorAll('.selected');\r\n      selected = Array.from(selected).map((s) => {\r\n         if (+s.dataset.value) return s.dataset.value;\r\n      });\r\n      this.$table.querySelectorAll('[custom-select]').forEach(\r\n         function (select) {\r\n            select.querySelectorAll('li').forEach(function (o) {\r\n               if (selected.includes(o.dataset.value)) {\r\n                  o.remove()\r\n               }\r\n            })\r\n         }\r\n      )\r\n   }\r\n\r\n   createSelect(el) {\r\n      const select = (new createElement()).tag('select').attr('new-select').className('name').get()\r\n\r\n      const lis = [...el[qa]('li')].map((li) => {\r\n         const op = (new createElement()).tag('option').attr('value', li.dataset.value).text(li[it]).get()\r\n         select.append(op)\r\n      })\r\n      return select\r\n   }\r\n\r\n   createRow() {\r\n      let baseUnitText = this.$baseUnit.selectedOptions[0].innerText;\r\n\r\n      let row = (new createElement()).tag('div').attr('class', 'row').get();\r\n      const select = this.createSelect(this.$emtyRow)\r\n\r\n      let multiplier = (new createElement()).attr('type', 'number').tag('input').attr('value', 10).className('multiplier').get();\r\n      let baseUnit = (new createElement()).tag('div').attr('class', 'base-unit').text(baseUnitText).get();\r\n      let minUnit = (new createElement()).tag('div').className('shippable').get();\r\n      let minUnitInput = (new createElement()).tag('input').attr('type', 'checkbox').get();\r\n      let del = (new createElement()).tag('div').attr('class', 'del').text('X').get();\r\n\r\n      row.append(select);\r\n      row.append(multiplier);\r\n      row.append(baseUnit);\r\n      minUnit.append(minUnitInput);\r\n      row.append(minUnit);\r\n      row.append(del);\r\n\r\n      new SelectNew(select);\r\n\r\n      this.$rows.append(row);\r\n      // this.deleteSelected()\r\n   }\r\n\r\n   async unitChanged(obj) {\r\n      let data = this.dto(obj.target.closest('.row'));\r\n      data.morphed.new_id = obj.detail.next.value;\r\n      data.morphed.old_id = obj.detail.prev.value;\r\n      if (obj.detail.next.value)\r\n         this.deleteSelectedUnitFromSelects(obj.detail.next.value);\r\n\r\n      if (obj.detail.prev.value)\r\n         this.addDeletedUnitToSelects(obj.detail.prev);\r\n\r\n      let res = await post('/adminsc/product/changeUnit', data)\r\n   }\r\n\r\n   deleteSelectedUnitFromSelects(value) {\r\n      this.$table.querySelectorAll('[custom-select]').forEach(\r\n         function (select) {\r\n            let options = select.querySelectorAll('li');\r\n            options.forEach(function (o) {\r\n               if (o.dataset.value === value) {\r\n                  o.remove()\r\n               }\r\n            })\r\n         }\r\n      )\r\n   }\r\n\r\n   addDeletedUnitToSelects() {\r\n      this.$table.querySelectorAll('[custom-select]').forEach(\r\n         function (select) {\r\n            let options = select.querySelectorAll('li');\r\n            options.forEach(function (o) {\r\n               if (o.dataset.value === value) {\r\n                  o.remove()\r\n               }\r\n            })\r\n         }\r\n      )\r\n   }\r\n\r\n   async clickRow({target}) {\r\n      if (target.classList.contains('del')) {\r\n         let row = target.closest('.row');\r\n         let data = this.dto(row);\r\n         let res = await post('/adminsc/product/deleteUnit', data);\r\n         if (res?.arr?.ok) {\r\n            row.remove()\r\n         }\r\n      }\r\n   }\r\n\r\n   handleKeyUp(e) {\r\n      let multiplier = +e.target.value;\r\n      if (!/\\d+/.test(multiplier)) {\r\n         return\r\n      }\r\n      this.update(e, this)\r\n   }\r\n\r\n   async handleChange({target}) {\r\n      if (target.type === 'checkbox' && target.hasAttribute('data-isbase')) {\r\n         const base_is_shippable = +target.checked\r\n         const product_1s_id = this.product1sId\r\n         const data = {product_1s_id,base_is_shippable}\r\n         const res = await post('/adminsc/product/changeBaseIsShippable', data);\r\n      } else {\r\n         this.update(target, this)\r\n      }\r\n   }\r\n\r\n   async update(target, self) {\r\n      let row = target.closest('.row');\r\n      let chosenUnit = +$(row).find('[select-new]').dataset.value;\r\n      if (!chosenUnit) return false;\r\n      let data = self.dto(row);\r\n      data.morphed.new_id = data.morphed.old_id;\r\n\r\n      const res = await post('/adminsc/product/changeUnit', data);\r\n\r\n   }\r\n\r\n   dto(row) {\r\n      let pivot = {\r\n         'product_id': this.product1sId,\r\n         'multiplier': +$(row).find(`.multiplier`).value ?? 0,\r\n         'is_shippable': $(row).find(`.shippable input`).checked ? 1 : null,\r\n      };\r\n      let morphed = {\r\n         new_id: 0,\r\n         old_id: +this.getUnitId(row),\r\n         detach: 0\r\n      };\r\n      return {\r\n         baseUnitId: this.getBaseUnitId(),\r\n         pivot, morphed\r\n      }\r\n   }\r\n\r\n   getBaseUnitId() {\r\n      return +this.$baseUnit.options[this.$baseUnit.selectedIndex].value\r\n   }\r\n\r\n   getUnitId(row) {\r\n      let classSelected = row.querySelector('[select-new]');\r\n      return classSelected.dataset.value ?? 0\r\n   }\r\n\r\n}","import './product.scss'\r\nimport './units'\r\nimport './Values'\r\nimport {objAndFiles2FormData, post} from '../../common'\r\nimport {qs} from '../../constants'\r\n\r\nexport default class Product {\r\n   constructor(product) {\r\n      if (!product) return false;\r\n      this.product = product\r\n\r\n      this.setValues()\r\n      this.setFields()\r\n      this.setDragNDrop()\r\n      this.setCardPanel()\r\n   }\r\n\r\n   async setDragNDrop() {\r\n      const dragNdrop = document[qs]('[dnd]')\r\n      if (dragNdrop) {\r\n         const {default: Dnd} = await import(\"../../components/dnd/dnd\")\r\n         new Dnd(dragNdrop, this.addMainImage)\r\n      }\r\n   }\r\n\r\n   async setFields() {\r\n      const {default: Fields} = await import(\"./Fields.js\")\r\n      new Fields(this.product)\r\n   }\r\n\r\n   async setValues() {\r\n      const {default: Values} = await import(\"./Values.js\")\r\n      new Values(this.product)\r\n   }\r\n\r\n\r\n   async setCardPanel() {\r\n      const cardPanel = document[qs](`.cardPanel`)\r\n      if (cardPanel) {\r\n         const {default: cardPanel} = await import(\"./../../share/card_panel/card_panel\")\r\n         new cardPanel()\r\n      }\r\n   }\r\n\r\n   async addMainImage(files, target) {\r\n      const obj = {productId: target.closest('.item-wrap').dataset.id,};\r\n      let data = objAndFiles2FormData(obj, files[0]);\r\n\r\n      let res = await post('/adminsc/product/saveMainImage', data);\r\n      let src = res?.arr[0];\r\n      if (src) {\r\n         const mainImage = target.closest('.dnd-container').querySelector('img');\r\n         mainImage.removeAttribute(\"src\");\r\n         mainImage.setAttribute(\"src\", src)\r\n      }\r\n   }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n","import './values.scss'\r\nimport {$, post} from '../../common'\r\nimport SelectNew from \"../../components/select/SelectNew\";\r\n\r\nexport default class Values {\r\n  constructor($product) {\r\n    this.$product = $product;\r\n    this.$values = $($product).find('.values');\r\n    this.values = this.$values.querySelectorAll('.value');\r\n    this.$values.addEventListener('customSelect.changed', this.selectChanged.bind(this));\r\n    this.values.forEach((value) => {\r\n      new SelectNew(value)\r\n    })\r\n  }\r\n\r\n  dto() {\r\n    return {\r\n      product_id: this.$product.dataset.id,\r\n      morphed: {\r\n        old_id: 0,\r\n        new_id: 0\r\n      }\r\n    }\r\n  }\r\n\r\n  async selectChanged(obj) {\r\n    let data = this.dto();\r\n    data.morphed.old_id = obj.detail.prev.value;\r\n    data.morphed.new_id = obj.detail.next.value;\r\n    let res = await post(`/adminsc/product/changeVal`, data)\r\n  }\r\n}\r\n\r\n"],"names":["$","first","constructor","tableClass","this","$table","product1sId","innerText","$baseUnit","$addUnit","$rows","$emtyRow","find","onclick","createRow","bind","onchange","handleChange","onkeyup","handleKeyUp","clickRow","addEventListener","unitChanged","initSelects","setTimeout","deleteSelected","querySelectorAll","forEach","s","SelectNew","selected","Array","from","map","dataset","value","select","o","includes","remove","createSelect","el","createElement","tag","attr","className","get","qa","li","op","text","it","append","baseUnitText","selectedOptions","row","multiplier","baseUnit","minUnit","minUnitInput","del","obj","data","dto","target","closest","morphed","new_id","detail","next","old_id","prev","deleteSelectedUnitFromSelects","addDeletedUnitToSelects","post","classList","contains","res","arr","ok","e","test","update","type","hasAttribute","base_is_shippable","checked","product_1s_id","self","pivot","getUnitId","detach","baseUnitId","getBaseUnitId","options","selectedIndex","querySelector","Product","product","setValues","setFields","setDragNDrop","setCardPanel","dragNdrop","document","qs","default","Dnd","addMainImage","Fields","Values","cardPanel","files","productId","id","objAndFiles2FormData","src","mainImage","removeAttribute","setAttribute","$product","$values","values","selectChanged","product_id"],"sourceRoot":""}