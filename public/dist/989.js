"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[989],{7989:(e,t,s)=>{s.d(t,{default:()=>d});var a=s(6584),i=s(4069),n=s(8832);(0,a.$)(".units").first()&&new class{constructor(e){this.$table=(0,a.$)(e).first(),this.$table&&(this.product1sId=(0,a.$)("[data-field='1s_id']").first().innerText,this.$baseUnit=(0,a.$)("[data-field='base_unit']").first(),this.$addUnit=(0,a.$)(".add-unit").first(),this.$rows=(0,a.$)(".rows").first(),this.$emtyRow=(0,a.$)(this.$rows).find(".none"),this.$addUnit.onclick=this.createRow.bind(this),this.$rows.onchange=this.handleChange.bind(this),this.$rows.onkeyup=this.handleKeyUp.bind(this),this.$rows.onclick=this.clickRow.bind(this),this.$rows.addEventListener("customSelect.changed",this.unitChanged.bind(this)),this.initSelects(),setTimeout(this.deleteSelected.bind(this),800))}initSelects(){this.$rows.querySelectorAll("[custom-select]").forEach((e=>{new i.A(e)}))}deleteSelected(){let e=this.$rows.querySelectorAll(".selected");e=Array.from(e).map((e=>{if(+e.dataset.value)return e.dataset.value})),this.$table.querySelectorAll("[custom-select]").forEach((function(t){t.querySelectorAll("li").forEach((function(t){e.includes(t.dataset.value)&&t.remove()}))}))}createSelect(e){const t=(new a.n).tag("select").attr("new-select").className("name").get();return[...e[n.qa]("li")].map((e=>{const s=(new a.n).tag("option").attr("value",e.dataset.value).text(e[n.it]).get();t.append(s)})),t}createRow(){let e=this.$baseUnit.selectedOptions[0].innerText,t=(new a.n).tag("div").attr("class","row").get();const s=this.createSelect(this.$emtyRow);let n=(new a.n).attr("type","number").tag("input").attr("value",10).className("multiplier").get(),d=(new a.n).tag("div").attr("class","base-unit").text(e).get(),l=(new a.n).tag("div").className("shippable").get(),c=(new a.n).tag("input").attr("type","checkbox").get(),r=(new a.n).tag("div").attr("class","del").text("X").get();t.append(s),t.append(n),t.append(d),l.append(c),t.append(l),t.append(r),new i.A(s),this.$rows.append(t)}async unitChanged(e){let t=this.dto(e.target.closest(".row"));t.morphed.new_id=e.detail.next.value,t.morphed.old_id=e.detail.prev.value,e.detail.next.value&&this.deleteSelectedUnitFromSelects(e.detail.next.value),e.detail.prev.value&&this.addDeletedUnitToSelects(e.detail.prev),await(0,a.bE)("/adminsc/product/changeUnit",t)}deleteSelectedUnitFromSelects(e){this.$table.querySelectorAll("[custom-select]").forEach((function(t){t.querySelectorAll("li").forEach((function(t){t.dataset.value===e&&t.remove()}))}))}addDeletedUnitToSelects(){this.$table.querySelectorAll("[custom-select]").forEach((function(e){e.querySelectorAll("li").forEach((function(e){e.dataset.value===value&&e.remove()}))}))}async clickRow({target:e}){if(e.classList.contains("del")){let t=e.closest(".row"),s=this.dto(t),i=await(0,a.bE)("/adminsc/product/deleteUnit",s);i?.arr?.ok&&t.remove()}}handleKeyUp(e){let t=+e.target.value;/\d+/.test(t)&&this.update(e,this)}async handleChange({target:e}){if("checkbox"===e.type&&e.hasAttribute("data-isbase")){const t=+e.checked,s={product_1s_id:this.product1sId,base_is_shippable:t};await(0,a.bE)("/adminsc/product/changeBaseIsShippable",s)}else this.update(e,this)}async update(e,t){let s=e.closest(".row");if(!+(0,a.$)(s).find("[select-new]").dataset.value)return!1;let i=t.dto(s);i.morphed.new_id=i.morphed.old_id,await(0,a.bE)("/adminsc/product/changeUnit",i)}dto(e){let t={product_id:this.product1sId,multiplier:+(0,a.$)(e).find(".multiplier").value??0,is_shippable:(0,a.$)(e).find(".shippable input").checked?1:null},s={new_id:0,old_id:+this.getUnitId(e),detach:0};return{baseUnitId:this.getBaseUnitId(),pivot:t,morphed:s}}getBaseUnitId(){return+this.$baseUnit.options[this.$baseUnit.selectedIndex].value}getUnitId(e){return e.querySelector("[select-new]").dataset.value??0}}(".units"),s(7543);class d{constructor(e){if(!e)return!1;this.product=e,this.setValues(),this.setFields(),this.setDragNDrop(),this.setCardPanel()}async setDragNDrop(){const e=document[n.qs]("[dnd]");if(e){const{default:t}=await Promise.resolve().then(s.bind(s,5529));new t(e,this.addMainImage)}}async setFields(){const{default:e}=await s.e(116).then(s.bind(s,7116));new e(this.product)}async setValues(){const{default:e}=await Promise.resolve().then(s.bind(s,7543));new e(this.product)}async setCardPanel(){if(document[n.qs](".cardPanel")){const{default:e}=await s.e(602).then(s.bind(s,602));new e}}async addMainImage(e,t){const s={productId:t.closest(".item-wrap").dataset.id};let i=(0,a.yF)(s,e[0]),n=await(0,a.bE)("/adminsc/product/saveMainImage",i),d=n?.arr[0];if(d){const e=t.closest(".dnd-container").querySelector("img");e.removeAttribute("src"),e.setAttribute("src",d)}}}},7543:(e,t,s)=>{s.d(t,{default:()=>n});var a=s(6584),i=s(4069);class n{constructor(e){this.$product=e,this.$values=(0,a.$)(e).find(".values"),this.values=this.$values.querySelectorAll(".value"),this.$values.addEventListener("customSelect.changed",this.selectChanged.bind(this)),this.values.forEach((e=>{new i.A(e)}))}dto(){return{product_id:this.$product.dataset.id,morphed:{old_id:0,new_id:0}}}async selectChanged(e){let t=this.dto();t.morphed.old_id=e.detail.prev.value,t.morphed.new_id=e.detail.next.value,await(0,a.bE)("/adminsc/product/changeVal",t)}}}}]);
//# sourceMappingURL=989.js.map