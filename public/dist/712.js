"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[712],{712:(t,e,s)=>{s.d(e,{default:()=>a});var i=s(832),n=s(87);class a{constructor(){if(this.category=document[i.qs](".category"),!this.category)return!1;this.mapShippableTables(),this.category[i.z]("click",this.handleClick.bind(this))}handleClick({target:t}){t.classList.contains(".blue-button")&&t.closest("[shipable-table]")[i.qs](".unit-row")}mapShippableTables(){[...this.category[i.qa](".shippable-table")].forEach((t=>{new n.A(t)}))}}},87:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(448),n=s(832);class a{constructor(t){if(!t)return!1;this.target=t,this.table=t.closest("[shippable-table]"),this.table[n.z]("click",this.handleClick.bind(this)),this.blueButton=this.table[n.qs](".blue-button"),this.greenButtonWrap=this.table[n.qs](".green-button-wrap")??!1,this.price=+this.table.dataset.price,this.sid=this.table.dataset["1sid"],this.total=this.table[n.qs]("[data-total]"),this.setFormatter(),this.showButtons(),this.renderSums()}showButtons(){if(!this.blueButton||!this.greenButtonWrap)return!1;this.getTotalCount()?(this.blueButton.style.display="none",this.greenButtonWrap.style.display="flex"):(this.blueButton.style.display="flex",this.greenButtonWrap.style.display="none")}handleClick({target:t}){const e=t??this.target;if(e.classList.contains("blue-button"))this.showGreenButton(e);else if(e.classList.contains("green-button"))window.location.href="/cart";else if(e.classList.contains("plus")){const t=e.closest(".unit-row");this.increment(t)}else if(e.classList.contains("minus")){const t=e.closest(".unit-row");this.decrement(t)}else if(e.classList.contains("input")){const t=e.closest(".unit-row");this.handleChange(t)}return this}increment(t){t[n.qs]("input").value++,t.dataset.rowSum=""+t[n.qs]("input").value,this.handleChange(t)}decrement(t){const e=t[n.qs]("input");+e.value<2?e.value="":(e.value--,t.dataset.rowSum=e.value),this.handleChange(t)}getTotalCount(){return[...this.table[n.qa]("input")].reduce(((t,e)=>t+ +e.value),0)}handleChange(t){const e=this.getTotalCount(t);this.renderSums(),0===e?this.showBlueButton():this.toServer(this.dto(t))}renderSums(){let t=[...this.table[n.qa](".unit-row")].reduce(((t,e,s)=>{const i=this.rowDto(e);let n=+this.price*+i.multiplier*+i.count;return i.sub_sum&&(i.sub_sum.innerText=this.formatter.format(n)),t+n}),0);this.total&&(this.total.innerText=this.formatter.format(t))}showBlueButton(){if(!this.blueButton)return!1;this.getTotalCount()||(this.greenButtonWrap.style.display="none",this.greenButtonWrap[n.qs]("input").value="0",this.blueButton.style.display="flex",this.deleteOrderItems(this.tableDTO(this.table)))}showGreenButton(){if(!this.greenButtonWrap)return!1;this.greenButtonWrap.style.display="flex";const t=+this.greenButtonWrap[n.qs]("input").value;this.greenButtonWrap[n.qs]("input").value=t||1,this.blueButton.style.display="none",this.toServer(this.dto(this.greenButtonWrap[n.qs]("[unit-row]")))}getUrl(){return(0,i.a$)()?"/adminsc/order":"/adminsc/orderitem"}deleteOrderItems(t){const e=`${this.getUrl()}/delete`;(0,i.bE)(e,t)}async toServer(t){const e=`${this.getUrl()}/updateOrCreate`;await(0,i.bE)(e,t)}setFormatter(){this.formatter=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",minimumFractionDigits:2})}rowDto(t){return{count:t[n.qs]("input").value,multiplier:t.dataset.multiplier,sub_sum:t[n.qs](".sub-sum")}}tableDTO(t){return{unit_ids:this.unitIds(t),product_id:this.sid}}unitIds(t){return[...t[n.qa]("[unit-row]")].map((t=>t.dataset.unitid))}dto(t){return{count:t[n.qs]("input").value,unit_id:t.dataset.unitid,product_id:this.sid}}}}}]);
//# sourceMappingURL=712.js.map