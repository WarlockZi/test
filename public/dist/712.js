"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[712],{5712:(t,e,s)=>{s.d(e,{default:()=>n});var i=s(8832),a=s(4087);class n{constructor(){if(this.category=document[i.qs](".category"),!this.category)return!1;this.setCardPanel(),this.mapShippableTables(),this.category[i.z]("click",this.handleClick.bind(this))}async setCardPanel(){if(document[i.qs](".card-panel")){const{default:t}=await s.e(602).then(s.bind(s,602));this.cardPanel=new t}}handleClick({target:t}){t.classList.contains("blue-button")?t.closest("[shipable-table]")[i.qs](".unit-row"):t.classList.contains("short-link")&&this.cardPanel.shortLink(t)}mapShippableTables(){[...this.category[i.qa](".shippable-table")].forEach((t=>{new a.A(t)}))}}},4087:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(6584),a=s(8832);class n{constructor(t){if(!t)return!1;this.target=t,this.table=t.closest("[shippable-table]"),this.table[a.z]("click",this.handleClick.bind(this)),this.blueButton=this.table[a.qs](".blue-button"),this.greenButtonWrap=this.table[a.qs](".green-button-wrap")??!1,this.price=+this.table.dataset.price,this.sid=this.table.dataset["1sid"],this.total=this.table[a.qs]("[data-total]"),this.updateOrCreateUrl=this.table[a.qs]("[data-total]"),this.setFormatter(),this.showButtons(),this.renderSums()}showButtons(){if(!this.blueButton||!this.greenButtonWrap)return!1;this.getTotalCount()?(this.blueButton.style.display="none",this.greenButtonWrap.style.display="flex"):(this.blueButton.style.display="flex",this.greenButtonWrap.style.display="none")}handleClick({target:t}){const e=t??this.target;if(e.classList.contains("blue-button"))this.showGreenButton(e);else if(e.classList.contains("green-button"))window.location.href="/cart";else if(e.classList.contains("plus")){const t=e.closest(".unit-row");this.increment(t)}else if(e.classList.contains("minus")){const t=e.closest(".unit-row");this.decrement(t)}}increment(t){t[a.qs]("input").value++,t.dataset.rowSum=""+t[a.qs]("input").value,this.handleChange(t)}decrement(t){const e=t[a.qs]("input");+e.value<2?e.value="":(e.value--,t.dataset.rowSum=e.value),this.handleChange(t)}getTotalCount(){return[...this.table[a.qa]("input")].reduce(((t,e)=>t+ +e.value),0)}handleChange(t){const e=this.getTotalCount(t);this.renderSums(),0===e?this.showBlueButton():this.toServer(this.dto(t))}renderSums(){let t=[...this.table[a.qa](".unit-row")].reduce(((t,e,s)=>{const i=this.rowDto(e);let a=+this.price*+i.multiplier*+i.count;return i.sub_sum&&(i.sub_sum.innerText=this.formatter.format(a)),t+a}),0);this.total&&(this.total.innerText=this.formatter.format(t))}showBlueButton(){if(!this.blueButton)return!1;this.getTotalCount()||(this.greenButtonWrap.style.display="none",this.greenButtonWrap[a.qs]("input").value="0",this.blueButton.style.display="flex",this.deleteOrderItems(this.tableDTO(this.table)))}showGreenButton(){if(!this.greenButtonWrap)return!1;this.greenButtonWrap.style.display="flex";const t=+this.greenButtonWrap[a.qs]("input").value;this.greenButtonWrap[a.qs]("input").value=t||1,this.blueButton.style.display="none",this.toServer(this.dto(this.greenButtonWrap[a.qs]("[unit-row]")))}getUrl(t){const e={updateOrCreate:"updateOrCreate",delete:"delete"}[t];return`/adminsc/${(0,i.a$)()?"order":"orderItem"}/${e}`}deleteOrderItems(t){(0,i.bE)(this.getUrl("delete"),t)}async toServer(t){const e=this.getUrl("updateOrCreate");await(0,i.bE)(e,t)}setFormatter(){this.formatter=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",minimumFractionDigits:2})}rowDto(t){return{count:t[a.qs]("input").value,multiplier:t.dataset.multiplier,sub_sum:t[a.qs](".sub-sum"),sess_id:localStorage.getItem("SESSION")}}tableDTO(t){return{unit_ids:this.unitIds(t),product_id:this.sid}}unitIds(t){return[...t[a.qa]("[unit-row]")].map((t=>t.dataset.unitid))}dto(t){return{count:t[a.qs]("input").value,unit_id:t.dataset.unitid,product_id:this.sid}}}}}]);
//# sourceMappingURL=712.js.map