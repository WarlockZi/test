(()=>{"use strict";var e={449:(e,t,n)=>{n(400),n(736),n(522)},400:(e,t,n)=>{n.d(t,{gk:()=>a,v_:()=>r,Gu:()=>s,$:()=>o});let s={sort:function(){let e=this.nextElementSibling;this.value.match(/\D+/)?(e.innerText="Только цифры",e.style.opacity="1"):"1"===e.style.opacity&&(e.style.opacity="0")},email:function(e){return!!e&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},password:function(e){return!!e&&/^[a-zA-Z\-0-9]{6,20}$/.test(e)}},a={show:function(e){let t=document.createElement("div");t.classList.add("close");let n=document.createElement("div");t.classList.add("popup"),n.innerText=e,n.append(t);let s=document.createElement("div");s.classList.add("popup__wrapper"),s.append(n),n.addEventListener("click",this.close),document.body.append(s)},close:function(e){e.target.classList.contains("close")}};async function r(e,t){return new Promise((function(n,s){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?a.send(t):(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("param="+JSON.stringify(t))),a.onerror=function(){s(Error("Network Error"))},a.onload=function(){n(a.response)}}))}function i(e){this.el=e,this.elType={}.toString.call(e),this.on=function(t,n){"[object HTMLDivElement]"===this.elType&&this.el.addEventListener(t,n),"[object NodeList]"===this.elType&&e.forEach((e=>e.addEventListener(t,n)))},this.value=function(){return this.el[0].getAttribute("value")},this.count=function(){return this.el.length},this.getWithStyle=function(t,n){let s=[];return e.forEach((e=>{e.style[t]===n&&s.push(e)})),s},this.addClass=function(e){"[object HTMLDivElement]"===this.elType&&this.el.classList.add(e),["[object NodeList]","[object Array]"].includes(this.elType)&&this.el.forEach((t=>{t.classList.add(e)}))},this.removeClass=function(e){this.el.forEach((t=>{t.classList.remove(e)}))},this.hasClass=function(e){if(this.el.classList.contains(e))return!0},this.append=function(e){this.el[0].appendChild(e)},this.find=function(e){return["[object HTMLDivElement]","[object HTMLInputElement]"].includes(this.elType)?this.el.querySelector(e):["[object NodeList]","[object Array]"].includes(this.elType)?this.el[0].querySelector(e):void 0},this.css=function(t,n){if(!n)return this.el[0].style[t];"[object HTMLDivElement]"===this.elType&&(this.el.style[t]=n),"[object NodeList]"===this.elType&&e.forEach((e=>{e.style[t]=n}))}}function o(e){let t="";return t="string"==typeof e?document.querySelectorAll(e):e,new i(t)}},522:(e,t,n)=>{var s=n(400);document.cookie.match("(^|;)?cn=([^;]*)")?(0,s.$)("#cookie-notice").css("bottom","-100%"):(0,s.$)("#cookie-notice").css("bottom","0"),(0,s.$)("#cn-accept-cookie").on("click",(function(){(function(){const e=new Date;e.setTime(e.getTime()+864e5),document.cookie="cn=1; expires="+e+"path=/; SameSite=lax"})(),(0,s.$)("#cookie-notice").css("bottom","-100%")}))},736:(e,t,n)=>{var s=n(400);let a=(0,s.$)("#autocomplete").el;Array.from(a).map((e=>{e&&e.addEventListener("input",(function(){!async function(e,t){if(e.length<1)return void(r.innerHTML="");let n=await async function(e){let t=await fetch("/search?q="+e);return await t.json()}(e),a=document.createElement("ul"),r=(n.map((e=>{let t=document.createElement("a");t.href=e.alias,t.innerHTML=`<img src='/pic/${e.preview_pic}' alt='${e.name}'>`+e.name,a.appendChild(function(e,t){let n=document.createElement("li");return n.appendChild(e),n}(t))})),(0,s.$)(t.parentNode).find(".search__result"));r.appendChild(a),(0,s.$)("body").on("click",(function(e){const t=(0,s.$)(".result-search ul").el[0];(0,s.$)(".result-search ul")&&e.target!==t&&t.remove()}))}(this.value,e)}))}))}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{n(736);var e=n(400);(0,e.$)("body").on("click",(function(e){"messageClose"===e.target.className&&(window.location.href="/user/cabinet")})),n(522),(0,e.$)(".changepassword").on("click",(async function(){if("ok"===await(0,e.v_)("/user/changepassword",{old_password:(0,e.$)('[name="old_password"]').el[0].value,new_password:(0,e.$)('[name="new_password"]').el[0].value})){let t=(0,e.$)(".message").el[0];t.innerText="Пароль сменен",(0,e.$)(t).addClass("success"),(0,e.$)(t).removeClass("error")}else{let t=(0,e.$)(".message").el[0];t.innerText="Что-то пошло не так",(0,e.$)(t).addClass("error"),(0,e.$)(t).removeClass("success")}}));let t=(0,e.$)("#login").el[0];t&&(0,e.$)(t).on("click",(async function(t){t.preventDefault();let n=(0,e.$)("input[type = email]").el[0].value,s=(0,e.$)("input[type = password]").el[0].value;if(!e.Gu.email(n)){let t=(0,e.$)(".message").el[0];return t.innerText="Неправильный формат почты",(0,e.$)(t).addClass("error"),!1}if(!e.Gu.password(s)){let t=(0,e.$)(".message").el[0];return t.innerText="Пароль может состоять из \n - Большие латинские бкувы \n- Маленькие латинские буквы \n- Цифры \n- Должен содержать не менее 6 символов",(0,e.$)(t).addClass("error"),!1}!async function(t){let n=await(0,e.v_)("/user/login",{email:t,password:(0,e.$)("input[type= password]").el[0].value}),s=(0,e.$)(".message").el[0];"fail"===n?(s.innerHTML="Не верный email или пароль",(0,e.$)(s).addClass("error"),(0,e.$)(s).removeClass("success")):"ok"===n?window.location="/user/cabinet":"not_registered"===n&&(s.innerHTML="Для регистрации перейдите в раздел <a href = '/user/register'>Регистрация</a>",(0,e.$)(s).addClass("error"),(0,e.$)(s).removeClass("success"))}(n)})),(0,e.$)("[name = 'reg']").on("click",(async function(t){t.preventDefault();let n=(0,e.$)("input[type = email]").el[0].value,s=(0,e.$)("input[type = password]").el[0].value,a=(0,e.$)(".message").el[0];if(!n||!s)return a.innerText="Заполните email и пароль",(0,e.$)(a).addClass("error"),!1;if(n){if(!e.Gu.email(n))return a.innerText="Неправильный формат почты",(0,e.$)(a).addClass("error"),!1;if(s&&!e.Gu.password(s))return a.innerText="Пароль может состоять из \n - больших латинских букв \n- маленьких латинских букв \n- цифр \n- должен содержать не менее 6 символов",(0,e.$)(a).addClass("error"),!1;await async function(t){let n={email:t,password:(0,e.$)("input[type= password]").el[0].value,surName:(0,e.$)("[name='surName']").el[0].value,name:(0,e.$)("[name='name']").el[0].value,token:(0,e.$)('meta[name="token"]').el[0].getAttribute("content")},s=await(0,e.v_)("/user/register",n),a=(0,e.$)(".message");"confirm"===s?(a.removeClass("error"),a.addClass("success"),a.el[0].innerHTML="-Пользователь зарегистрирован.<br>-Для подтверждения регистрации зайдите на почту, <bold>email</bold>.<br> -Перейдите по ссылке в письме."):"mail exists"===s?(a.el[0].innerHTML="Эта почта уже зарегистрирована",a.removeClass("success"),a.addClass("error")):"empty password"===s?(a.el[0].innerHTML="Зполните пароль",a.removeClass("success"),a.addClass("error")):(a.el[0].innerHTML=s,a.removeClass("success"),a.addClass("error"))}(n)}})),n(449),(0,e.$)(".return_pass").on("click",(async function(t){if(t.preventDefault(),t.target.classList.contains("returnpass")){let t=(0,e.$)('input[type="email"]').el[0].value;"ok"===await(0,e.v_)("/user/returnPass",{email:t})&&(window.location="/user/login")}})),(0,e.$)("[name = 'edit']").on("click",(async function(t){t.preventDefault();let n={name:(0,e.$)('[name = "name"]').el[0].value,surName:(0,e.$)('[name = "surName"]').el[0].value,middleName:(0,e.$)('[name = "middleName"]').el[0].value,birthDate:(0,e.$)('[name = "birthDate"]').el[0].value,phone:(0,e.$)('[name = "phone"]').el[0].value};await(0,e.v_)("/user/edit",n),e.gk.show("Сохранено")}))})()})();