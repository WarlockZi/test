!function(){"use strict";var e={317:function(e,t,n){function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{$:function(){return u},Ds:function(){return s},Gu:function(){return r},mN:function(){return i},v_:function(){return l}});const s=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:700;return function(){const a=()=>e.apply(this,arguments);clearTimeout(t),t=setTimeout(a,n)}};function i(e){return function(e){var t=new RegExp("\\t?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("\\n?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("&nbsp;?","g");return e.replace(t," ")}(e)))}let r={sort:()=>{let e=(void 0).nextElementSibling;(void 0).value.match(/\D+/)?(e.innerText="Только цифры",e.style.opacity="1"):"1"===e.style.opacity&&(e.style.opacity="0")},email:e=>!!e&&(!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())&&"Неправильный формат почты"),password:e=>!!e&&(!/^[a-zA-Z\-0-9]{6,20}$/.test(e)&&"Пароль может состоять из \n - Большие латинские бкувы \n- Маленькие латинские буквы \n- Цифры \n- Должен содержать не менее 6 символов")},o={show:function(e,t){let n=this.el("div","popup__close");n.innerText="X";let a=this.el("div","popup__item");a.innerText=e,a.append(n);let s=u(".popup")[0];s||(s=this.el("div","popup")),s.append(a),s.addEventListener("click",this.close,!0),document.body.append(s),setTimeout((()=>{a.classList.remove("popup__item"),a.classList.add("popup-hide")}),5e3),setTimeout((()=>{a.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let n=document.createElement(e);return n.classList.add(t),n}};async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((async function(n,a){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?s.send(t):(s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("param="+JSON.stringify(t))),s.onerror=function(e){a(Error("Network Error"+e))},s.onload=function(){var e;let t=JSON.parse(s.response),a=u(".message")[0];var i;t.popup||null!=t&&null!==(e=t.arr)&&void 0!==e&&e.popup?o.show(t.popup??(null==t||null===(i=t.arr)||void 0===i?void 0:i.popup)):t.msg?a&&(a.innerHTML=t.msg,a.innerHTML=t.msg,u(a).removeClass("success"),u(a).removeClass("error")):t.success?a&&(a.innerHTML=t.success,u(a).addClass("success"),u(a).removeClass("error")):t.error&&a&&(a.innerHTML="",a.innerHTML=t.error,u(a).removeClass("success"),u(a).addClass("error")),n(t)}}))}class c extends Array{constructor(){super(...arguments),a(this,"value",(function(){return this[0].getAttribute("value")})),a(this,"attr",(function(e,t){return t&&this[0].setAttribute(e,t),this[0].getAttribute(e)})),a(this,"selectedIndexValue",(function(){if(this.length)return this[0].selectedOptions[0].value})),a(this,"options",(function(){if(this.length)return this[0].options})),a(this,"count",(function(){return this.length})),a(this,"text",(function(){if(this.length)return this[0].innerText})),a(this,"checked",(function(){if(this.length)return this[0].checked})),a(this,"getWithStyle",(function(e,t){let n=[];return this.forEach((a=>{a.style[e]===t&&n.push(a)})),n})),a(this,"addClass",(function(e){this.forEach((t=>{t.classList.add(e)}))})),a(this,"removeClass",(function(e){this.forEach((t=>{t.classList.remove(e)}))})),a(this,"hasClass",(function(e){if(this.classList.contains(e))return!0})),a(this,"append",(function(e){this[0].appendChild(e)})),a(this,"find",(function(e){return"string"==typeof e?this[0].querySelector(e):this[0].filter((t=>t===e))[0]})),a(this,"findAll",(function(e){if("string"==typeof e)return this[0].querySelectorAll(e)})),a(this,"css",(function(e,t){if(!t)return this[0].style[e];this.forEach((n=>{n.style[e]=t}))}))}on(e,t,n){"function"==typeof t?this.forEach((n=>n.addEventListener(e,t))):this.forEach((a=>{a.addEventListener(e,(e=>{e.target===t&&n(e)}))}))}ready(e){this.some((e=>null!=e.readyState&&"loading"!=e.readyState))?e():document.addEventListener("DOMContentLoaded",e)}}function u(e){return"string"==typeof e||e instanceof String?new c(...document.querySelectorAll(e)):new c(e)}}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(317);(0,e.$)(".gamburger")[0]&&(0,e.$)(".gamburger").on("click",(function(e){e.target.closest(".utils").querySelector(".mobile-menu").classList.toggle("show")})),[...(0,e.$)(".search input")].map((t=>{t&&t.addEventListener("input",(function(){!async function(t){let n=t.parentNode,a=(0,e.$)(n).find(".search__result");if(t.value.length<1)return void(a&&(a.innerHTML=""));let s=await fetch("/search?q="+t.value);s=await s.json(s),0!==a.childNodes.length&&(a.innerHTML=""),s.map((e=>{let t=document.createElement("a");t.href=e.alias,t.innerHTML=`<img src='/pic/${e.preview_pic}' alt='${e.name}'>`+e.name,a.appendChild(t)})),(0,e.$)("body").on("click",(function(e){a&&e.target!==a&&(a.innerHTML="")}))}(t)}),!0)})),document.cookie.match("(^|;)?cn=([^;]*)")?(0,e.$)("#cookie-notice").css("bottom","-100%"):(0,e.$)("#cookie-notice").css("bottom","0"),(0,e.$)("#cn-accept-cookie").on("click",(function(){(function(){const e=new Date;e.setTime(e.getTime()+2592e5),document.cookie="cn=1; expires="+e+"path=/; SameSite=lax"})(),(0,e.$)("#cookie-notice").css("bottom","-100%")})),(0,e.$)(".changepassword").on("click",(async function(t){let n={old_password:(0,e.$)('[name="old_password"]')[0].value,new_password:(0,e.$)('[name="new_password"]')[0].value},a=(0,e.$)(".message")[0];await(0,e.v_)("/auth/changepassword",n)?(a.innerText="Пароль сменен",(0,e.$)(a).addClass("success"),(0,e.$)(a).removeClass("error")):(a.innerText="Что-то пошло не так",(0,e.$)(a).addClass("error"),(0,e.$)(a).removeClass("success"))}));let t=(0,e.$)("[data-auth='login']")[0];t&&(0,e.$)(t).on("click",function(t){let{target:n}=t;n.classList.contains("submit__button")&&function(){let t=e.Gu.email(a.value);return t?(i.innerText="",i.innerText=t,(0,e.$)(i).addClass("error"),!1):"vvoronik@yandex.ru"===a.value||(t=e.Gu.password(s.value),!t)||(i.innerText="",i.innerText=t,(0,e.$)(i).addClass("error"),!1)}()&&async function(){let t={email:a.value,password:s.value},n=await(0,e.v_)("/auth/login",t);"employee"===n.arr.role?window.location="/adminsc":"user"===n.arr.role&&(window.location="/auth/cabinet")}()}.bind(void 0));let a=(0,e.$)("input[type = email]")[0],s=(0,e.$)("input[name= password]")[0],i=(0,e.$)(".message")[0],r=(0,e.$)("[data-auth='register']")[0];r&&(0,e.$)(r).on("click",(function(t){let{target:n}=t,a=(0,e.mN)((0,e.$)("input[type = email]")[0].value),s=(0,e.mN)((0,e.$)("input[name = password]")[0].value);n.classList.contains("submit__button")&&function(t,n){let a=e.Gu.email(t);return a?(msg.innerText=msg.innerText+a,(0,e.$)(msg).addClass("error"),!1):(a=e.Gu.password(n),!a||(msg.innerText=msg.innerText+a,(0,e.$)(msg).addClass("error"),!1))}(a,s)&&async function(t,n){let a=(0,e.$)(".message")[0],s={email:t,password:n,surName:(0,e.$)("[name='surName']")[0].value,name:(0,e.$)("[name='name']")[0].value},i=await(0,e.v_)("/auth/register",s);"confirmed"===i.msg?(a.classList.remove("error"),a.classList.add("success"),a.innerHTML="-Пользователь зарегистрирован.<br>-Для подтверждения регистрации зайдите на почту, <bold>email</bold>.<br> -Перейдите по ссылке в письме."):"mail exists"===i.msg?(a.innerHTML="Эта почта уже зарегистрирована",a.classList.remove("success"),a.classList.add("error")):(a.innerHTML=i.msg,a.classList.remove("success"),a.classList.add("error"))}(a,s)})),(0,e.$)('[data-auth="returnpass"]')[0]&&(0,e.$)(".submit__button").on("click",(async function(t){let n=(0,e.$)('input[type="email"]')[0].value;await(0,e.v_)("/auth/returnpass",{email:n})&&(window.location="/auth/login")})),(0,e.$)("#save").on("click",(async function(t){t.preventDefault();let n={name:(0,e.$)('[name = "name"]')[0].value,surName:(0,e.$)('[name = "surName"]')[0].value,middleName:(0,e.$)('[name = "middleName"]')[0].value,birthDate:(0,e.$)('[name = "birthDate"]')[0].value,phone:(0,e.$)('[name = "phone"]')[0].value,sex:void 0};await(0,e.v_)("/user/edit",n)})),function(){let t=(0,e.$)("[custom-radio]");[].map.call(t,(function(t){(0,e.$)(t).on("click",(function(e){let{target:n}=e,a=n.closest("label");t.dataset.value=a.dataset.value}))}))}(),function(){const t=(0,e.$)(".custom-list__wrapper");t&&[].forEach.call(t,(function(t){const n=(0,e.$)("[contenteditable]"),a=t.querySelectorAll(".head"),s=t.querySelectorAll("[hidden]"),i=t.querySelectorAll("[data-sort]"),r=(0,e.$)(t).findAll(".head input"),o=(0,e.$)(t)[0].querySelectorAll(".id:not(.head"),l=t.dataset.model,c=[];(0,e.$)(t).on("click",function(n){let{target:i}=n;if("add-model"===i.className)!async function(n,a){let i=await(0,e.v_)(`/adminsc/${n}/updateOrCreate`,{});i.arr.id&&function(n){let a=[...s];[].forEach.call(a,(function(a){let s=a.cloneNode(!0);s.removeAttribute("hidden"),(0,e.$)(t).find(".custom-list").appendChild(s),["id"].includes(s.className)?s.innerText=n:["del","edit","save"].includes(s.className)||(s.innerText=""),s.dataset.id=n}))}(i.arr.id)}(l);else if(".del:not(.head)"===i.className||i.closest(".del:not(.head)"))!async function(t){if(!confirm("Удалить?"))return;let n=t.dataset.id;await(0,e.v_)(`/adminsc/${l}/delete`,{id:n})&&function(t){let n=(0,e.$)(`[data-id='${t}']`);[].forEach.call(n,(function(e){e.remove()}))}(n)}(i.closest(".del:not(.head)"));else if(".edit:not(.head)"===i.className||i.closest(".edit:not(.head)"))!function(e,t){let n=e.closest(".edit:not(.head)").dataset.id;window.location=`/adminsc/${t}/edit/${n}`}(i,l);else if(i.classList.contains("head")){let e=i.closest(".head");!function(e){const t=d[e]||"asc",n="asc"===t?1:-1,s=Array.from(c);s.sort((function(t,a){const s=t[e].innerHTML,i=a[e].innerHTML,r=f(e,s),o=f(e,i);switch(!0){case r>o:return 1*n;case r<o:return-1*n;case r===o:return 0}})),[].forEach.call(c,(function(e){[].forEach.call(e,(e=>{e.remove()}))})),d[e]="asc"===t?"desc":"asc",s.forEach((function(e){(e=Array.from(e)).reverse(),[].forEach.call(e,(e=>{a[a.length-1].after(e)}))}))}([].findIndex.call(a,((t,n,a)=>t===e)))}}.bind(this)),(0,e.$)(t).on("keyup",function(e){let{target:s}=e;if(s.hasAttribute("contenteditable"))u(t,n,s);else if(s.closest(".head")){let e=s.closest(".head");!function(e,t){[].forEach.call(c,(e=>{[].forEach.call(e,(e=>{e.style.display="flex"}))}));const n=t.value;[].forEach.call(r,(e=>{e!==t&&(e.value="")})),[].forEach.call(c,(function(t){const a=t[e].innerText,s=new RegExp(`${n}`,"gi");a.match(s)||[].forEach.call(t,(e=>{e.style.display="none"}))}))}([].findIndex.call(a,((t,n,a)=>t===e)),s)}}.bind(this)),(0,e.$)(t).on("paste",function(e){let t=e.clipboardData.getData("text/plain");e.target.innerText=t,p(0,0,e.target),e.target.innerText=""}.bind(this));let u=(0,e.Ds)(p);for(let n=0;n<o.length;n++){let a=o[n].dataset.id,s=(0,e.$)(t)[0].querySelectorAll(`[data-id='${a}']`);c.push(s)}const d=Array.from(i).map((function(e){return""}));function f(e,t){if(i[e])return"number"===i[e].getAttribute("data-type")?parseFloat(t):t}function p(t,n,a){if(!a.hasAttribute("contenteditable"))return!1;!async function(t){let n=`/adminsc/${t.modelName}/updateOrCreate`;await(0,e.v_)(n,t.model)}(m(a,l))}function m(e,n){let a=e.dataset.field,s=t.dataset.parent+"_id",i=t.dataset.parentId,r={model:{id:e.dataset.id,[a]:e.innerText},modelName:n};return s&&(r.model[s]=i),r}}))}(),function(){let t=(0,e.$)("[multi-select] ");t&&[].forEach.call(t,(function(t){t.addEventListener("click",(function(t){let{target:n}=t,a=n.closest("[multi-select]");if(n.closest(".arrow")||["chip-wrap"].includes(n.className))a.querySelector("ul").classList.toggle("show");else if(["del"].includes(n.className))s=n.closest(".chip").dataset.id,(0,e.$)(a).find(`label[data-id='${s}']`).classList.remove("selected"),n.closest(".chip").remove();else if("label"===n.tagName.toLowerCase()){let t=n.dataset.id,s=a.querySelectorAll(".chip"),i=[].some.call(s,(e=>e.dataset.id===t)),r=(0,e.$)(a).find(".chip-wrap");if(i)n.classList.toggle("selected"),r.querySelector(`[data-id='${t}']`).remove();else{n.classList.toggle("selected");let e=function(e){let t=document.createElement("div");t.classList.add("chip"),t.innerText=n.innerText,t.dataset.id=e;let a=document.createElement("div");return a.classList.add("del"),a.innerText="X",t.append(a),t}(t);r.append(e)}}var s}),!1),t.addEventListener("blur",(function(t){let{target:n}=t,a=(0,e.$)(this).find(".show");a&&a.classList.remove("show")}),!1)}))}(),function(){let t=(0,e.$)(".item_wrap")[0];t&&(0,e.$)(t).on("click",async function(n){let{target:a}=n,s=t,i=s.dataset.model;a.closest(".save")?async function(t){if(function(){let t=(0,e.$)("[required]"),n=0;return[].forEach.call(t,(function(t){if(!t.innerText){if(t.style.borderColor="red",(0,e.$)(t).find(".error"))return;let a=document.createElement("div");a.innerText="Заполните поле",a.classList.add("error"),t.closest(".value").appendChild(a),n++}})),n}())return!1;let n=function(){let t=(0,e.$)("[data-field]"),n={};[].map.call(t,(t=>{if(t.closest("[data-parent]"))return n;if(t.hasAttribute("multi-select")){let e=t.querySelectorAll(".chip"),a=[].map.call(e,(e=>e.dataset.id));n[t.dataset.field]=a.toString()}else t.hasAttribute("custom-select")?n[t.dataset.field]=t.dataset.value:"inputs"===t.dataset.type?n[t.dataset.field]=function(e){let t=e.querySelectorAll("input"),n=[];return t.forEach((e=>{if(!e.checked)return;let t=e.parentNode.querySelector(".name").innerText;t&&n.push(t)})),n.join(",")}(t):t.hasAttribute("custom-radio")||t.hasAttribute("tab")?n[t.dataset.field]=t.dataset.value:"date"===t.type?n[t.dataset.field]=t.value:n[t.dataset.field]=(0,e.mN)(t.innerText)}),n);let a=(0,e.$)("[data-isTest]")[0];return a&&(n.isTest=+a.dataset.istest),n}();await(0,e.v_)(`/adminsc/${t}/updateorcreate`,n)}(i):a.closest(".del")&&a.closest(".del").dataset.model?async function(t,n){let a=t.dataset.id;await(0,e.v_)(`/adminsc/${n}/delete`,{id:a})&&(window.location.href=`/adminsc/${n}/edit`)}(s,a.closest(".del").dataset.model):a.classList.contains("tab")&&async function(t){(0,e.$)("section.show")[0].classList.toggle("show"),(0,e.$)(`section[data-id='${t.dataset.id}']`)[0].classList.toggle("show"),(0,e.$)(".tab.active")[0].classList.toggle("active"),t.classList.toggle("active")}(a)}.bind(this))}(),(0,e.$)(".password-control")&&(0,e.$)(".password-control").on("click",(function(e){let{target:t}=e,n=t.parentNode.querySelector("input");"password"===n.getAttribute("type")?n.setAttribute("type","text"):n.setAttribute("type","password"),t.classList.toggle("view")}))}()}();
//# sourceMappingURL=auth.js.map