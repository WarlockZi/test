!function(){"use strict";var e={317:function(e,t,n){function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{$:function(){return u},Ds:function(){return a},Gu:function(){return r},mN:function(){return i},v_:function(){return l}});const a=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:700;return function(){const s=()=>e.apply(this,arguments);clearTimeout(t),t=setTimeout(s,n)}};function i(e){return function(e){var t=new RegExp("\\t?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("\\n?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("&nbsp;?","g");return e.replace(t," ")}(e)))}let r={sort:()=>{let e=(void 0).nextElementSibling;(void 0).value.match(/\D+/)?(e.innerText="Только цифры",e.style.opacity="1"):"1"===e.style.opacity&&(e.style.opacity="0")},email:e=>!!e&&(!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())&&"Неправильный формат почты"),password:e=>!!e&&(!/^[a-zA-Z\-0-9]{6,20}$/.test(e)&&"Пароль может состоять из \n - Большие латинские бкувы \n- Маленькие латинские буквы \n- Цифры \n- Должен содержать не менее 6 символов")},o={show:function(e,t){let n=this.el("div","popup__close");n.innerText="X";let s=this.el("div","popup__item");s.innerText=e,s.append(n);let a=u(".popup")[0];a||(a=this.el("div","popup")),a.append(s),a.addEventListener("click",this.close,!0),document.body.append(a),setTimeout((()=>{s.classList.remove("popup__item"),s.classList.add("popup-hide")}),5e3),setTimeout((()=>{s.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let n=document.createElement(e);return n.classList.add(t),n}};async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((async function(n,s){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?a.send(t):(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("param="+JSON.stringify(t))),a.onerror=function(e){s(Error("Network Error"+e))},a.onload=function(){let e=JSON.parse(a.response),t=u(".message")[0];e.popup||e?.arr.popup?o.show(e.popup??e?.arr.popup):e.msg?t&&(t.innerHTML=e.msg,t.innerHTML=e.msg,u(t).removeClass("success"),u(t).removeClass("error")):e.success?t&&(t.innerHTML=e.success,u(t).addClass("success"),u(t).removeClass("error")):e.error&&t&&(t.innerHTML="",t.innerHTML=e.error,u(t).removeClass("success"),u(t).addClass("error")),n(e)}}))}class c extends Array{constructor(){super(...arguments),s(this,"value",(function(){return this[0].getAttribute("value")})),s(this,"attr",(function(e,t){return t&&this[0].setAttribute(e,t),this[0].getAttribute(e)})),s(this,"selectedIndexValue",(function(){if(this.length)return this[0].selectedOptions[0].value})),s(this,"options",(function(){if(this.length)return this[0].options})),s(this,"count",(function(){return this.length})),s(this,"text",(function(){if(this.length)return this[0].innerText})),s(this,"checked",(function(){if(this.length)return this[0].checked})),s(this,"getWithStyle",(function(e,t){let n=[];return this.forEach((s=>{s.style[e]===t&&n.push(s)})),n})),s(this,"addClass",(function(e){this.forEach((t=>{t.classList.add(e)}))})),s(this,"removeClass",(function(e){this.forEach((t=>{t.classList.remove(e)}))})),s(this,"hasClass",(function(e){if(this.classList.contains(e))return!0})),s(this,"append",(function(e){this[0].appendChild(e)})),s(this,"find",(function(e){return"string"==typeof e?this[0].querySelector(e):this[0].filter((t=>t===e))[0]})),s(this,"findAll",(function(e){if("string"==typeof e)return this[0].querySelectorAll(e)})),s(this,"css",(function(e,t){if(!t)return this[0].style[e];this.forEach((n=>{n.style[e]=t}))}))}on(e,t,n){"function"==typeof t?this.forEach((n=>n.addEventListener(e,t))):this.forEach((s=>{s.addEventListener(e,(e=>{e.target===t&&n(e)}))}))}ready(e){this.some((e=>null!=e.readyState&&"loading"!=e.readyState))?e():document.addEventListener("DOMContentLoaded",e)}}function u(e){return"string"==typeof e||e instanceof String?new c(...document.querySelectorAll(e)):new c(e)}}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(317);(0,e.$)(".gamburger")[0]&&(0,e.$)(".gamburger").on("click",(function(e){e.target.closest(".utils").querySelector(".mobile-menu").classList.toggle("show")})),[...(0,e.$)(".search input")].map((t=>{t&&t.addEventListener("input",(function(){!async function(t){let n=t.parentNode,s=(0,e.$)(n).find(".search__result");if(t.value.length<1)return void(s&&(s.innerHTML=""));let a=await fetch("/search?q="+t.value);a=await a.json(a),0!==s.childNodes.length&&(s.innerHTML=""),a.map((e=>{let t=document.createElement("a");t.href=e.alias,t.innerHTML=`<img src='/pic/${e.preview_pic}' alt='${e.name}'>`+e.name,s.appendChild(t)})),(0,e.$)("body").on("click",(function(e){s&&e.target!==s&&(s.innerHTML="")}))}(t)}),!0)})),document.cookie.match("(^|;)?cn=([^;]*)")?(0,e.$)("#cookie-notice").css("bottom","-100%"):(0,e.$)("#cookie-notice").css("bottom","0"),(0,e.$)("#cn-accept-cookie").on("click",(function(){(function(){const e=new Date;e.setTime(e.getTime()+2592e5),document.cookie="cn=1; expires="+e+"path=/; SameSite=lax"})(),(0,e.$)("#cookie-notice").css("bottom","-100%")})),(0,e.$)(".changepassword").on("click",(async function(t){let n={old_password:(0,e.$)('[name="old_password"]')[0].value,new_password:(0,e.$)('[name="new_password"]')[0].value},s=(0,e.$)(".message")[0];await(0,e.v_)("/auth/changepassword",n)?(s.innerText="Пароль сменен",(0,e.$)(s).addClass("success"),(0,e.$)(s).removeClass("error")):(s.innerText="Что-то пошло не так",(0,e.$)(s).addClass("error"),(0,e.$)(s).removeClass("success"))}));let t=(0,e.$)("[data-auth='login']")[0];t&&(0,e.$)(t).on("click",function(t){let{target:n}=t;n.classList.contains("submit__button")&&function(){let t=e.Gu.email(s.value);return t?(i.innerText="",i.innerText=t,(0,e.$)(i).addClass("error"),!1):process.env.SU_EMAIL===s.value||(t=e.Gu.password(a.value),!t)||(i.innerText="",i.innerText=t,(0,e.$)(i).addClass("error"),!1)}()&&async function(){let t={email:s.value,password:a.value},n=await(0,e.v_)("/auth/login",t);"employee"===n.arr.role?window.location="/adminsc":"user"===n.arr.role&&(window.location="/auth/cabinet")}()}.bind(void 0));let s=(0,e.$)("input[type = email]")[0],a=(0,e.$)("input[name= password]")[0],i=(0,e.$)(".message")[0],r=(0,e.$)("[data-auth='register']")[0];r&&(0,e.$)(r).on("click",function(t){let{target:n}=t;n.classList.contains("submit__button")&&function(){let t=e.Gu.email(o.value);return t?(c.innerText=c.innerText+t,(0,e.$)(c).addClass("error"),!1):(t=e.Gu.password(l.value),!t||(c.innerText=c.innerText+t,(0,e.$)(c).addClass("error"),!1))}()&&async function(){let t=(0,e.$)(".message")[0],n={email:o.value,password:l.value,surName:(0,e.$)("[name='surName']")[0].value,name:(0,e.$)("[name='name']")[0].value},s=await(0,e.v_)("/auth/register",n);"confirmed"===s.msg?(t.classList.remove("error"),t.classList.add("success"),t.innerHTML="-Пользователь зарегистрирован.<br>-Для подтверждения регистрации зайдите на почту, <bold>email</bold>.<br> -Перейдите по ссылке в письме."):"mail exists"===s.msg?(t.innerHTML="Эта почта уже зарегистрирована",t.classList.remove("success"),t.classList.add("error")):(t.innerHTML=s.msg,t.classList.remove("success"),t.classList.add("error"))}()}.bind(void 0));let o=(0,e.$)("input[type = email]")[0],l=(0,e.$)("input[name = password]")[0],c=(0,e.$)(".message")[0];(0,e.$)('[data-auth="returnpass"]')[0]&&(0,e.$)(".submit__button").on("click",(async function(t){let n=(0,e.$)('input[type="email"]')[0].value;await(0,e.v_)("/auth/returnpass",{email:n})&&(window.location="/auth/login")})),(0,e.$)("#save").on("click",(async function(t){t.preventDefault();let n={name:(0,e.$)('[name = "name"]')[0].value,surName:(0,e.$)('[name = "surName"]')[0].value,middleName:(0,e.$)('[name = "middleName"]')[0].value,birthDate:(0,e.$)('[name = "birthDate"]')[0].value,phone:(0,e.$)('[name = "phone"]')[0].value,sex:void 0};await(0,e.v_)("/user/edit",n)})),function(){let t=(0,e.$)("[custom-radio]");[].map.call(t,(function(t){(0,e.$)(t).on("click",(function(e){let{target:n}=e,s=n.closest("label");t.dataset.value=s.dataset.value}))}))}(),function(){const t=(0,e.$)(".custom-list__wrapper");t&&[].forEach.call(t,(function(t){const n=(0,e.$)("[contenteditable]"),s=t.querySelectorAll(".head"),a=t.querySelectorAll("[data-sort]"),i=(0,e.$)(t).findAll(".head input"),r=(0,e.$)(t)[0].querySelectorAll(".id:not(.head"),o=t.dataset.model,l=[];(0,e.$)(t).on("click",function(n){let{target:a}=n;if("add-model"===a.className)!async function(n,s){let a=await(0,e.v_)(`/adminsc/${n}/create`,{});a.arr.id&&function(n){let s=[...l[0]];[].forEach.call(s,(function(s){let a=s.cloneNode(!0);(0,e.$)(t).find(".custom-list").appendChild(a),["id"].includes(a.className)?a.innerText=n:["del","edit","save"].includes(a.className)||(a.innerText=""),a.dataset.id=n}))}(a.arr.id)}(o);else if(".del:not(.head)"===a.className||a.closest(".del:not(.head)"))!async function(t){if(!confirm("Удалить?"))return;let n=t.dataset.id;await(0,e.v_)(`/adminsc/${o}/delete`,{id:n})&&function(t){let n=(0,e.$)(`[data-id='${t}']`);[].forEach.call(n,(function(e){e.remove()}))}(n)}(a.closest(".del:not(.head)"));else if(".edit:not(.head)"===a.className||a.closest(".edit:not(.head)")){let e=a.closest(".edit:not(.head)").dataset.id;window.location=`/adminsc/${o}/edit/${e}`}else if(a.classList.contains("head")){let e=a.closest(".head");!function(e){const t=u[e]||"asc",n="asc"===t?1:-1,a=Array.from(l);a.sort((function(t,s){const a=t[e].innerHTML,i=s[e].innerHTML,r=d(e,a),o=d(e,i);switch(!0){case r>o:return 1*n;case r<o:return-1*n;case r===o:return 0}})),[].forEach.call(l,(function(e){[].forEach.call(e,(e=>{e.remove()}))})),u[e]="asc"===t?"desc":"asc",a.forEach((function(e){(e=Array.from(e)).reverse(),[].forEach.call(e,(e=>{s[s.length-1].after(e)}))}))}([].findIndex.call(s,((t,n,s)=>t===e)))}}.bind(this)),(0,e.$)(t).on("keyup",function(e){let{target:a}=e;if(a.hasAttribute("contenteditable"))c(t,n,a);else if(a.closest(".head")){let e=a.closest(".head");!function(e,t){[].forEach.call(l,(e=>{[].forEach.call(e,(e=>{e.style.display="flex"}))}));const n=t.value;[].forEach.call(i,(e=>{e!==t&&(e.value="")})),[].forEach.call(l,(function(t){const s=t[e].innerText,a=new RegExp(`${n}`,"gi");s.match(a)||[].forEach.call(t,(e=>{e.style.display="none"}))}))}([].findIndex.call(s,((t,n,s)=>t===e)),a)}}.bind(this));let c=(0,e.Ds)((function(t,n,s){if(!s.hasAttribute("contenteditable"))return!1;!async function(t){let n=`/adminsc/${t.modelName}/updateOrCreate`;await(0,e.v_)(n,t.model)}(function(e,t){let n=e.dataset.field;return{model:{id:e.dataset.id,[n]:e.innerText},modelName:t}}(s,o))}));for(let n=0;n<r.length;n++){let s=r[n].dataset.id,a=(0,e.$)(t)[0].querySelectorAll(`[data-id='${s}']`);l.push(a)}const u=Array.from(a).map((function(e){return""}));function d(e,t){return"number"===a[e].getAttribute("data-type")?parseFloat(t):t}}))}(),function(){let t=(0,e.$)("[multi-select] ");t&&[].forEach.call(t,(function(t){t.addEventListener("click",(function(t){let{target:n}=t,s=n.closest("[multi-select]");if(n.closest(".arrow")||["chip-wrap"].includes(n.className))s.querySelector("ul").classList.toggle("show");else if(["del"].includes(n.className))a=n.closest(".chip").dataset.id,(0,e.$)(s).find(`label[data-id='${a}']`).classList.remove("selected"),n.closest(".chip").remove();else if("label"===n.tagName.toLowerCase()){let t=n.dataset.id,a=s.querySelectorAll(".chip"),i=[].some.call(a,(e=>e.dataset.id===t)),r=(0,e.$)(s).find(".chip-wrap");if(i)n.classList.toggle("selected"),r.querySelector(`[data-id='${t}']`).remove();else{n.classList.toggle("selected");let e=function(e){let t=document.createElement("div");t.classList.add("chip"),t.innerText=n.innerText,t.dataset.id=e;let s=document.createElement("div");return s.classList.add("del"),s.innerText="X",t.append(s),t}(t);r.append(e)}}var a}),!1),t.addEventListener("blur",(function(t){let{target:n}=t,s=(0,e.$)(this).find(".show");s&&s.classList.remove("show")}),!1)}))}(),function(){let t=(0,e.$)(".item_wrap")[0];t&&(0,e.$)(t).on("click",async function(n){let{target:s}=n,a=t,i=a.dataset.model;s.closest(".save")?async function(t){if(function(){let t=(0,e.$)("[required]"),n=0;return[].forEach.call(t,(function(t){if(!t.innerText){if(t.style.borderColor="red",(0,e.$)(t).find(".error"))return;let s=document.createElement("div");s.innerText="Заполните поле",s.classList.add("error"),t.closest(".value").appendChild(s),n++}})),n}())return!1;let n=function(){let t=(0,e.$)("[data-field]"),n={};[].map.call(t,(t=>{if(t.hasAttribute("multi-select")){let e=t.querySelectorAll(".chip"),s=[].map.call(e,(e=>e.dataset.id));n[t.dataset.field]=s.toString()}else t.hasAttribute("custom-select")?n[t.dataset.field]=t.dataset.value:"inputs"===t.dataset.type?n[t.dataset.field]=function(e){let t=e.querySelectorAll("input"),n=[];return t.forEach((e=>{if(!e.checked)return;let t=e.parentNode.querySelector(".name").innerText;t&&n.push(t)})),n.join(",")}(t):t.hasAttribute("custom-radio")||t.hasAttribute("tab")?n[t.dataset.field]=t.dataset.value:"date"===t.type?n[t.dataset.field]=t.value:n[t.dataset.field]=(0,e.mN)(t.innerText)}),n);let s=(0,e.$)("[data-isTest]")[0];return s&&(n.isTest=+s.dataset.istest),n}();await(0,e.v_)(`/adminsc/${t}/updateorcreate`,n)}(i):s.closest(".del")&&s.closest(".del").dataset.model?async function(t,n){let s=t.dataset.id;await(0,e.v_)(`/adminsc/${n}/delete`,{id:s})&&(window.location.href=`/adminsc/${n}/edit`)}(a,s.closest(".del").dataset.model):s.classList.contains("tab")&&async function(t){(0,e.$)("section.show")[0].classList.toggle("show"),(0,e.$)(`section[data-id='${t.dataset.id}']`)[0].classList.toggle("show"),(0,e.$)(".tab.active")[0].classList.toggle("active"),t.classList.toggle("active")}(s)}.bind(this))}(),(0,e.$)(".password-control")&&(0,e.$)(".password-control").on("click",(function(e){let{target:t}=e,n=t.parentNode.querySelector("input");"password"===n.getAttribute("type")?n.setAttribute("type","text"):n.setAttribute("type","password"),t.classList.toggle("view")}))}()}();
//# sourceMappingURL=auth.js.map