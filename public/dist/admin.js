/*! For license information please see admin.js.LICENSE.txt */
!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const t=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:700;return function(){const i=()=>e.apply(this,arguments);clearTimeout(t),t=setTimeout(i,n)}};function n(e){return function(e){return e.trim()}(e=function(e){var t=new RegExp("s","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("\\t?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("\\n?","g");return e.replace(t,"")}(e=function(e){var t=new RegExp("&nbsp;?","g");return e.replace(t," ")}(e)))))}function i(e){return n(r(e)[0].outerHTML)}let a={show:function(e,t){let n=this.el("div","popup__close");n.innerText="X";let i=this.el("div","popup__item");i.innerText=e,i.append(n);let a=r(".popup")[0];a||(a=this.el("div","popup")),a.append(i),a.addEventListener("click",this.close,!0),document.body.append(a),setTimeout((()=>{i.classList.remove("popup__item"),i.classList.add("popup-hide")}),5e3),setTimeout((()=>{i.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let n=document.createElement(e);return n.classList.add(t),n}};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((async function(n,i){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?o.send(t):(o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("param="+JSON.stringify(t))),o.onerror=function(e){i(Error("Network Error"+e))},o.onload=function(){var e;let t=JSON.parse(o.response),i=r(".message")[0];var s;t.popup||null!=t&&null!==(e=t.arr)&&void 0!==e&&e.popup?a.show(t.popup??(null==t||null===(s=t.arr)||void 0===s?void 0:s.popup)):t.msg?i&&(i.innerHTML=t.msg,i.innerHTML=t.msg,r(i).removeClass("success"),r(i).removeClass("error")):t.success?i&&(i.innerHTML=t.success,r(i).addClass("success"),r(i).removeClass("error")):t.error&&i&&(i.innerHTML="",i.innerHTML=t.error,r(i).removeClass("success"),r(i).addClass("error")),n(t)}}))}class s extends Array{constructor(){super(...arguments),e(this,"value",(function(){return this[0].getAttribute("value")})),e(this,"attr",(function(e,t){return t&&this[0].setAttribute(e,t),this[0].getAttribute(e)})),e(this,"selectedIndexValue",(function(){if(this.length)return this[0].selectedOptions[0].value})),e(this,"options",(function(){if(this.length)return this[0].options})),e(this,"count",(function(){return this.length})),e(this,"text",(function(){if(this.length)return this[0].innerText})),e(this,"checked",(function(){if(this.length)return this[0].checked})),e(this,"getWithStyle",(function(e,t){let n=[];return this.forEach((i=>{i.style[e]===t&&n.push(i)})),n})),e(this,"addClass",(function(e){this.forEach((t=>{t.classList.add(e)}))})),e(this,"removeClass",(function(e){this.forEach((t=>{t.classList.remove(e)}))})),e(this,"hasClass",(function(e){if(this.classList.contains(e))return!0})),e(this,"append",(function(e){this[0].appendChild(e)})),e(this,"find",(function(e){return"string"==typeof e?this[0].querySelector(e):this[0].filter((t=>t===e))[0]})),e(this,"findAll",(function(e){if("string"==typeof e)return this[0].querySelectorAll(e)})),e(this,"css",(function(e,t){if(!t)return this[0].style[e];this.forEach((n=>{n.style[e]=t}))}))}on(e,t,n){"function"==typeof t?this.forEach((n=>n.addEventListener(e,t))):this.forEach((i=>{i.addEventListener(e,(e=>{e.target===t&&n(e)}))}))}ready(e){this.some((e=>null!=e.readyState&&"loading"!=e.readyState))?e():document.addEventListener("DOMContentLoaded",e)}}function r(e){return"string"==typeof e||e instanceof String?new s(...document.querySelectorAll(e)):new s(e)}function l(e,t,n,i,a,o){let s=new Date(e),r=s.getFullYear(),l=s.getMonth()+1,c=s.getDate();return c<10&&(c="0"+c),l<10&&(l="0"+l),{yyyy:r,mm:l,dd:c,M:["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()],D:s.getDay(),wd:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"][s.getDay()]}}if(r("[accordion]")){let e=r("[accordion] [type='checkbox']");e&&[...e].filter((e=>{e.checked=!1})),r("[accordion]").on("click",(function(e){let{target:t}=e,n=t.closest("li");if(!n)return;let i=r(n).find("ul");if(i)if(i.classList.contains("open"))c(i,n);else{if(!i)return;let e=n.closest("ul");!function(e){if(!e)return;let t=r(e).find("li>ul.open");if(t){let e=t.closest("li");c(t,e)}}(e),function(e,t,n){n&&(n.style.maxHeight=e.scrollHeight+n.scrollHeight+"px"),e.style.maxHeight=e.scrollHeight+"px",e.classList.toggle("open"),t.classList.toggle("rotate")}(i,n,e)}else!function(e){e.classList.toggle("rotate")}(n)}))}function c(e,t){e.style.maxHeight="0px",e.classList.toggle("open"),t.classList.toggle("rotate")}r(".admin_sidebar")[0]&&r("svg#burger").on("click",(function(){r(".admin_sidebar [accordion]")[0].classList.toggle("show")}));let d=r("[custom-date]");if(d)for(let e of d)e.onchange=function(e){let{target:t}=e,{yyyy:n,mm:i,dd:a}=l(t.value),o=`${n}-${i}-${a}`;t.value,t.setAttribute("data-value",o)};const u={delServer:async e=>{r(".opentest")[0]?await o("/adminsc/opentestresult/delete",{id:e}):await o("/adminsc/testresult/delete",{id:e})},delDom:e=>{[].map.call(r(`[data-row = "${e}"]`),(function(e){e.remove()}))},delete:e=>{confirm("Удалить результат теста?")&&(u.delServer(e),u.delDom(e))}};let p=r(".test-results__table")[0];function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}p&&r(p).on("click",(function(e){let{target:t}=e;if(t.closest(".del-btn")){let e=t.closest(".del-btn").dataset.row;u.delete(e)}})),r(".testresult")[0]&&(r(".accordion_wrap")[0].remove(),r(".page-name")[0].remove(),r(".test-name")[0].remove(),r(".test-do__finish-btn")[0].remove());const m=new class{constructor(){var e;h(this,"model","openquestion"),h(this,"questions",r(".questions>.question-edit")),h(this,"testId",+(null===(e=r(".questions")[0])||void 0===e?void 0:e.dataset.testId)??null),h(this,"questionCnt",r(".questions>.question-edit").length??null)}async create(e){let t=this.testId,n=this.questionCnt+1,i=await o(`/adminsc/${this.model}/updateOrCreate`,{id:0,opentest_id:t,sort:n});if(i.arr.id){let t=this.cloneEmptyModel();t.querySelector(".sort").innerText=this.questionCnt+1,t.querySelector(".text").innerText="",t.dataset.id=i.arr.id,e.before(t)}}cloneEmptyModel(){let e=r(".questions .question-edit")[0];if(e){let t=e.cloneNode(!0),n=t.querySelectorAll(".row .answer");return[].forEach.call(n,(function(e){e.remove()})),t}}async sort(e){let t=this.questions.filter((function(t,n){if(n+1<e)return t})),n=t.map((e=>e.dataset.id));await o(`/${this.model}/sort`,{toChange:n}),t.map(((e,t)=>{r(e).find(".sort").innerText=t+1}))}async changeParent(e){let t=+e.options[e.selectedIndex].value;if(!t)return;let n=e.closest(".question-edit"),i=n.dataset.id,s=e.innerText;await o(`/adminsc/${this.model}/changeParent`,{id:i,test_id:t})&&(n.remove(),a.show("Перемещен в "+s))}showAnswers(e){let t=r(e.closest(".question-edit")).find(".question__answers");t.classList.toggle("height"),t.classList.toggle("scale"),e.classList.toggle("rotate")}async del(e){if(confirm("Удалить вопрос со всеми его ответами?")){let t=e.closest(".question-edit"),n=t.dataset.id;await o(`/adminsc/${this.model}/delete`,{id:n})&&t.remove()}}};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},y.apply(this,arguments)}function E(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function _(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var S=_(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),x=_(/Edge/i),T=_(/firefox/i),C=_(/safari/i)&&!_(/chrome/i)&&!_(/android/i),L=_(/iP(ad|od|hone)/i),D=_(/chrome/i)&&_(/android/i),A={capture:!1,passive:!1};function q(e,t,n){e.addEventListener(t,n,!S&&A)}function k(e,t,n){e.removeEventListener(t,n,!S&&A)}function O(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function M(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function I(e,t,n,i){if(e){n=n||document;do{if(null!=t&&(">"===t[0]?e.parentNode===n&&O(e,t):O(e,t))||i&&e===n)return e;if(e===n)break}while(e=M(e))}return null}var N,P=/\s+/g;function $(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(P," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(P," ")}}function R(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in i||-1!==t.indexOf("webkit")||(t="-webkit-"+t),i[t]=n+("string"==typeof n?"":"px")}}function B(e,t){var n="";if("string"==typeof e)n=e;else do{var i=R(e,"transform");i&&"none"!==i&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(n)}function X(e,t,n){if(e){var i=e.getElementsByTagName(t),a=0,o=i.length;if(n)for(;a<o;a++)n(i[a],a);return i}return[]}function H(){return document.scrollingElement||document.documentElement}function Y(e,t,n,i,a){if(e.getBoundingClientRect||e===window){var o,s,r,l,c,d,u;if(e!==window&&e.parentNode&&e!==H()?(s=(o=e.getBoundingClientRect()).top,r=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(s=0,r=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(a=a||e.parentNode,!S))do{if(a&&a.getBoundingClientRect&&("none"!==R(a,"transform")||n&&"static"!==R(a,"position"))){var p=a.getBoundingClientRect();s-=p.top+parseInt(R(a,"border-top-width")),r-=p.left+parseInt(R(a,"border-left-width")),l=s+o.height,c=r+o.width;break}}while(a=a.parentNode);if(i&&e!==window){var h=B(a||e),f=h&&h.a,m=h&&h.d;h&&(l=(s/=m)+(d/=m),c=(r/=f)+(u/=f))}return{top:s,left:r,bottom:l,right:c,width:u,height:d}}}function j(e,t,n){for(var i=U(e,!0),a=Y(e)[t];i;){var o=Y(i)[n];if(!("top"===n||"left"===n?a>=o:a<=o))return i;if(i===H())break;i=U(i,!1)}return!1}function F(e,t,n,i){for(var a=0,o=0,s=e.children;o<s.length;){if("none"!==s[o].style.display&&s[o]!==Qe.ghost&&(i||s[o]!==Qe.dragged)&&I(s[o],n.draggable,e,!1)){if(a===t)return s[o];a++}o++}return null}function W(e,t){for(var n=e.lastElementChild;n&&(n===Qe.ghost||"none"===R(n,"display")||t&&!O(n,t));)n=n.previousElementSibling;return n||null}function z(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Qe.clone||t&&!O(e,t)||n++;return n}function V(e){var t=0,n=0,i=H();if(e)do{var a=B(e),o=a.a,s=a.d;t+=e.scrollLeft*o,n+=e.scrollTop*s}while(e!==i&&(e=e.parentNode));return[t,n]}function U(e,t){if(!e||!e.getBoundingClientRect)return H();var n=e,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var a=R(n);if(n.clientWidth<n.scrollWidth&&("auto"==a.overflowX||"scroll"==a.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==a.overflowY||"scroll"==a.overflowY)){if(!n.getBoundingClientRect||n===document.body)return H();if(i||t)return n;i=!0}}}while(n=n.parentNode);return H()}function G(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Q(e,t){return function(){if(!N){var n=arguments,i=this;1===n.length?e.call(i,n[0]):e.apply(i,n),N=setTimeout((function(){N=void 0}),t)}}}function J(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function Z(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}var K="Sortable"+(new Date).getTime();var ee=[],te={initializeByDefault:!0},ne={mount:function(e){for(var t in te)te.hasOwnProperty(t)&&!(t in e)&&(e[t]=te[t]);ee.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),ee.push(e)},pluginEvent:function(e,t,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var a=e+"Global";ee.forEach((function(i){t[i.pluginName]&&(t[i.pluginName][a]&&t[i.pluginName][a](v({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](v({sortable:t},n)))}))},initializePlugins:function(e,t,n,i){for(var a in ee.forEach((function(i){var a=i.pluginName;if(e.options[a]||i.initializeByDefault){var o=new i(e,t,e.options);o.sortable=e,o.options=e.options,e[a]=o,y(n,o.defaults)}})),e.options)if(e.options.hasOwnProperty(a)){var o=this.modifyOption(e,a,e.options[a]);void 0!==o&&(e.options[a]=o)}},getEventProperties:function(e,t){var n={};return ee.forEach((function(i){"function"==typeof i.eventProperties&&y(n,i.eventProperties.call(t[i.pluginName],e))})),n},modifyOption:function(e,t,n){var i;return ee.forEach((function(a){e[a.pluginName]&&a.optionListeners&&"function"==typeof a.optionListeners[t]&&(i=a.optionListeners[t].call(e[a.pluginName],n))})),i}};var ie=["evt"],ae=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.evt,a=E(n,ie);ne.pluginEvent.bind(Qe)(e,t,v({dragEl:se,parentEl:re,ghostEl:le,rootEl:ce,nextEl:de,lastDownEl:ue,cloneEl:pe,cloneHidden:he,dragStarted:Ce,putSortable:we,activeSortable:Qe.active,originalEvent:i,oldIndex:fe,oldDraggableIndex:ge,newIndex:me,newDraggableIndex:ve,hideGhostForTarget:ze,unhideGhostForTarget:Ve,cloneNowHidden:function(){he=!0},cloneNowShown:function(){he=!1},dispatchSortableEvent:function(e){oe({sortable:t,name:e,originalEvent:i})}},a))};function oe(e){!function(e){var t=e.sortable,n=e.rootEl,i=e.name,a=e.targetEl,o=e.cloneEl,s=e.toEl,r=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,p=e.originalEvent,h=e.putSortable,f=e.extraEventProperties;if(t=t||n&&n[K]){var m,g=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||S||x?(m=document.createEvent("Event")).initEvent(i,!0,!0):m=new CustomEvent(i,{bubbles:!0,cancelable:!0}),m.to=s||n,m.from=r||n,m.item=a||n,m.clone=o,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=d,m.newDraggableIndex=u,m.originalEvent=p,m.pullMode=h?h.lastPutMode:void 0;var w=v(v({},f),ne.getEventProperties(i,t));for(var y in w)m[y]=w[y];n&&n.dispatchEvent(m),g[b]&&g[b].call(t,m)}}(v({putSortable:we,cloneEl:pe,targetEl:se,rootEl:ce,oldIndex:fe,oldDraggableIndex:ge,newIndex:me,newDraggableIndex:ve},e))}var se,re,le,ce,de,ue,pe,he,fe,me,ge,ve,be,we,ye,Ee,_e,Se,xe,Te,Ce,Le,De,Ae,qe,ke=!1,Oe=!1,Me=[],Ie=!1,Ne=!1,Pe=[],$e=!1,Re=[],Be="undefined"!=typeof document,Xe=L,He=x||S?"cssFloat":"float",Ye=Be&&!D&&!L&&"draggable"in document.createElement("div"),je=function(){if(Be){if(S)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Fe=function(e,t){var n=R(e),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=F(e,0,t),o=F(e,1,t),s=a&&R(a),r=o&&R(o),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+Y(a).width,c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Y(o).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&s.float&&"none"!==s.float){var d="left"===s.float?"left":"right";return!o||"both"!==r.clear&&r.clear!==d?"horizontal":"vertical"}return a&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||l>=i&&"none"===n[He]||o&&"none"===n[He]&&l+c>i)?"vertical":"horizontal"},We=function(e){function t(e,n){return function(i,a,o,s){var r=i.options.group.name&&a.options.group.name&&i.options.group.name===a.options.group.name;if(null==e&&(n||r))return!0;if(null==e||!1===e)return!1;if(n&&"clone"===e)return e;if("function"==typeof e)return t(e(i,a,o,s),n)(i,a,o,s);var l=(n?i:a).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var n={},i=e.group;i&&"object"==b(i)||(i={name:i}),n.name=i.name,n.checkPull=t(i.pull,!0),n.checkPut=t(i.put),n.revertClone=i.revertClone,e.group=n},ze=function(){!je&&le&&R(le,"display","none")},Ve=function(){!je&&le&&R(le,"display","")};Be&&!D&&document.addEventListener("click",(function(e){if(Oe)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Oe=!1,!1}),!0);var Ue=function(e){if(se){e=e.touches?e.touches[0]:e;var t=(a=e.clientX,o=e.clientY,Me.some((function(e){var t=e[K].options.emptyInsertThreshold;if(t&&!W(e)){var n=Y(e),i=a>=n.left-t&&a<=n.right+t,r=o>=n.top-t&&o<=n.bottom+t;return i&&r?s=e:void 0}})),s);if(t){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[K]._onDragOver(n)}}var a,o,s},Ge=function(e){se&&se.parentNode[K]._isOutsideThisEl(e.target)};function Qe(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=y({},t),e[K]=this;var n,i,a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Fe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Qe.supportPointer&&"PointerEvent"in window&&!C,emptyInsertThreshold:5};for(var o in ne.initializePlugins(this,e,a),a)!(o in t)&&(t[o]=a[o]);for(var s in We(t),this)"_"===s.charAt(0)&&"function"==typeof this[s]&&(this[s]=this[s].bind(this));this.nativeDraggable=!t.forceFallback&&Ye,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?q(e,"pointerdown",this._onTapStart):(q(e,"mousedown",this._onTapStart),q(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(q(e,"dragover",this),q(e,"dragenter",this)),Me.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),y(this,(i=[],{captureAnimationState:function(){i=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==R(e,"display")&&e!==Qe.ghost){i.push({target:e,rect:Y(e)});var t=v({},i[i.length-1].rect);if(e.thisAnimationDuration){var n=B(e,!0);n&&(t.top-=n.f,t.left-=n.e)}e.fromRect=t}}))},addAnimationState:function(e){i.push(e)},removeAnimationState:function(e){i.splice(function(e,t){for(var n in e)if(e.hasOwnProperty(n))for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n);return-1}(i,{target:e}),1)},animateAll:function(e){var t=this;if(!this.options.animation)return clearTimeout(n),void("function"==typeof e&&e());var a=!1,o=0;i.forEach((function(e){var n=0,i=e.target,s=i.fromRect,r=Y(i),l=i.prevFromRect,c=i.prevToRect,d=e.rect,u=B(i,!0);u&&(r.top-=u.f,r.left-=u.e),i.toRect=r,i.thisAnimationDuration&&G(l,r)&&!G(s,r)&&(d.top-r.top)/(d.left-r.left)==(s.top-r.top)/(s.left-r.left)&&(n=function(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}(d,l,c,t.options)),G(r,s)||(i.prevFromRect=s,i.prevToRect=r,n||(n=t.options.animation),t.animate(i,d,r,n)),n&&(a=!0,o=Math.max(o,n),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),n),i.thisAnimationDuration=n)})),clearTimeout(n),a?n=setTimeout((function(){"function"==typeof e&&e()}),o):"function"==typeof e&&e(),i=[]},animate:function(e,t,n,i){if(i){R(e,"transition",""),R(e,"transform","");var a=B(this.el),o=a&&a.a,s=a&&a.d,r=(t.left-n.left)/(o||1),l=(t.top-n.top)/(s||1);e.animatingX=!!r,e.animatingY=!!l,R(e,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),R(e,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),R(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){R(e,"transition",""),R(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),i)}}}))}function Je(e,t,n,i,a,o,s,r){var l,c,d=e[K],u=d.options.onMove;return!window.CustomEvent||S||x?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=a||t,l.relatedRect=o||Y(t),l.willInsertAfter=r,l.originalEvent=s,e.dispatchEvent(l),u&&(c=u.call(d,l,s)),c}function Ze(e){e.draggable=!1}function Ke(){$e=!1}function et(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function tt(e){return setTimeout(e,0)}function nt(e){return clearTimeout(e)}Qe.prototype={constructor:Qe,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Le=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,se):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,i=this.options,a=i.preventOnFilter,o=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,c=i.filter;if(function(e){Re.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&Re.push(i)}}(n),!se&&!(/mousedown|pointerdown/.test(o)&&0!==e.button||i.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!C||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=I(r,i.draggable,n,!1))&&r.animated||ue===r)){if(fe=z(r),ge=z(r,i.draggable),"function"==typeof c){if(c.call(this,e,r,this))return oe({sortable:t,rootEl:l,name:"filter",targetEl:r,toEl:n,fromEl:n}),ae("filter",t,{evt:e}),void(a&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(i){if(i=I(l,i.trim(),n,!1))return oe({sortable:t,rootEl:i,name:"filter",targetEl:r,fromEl:n,toEl:n}),ae("filter",t,{evt:e}),!0}))))return void(a&&e.cancelable&&e.preventDefault());i.handle&&!I(l,i.handle,n,!1)||this._prepareDragStart(e,s,r)}}},_prepareDragStart:function(e,t,n){var i,a=this,o=a.el,s=a.options,r=o.ownerDocument;if(n&&!se&&n.parentNode===o){var l=Y(n);if(ce=o,re=(se=n).parentNode,de=se.nextSibling,ue=n,be=s.group,Qe.dragged=se,ye={target:se,clientX:(t||e).clientX,clientY:(t||e).clientY},xe=ye.clientX-l.left,Te=ye.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,se.style["will-change"]="all",i=function(){ae("delayEnded",a,{evt:e}),Qe.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!T&&a.nativeDraggable&&(se.draggable=!0),a._triggerDragStart(e,t),oe({sortable:a,name:"choose",originalEvent:e}),$(se,s.chosenClass,!0))},s.ignore.split(",").forEach((function(e){X(se,e.trim(),Ze)})),q(r,"dragover",Ue),q(r,"mousemove",Ue),q(r,"touchmove",Ue),q(r,"mouseup",a._onDrop),q(r,"touchend",a._onDrop),q(r,"touchcancel",a._onDrop),T&&this.nativeDraggable&&(this.options.touchStartThreshold=4,se.draggable=!0),ae("delayStart",this,{evt:e}),!s.delay||s.delayOnTouchOnly&&!t||this.nativeDraggable&&(x||S))i();else{if(Qe.eventCanceled)return void this._onDrop();q(r,"mouseup",a._disableDelayedDrag),q(r,"touchend",a._disableDelayedDrag),q(r,"touchcancel",a._disableDelayedDrag),q(r,"mousemove",a._delayedDragTouchMoveHandler),q(r,"touchmove",a._delayedDragTouchMoveHandler),s.supportPointer&&q(r,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(i,s.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){se&&Ze(se),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;k(e,"mouseup",this._disableDelayedDrag),k(e,"touchend",this._disableDelayedDrag),k(e,"touchcancel",this._disableDelayedDrag),k(e,"mousemove",this._delayedDragTouchMoveHandler),k(e,"touchmove",this._delayedDragTouchMoveHandler),k(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?q(document,"pointermove",this._onTouchMove):q(document,t?"touchmove":"mousemove",this._onTouchMove):(q(se,"dragend",this),q(ce,"dragstart",this._onDragStart));try{document.selection?tt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(ke=!1,ce&&se){ae("dragStarted",this,{evt:t}),this.nativeDraggable&&q(document,"dragover",Ge);var n=this.options;!e&&$(se,n.dragClass,!1),$(se,n.ghostClass,!0),Qe.active=this,e&&this._appendGhost(),oe({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ee){this._lastX=Ee.clientX,this._lastY=Ee.clientY,ze();for(var e=document.elementFromPoint(Ee.clientX,Ee.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ee.clientX,Ee.clientY))!==t;)t=e;if(se.parentNode[K]._isOutsideThisEl(e),t)do{if(t[K]&&t[K]._onDragOver({clientX:Ee.clientX,clientY:Ee.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);Ve()}},_onTouchMove:function(e){if(ye){var t=this.options,n=t.fallbackTolerance,i=t.fallbackOffset,a=e.touches?e.touches[0]:e,o=le&&B(le,!0),s=le&&o&&o.a,r=le&&o&&o.d,l=Xe&&qe&&V(qe),c=(a.clientX-ye.clientX+i.x)/(s||1)+(l?l[0]-Pe[0]:0)/(s||1),d=(a.clientY-ye.clientY+i.y)/(r||1)+(l?l[1]-Pe[1]:0)/(r||1);if(!Qe.active&&!ke){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(le){o?(o.e+=c-(_e||0),o.f+=d-(Se||0)):o={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");R(le,"webkitTransform",u),R(le,"mozTransform",u),R(le,"msTransform",u),R(le,"transform",u),_e=c,Se=d,Ee=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!le){var e=this.options.fallbackOnBody?document.body:ce,t=Y(se,!0,Xe,!0,e),n=this.options;if(Xe){for(qe=e;"static"===R(qe,"position")&&"none"===R(qe,"transform")&&qe!==document;)qe=qe.parentNode;qe!==document.body&&qe!==document.documentElement?(qe===document&&(qe=H()),t.top+=qe.scrollTop,t.left+=qe.scrollLeft):qe=H(),Pe=V(qe)}$(le=se.cloneNode(!0),n.ghostClass,!1),$(le,n.fallbackClass,!0),$(le,n.dragClass,!0),R(le,"transition",""),R(le,"transform",""),R(le,"box-sizing","border-box"),R(le,"margin",0),R(le,"top",t.top),R(le,"left",t.left),R(le,"width",t.width),R(le,"height",t.height),R(le,"opacity","0.8"),R(le,"position",Xe?"absolute":"fixed"),R(le,"zIndex","100000"),R(le,"pointerEvents","none"),Qe.ghost=le,e.appendChild(le),R(le,"transform-origin",xe/parseInt(le.style.width)*100+"% "+Te/parseInt(le.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,i=e.dataTransfer,a=n.options;ae("dragStart",this,{evt:e}),Qe.eventCanceled?this._onDrop():(ae("setupClone",this),Qe.eventCanceled||((pe=Z(se)).removeAttribute("id"),pe.draggable=!1,pe.style["will-change"]="",this._hideClone(),$(pe,this.options.chosenClass,!1),Qe.clone=pe),n.cloneId=tt((function(){ae("clone",n),Qe.eventCanceled||(n.options.removeCloneOnHide||ce.insertBefore(pe,se),n._hideClone(),oe({sortable:n,name:"clone"}))})),!t&&$(se,a.dragClass,!0),t?(Oe=!0,n._loopId=setInterval(n._emulateDragOver,50)):(k(document,"mouseup",n._onDrop),k(document,"touchend",n._onDrop),k(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",a.setData&&a.setData.call(n,i,se)),q(document,"drop",n),R(se,"transform","translateZ(0)")),ke=!0,n._dragStartId=tt(n._dragStarted.bind(n,t,e)),q(document,"selectstart",n),Ce=!0,C&&R(document.body,"user-select","none"))},_onDragOver:function(e){var t,n,i,a,o=this.el,s=e.target,r=this.options,l=r.group,c=Qe.active,d=be===l,u=r.sort,p=we||c,h=this,f=!1;if(!$e){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=I(s,r.draggable,o,!0),q("dragOver"),Qe.eventCanceled)return f;if(se.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||h._ignoreWhileAnimating===s)return O(!1);if(Oe=!1,c&&!r.disabled&&(d?u||(i=re!==ce):we===this||(this.lastPutMode=be.checkPull(this,c,se,e))&&l.checkPut(this,c,se,e))){if(a="vertical"===this._getDirection(e,s),t=Y(se),q("dragOverValid"),Qe.eventCanceled)return f;if(i)return re=ce,k(),this._hideClone(),q("revert"),Qe.eventCanceled||(de?ce.insertBefore(se,de):ce.appendChild(se)),O(!0);var m=W(o,r.draggable);if(!m||function(e,t,n){var i=Y(W(n.el,n.options.draggable));return t?e.clientX>i.right+10||e.clientX<=i.right&&e.clientY>i.bottom&&e.clientX>=i.left:e.clientX>i.right&&e.clientY>i.top||e.clientX<=i.right&&e.clientY>i.bottom+10}(e,a,this)&&!m.animated){if(m===se)return O(!1);if(m&&o===e.target&&(s=m),s&&(n=Y(s)),!1!==Je(ce,o,se,t,s,n,e,!!s))return k(),m&&m.nextSibling?o.insertBefore(se,m.nextSibling):o.appendChild(se),re=o,M(),O(!0)}else if(m&&function(e,t,n){var i=Y(F(n.el,0,n.options,!0));return t?e.clientX<i.left-10||e.clientY<i.top&&e.clientX<i.right:e.clientY<i.top-10||e.clientY<i.bottom&&e.clientX<i.left}(e,a,this)){var g=F(o,0,r,!0);if(g===se)return O(!1);if(n=Y(s=g),!1!==Je(ce,o,se,t,s,n,e,!1))return k(),o.insertBefore(se,g),re=o,M(),O(!0)}else if(s.parentNode===o){n=Y(s);var b,w,y,E=se.parentNode!==o,_=!function(e,t,n){var i=n?e.left:e.top,a=n?e.right:e.bottom,o=n?e.width:e.height,s=n?t.left:t.top,r=n?t.right:t.bottom,l=n?t.width:t.height;return i===s||a===r||i+o/2===s+l/2}(se.animated&&se.toRect||t,s.animated&&s.toRect||n,a),S=a?"top":"left",x=j(s,"top","top")||j(se,"top","top"),T=x?x.scrollTop:void 0;if(Le!==s&&(w=n[S],Ie=!1,Ne=!_&&r.invertSwap||E),b=function(e,t,n,i,a,o,s,r){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,p=!1;if(!s)if(r&&Ae<c*a){if(!Ie&&(1===De?l>d+c*o/2:l<u-c*o/2)&&(Ie=!0),Ie)p=!0;else if(1===De?l<d+Ae:l>u-Ae)return-De}else if(l>d+c*(1-a)/2&&l<u-c*(1-a)/2)return function(e){return z(se)<z(e)?1:-1}(t);return(p=p||s)&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}(e,s,n,a,_?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,Ne,Le===s),0!==b){var C=z(se);do{C-=b,y=re.children[C]}while(y&&("none"===R(y,"display")||y===le))}if(0===b||y===s)return O(!1);Le=s,De=b;var L=s.nextElementSibling,D=!1,A=Je(ce,o,se,t,s,n,e,D=1===b);if(!1!==A)return 1!==A&&-1!==A||(D=1===A),$e=!0,setTimeout(Ke,30),k(),D&&!L?o.appendChild(se):s.parentNode.insertBefore(se,D?L:s),x&&J(x,0,T-x.scrollTop),re=se.parentNode,void 0===w||Ne||(Ae=Math.abs(w-Y(s)[S])),M(),O(!0)}if(o.contains(se))return O(!1)}return!1}function q(r,l){ae(r,h,v({evt:e,isOwner:d,axis:a?"vertical":"horizontal",revert:i,dragRect:t,targetRect:n,canSort:u,fromSortable:p,target:s,completed:O,onMove:function(n,i){return Je(ce,o,se,t,n,Y(n),e,i)},changed:M},l))}function k(){q("dragOverAnimationCapture"),h.captureAnimationState(),h!==p&&p.captureAnimationState()}function O(t){return q("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(h),h!==p&&($(se,we?we.options.ghostClass:c.options.ghostClass,!1),$(se,r.ghostClass,!0)),we!==h&&h!==Qe.active?we=h:h===Qe.active&&we&&(we=null),p===h&&(h._ignoreWhileAnimating=s),h.animateAll((function(){q("dragOverAnimationComplete"),h._ignoreWhileAnimating=null})),h!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(s===se&&!se.animated||s===o&&!s.animated)&&(Le=null),r.dragoverBubble||e.rootEl||s===document||(se.parentNode[K]._isOutsideThisEl(e.target),!t&&Ue(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),f=!0}function M(){me=z(se),ve=z(se,r.draggable),oe({sortable:h,name:"change",toEl:o,newIndex:me,newDraggableIndex:ve,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){k(document,"mousemove",this._onTouchMove),k(document,"touchmove",this._onTouchMove),k(document,"pointermove",this._onTouchMove),k(document,"dragover",Ue),k(document,"mousemove",Ue),k(document,"touchmove",Ue)},_offUpEvents:function(){var e=this.el.ownerDocument;k(e,"mouseup",this._onDrop),k(e,"touchend",this._onDrop),k(e,"pointerup",this._onDrop),k(e,"touchcancel",this._onDrop),k(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;me=z(se),ve=z(se,n.draggable),ae("drop",this,{evt:e}),re=se&&se.parentNode,me=z(se),ve=z(se,n.draggable),Qe.eventCanceled||(ke=!1,Ne=!1,Ie=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),nt(this.cloneId),nt(this._dragStartId),this.nativeDraggable&&(k(document,"drop",this),k(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),C&&R(document.body,"user-select",""),R(se,"transform",""),e&&(Ce&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),le&&le.parentNode&&le.parentNode.removeChild(le),(ce===re||we&&"clone"!==we.lastPutMode)&&pe&&pe.parentNode&&pe.parentNode.removeChild(pe),se&&(this.nativeDraggable&&k(se,"dragend",this),Ze(se),se.style["will-change"]="",Ce&&!ke&&$(se,we?we.options.ghostClass:this.options.ghostClass,!1),$(se,this.options.chosenClass,!1),oe({sortable:this,name:"unchoose",toEl:re,newIndex:null,newDraggableIndex:null,originalEvent:e}),ce!==re?(me>=0&&(oe({rootEl:re,name:"add",toEl:re,fromEl:ce,originalEvent:e}),oe({sortable:this,name:"remove",toEl:re,originalEvent:e}),oe({rootEl:re,name:"sort",toEl:re,fromEl:ce,originalEvent:e}),oe({sortable:this,name:"sort",toEl:re,originalEvent:e})),we&&we.save()):me!==fe&&me>=0&&(oe({sortable:this,name:"update",toEl:re,originalEvent:e}),oe({sortable:this,name:"sort",toEl:re,originalEvent:e})),Qe.active&&(null!=me&&-1!==me||(me=fe,ve=ge),oe({sortable:this,name:"end",toEl:re,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){ae("nulling",this),ce=se=re=le=de=pe=ue=he=ye=Ee=Ce=me=ve=fe=ge=Le=De=we=be=Qe.dragged=Qe.ghost=Qe.clone=Qe.active=null,Re.forEach((function(e){e.checked=!0})),Re.length=_e=Se=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":se&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,i=0,a=n.length,o=this.options;i<a;i++)I(e=n[i],o.draggable,this.el,!1)&&t.push(e.getAttribute(o.dataIdAttr)||et(e));return t},sort:function(e,t){var n={},i=this.el;this.toArray().forEach((function(e,t){var a=i.children[t];I(a,this.options.draggable,i,!1)&&(n[e]=a)}),this),t&&this.captureAnimationState(),e.forEach((function(e){n[e]&&(i.removeChild(n[e]),i.appendChild(n[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return I(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];var i=ne.modifyOption(this,e,t);n[e]=void 0!==i?i:t,"group"===e&&We(n)},destroy:function(){ae("destroy",this);var e=this.el;e[K]=null,k(e,"mousedown",this._onTapStart),k(e,"touchstart",this._onTapStart),k(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(k(e,"dragover",this),k(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Me.splice(Me.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!he){if(ae("hideClone",this),Qe.eventCanceled)return;R(pe,"display","none"),this.options.removeCloneOnHide&&pe.parentNode&&pe.parentNode.removeChild(pe),he=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(he){if(ae("showClone",this),Qe.eventCanceled)return;se.parentNode!=ce||this.options.group.revertClone?de?ce.insertBefore(pe,de):ce.appendChild(pe):ce.insertBefore(pe,se),this.options.group.revertClone&&this.animate(se,pe),R(pe,"display",""),he=!1}}else this._hideClone()}},Be&&q(document,"touchmove",(function(e){(Qe.active||ke)&&e.cancelable&&e.preventDefault()})),Qe.utils={on:q,off:k,css:R,find:X,is:function(e,t){return!!I(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},throttle:Q,closest:I,toggleClass:$,clone:Z,index:z,nextTick:tt,cancelNextTick:nt,detectDirection:Fe,getChild:F},Qe.get=function(e){return e[K]},Qe.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Qe.utils=v(v({},Qe.utils),e.utils)),ne.mount(e)}))},Qe.create=function(e,t){return new Qe(e,t)},Qe.version="1.15.0";var it,at,ot,st,rt,lt,ct=[],dt=!1;function ut(){ct.forEach((function(e){clearInterval(e.pid)})),ct=[]}function pt(){clearInterval(lt)}var ht=Q((function(e,t,n,i){if(t.scroll){var a,o=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,l=t.scrollSpeed,c=H(),d=!1;at!==n&&(at=n,ut(),it=t.scroll,a=t.scrollFn,!0===it&&(it=U(n,!0)));var u=0,p=it;do{var h=p,f=Y(h),m=f.top,g=f.bottom,v=f.left,b=f.right,w=f.width,y=f.height,E=void 0,_=void 0,S=h.scrollWidth,x=h.scrollHeight,T=R(h),C=h.scrollLeft,L=h.scrollTop;h===c?(E=w<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),_=y<x&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(E=w<S&&("auto"===T.overflowX||"scroll"===T.overflowX),_=y<x&&("auto"===T.overflowY||"scroll"===T.overflowY));var D=E&&(Math.abs(b-o)<=r&&C+w<S)-(Math.abs(v-o)<=r&&!!C),A=_&&(Math.abs(g-s)<=r&&L+y<x)-(Math.abs(m-s)<=r&&!!L);if(!ct[u])for(var q=0;q<=u;q++)ct[q]||(ct[q]={});ct[u].vx==D&&ct[u].vy==A&&ct[u].el===h||(ct[u].el=h,ct[u].vx=D,ct[u].vy=A,clearInterval(ct[u].pid),0==D&&0==A||(d=!0,ct[u].pid=setInterval(function(){i&&0===this.layer&&Qe.active._onTouchMove(rt);var t=ct[this.layer].vy?ct[this.layer].vy*l:0,n=ct[this.layer].vx?ct[this.layer].vx*l:0;"function"==typeof a&&"continue"!==a.call(Qe.dragged.parentNode[K],n,t,e,rt,ct[this.layer].el)||J(ct[this.layer].el,n,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=U(p,!1)));dt=d}}),30),ft=function(e){var t=e.originalEvent,n=e.putSortable,i=e.dragEl,a=e.activeSortable,o=e.dispatchSortableEvent,s=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var l=n||a;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);r(),l&&!l.el.contains(d)&&(o("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function mt(){}function gt(){}mt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=F(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(t,i):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:ft},y(mt,{pluginName:"revertOnSpill"}),gt.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:ft},y(gt,{pluginName:"removeOnSpill"}),Qe.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?q(document,"dragover",this._handleAutoScroll):this.options.supportPointer?q(document,"pointermove",this._handleFallbackAutoScroll):t.touches?q(document,"touchmove",this._handleFallbackAutoScroll):q(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?k(document,"dragover",this._handleAutoScroll):(k(document,"pointermove",this._handleFallbackAutoScroll),k(document,"touchmove",this._handleFallbackAutoScroll),k(document,"mousemove",this._handleFallbackAutoScroll)),pt(),ut(),clearTimeout(N),N=void 0},nulling:function(){rt=at=it=dt=lt=ot=st=null,ct.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,i=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(i,a);if(rt=e,t||this.options.forceAutoScrollFallback||x||S||C){ht(e,this.options,o,t);var s=U(o,!0);!dt||lt&&i===ot&&a===st||(lt&&pt(),lt=setInterval((function(){var o=U(document.elementFromPoint(i,a),!0);o!==s&&(s=o,ut()),ht(e,n.options,o,t)}),10),ot=i,st=a)}else{if(!this.options.bubbleScroll||U(o,!0)===H())return void ut();ht(e,this.options,U(o,!1),!1)}}},y(e,{pluginName:"scroll",initializeByDefault:!0})}),Qe.mount(gt,mt);var vt=Qe;function bt(e,t,n){let i=r(e)[0];i&&vt.create(i,{animation:150,onEnd:function(e){let i=e.oldIndex,a=e.newIndex;!async function(e){let i=r(t),a=[].map.call(i,(function(t,n){if(n-1<e)return t})),s=a.map((e=>e.dataset.id));await o(`/adminsc/${n}/sort`,{toChange:s}),a.map(((e,t)=>{r(e).find(".sort").innerText=t+1}))}(i>a?i:a)}})}class wt{constructor(){this.model="opentest"}async create(){let e=wt.serverModel();e.id=0,e.isTest=1;let t=`/${this.model}/updateOrCreate`,n=await o(t,e);n&&(window.location.href=`/adminsc/${model}/edit/${n.id}`)}id(){return id??r(".test-name")[0].dataset.testid}children(){return r(".children").length||!1}async path_create(){let e=wt.serverModel();e.id=0,e.isTest=0;let t=`/adminsc/${model}/create`,n=await o(t,e);n&&(window.location.href=`/adminsc/${model}/edit/${n.id-1}`)}name(){return r(".test-name")[0].innerText}async update(){let e=wt.serverModel(),t=`/adminsc/${e}/update/${e.id}`;await o(t,e)&&(window.location.href=`/adminsc/${e}/edit/${e.id}`)}async del(){if(wt.children())return a.show("Сначала удалите все тесты из папки"),!1;let e=wt.id();(await o("/adminsc/${model}/delete",{id:e})).notAdmin?(a.show("Видимость теста скрыта. Чтобы удалить полностью - обратитесь к ГД"),setTimeout((()=>{window.location=`/adminsc/${model}/edit/400`}),4e3)):window.location=`/adminsc/${model}/edit/400`}}let yt={async create(e){let t=e.closest(".question-edit"),n=t.dataset.id,i=t.querySelectorAll(".answer").length+1,s=(await o("/adminsc/openanswer/updateOrCreate",{openquestion_id:n,sort:i})).arr.html;s?e.insertAdjacentHTML("beforebegin",s):a.show("Сохранено")},async del(e){let t=e.closest(".delete");if(!t)return!1;if(confirm("Удалить этот ответ?")){let e=t.closest(".answer"),n=+e.dataset.answerId;await o("/adminsc/openanswer/delete",{id:n})&&e.remove()}}};class Et{constructor(e){return!!e&&!e.multiple&&(this.title=e.title??"",this.field=e.dataset.field,this.model=e.dataset.model,this.modelId=e.dataset.id,this.options=(t=e.querySelectorAll("option"),[...t].map((e=>({value:e.value,label:e.label,selected:e.selected,element:e})))),this.sel=document.createElement("div"),e.className&&this.sel.classList.add(e.className),this.label=document.createElement("span"),this.arrow=document.createElement("div"),this.space=document.createElement("div"),this.ul=document.createElement("ul"),function(e){let t;e.title&&(e.titleElement=document.createElement("div"),e.titleElement.classList.add("title"),e.titleElement.innerText=e.title,e.sel.append(e.titleElement)),e.sel.setAttribute("custom-select",""),e.sel.dataset.model=e.model,e.sel.dataset.modelId=e.modelId,e.field&&(e.sel.dataset.field=e.field),e.sel.dataset.value=e.selectedOption.value,e.sel.tabIndex=0,e.sel.append(e.label),e.space.classList.add("space"),e.space.innerText=e.selectedOption.label,e.label.append(e.space),e.arrow.classList.add("arrow"),e.label.append(e.arrow),e.ul.classList.add("options"),e.options.forEach((t=>{!function(t){const n=document.createElement("li");n.innerText=t.label,n.dataset.value=t.value,n.classList.toggle("selected",t.selected),n.addEventListener("click",(()=>{e.selectValue(t.value),e.ul.classList.remove("show")})),e.ul.append(n)}(t)})),e.sel.append(e.ul),e.label.addEventListener("click",(()=>{e.ul.classList.toggle("show")})),e.sel.addEventListener("blur",(()=>{e.ul.classList.remove("show")}));let n="";e.sel.addEventListener("keydown",(i=>{switch(i.code){case"Space":e.ul.classList.toggle("show");break;case"ArrowUp":{const t=e.options[e.selectedOptionIndex-1];t&&e.selectValue(t.value);break}case"ArrowDown":{const t=e.options[e.selectedOptionIndex+1];t&&e.selectValue(t.value);break}case"Enter":case"Escape":e.ul.classList.remove("show");break;default:{clearTimeout(t),n+=i.key,t=setTimeout((()=>{n=""}),500);const a=e.options.find((e=>e.label.toLowerCase().startsWith(n)));a&&e.selectValue(a.value)}}}))}(this),e.after(this.sel),void e.remove());var t}get selectedOption(){return this.options.find((e=>e.selected))}get selectedOptionIndex(){return this.options.indexOf(this.selectedOption)}selectValue(e){const t=this.options.find((t=>t.value===e)),n=this.selectedOption;n.selected=!1,t.selected=!0,this.space.innerText=t.label,this.label.closest("[custom-select]").dataset.value=t.value,this.ul.querySelector(`[data-value="${n.value}"]`).classList.remove("selected");const i=this.ul.querySelector(`[data-value="${t.value}"]`);i.classList.add("selected"),i.scrollIntoView({block:"nearest"})}}class _t{constructor(e){this.pClass=e.pClass??"",this.pActiveClass=e.pActiveClass??"",this.pageClass=e.pageClass??"",this.pageActiveClass=e.pageActiveClass??"",this.prevBttnEl=e.prevBttnEl??null,this.nextBttnEl=e.nextBttnEl??null,this.paginations=r(this.pClass),this.activePClass=this.pClass+"."+this.pActiveClass,this.activePageClass="."+this.pageClass+"."+this.pageActiveClass,this.paginations.length&&(this.navInit(),r(this.pClass).on("click",this.handleClick.bind(this)),this.prevBttnEl&&(r(this.prevBttnEl).on("click",this.handleNextPrev.bind(this)),r(this.nextBttnEl).on("click",this.handleNextPrev.bind(this))))}navInit(){[].map.call(this.paginations,(e=>{e.classList.remove(this.pActiveClass)})),this.paginations[0].classList.add(this.pActiveClass)}handleNextPrev(e){let{target:t}=e,n=r(this.activePageClass)[0],i=r(this.activePClass)[0],a=this.paginations.indexOf(i);t===this.prevBttnEl?function(){if(a<1)return!1;let e=this.paginations[a-1];this.togglePage(e,n),this.toggleNav(e,i)}.call(this):t===this.nextBttnEl&&function(){if(a>this.paginations.length-2)return!1;let e=this.paginations[a+1];this.togglePage(e,n),this.toggleNav(e,i)}.call(this)}toggleNav(e,t){t.classList.toggle(this.pActiveClass),e.classList.toggle(this.pActiveClass)}togglePage(e,t){r(`.question[data-id='${e.dataset.pagination}']`)[0].classList.toggle(this.pageActiveClass),t.classList.toggle(this.pageActiveClass)}handleClick(e){let{target:t}=e;if(!t.dataset.pagination)return;if(t.classList.contains(this.pActiveClass))return;let n=r(this.activePClass)[0];n.classList.remove(this.pActiveClass),t.classList.add(this.pActiveClass);let i=n.dataset.pagination;r(`.${this.pageClass}[data-id="${i}"]`).removeClass(this.pageActiveClass);let a=t.dataset.pagination;r(`.${this.pageClass}[data-id="${a}"]`).addClass(this.pageActiveClass)}}function St(){return new _t({pClass:"[data-pagination]",pActiveClass:"active",pageClass:"question",pageActiveClass:"show",prevBttnEl:r("#prev")[0],nextBttnEl:r("#next")[0]})}let xt=r(".opentest-edit-wrapper")[0];if(xt){St(),bt(".opentest-edit-wrapper .questions",".opentest-edit-wrapper .question-edit","openquestion"),r(xt).on("change",(async function(e){let{target:t}=e,n=t.closest(".answer"),i=t.closest(".question-edit__parent-select");n?Tt(n):i&&m.changeParent(t)})),r(xt).on("click",(e=>{let{target:t}=e;const n=new wt;t.classList.contains("test-path__create")?n.path_create():t.classList.contains("test__create")?n.create():t.closest(".question__show-answers")?m.showAnswers(t):t.closest(".question__delete")?m.del(t):t.classList.contains("question__create-button")?m.create(t):t.closest(".delete")?yt.del(t):t.classList.contains("answer__create-button")?yt.create(t):t.classList.contains("led")&&t.classList.toggle("animated")}));let e=t((async function(e){let{target:t}=e;if(t.classList.contains("text")){let e=t.closest(".answer"),n=t.closest(".question-edit");if(e)Tt(e);else if(n){let e=n.dataset.id,i=t.innerText;await o("/adminsc/openquestion/updateOrCreate",{id:e,question:i})}}}));r(xt).on("keyup",e)}async function Tt(e){let t=e.dataset.answerId,n=+e.querySelector("input").checked,i=e.closest(".question-edit").dataset.id,a=e.querySelector(".text").innerText;await o("/adminsc/openanswer/updateOrCreate",{id:t,answer:a,openquestion_id:i,is_correct:n})}let Ct=new class{constructor(){}async saveAnswer(e){let t=e.closest(".question-edit").dataset.id,n=e.closest(".answer"),i=this.getAnswerModel(n,t);await o("/adminsc/answer/updateOrCreate",i)}async del(e){let t=e.closest(".answer"),n=+e.dataset.id;confirm("Удалить?")&&await o("/adminsc/answer/delete",{id:n})&&t.remove()}async answerCreate(e){let t=r(".answer__create .answer")[0],n=e.closest(".question-edit"),i=+n.dataset.id,s=t.cloneNode(!0),l=this.getAnswerModel(s,i),c=await o("/adminsc/answer/updateOrCreate",l);if(c&&(c.arr.popup&&a.show(c.arr.popup),c.arr.id)){let t=n.querySelectorAll(".answer").length+1;s.querySelector(".sort").innerText=t,s.querySelector(".delete").dataset.id=s.dataset.id=c.arr.id,e.before(s)}}getAnswerModel(e,t){return{id:+e.dataset.id,answer:n(r(e).find(".text").innerText),question_id:t,correct_answer:+r(e).find("input").checked,pica:""}}},Lt=new class{constructor(e){this.sort=document.querySelectorAll(".questions>.question-edit").length+1??0}async questionCreate(e){let t=r(".question__create .question-edit")[0].cloneNode(!0),n=this.getQuestionModel(t),i=await o("/adminsc/question/updateOrCreate",n);i&&(t.querySelector(".sort").innerText=r(".question-edit").length,t.querySelector(".question__delete").dataset.id=t.dataset.id=i.arr.id,e.before(t))}getQuestionModel(e){return{id:+e.dataset.id,qustion:n(e.querySelector(".text").innerText),test_id:+window.location.href.split("/").pop(),sort:+r(".question-edit").length}}async changeParent(e){let t=e.closest(".question-edit"),n=t.dataset.id,i=e.options[e.selectedIndex].dataset.questionParentId;await o("/adminsc/question/changeParent",{id:n,test_id:i})&&t.remove()}showAnswers(e){let t=r(e.closest(".question-edit")).find(".question__answers");t.classList.toggle("height"),t.classList.toggle("scale"),e.classList.toggle("rotate")}async del(e){let t=e.dataset.model,n=null;"answer"===t?n=e.closest(".answer"):"question"===t&&(n=e.closest(".question-edit"));let i=+e.dataset.id;confirm("Удалить?")&&await o(`/adminsc/${t}/delete`,{id:i})&&n.remove()}async saveQuestion(e){let t=e.closest(".question-edit"),n=Lt.getQuestionModel(t);await o("/adminsc/question/UpdateOrCreate",n)}};const Dt={viewModel:()=>({id:+window.location.href.split("/").pop(),name:r("#test_name").text(),enable:r("#enable")[0],parent:r("select").selectedIndexValue()}),children:()=>r(".children").length||!1,path_create:async()=>{let e=Dt.serverModel();e.id=0,e.isTest=0;let t=await o("/adminsc/test/updateOrCreate",e);t&&(window.location.href=`/adminsc/test/edit/${t.arr.id}`)},id:e=>e??r(".test-name")[0].dataset.testid,name:()=>r(".test-name")[0].innerText,create:async()=>{let e=Dt.serverModel();e.id=0,e.isTest=1;let t=await o("/test/updateOrCreate",e);t&&(window.location.href=`/adminsc/test/edit/${t.arr.id}`)},serverModel:()=>{let e=!!+window.location.href.split("/").pop();e=e||0;let t={id:e,name:r("#name.field")[0].value,isTest:+r("[isTest]")[0].getAttribute("isTest")},n=r("[custom-select]");return[].forEach.call(n,(function(e){t[e.dataset.field]=e.dataset.id})),t},update:async()=>{let e=Dt.serverModel(),t=`/adminsc/test/update/${e.id}`;await o(t,e)&&(window.location.href=`/adminsc/test/edit/${e.id}`)},delete:async function(){if(Dt.children())return a.show("Сначала удалите все тесты из папки"),!1;let e=Dt.id();(await o("/adminsc/test/delete",{id:e})).notAdmin?(a.show("Видимость теста скрыта. Чтобы удалить полностью - обратитесь к ГД"),setTimeout((()=>{window.location="/adminsc/test/edit/400"}),4e3)):window.location="/adminsc/test/edit/400"}};function At(e){let{target:t}=e;t.classList.contains("test-path__update")||t.classList.contains("test__update")||t.classList.contains("test__save")?Dt.update():t.classList.contains("test__delete")?Dt.delete():t.classList.contains("test-path__create")?Dt.path_create():t.classList.contains("test__create")?Dt.create():t.closest(".question__show-answers")?Lt.showAnswers(t):t.classList.contains("question__create-button")?Lt.questionCreate(t):t.closest(".question__delete")?Lt.del(t):t.closest(".delete")?Ct.del(t):t.classList.contains("answer__create-button")?Ct.answerCreate(t):t.classList.contains("correct")&&Ct.saveAnswer(t)}let qt=t((async function(e){let{target:t}=e;t.classList.contains("text")&&(t.closest(".answer")?Ct.saveAnswer(t):Lt.saveQuestion(t))}));async function kt(e){let{target:t}=e;t.closest(".question-edit__parent-select")&&Lt.changeParent(t)}St();let Ot=r(".test-do .content")[0];function Mt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=r(e);[].forEach.call(n,(function(e){e.ondragenter=function(e){return e.preventDefault(),this.classList.toggle("hover"),!1},e.ondragleave=function(e){return e.preventDefault(),this.classList.toggle("hover"),!1},e.ondragover=function(e){return e.preventDefault(),!1},e.ondrop=function(e){e.preventDefault(),t(e.dataTransfer.files)}}))}Ot&&(r(".question").removeClass("show"),r(".question:first-child").addClass("show"),function(){let e=r(".test-do__finish-btn")[0];e&&window.location.pathname.match("^/test/result/.?")&&e.classList.add("inactive")}(),Ot.addEventListener("click",(function(e){let{target:t}=e,n=r(".question.show")[0]??"",a=+(null==n?void 0:n.dataset.id)??"",s=r("[data-pagination]")??"",l=s.findIndex((e=>e.classList.contains("active")))??"";function c(e,t){r(`[data-pagination="${e}"]`)[0].classList.toggle("active"),r(`[data-pagination="${t}"]`)[0].classList.toggle("active")}function d(e){n.classList.toggle("show"),r(`.question[data-id="${e}"]`)[0].classList.toggle("show")}"checkbox"===t.type?t.labels[0].classList.toggle("pushed"):"prev"===t.id?function(){if(l<1)return!1;let e=+s[l-1].dataset.pagination;c(a,e),d(e)}():"next"===t.id?function(){if(l===s.length-1)return!1;let e=+s[l+1].dataset.pagination;c(a,e),d(e)}():t.classList.contains("test-do__finish-btn")&&async function(e){if("ПРОЙТИ ТЕСТ ЗАНОВО"===e.innerText)return void location.reload();e.innerText="ПРОЙТИ ТЕСТ ЗАНОВО",e.classList.add("inactive"),function(e){let t=r(".question");[].map.call(t,(t=>{let n=function(e,t){let n=e.querySelectorAll(".a"),i=[];return[].map.call(n,(e=>{let n=r(e).find("input"),a=function(e,t,n,i){let a=-1!==t.indexOf(e),o=n.checked,s=!1;return o&&a?i.classList.add("done"):o&&!a?s=!0:!o&&a&&(i.classList.add("done"),s=!0),s}(e.dataset.id,t,n,e);a&&i.push(!0)})),i}(t,e);!function(e,t){let n=r(`.pagination [data-pagination='${+e.dataset.id}']`)[0];t.length?r(n).addClass("redShadow"):r(n).addClass("greenShadow")}(t,n)}))}((await o("/adminsc/test/getCorrectAnswers",{})).arr);let t=(n=r(".redShadow").length,{questionCnt:r(".question").length,errorCnt:n,html:i(".test-do"),testid:r("[data-test-id]")[0].dataset.testId,testname:r(".test-name")[0].innerText,user:r(".user-menu .fio")[0].innerText});var n;await o("/adminsc/testresult/create",t)&&(e.href=location.href,e.innerText="ПРОЙТИ ТЕСТ ЗАНОВО")}(t)}))),St();let It=r(".opentest-do")[0];It&&(function(){let e=r(".question")[0];e&&e.classList.add("show")}(),r(It).on("click",(async function(e){let{target:t}=e,n=t.dataset.id;r(".question.show")[0],"finish"===t.id&&async function(e){if("ПРОЙТИ ТЕСТ ЗАНОВО"===e.innerText)return void location.reload();let t=function(e){let t=0;return[].forEach.call(e,(e=>{let n=e.id,i=r(`.question[data-id='${n}']`)[0],a=r(i).find(".textarea");if(!e.Openanswer)return;let o="";e.Openanswer.forEach((e=>{o+=`(${e.answer})?`})),t+=function(e,t,n){let i=t.innerHTML,a=new RegExp(e,"g"),o=i.match(a),s=0;return o.forEach((e=>{if(!e)return;s=1;let i=new RegExp(e,"g"),a="<span style='color:limegreen;'>"+e+"</span>";t.innerHTML=t.innerHTML.replace(i,a),function(e){let t=r(`[data-pagination="${e}"]`);t&&t.css("backgroundColor","green")}(n)})),s}(`${o}`,a,n)})),t}((await o("/adminsc/opentestresult/getanswers",{id:n})).arr),a=(s=t,r(".buttons")[0].remove(),{id:n,questionCnt:r("[data-pagination]").length,html:i(".test"),testname:r(".test-name")[0].innerText,username:r(".user-menu .fio")[0].innerText,rightAnswers:s});var s;await o("/adminsc/opentestresult/finish",a)&&(e.innerText="ПРОЙТИ ТЕСТ ЗАНОВО",e.classList.add("inactive"))}(t)})),r(It).on("keyup",(function(e){let{target:t}=e;if(t.classList.contains("textarea")){let e=r("[data-pagination].active")[0];t.innerText?e.classList.add("filled"):e.classList.remove("filled")}}))),r(document).ready((function(){var e;f(),e=window.location.pathname,/\/adminsc\/settings/.test(e)||/\/adminsc\/right\/list/.test(e)||/\/adminsc\/post\/list/.test(e)||/\/adminsc\/todo\/list/.test(e)?(r(".rights-table").on("click",(function(e){let{target:t}=e;function n(e){let t=r(`[data-id='${e.dataset.id??"new"}']`),n={toServ:{},empty:{}};return t.map((e=>{e.classList.contains("id")?(n.id=e,n.toServ.id=e.dataset.id):e.classList.contains("name")?(n.name=e,n.toServ.name=e.innerText.trim()):e.classList.contains("description")?(n.description=e,n.toServ.description=e.innerText.trim()):e.classList.contains("save.svg")?n.save=e:e.classList.contains("del")&&(n.del=e)})),n.empty.del=n.id.previousElementSibling.cloneNode(!0),n.empty.save=n.id.previousElementSibling.previousElementSibling.cloneNode(!0),n.empty.description=n.id.previousElementSibling.previousElementSibling.previousElementSibling.cloneNode(!0),n.empty.name=n.id.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.cloneNode(!0),n.empty.id=n.id.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.cloneNode(!0),n}t.closest(".del")&&function(e){let t=n(e);"new"!==t.toServ.id&&confirm("Удалить право?")&&(function(e){e.id.remove(),e.name.remove(),e.description.remove(),e.save.remove(),e.del.remove()}(t),async function(e){await o("/right/delete",{id:e.toServ.id})}(t))}(t.closest(".del")),t.closest(".save")&&function(e){let t=n(e);if("new"!==t.toServ.id)!async function(e){await o("/right/update",e)}(t.toServ);else{if(!t.toServ.name||!t.toServ.description)return!1;!async function(e){let t=await o("/right/create",e.toServ);t.arr.id&&(function(e,t){e.empty.id.dataset.id=t,e.empty.id.innerText=t,e.empty.name.dataset.id=t,e.empty.name.innerText=e.name.innerText.trim(),e.empty.description.dataset.id=t,e.empty.description.innerText=e.description.innerText.trim(),e.empty.save.dataset.id=t,e.empty.del.dataset.id=t}(e,t.id-1),function(e){let t=r(".id[data-id='new']")[0];t.before(e.empty.id),t.before(e.empty.name),t.before(e.empty.description),t.before(e.empty.save),t.before(e.empty.del)}(e),function(e){e.name.innerText="",e.description.innerText=""}(e),a.show("Сохранено"))}(t)}}(t.closest(".save"))})),r("[settings]").addClass("current")):/\/auth\/profile/.test(e)?function(){let e=r('[data-model="user"]')[0];if(e){r(e).on("click",(async function(e){let{target:t}=e;if(t.closest("#save")){let e=a(r(".user-item")[0]);await o("/adminsc/user/update",e)}else if(t.classList.contains("right")){let e=r("input.right:checked"),n="";[].map.call(e,(function(e){let t=e.previousElementSibling.innerText;n+=t+","})),t.closest("[data-tab]").dataset.value=n}})),t();let n=r("[data-field='rights']")[0];r(n).on("click",t)}function t(){let e=n().replace(/,$/,"");r("[data-field='rights']")[0].dataset.value=e}function n(){let e=r(".right:checked"),t="";return[].map.call(e,(e=>{let n=e.previousElementSibling.innerText+",";t+=n}),t),t}function i(){const e=r("#conf option");for(let t of e)if(t.selected)return t.value;return"0"}function a(e){return{id:r(e).find("#id").innerText,name:r(e).find("#name").innerText,surName:r(e).find("#s-name").innerText,middleName:r(e).find("#m-name").innerText,birthDate:r(e).find("#bday").innerText,phone:r(e).find("#phone").innerText,email:r(e).find("#email").innerText,hired:r(e).find("#hired").innerText,fired:r(e).find("#fired").innerText,confirm:i(),sex:void 0,rights:n()}}}():/\/adminsc\/crm/.test(e)?r("[crm]").addClass("current"):/\/adminsc\/planning/.test(e)?r("[plan]").addClass("current"):/\/test/.test(e)||/\/opentest/.test(e)||/\/adminsc\/opentest/.test(e)||/\/adminsc\/test/.test(e)?r("[test]").addClass("current"):r("[href='/adminsc']").addClass("current"),function(){let e=r("[custom-radio]");[].map.call(e,(function(e){r(e).on("click",(function(t){let{target:n}=t,i=n.closest("label");e.dataset.value=i.dataset.value}))}))}(),function(){let e=r("[multi-select] ");e&&[].forEach.call(e,(function(e){e.addEventListener("click",(function(e){let{target:t}=e,n=t.closest("[multi-select]");if(t.closest(".arrow")||["chip-wrap"].includes(t.className))n.querySelector("ul").classList.toggle("show");else if(["view.components.Builders.ListBuilder.del"].includes(t.className))!function(e){r(n).find(`label[data-id='${e}']`).classList.remove("selected")}(t.closest(".chip").dataset.id),t.closest(".chip").remove();else if("label"===t.tagName.toLowerCase()){let e=t.dataset.id,i=n.querySelectorAll(".chip"),a=[].some.call(i,(t=>t.dataset.id===e)),o=r(n).find(".chip-wrap");if(a)t.classList.toggle("selected"),o.querySelector(`[data-id='${e}']`).remove();else{t.classList.toggle("selected");let n=function(e){let n=document.createElement("div");n.classList.add("chip"),n.innerText=t.innerText,n.dataset.id=e;let i=document.createElement("div");return i.classList.add("view.components.Builders.ListBuilder.del"),i.innerText="X",n.append(i),n}(e);o.append(n)}}}),!1),e.addEventListener("blur",(function(e){let{target:t}=e,n=r(this).find(".show");n&&n.classList.remove("show")}),!1)}))}(),function(){let e=r(".item_wrap")[0];if(e){r(e).on("click",(async function(t){let{target:i}=t,a=e,s=a.dataset.model;i.closest(".save")?async function(e){if(function(){let e=r("[required]"),t=0;return[].forEach.call(e,(function(e){if(!e.innerText){if(e.style.borderColor="red",r(e).find(".error"))return;let n=document.createElement("div");n.innerText="Заполните поле",n.classList.add("error"),e.closest(".value").appendChild(n),t++}})),t}())return!1;let t=function(e){let t=r(`[data-field][data-model='${e}']`),i={};return[].map.call(t,(e=>{if(e.closest("[data-parent]"))return i;if(e.hasAttribute("data-value")||e.hasAttribute("custom-select")||e.hasAttribute("custom-radio")||e.hasAttribute("tab"))i[e.dataset.field]=e.dataset.value;else if(e.hasAttribute("multi-select")){let t=e.querySelectorAll(".chip"),n=[].map.call(t,(e=>e.dataset.id));i[e.dataset.field]=n.toString()}else"inputs"===e.dataset.type?i[e.dataset.field]=function(e){let t=e.querySelectorAll("input"),n=[];return t.forEach((e=>{if(!e.checked)return;let t=e.parentNode.querySelector(".name").innerText;t&&n.push(t)})),n.join(",")}(e):"date"===e.type?i[e.dataset.field]=e.value:i[e.dataset.field]=n(e.innerText)}),i),i}(e);await o(`/adminsc/${e}/updateorcreate`,t)}(s):i.closest(".del")&&i.closest(".del").dataset.model?async function(e,t){let n=e.dataset.id;await o(`/adminsc/${t}/delete`,{id:n})&&(window.location.href=`/adminsc/${t}/edit`)}(a,i.closest(".del").dataset.model):i.classList.contains("tab")&&async function(e){r("[data-tab].show")[0].classList.toggle("show"),r(`[data-tab='${e.dataset.tabId}']`)[0].classList.toggle("show"),r(".tab.active")[0].classList.toggle("active"),e.classList.toggle("active")}(i)}));let t=r("[custom-select]");t&&[].map.call(t,(function(e){new Et(e)}))}}(),document.addEventListener("mouseenter",(function(e){let{target:t}=e;if(!t.dataset||!t.dataset.tooltip)return;let n=t.dataset.tooltip,i=document.createElement("div");i.className="tooltip",i.innerHTML=n,document.body.append(i);let a=t.getBoundingClientRect(),o=a.left+(t.offsetWidth-i.offsetWidth)/2;o<0&&(o=0);let s=a.top-i.offsetHeight-5;s<0&&(s=a.top+t.offsetHeight+5),i.style.left=o+"px",i.style.top=s+"px"}),!0),document.addEventListener("mouseleave",(function(){let e=document.querySelectorAll(".tooltip");e&&[].forEach.call(e,(e=>{e.remove()}))}),!0),function(){if(r("[tiny]")){let e=document.createElement("script");e.src="https://cdn.tiny.cloud/1/vmwh6wx8yqbbpeqrkm691ltxy7bx3x90ez9iqlop0mt9uqwl/tinymce/6/tinymce.min.js",e.onload=function(){tinymce.init({skin_url:"/public/src/components/tiny",selector:"#mytextarea",toolbar_mode:"floating",preview_styles:"font-size color",statusbar:!1,menubar:!1,init_instance_callback:function(e){},height:100,content_style:"p{margin:2px 0} body { font-family:Helvetica,Arial,sans-serif; font-size:12px }",plugins:["autoresize","a11ychecker","advlist","advcode","advtable","autolink","checklist","export","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","powerpaste","fullscreen","formatpainter","insertdatetime","media","table","help","wordcount"],toolbar:"save |undo redo | formatpainter casechange blocks | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist checklist outdent indent | removeformat | a11ycheck code table help"})},e.setAttribute("referrerpolicy","origin"),r("head")[0].appendChild(e)}}(),function(){let e=r("[data-testid]")[0];if(e){e=+e.dataset.testid;let t=r(".test-edit.accordion a");Array.from(t).filter((t=>{+t.dataset.id===e&&t.classList.add("current")}))}let t=r(".accordion-open")[0];t&&r(t).on("click",(function(){r(".accordion_wrap")[0].classList.toggle("open")}));let n=r("#burger")[0];n&&r(n).on("click",(function(){r(".admin_sidebar")[0].classList.toggle("open")}))}(),function(){St();let e=r(".test-edit-wrapper")[0];e&&(bt(".test-edit-wrapper .questions",".questions>.question-edit","question"),r(e).on("keyup",qt),r(e).on("change",kt),r(e).on("click",At))}(),function(){if(!r(".item_wrap[data-model='product']")[0])return!1;let e=r(".item_wrap")[0].dataset.id;r("#producttiny")[0].onsubmit=function(){tinymce.activeEditor.setProgressState(!0),tinymce.triggerSave(),setTimeout((async()=>{let t=tinymce.activeEditor.getContent();await o("/adminsc/product/adddescription",{description:t,id:e})&&tinymce.activeEditor.setProgressState(!1,1e3)}),1e3)};let t=r("[data-model='product'] [custom-select][data-model=\"property\"]");t&&[].map.call(t,(function(e){new MutationObserver((function(e){e.forEach((function(e){o("/adminsc/product/setProperty",{propertable_id:r(".item_wrap")[0].dataset.id,property_id:e.target.dataset.modelId,val_id:e.target.dataset.value})}))})).observe(e,{attributes:!0})}));let n=r(".images");async function i(t,n,i){let o=new FormData;o.append(t,n,n.name),o.append("imageable_id",e);let s=await fetch(i,{method:"POST",body:o}),r=await s.json(),l=await r.arr.id;return r.arr.popup&&a.show(r.arr.popup),l}function s(e,t,n,i){let a=new FileReader;a.readAsDataURL(e),a.onload=function(e){let{target:a}=e,o=new Image;o.src=a.result;let s=document.createElement("div"),r=document.createElement("div");r.classList.add("del"),r.dataset.id=n,r.dataset.tag=i,r.innerText="x",s.classList.add("image"),s.appendChild(o),s.appendChild(r),t.appendChild(s)}.bind()}async function l(e,t,n,o){for(let l=0;l<=o.length-1;l++){if(r=o[l],!["image/png","image/jpeg","image/jpg","image/webp","image/gif"].includes(r.type)&&(a.show(`Тип файлa ${r.name} должен быть jpg, jpeg, png, webp, gif`),1))continue;let c=await i(l,o[l],t);c&&s(o[l],e,c,n)}var r}[].forEach.call(n,(function(t){r(t).on("click",(async function(t){let{target:n}=t;if(n.classList.contains("del")){let t=n.closest(".image").querySelector("img"),i=n.closest(".image").querySelector(".del"),a=n.dataset.id,s=n.dataset.tag;"ok"===(await o("/adminsc/product/"+s,{productId:e,id:a})).popup&&(t.remove(),i.remove())}}))}));let c=r(".image_main .images")[0],d="/adminsc/product/addMainImage",u="delMainImage";Mt(".add_main_image",async function(e,t,n,a){let o=await i(0,a[0],t);o&&(e.querySelector(".image").remove(),s(a[0],e,o,n))}.bind(null,c,d,u)),c=r(".detail_images .images")[0],d="/adminsc/product/addDetailImages",u="delDetailImage",Mt(".add_detail_image",l.bind(null,c,d,u)),c=r(".small_pack_images .images")[0],d="/adminsc/product/addSmallPackImage",u="delSmallPackImages",Mt(".add_small_pack_images",l.bind(null,c,d,u)),c=r(".big_pack_images .images")[0],d="/adminsc/product/addBigPackImage",u="delBigPackImages",Mt(".add_big_pack_image",l.bind(null,c,d,u))}()}))}();
//# sourceMappingURL=admin.js.map