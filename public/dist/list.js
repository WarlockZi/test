(()=>{"use strict";var e={6584:(e,t,s)=>{s.d(t,{$:()=>o,sg:()=>n,bE:()=>r}),new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",minimumFractionDigits:2});const n=(e,t=700)=>{let s;return function(){clearTimeout(s),s=setTimeout((()=>e.apply(this,arguments)),t)}};let a={show:function(e,t){let s=this.el("div","popup__close");s.innerText="X";let n=this.el("div","popup__item");n.innerText=e,n.append(s);let a=o(".popup")[0];a||(a=this.el("div","popup")),a.append(n),a.addEventListener("click",this.close,!0),document.body.append(a),setTimeout((()=>{n.classList.remove("popup__item"),n.classList.add("popup-hide")}),5e3),setTimeout((()=>{n.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let s=document.createElement(e);return s.classList.add(t),s}};async function r(e,t={}){return new Promise((async function(s,n){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?r.send(t):(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("param="+JSON.stringify(t))),r.onerror=function(e){n(Error("Network Error"+e.message))},r.onload=function(){try{if(!function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(r.response))return void console.log(r.response);const e=JSON.parse(r.response);let t=o(".message")[0];e?.popup||e?.arr?.popup?a.show(e.popup??e?.arr?.popup):e.msg?t&&(t.innerHTML=e.msg,o(t).removeClass("success"),o(t).removeClass("error")):e.success?t&&(t.innerHTML=e.success,o(t).addClass("success"),o(t).removeClass("error")):e.error&&(t.innerHTML=e.error,o(t).addClass("error"),o(t).removeClass("success"),function(e){let t=o(".adm-content")[0];if(!t)return;let s=document.createElement("div");s.classList.add("message"),s.classList.add("error"),s.innerText=e,t.prepend(s),setTimeout(function(){s.style.scale=0,setTimeout(function(){s.remove()}.bind(this),500)}.bind(this),3e3)}(e.error)),s(e)}catch(e){return console.log("////////////********* REQUEST ERROR ***********//////////////////////"),console.log(r.response),!1}}}))}class i extends Array{on(e,t,s){"function"==typeof t?this.forEach((s=>s.addEventListener(e,t))):this[0].querySelectorAll(t).forEach((t=>{t.addEventListener(e,s)}))}value=function(){return this[0].getAttribute("value")};first=function(){return this[0]};attr=function(e,t){return t&&this[0].setAttribute(e,t),this[0].getAttribute(e)};selectedIndexValue=function(){if(this.length)return this[0].selectedOptions[0].value};options=function(){if(this.length)return this[0].options};count=function(){return this.length};text=function(){if(this.length)return this[0].innerText};checked=function(){if(this.length)return this[0].checked};getWithStyle=function(e,t){let s=[];return this.forEach((n=>{n.style[e]===t&&s.push(n)})),s};addClass=function(e){this.forEach((t=>{t.classList.add(e)}))};removeClass=function(e){this.forEach((t=>{t.classList.remove(e)}))};hasClass=function(e){if(this.classList.contains(e))return!0};append=function(e){this[0].appendChild(e)};find=function(e){return"string"==typeof e?this[0].querySelector(e):this[0].filter((t=>t===e))[0]};findAll=function(e){if("string"==typeof e)return this[0].querySelectorAll(e)};css=function(e,t){if(!t)return this[0].style[e];this.forEach((s=>{s.style[e]=t}))};ready(e){this.some((e=>null!=e.readyState&&"loading"!=e.readyState))?e():document.addEventListener("DOMContentLoaded",e)}}function o(e){return"string"==typeof e||e instanceof String?new i(...document.querySelectorAll(e)):new i(e)}}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=s(6584);class t{constructor(e){let t=e.parentNode;this._morph={},this._morph.relation=t.dataset.morphRelation,this._morph.oneormany=t.dataset.morphOneormany,this._morph.slug=t.dataset.morphSlug,this._morph.path=e.dataset.path??""}get morph(){return this._morph}set morph(e){this._morph=e}}function n(e){return new t(e).morph}class a{constructor(t){this.table=t,this.model=t.dataset.model,this.contenteditable=(0,e.$)("[contenteditable]"),this.headers=t.querySelectorAll(".head"),this.hidden=t.querySelectorAll("[hidden]"),this.sortables=t.querySelectorAll("[data-sort]"),this.inputs=(0,e.$)(t).findAll(".head input"),this.ids=this.getIds(),this.modelName=t.dataset.model??null,this.rows=this.fillRows(),this.WSSelects=(0,e.$)("[custom-select]"),[].forEach.call(this.WSSelects,(e=>{e.onchange=this.customSelectChange})),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=(0,e.sg)(this.handleInput),this.directions=Array.from(this.sortables).map((function(e){return""}))}async customSelectChange({target:t}){let s=t.closest("[data-model]");if(!s)return!1;let n=s.dataset.model,a=s.dataset.id,r=s.dataset.field,i=`/adminsc/${n}/updateOrCreate`,o=t.options.selectedIndex,l=t.options[o].value,d={[r]:l,id:a};await(0,e.bE)(i,d)}getIds(){let t=(0,e.$)(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,(function(e){return"0"!==e.dataset.id}))}handlePaste(e){e.target.innerText=e.clipboardData.getData("text/plain"),this.handleInput(this.table,this.contenteditable,e.target),e.target.innerText=""}handleKeyUp(e){let t=e.target;if(e.cancelBubble=!0,t.hasAttribute("contenteditable"))this.debouncedInput(this.table,this.contenteditable,t);else if(t.closest(".head")){let e=t.closest(".head"),s=[].findIndex.call(this.headers,((t,s,n)=>t===e));this.search(s,t)}}handleClick(t){let s=t.target;if("add-model"===s.className)modelCreate(s);else if(".del:not(.head)"===s.className||s.closest(".del:not(.head)"))this.modelDel(s.closest(".del:not(.head)"));else if("edit:not(.head)"===s.className||s.closest(".edit:not(.head)"))t.preventDefault(),this.edit(s);else if("checkbox"===s.type){const t=s.dataset.func,n={base_is_shippable:s.checked,product_1s_id:s.dataset["1sid"]};(0,e.bE)(`/adminsc/${this.model}/${t}`,n)}else if(s.classList.contains("head")||s.classList.contains("icon")){let e=s.closest(".head");if(e.hasAttribute("data-sort")){let t=[].findIndex.call(sortables,((t,s,n)=>t===e));sortColumn(t)}}}edit(e){let t=e.closest("[custom-list]").dataset.model,s=e.dataset.id;window.location=`/adminsc/${t}/edit/${s}`}async modelDel(t){if(!confirm("Удалить?"))return;let s=t.dataset.id;await(0,e.bE)(`/adminsc/${modelName}/delete`,{id:s})&&delView(s)}delView(t){let s=(0,e.$)(`[data-id='${t}']`);[].forEach.call(s,(function(e){e.remove()}))}createRelation(e,t,s){let n=t.closest(".item-wrap");return e.model=n.dataset.model,e.id=n.dataset.id,e.relation=s,e}createMorph(e,t,s){let a=t.closest(".item-wrap");return e.model=a.dataset.model,e.id=a.dataset.id,e.morph=new n(t),e}async modelCreate(t){let s={};s.model=t.closest("[custom-list]").dataset.model,s.id=0;let n=table.dataset.relation;n&&(s=createRelation(s,table,n)),table.parentNode.dataset.morphRelation&&(s=createMorph(s,table,n));let a=await(0,e.bE)(`/adminsc/${s.model}/updateOrCreate`,s);a.arr.id&&newrow(a.arr.id)}newrow(t){[].forEach.call(hidden,(function(s){let n=s.cloneNode(!0);n.removeAttribute("hidden"),(0,e.$)(table).find(".custom-list").appendChild(n),["id"].includes(n.dataset.field)?n.innerText=t:["del","edit","save"].includes(n.className)||n.hasChildNodes("select")||(n.innerText=""),n.dataset.id=t}))}showAllRows(){[].forEach.call(this.rows,(e=>{[].forEach.call(e,(e=>{e.style.display="flex"}))}))}search(e,t){this.showAllRows();const s=t.value;[].forEach.call(this.inputs,(e=>{e!==t&&(e.value="")})),[].forEach.call(this.rows,(function(t){const n=t[e].innerText,a=new RegExp(`${s}`,"gi");n.match(a)||[].forEach.call(t,(e=>{e.style.display="none"}))}))}fillRows(){let t=[];for(let s=0;s<this.ids.length;s++){let n=this.ids[s].dataset.id,a=(0,e.$)(this.table)[0].querySelectorAll(`[data-id='${n}']`);t.push(a)}return t}sortColumn(e){let t=this.fillRows();const s=this.directions[e]||"asc",n="asc"===s?1:-1,a=Array.from(t);a.sort((function(t,s){const a=t[e].innerHTML,r=s[e].innerHTML,i=transform(e,a),o=transform(e,r);switch(!0){case i>o:return 1*n;case i<o:return-1*n;case i===o:return 0}})),[].forEach.call(t,(function(e){[].forEach.call(e,(e=>{e.remove()}))})),directions[e]="asc"===s?"desc":"asc",a.forEach((function(e){(e=Array.from(e)).reverse(),[].forEach.call(e,(e=>{headers[headers.length-1].after(e)}))}))}transform(e,t){if(sortables[e])return"number"===sortables[e].getAttribute("data-type")?parseFloat(t):t}handleInput(e,t,s){if(!s.hasAttribute("contenteditable"))return!1;let n=makeServerModel(s,modelName);save(n)}async save(t){let s=`/adminsc/${t.modelName}/updateOrCreate`;await(0,e.bE)(s,t.model)}makeServerModel(e,t){e.closest("[custom-list]").dataset.model,e.dataset.id;let s=e.dataset.field;return{model:{id:e.dataset.id,[s]:e.innerText},modelName:t}}}const r=(0,e.$)("[custom-list]");r&&[].forEach.call(r,(function(e){new a(e)}))})()})();
//# sourceMappingURL=list.js.map