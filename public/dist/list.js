!function(){"use strict";function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let e={show:function(t,e){let n=this.el("div","popup__close");n.innerText="X";let i=this.el("div","popup__item");i.innerText=t,i.append(n);let a=s(".popup")[0];a||(a=this.el("div","popup")),a.append(i),a.addEventListener("click",this.close,!0),document.body.append(a),setTimeout((()=>{i.classList.remove("popup__item"),i.classList.add("popup-hide")}),5e3),setTimeout((()=>{i.remove(),e&&e()}),5950)},close:function(t){t.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(t,e){let n=document.createElement(t);return n.classList.add(e),n}};async function n(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((async function(i,a){n.token=document.querySelector('meta[name="token"]').getAttribute("content");let r=new XMLHttpRequest;r.open("POST",t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),n instanceof FormData?r.send(n):(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("param="+JSON.stringify(n))),r.onerror=function(t){a(Error("Network Error"+t))},r.onload=function(){var t;let n=JSON.parse(r.response),a=s(".message")[0];var o;n.popup||null!=n&&null!==(t=n.arr)&&void 0!==t&&t.popup?e.show(n.popup??(null==n||null===(o=n.arr)||void 0===o?void 0:o.popup)):n.msg?a&&(a.innerHTML=n.msg,a.innerHTML=n.msg,s(a).removeClass("success"),s(a).removeClass("error")):n.success?a&&(a.innerHTML=n.success,s(a).addClass("success"),s(a).removeClass("error")):n.error&&a&&(a.innerHTML="",a.innerHTML=n.error,s(a).removeClass("success"),s(a).addClass("error")),i(n)}}))}class i extends Array{constructor(){super(...arguments),t(this,"value",(function(){return this[0].getAttribute("value")})),t(this,"attr",(function(t,e){return e&&this[0].setAttribute(t,e),this[0].getAttribute(t)})),t(this,"selectedIndexValue",(function(){if(this.length)return this[0].selectedOptions[0].value})),t(this,"options",(function(){if(this.length)return this[0].options})),t(this,"count",(function(){return this.length})),t(this,"text",(function(){if(this.length)return this[0].innerText})),t(this,"checked",(function(){if(this.length)return this[0].checked})),t(this,"getWithStyle",(function(t,e){let n=[];return this.forEach((i=>{i.style[t]===e&&n.push(i)})),n})),t(this,"addClass",(function(t){this.forEach((e=>{e.classList.add(t)}))})),t(this,"removeClass",(function(t){this.forEach((e=>{e.classList.remove(t)}))})),t(this,"hasClass",(function(t){if(this.classList.contains(t))return!0})),t(this,"append",(function(t){this[0].appendChild(t)})),t(this,"find",(function(t){return"string"==typeof t?this[0].querySelector(t):this[0].filter((e=>e===t))[0]})),t(this,"findAll",(function(t){if("string"==typeof t)return this[0].querySelectorAll(t)})),t(this,"css",(function(t,e){if(!e)return this[0].style[t];this.forEach((n=>{n.style[t]=e}))}))}on(t,e,n){"function"==typeof e?this.forEach((n=>n.addEventListener(t,e))):this.forEach((i=>{i.addEventListener(t,(t=>{t.target===e&&n(t)}))}))}ready(t){this.some((t=>null!=t.readyState&&"loading"!=t.readyState))?t():document.addEventListener("DOMContentLoaded",t)}}function s(t){return"string"==typeof t||t instanceof String?new i(...document.querySelectorAll(t)):new i(t)}const a=s(".custom-list__wrapper");a&&[].forEach.call(a,(function(t){const e=s("[contenteditable]"),i=t.querySelectorAll(".head"),a=t.querySelectorAll("[hidden]"),r=t.querySelectorAll("[data-sort]"),o=s(t).findAll(".head input"),l=function(){let e=s(t)[0].querySelectorAll("[data-id]");return[].filter.call(e,(function(t){return"0"!==t.dataset.id}))}(),c=t.dataset.model,d=t.dataset.parent??null,u=t.dataset.parentid??null,f=t.dataset.morph??null,h=t.dataset.morphid??null,p=g();s(t).on("click",function(t){let e=t.target;if("add-model"===e.className)!async function(t,e,i,s,a){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o={};e&&(o={[e+"_id"]:+i}),s&&(o={morph_type:s,morph_id:a}),o.id=r;let l=await n(`/adminsc/${t}/updateOrCreate`,o);l.arr.id&&y(l.arr.id)}(c,d,u,f,h,0);else if(".del:not(.head)"===e.className||e.closest(".del:not(.head)"))!async function(t){if(!confirm("Удалить?"))return;let e=t.dataset.id;await n(`/adminsc/${c}/delete`,{id:e})&&function(t){let e=s(`[data-id='${t}']`);[].forEach.call(e,(function(t){t.remove()}))}(e)}(e.closest(".del:not(.head)"));else if(".edit:not(.head)"===e.className||e.closest(".edit:not(.head)"))t.preventDefault(),function(t,e){let n=t.closest(".edit:not(.head)").dataset.id;window.location=`/adminsc/${e}/edit/${n}`}(e,c);else if(e.classList.contains("head")||e.classList.contains("icon")){let t=e.closest(".head");t.hasAttribute("data-sort")&&function(t){let e=g();const n=v[t]||"asc",s="asc"===n?1:-1,a=Array.from(e);a.sort((function(e,n){const i=e[t].innerHTML,a=n[t].innerHTML,r=E(t,i),o=E(t,a);switch(!0){case r>o:return 1*s;case r<o:return-1*s;case r===o:return 0}})),[].forEach.call(e,(function(t){[].forEach.call(t,(t=>{t.remove()}))})),v[t]="asc"===n?"desc":"asc",a.forEach((function(t){(t=Array.from(t)).reverse(),[].forEach.call(t,(t=>{i[i.length-1].after(t)}))}))}([].findIndex.call(r,((e,n,i)=>e===t)))}}.bind(this)),s(t).on("keyup",function(n){let{target:s}=n;if(s.hasAttribute("contenteditable"))m(t,e,s);else if(s.closest(".head")){let t=s.closest(".head");!function(t,e){[].forEach.call(p,(t=>{[].forEach.call(t,(t=>{t.style.display="flex"}))}));const n=e.value;[].forEach.call(o,(t=>{t!==e&&(t.value="")})),[].forEach.call(p,(function(e){const i=e[t].innerText,s=new RegExp(`${n}`,"gi");i.match(s)||[].forEach.call(e,(t=>{t.style.display="none"}))}))}([].findIndex.call(i,((e,n,i)=>e===t)),s)}}.bind(this)),s(t).on("paste",function(t){let e=t.clipboardData.getData("text/plain");t.target.innerText=e,L(0,0,t.target),t.target.innerText=""}.bind(this));let m=function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:700;return function(){const i=()=>t.apply(this,arguments);clearTimeout(e),e=setTimeout(i,n)}}(L);function y(e){let n=[...a];[].forEach.call(n,(function(n){let i=n.cloneNode(!0);i.removeAttribute("hidden"),s(t).find(".custom-list").appendChild(i),["id"].includes(i.dataset.field)?i.innerText=e:["del","edit","save"].includes(i.className)||(i.innerText=""),i.dataset.id=e}))}function g(){let e=[];for(let n=0;n<l.length;n++){let i=l[n].dataset.id,a=s(t)[0].querySelectorAll(`[data-id='${i}']`);e.push(a)}return e}const v=Array.from(r).map((function(t){return""}));function E(t,e){if(r[t])return"number"===r[t].getAttribute("data-type")?parseFloat(e):e}function L(t,e,i){if(!i.hasAttribute("contenteditable"))return!1;!async function(t){let e=`/adminsc/${t.modelName}/updateOrCreate`;await n(e,t.model)}(b(i,c))}function b(e,n){let i=e.dataset.field,s=t.dataset.parent+"_id",a=t.dataset.parentid,r={model:{id:e.dataset.id,[i]:e.innerText},modelName:n};return s&&(r.model[s]=a),r}}))}();
//# sourceMappingURL=list.js.map