!function(){"use strict";var t={317:function(t,e,n){n.d(e,{$:function(){return l},Ds:function(){return o},v_:function(){return a}});var s=n(546);const o=function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:700;return function(){clearTimeout(e),e=setTimeout((()=>t.apply(this,arguments)),n)}};let r={show:function(t,e){let n=this.el("div","popup__close");n.innerText="X";let s=this.el("div","popup__item");s.innerText=t,s.append(n);let o=l(".popup")[0];o||(o=this.el("div","popup")),o.append(s),o.addEventListener("click",this.close,!0),document.body.append(o),setTimeout((()=>{s.classList.remove("popup__item"),s.classList.add("popup-hide")}),5e3),setTimeout((()=>{s.remove(),e&&e()}),5950)},close:function(t){t.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(t,e){let n=document.createElement(t);return n.classList.add(e),n}};async function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((async function(n,o){e.token=document.querySelector('meta[name="token"]').getAttribute("content");let a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),e instanceof FormData?a.send(e):(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("param="+JSON.stringify(e))),a.onerror=function(t){o(Error("Network Error"+t.message))},a.onload=function(){try{if(!function(t){try{JSON.parse(t)}catch(t){return!1}return!0}(a.response))return void console.log(a.response);const t=JSON.parse(a.response);let e=l(".message")[0];t?.popup||t?.arr?.popup?r.show(t.popup??t?.arr?.popup):t.msg?e&&(e.innerHTML=t.msg,l(e).removeClass("success"),l(e).removeClass("error")):t.success?e&&(e.innerHTML=t.success,l(e).addClass("success"),l(e).removeClass("error")):t.error&&(e.innerHTML=t.error,l(e).addClass("error"),l(e).removeClass("success"),(0,s.Z)(t.error)),n(t)}catch(t){return console.log("////////////********* REQUEST ERROR ***********//////////////////////"),console.log(a.response),!1}}}))}class i extends Array{on(t,e,n){"function"==typeof e?this.forEach((n=>n.addEventListener(t,e))):this[0].querySelectorAll(e).forEach((e=>{e.addEventListener(t,n)}))}value=function(){return this[0].getAttribute("value")};first=function(){return this[0]};attr=function(t,e){return e&&this[0].setAttribute(t,e),this[0].getAttribute(t)};selectedIndexValue=function(){if(this.length)return this[0].selectedOptions[0].value};options=function(){if(this.length)return this[0].options};count=function(){return this.length};text=function(){if(this.length)return this[0].innerText};checked=function(){if(this.length)return this[0].checked};getWithStyle=function(t,e){let n=[];return this.forEach((s=>{s.style[t]===e&&n.push(s)})),n};addClass=function(t){this.forEach((e=>{e.classList.add(t)}))};removeClass=function(t){this.forEach((e=>{e.classList.remove(t)}))};hasClass=function(t){if(this.classList.contains(t))return!0};append=function(t){this[0].appendChild(t)};find=function(t){return"string"==typeof t?this[0].querySelector(t):this[0].filter((e=>e===t))[0]};findAll=function(t){if("string"==typeof t)return this[0].querySelectorAll(t)};css=function(t,e){if(!e)return this[0].style[t];this.forEach((n=>{n.style[t]=e}))};ready(t){this.some((t=>null!=t.readyState&&"loading"!=t.readyState))?t():document.addEventListener("DOMContentLoaded",t)}}function l(t){return"string"==typeof t||t instanceof String?new i(...document.querySelectorAll(t)):new i(t)}},546:function(t,e,n){n.d(e,{Z:function(){return o}});var s=n(317);function o(t){let e=(0,s.$)(".adm-content")[0];if(!e)return;let n=document.createElement("div");n.classList.add("message"),n.classList.add("error"),n.innerText=t,e.prepend(n),setTimeout(function(){n.style.scale=0,setTimeout(function(){n.remove()}.bind(this),500)}.bind(this),3e3)}}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,n),r.exports}n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t=n(317);class e{constructor(t){let e=t.parentNode;this._morph={},this._morph.relation=e.dataset.morphRelation,this._morph.oneormany=e.dataset.morphOneormany,this._morph.slug=e.dataset.morphSlug,this._morph.path=t.dataset.path??""}get morph(){return this._morph}set morph(t){this._morph=t}}function s(t){return new e(t).morph}const o=(0,t.$)("[custom-list]");o&&[].forEach.call(o,(function(e){const n=(0,t.$)("[contenteditable]"),o=e.querySelectorAll(".head"),r=e.querySelectorAll("[hidden]"),a=e.querySelectorAll("[data-sort]"),i=(0,t.$)(e).findAll(".head input"),l=function(){let n=(0,t.$)(e)[0].querySelectorAll("[data-id]");return[].filter.call(n,(function(t){return"0"!==t.dataset.id}))}(),c=e.dataset.model??null,d=p(),u=(0,t.$)("[custom-select]");async function f(e){let{target:n}=e,s=n.closest("[data-model]"),o=s.dataset.model,r=s.dataset.id,a=s.dataset.field,i=`/adminsc/${o}/updateOrCreate`,l=n.options.selectedIndex,c={[a]:n.options[l].value,id:r};await(0,t.v_)(i,c)}[].forEach.call(u,(t=>{t.onchange=f})),(0,t.$)(e).on("click",function(n){let i=n.target;if("add-model"===i.className)!async function(n){let o={};o.model=n.closest("[custom-list]").dataset.model,o.id=0;let a=e.dataset.relation;a&&(o=function(t,e,n){let s=e.closest(".item-wrap");return t.model=s.dataset.model,t.id=s.dataset.id,t.relation=n,t}(o,e,a)),e.parentNode.dataset.morphRelation&&(o=function(t,e,n){let o=e.closest(".item-wrap");return t.model=o.dataset.model,t.id=o.dataset.id,t.morph=new s(e),t}(o,e));let i=await(0,t.v_)(`/adminsc/${o.model}/updateOrCreate`,o);var l;i.arr.id&&(l=i.arr.id,[].forEach.call(r,(function(n){let s=n.cloneNode(!0);s.removeAttribute("hidden"),(0,t.$)(e).find(".custom-list").appendChild(s),["id"].includes(s.dataset.field)?s.innerText=l:["del","edit","save"].includes(s.className)||s.hasChildNodes("select")||(s.innerText=""),s.dataset.id=l})))}(i);else if(".del:not(.head)"===i.className||i.closest(".del:not(.head)"))!async function(e){if(!confirm("Удалить?"))return;let n=e.dataset.id;await(0,t.v_)(`/adminsc/${c}/delete`,{id:n})&&function(e){let n=(0,t.$)(`[data-id='${e}']`);[].forEach.call(n,(function(t){t.remove()}))}(n)}(i.closest(".del:not(.head)"));else if("edit:not(.head)"===i.className||i.closest(".edit:not(.head)"))n.preventDefault(),function(t){let e=t.closest("[custom-list]").dataset.model,n=t.dataset.id;window.location=`/adminsc/${e}/edit/${n}`}(i);else if(i.classList.contains("head")||i.classList.contains("icon")){let t=i.closest(".head");t.hasAttribute("data-sort")&&function(t){let e=p();const n=m[t]||"asc",s="asc"===n?1:-1,r=Array.from(e);r.sort((function(e,n){const o=e[t].innerHTML,r=n[t].innerHTML,a=y(t,o),i=y(t,r);switch(!0){case a>i:return 1*s;case a<i:return-1*s;case a===i:return 0}})),[].forEach.call(e,(function(t){[].forEach.call(t,(t=>{t.remove()}))})),m[t]="asc"===n?"desc":"asc",r.forEach((function(t){(t=Array.from(t)).reverse(),[].forEach.call(t,(t=>{o[o.length-1].after(t)}))}))}([].findIndex.call(a,((e,n,s)=>e===t)))}}.bind(this)),(0,t.$)(e).on("keyup",function(t){let s=t.target;if(t.cancelBubble=!0,s.hasAttribute("contenteditable"))h(e,n,s);else if(s.closest(".head")){let t=s.closest(".head");!function(t,e){[].forEach.call(d,(t=>{[].forEach.call(t,(t=>{t.style.display="flex"}))}));const n=e.value;[].forEach.call(i,(t=>{t!==e&&(t.value="")})),[].forEach.call(d,(function(e){const s=e[t].innerText,o=new RegExp(`${n}`,"gi");s.match(o)||[].forEach.call(e,(t=>{t.style.display="none"}))}))}([].findIndex.call(o,((e,n,s)=>e===t)),s)}}.bind(this)),(0,t.$)(e).on("paste",function(t){t.target.innerText=t.clipboardData.getData("text/plain"),v(0,0,t.target),t.target.innerText=""}.bind(this));let h=(0,t.Ds)(v);function p(){let n=[];for(let s=0;s<l.length;s++){let o=l[s].dataset.id,r=(0,t.$)(e)[0].querySelectorAll(`[data-id='${o}']`);n.push(r)}return n}const m=Array.from(a).map((function(t){return""}));function y(t,e){if(a[t])return"number"===a[t].getAttribute("data-type")?parseFloat(e):e}function v(e,n,s){if(!s.hasAttribute("contenteditable"))return!1;let o=function(t,e){t.closest("[custom-list]").dataset.model,t.dataset.id;let n=t.dataset.field;return{model:{id:t.dataset.id,[n]:t.innerText},modelName:e}}(s,c);!async function(e){let n=`/adminsc/${e.modelName}/updateOrCreate`;await(0,t.v_)(n,e.model)}(o)}}))}()}();
//# sourceMappingURL=list.js.map