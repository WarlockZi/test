(()=>{"use strict";var e={448:(e,t,s)=>{s.d(t,{$:()=>l,bE:()=>i,sg:()=>n});var a=s(869);new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",minimumFractionDigits:2});const n=(e,t=700)=>{let s;return function(){clearTimeout(s),s=setTimeout((()=>e.apply(this,arguments)),t)}};let r={show:function(e,t){let s=this.el("div","popup__close");s.innerText="X";let a=this.el("div","popup__item");a.innerText=e,a.append(s);let n=l(".popup")[0];n||(n=this.el("div","popup")),n.append(a),n.addEventListener("click",this.close,!0),document.body.append(n),setTimeout((()=>{a.classList.remove("popup__item"),a.classList.add("popup-hide")}),5e3),setTimeout((()=>{a.remove(),t&&t()}),5950)},close:function(e){e.target.classList.contains("popup__close")&&this.closest(".popup").remove()},el:function(e,t){let s=document.createElement(e);return s.classList.add(t),s}};async function i(e,t={}){return new Promise((async function(s,n){t.token=document.querySelector('meta[name="token"]').getAttribute("content");let i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?i.send(t):(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send("param="+JSON.stringify(t))),i.onerror=function(e){n(Error("Network Error"+e.message))},i.onload=function(){try{if(!function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(i.response))return void console.log(i.response);const e=JSON.parse(i.response);let t=l(".message")[0];e?.popup||e?.arr?.popup?r.show(e.popup??e?.arr?.popup):e.msg?t&&(t.innerHTML=e.msg,l(t).removeClass("success"),l(t).removeClass("error")):e.success?t&&(t.innerHTML=e.success,l(t).addClass("success"),l(t).removeClass("error")):e.error&&(t.innerHTML=e.error,l(t).addClass("error"),l(t).removeClass("success"),(0,a.A)(e.error)),s(e)}catch(e){return console.log("////////////********* REQUEST ERROR ***********//////////////////////"),console.log(i.response),!1}}}))}class o extends Array{on(e,t,s){"function"==typeof t?this.forEach((s=>s.addEventListener(e,t))):this[0].querySelectorAll(t).forEach((t=>{t.addEventListener(e,s)}))}value=function(){return this[0].getAttribute("value")};first=function(){return this[0]};attr=function(e,t){return t&&this[0].setAttribute(e,t),this[0].getAttribute(e)};selectedIndexValue=function(){if(this.length)return this[0].selectedOptions[0].value};options=function(){if(this.length)return this[0].options};count=function(){return this.length};text=function(){if(this.length)return this[0].innerText};checked=function(){if(this.length)return this[0].checked};getWithStyle=function(e,t){let s=[];return this.forEach((a=>{a.style[e]===t&&s.push(a)})),s};addClass=function(e){this.forEach((t=>{t.classList.add(e)}))};removeClass=function(e){this.forEach((t=>{t.classList.remove(e)}))};hasClass=function(e){if(this.classList.contains(e))return!0};append=function(e){this[0].appendChild(e)};find=function(e){return"string"==typeof e?this[0].querySelector(e):this[0].filter((t=>t===e))[0]};findAll=function(e){if("string"==typeof e)return this[0].querySelectorAll(e)};css=function(e,t){if(!t)return this[0].style[e];this.forEach((s=>{s.style[e]=t}))};ready(e){this.some((e=>null!=e.readyState&&"loading"!=e.readyState))?e():document.addEventListener("DOMContentLoaded",e)}}function l(e){return"string"==typeof e||e instanceof String?new o(...document.querySelectorAll(e)):new o(e)}},869:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(448);function n(e){let t=(0,a.$)(".adm-content")[0];if(!t)return;let s=document.createElement("div");s.classList.add("message"),s.classList.add("error"),s.innerText=e,t.prepend(s),setTimeout(function(){s.style.scale=0,setTimeout(function(){s.remove()}.bind(this),500)}.bind(this),3e3)}}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=s(448);class t{constructor(e){let t=e.parentNode;this._morph={},this._morph.relation=t.dataset.morphRelation,this._morph.oneormany=t.dataset.morphOneormany,this._morph.slug=t.dataset.morphSlug,this._morph.path=e.dataset.path??""}get morph(){return this._morph}set morph(e){this._morph=e}}function a(e){return new t(e).morph}class n{constructor(t){this.table=t,this.model=t.dataset.model,this.contenteditable=(0,e.$)("[contenteditable]"),this.headers=t.querySelectorAll(".head"),this.hidden=t.querySelectorAll("[hidden]"),this.sortables=t.querySelectorAll("[data-sort]"),this.inputs=(0,e.$)(t).findAll(".head input"),this.ids=this.getIds(),this.modelName=t.dataset.model??null,this.rows=this.fillRows(),this.WSSelects=(0,e.$)("[custom-select]"),[].forEach.call(this.WSSelects,(e=>{e.onchange=this.customSelectChange})),this.table.addEventListener("click",this.handleClick.bind(this)),this.table.addEventListener("keyup",this.handleKeyUp.bind(this)),this.table.addEventListener("paste",this.handlePaste.bind(this)),this.debouncedInput=(0,e.sg)(this.handleInput),this.directions=Array.from(this.sortables).map((function(e){return""}))}async customSelectChange({target:t}){let s=t.closest("[data-model]"),a=s.dataset.model,n=s.dataset.id,r=s.dataset.field,i=`/adminsc/${a}/updateOrCreate`,o=t.options.selectedIndex,l=t.options[o].value,d={[r]:l,id:n};await(0,e.bE)(i,d)}getIds(){let t=(0,e.$)(this.table)[0].querySelectorAll("[data-id]");return[].filter.call(t,(function(e){return"0"!==e.dataset.id}))}handlePaste(e){e.target.innerText=e.clipboardData.getData("text/plain"),this.handleInput(this.table,this.contenteditable,e.target),e.target.innerText=""}handleKeyUp(e){let t=e.target;if(e.cancelBubble=!0,t.hasAttribute("contenteditable"))this.debouncedInput(this.table,this.contenteditable,t);else if(t.closest(".head")){let e=t.closest(".head"),s=[].findIndex.call(this.headers,((t,s,a)=>t===e));this.search(s,t)}}handleClick(t){let s=t.target;if("add-model"===s.className)modelCreate(s);else if(".del:not(.head)"===s.className||s.closest(".del:not(.head)"))this.modelDel(s.closest(".del:not(.head)"));else if("edit:not(.head)"===s.className||s.closest(".edit:not(.head)"))t.preventDefault(),this.edit(s);else if("checkbox"===s.type){const t=s.dataset.func,a={base_is_shippable:s.checked,product_1s_id:s.dataset["1sid"]};(0,e.bE)(`/adminsc/${this.model}/${t}`,a)}else if(s.classList.contains("head")||s.classList.contains("icon")){let e=s.closest(".head");if(e.hasAttribute("data-sort")){let t=[].findIndex.call(sortables,((t,s,a)=>t===e));sortColumn(t)}}}edit(e){let t=e.closest("[custom-list]").dataset.model,s=e.dataset.id;window.location=`/adminsc/${t}/edit/${s}`}async modelDel(t){if(!confirm("Удалить?"))return;let s=t.dataset.id;await(0,e.bE)(`/adminsc/${modelName}/delete`,{id:s})&&delView(s)}delView(t){let s=(0,e.$)(`[data-id='${t}']`);[].forEach.call(s,(function(e){e.remove()}))}createRelation(e,t,s){let a=t.closest(".item-wrap");return e.model=a.dataset.model,e.id=a.dataset.id,e.relation=s,e}createMorph(e,t,s){let n=t.closest(".item-wrap");return e.model=n.dataset.model,e.id=n.dataset.id,e.morph=new a(t),e}async modelCreate(t){let s={};s.model=t.closest("[custom-list]").dataset.model,s.id=0;let a=table.dataset.relation;a&&(s=createRelation(s,table,a)),table.parentNode.dataset.morphRelation&&(s=createMorph(s,table,a));let n=await(0,e.bE)(`/adminsc/${s.model}/updateOrCreate`,s);n.arr.id&&newrow(n.arr.id)}newrow(t){[].forEach.call(hidden,(function(s){let a=s.cloneNode(!0);a.removeAttribute("hidden"),(0,e.$)(table).find(".custom-list").appendChild(a),["id"].includes(a.dataset.field)?a.innerText=t:["del","edit","save"].includes(a.className)||a.hasChildNodes("select")||(a.innerText=""),a.dataset.id=t}))}showAllRows(){[].forEach.call(this.rows,(e=>{[].forEach.call(e,(e=>{e.style.display="flex"}))}))}search(e,t){this.showAllRows();const s=t.value;[].forEach.call(this.inputs,(e=>{e!==t&&(e.value="")})),[].forEach.call(this.rows,(function(t){const a=t[e].innerText,n=new RegExp(`${s}`,"gi");a.match(n)||[].forEach.call(t,(e=>{e.style.display="none"}))}))}fillRows(){let t=[];for(let s=0;s<this.ids.length;s++){let a=this.ids[s].dataset.id,n=(0,e.$)(this.table)[0].querySelectorAll(`[data-id='${a}']`);t.push(n)}return t}sortColumn(e){let t=this.fillRows();const s=this.directions[e]||"asc",a="asc"===s?1:-1,n=Array.from(t);n.sort((function(t,s){const n=t[e].innerHTML,r=s[e].innerHTML,i=transform(e,n),o=transform(e,r);switch(!0){case i>o:return 1*a;case i<o:return-1*a;case i===o:return 0}})),[].forEach.call(t,(function(e){[].forEach.call(e,(e=>{e.remove()}))})),directions[e]="asc"===s?"desc":"asc",n.forEach((function(e){(e=Array.from(e)).reverse(),[].forEach.call(e,(e=>{headers[headers.length-1].after(e)}))}))}transform(e,t){if(sortables[e])return"number"===sortables[e].getAttribute("data-type")?parseFloat(t):t}handleInput(e,t,s){if(!s.hasAttribute("contenteditable"))return!1;let a=makeServerModel(s,modelName);save(a)}async save(t){let s=`/adminsc/${t.modelName}/updateOrCreate`;await(0,e.bE)(s,t.model)}makeServerModel(e,t){e.closest("[custom-list]").dataset.model,e.dataset.id;let s=e.dataset.field;return{model:{id:e.dataset.id,[s]:e.innerText},modelName:t}}}const r=(0,e.$)("[custom-list]");r&&[].forEach.call(r,(function(e){new n(e)}))})()})();
//# sourceMappingURL=list.js.map