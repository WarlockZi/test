{"version":3,"file":"712.js","mappings":"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","sources":["webpack://my-webpack-project/./public/src/Category/category.js","webpack://my-webpack-project/./public/src/share/shippable/shippableUnitsTable.js"],"sourcesContent":["import {ael, d, qa, qs} from '../constants';\r\nimport shippableTable from \"../share/shippable/shippableUnitsTable\";\r\n\r\nexport default class Category {\r\n    constructor() {\r\n        this.category = document[qs]('.category');\r\n        if (!this.category) return false;\r\n        this.mapShippableTables()\r\n        this.category[ael]('click', this.handleClick.bind(this))\r\n    }\r\n\r\n    handleClick({target}) {\r\n        if (target.classList.contains('.blue-button')){\r\n            const table = target.closest('[shipable-table]')\r\n            const firstRow = table[qs]('.unit-row')\r\n        }\r\n    }\r\n\r\n\r\n    mapShippableTables() {\r\n        [...this.category[qa]('.shippable-table')]\r\n            .forEach((table) => {\r\n                new shippableTable(table)\r\n            })\r\n    }\r\n\r\n}\r\n\r\n","import \"./shippableTable.scss\";\r\nimport {getToken, isAuthed, post} from \"../../common\";\r\nimport {ael, qs, qa} from '../../constants';\r\n\r\n\r\nexport default class shippableTable {\r\n    constructor(target) {\r\n        if (!target) return false\r\n        this.target = target\r\n\r\n        this.table = target.closest('[shippable-table]')\r\n        this.table[ael]('click', this.handleClick.bind(this))\r\n\r\n        this.blueButton = this.table[qs]('.blue-button')\r\n\r\n        this.greenButtonWrap = this.table[qs]('.green-button-wrap') ?? false\r\n        this.price = +this.table.dataset.price\r\n        this.sid = this.table.dataset['1sid']\r\n        this.total = this.table[qs]('[data-total]')\r\n        this.setFormatter()\r\n        this.showButtons()\r\n        this.renderSums()\r\n    }\r\n\r\n    showButtons() {\r\n        if (!this.blueButton || !this.greenButtonWrap) return false\r\n        if (this.getTotalCount()) {\r\n            this.blueButton.style.display = 'none'\r\n            this.greenButtonWrap.style.display = 'flex'\r\n        } else {\r\n            this.blueButton.style.display = 'flex'\r\n            this.greenButtonWrap.style.display = 'none'\r\n        }\r\n    }\r\n\r\n    handleClick({target}) {\r\n        const targ = target ?? this.target\r\n        if (targ.classList.contains('blue-button')) {\r\n            this.showGreenButton(targ)\r\n        } else if (targ.classList.contains('green-button')) {\r\n            window.location.href = '/cart'\r\n        } else if (targ.classList.contains('plus')) {\r\n            const row = targ.closest('.unit-row')\r\n            this.increment(row)\r\n        } else if (targ.classList.contains('minus')) {\r\n            const row = targ.closest('.unit-row')\r\n            this.decrement(row)\r\n        } else if (targ.classList.contains('input')) {\r\n            const row = targ.closest('.unit-row')\r\n            this.handleChange(row)\r\n        }\r\n        return this\r\n    }\r\n\r\n    increment(row) {\r\n        row[qs]('input').value++\r\n        row.dataset.rowSum = '' + row[qs]('input').value\r\n        this.handleChange(row)\r\n    }\r\n\r\n    decrement(row) {\r\n        const input = row[qs]('input')\r\n        const count = +input.value\r\n        if (count < 2) {\r\n            input.value = ''\r\n        } else {\r\n            input.value--\r\n            row.dataset.rowSum = input.value\r\n        }\r\n        this.handleChange(row)\r\n    }\r\n\r\n    getTotalCount() {\r\n        return [...this.table[qa]('input')].reduce((acc, el) => {\r\n            return acc + (+el.value)\r\n        }, 0)\r\n    }\r\n\r\n    handleChange(row) {\r\n        const count = this.getTotalCount(row)\r\n        this.renderSums()\r\n        if (count === 0) {\r\n            this.showBlueButton()\r\n        } else {\r\n            this.toServer(this.dto(row))\r\n        }\r\n    }\r\n\r\n    renderSums() {\r\n        let total = [...this.table[qa]('.unit-row')].reduce((acc, row, i) => {\r\n            const rowDto = this.rowDto(row)\r\n            let sub_sum = +this.price * +rowDto.multiplier * +rowDto.count\r\n            if (rowDto.sub_sum)\r\n                rowDto.sub_sum.innerText = this.formatter.format(sub_sum)\r\n            return acc + sub_sum\r\n        }, 0)\r\n\r\n        if (this.total) {\r\n            this.total.innerText = this.formatter.format(total)\r\n        }\r\n    }\r\n\r\n    showBlueButton() {\r\n        if (!this.blueButton) return false\r\n        if (!this.getTotalCount()) {\r\n            this.greenButtonWrap.style.display = 'none'\r\n            this.greenButtonWrap[qs]('input').value = '' + 0\r\n            this.blueButton.style.display = 'flex'\r\n            this.deleteOrderItems(this.tableDTO(this.table))\r\n        }\r\n    }\r\n\r\n\r\n    showGreenButton() {\r\n        if (!this.greenButtonWrap) return false\r\n        this.greenButtonWrap.style.display = 'flex'\r\n        const count = +this.greenButtonWrap[qs]('input').value\r\n        this.greenButtonWrap[qs]('input').value = count ? count : 1\r\n        this.blueButton.style.display = 'none'\r\n        this.toServer(this.dto(this.greenButtonWrap[qs]('[unit-row]')))\r\n    }\r\n\r\n    getUrl() {\r\n        if (isAuthed()) {\r\n            return '/adminsc/order'\r\n        }\r\n        return '/adminsc/orderitem'\r\n    }\r\n\r\n    deleteOrderItems(tableDTO) {\r\n        const url = `${this.getUrl()}/delete`\r\n        post(url, tableDTO)\r\n    }\r\n\r\n    async toServer(dto) {\r\n        const url = `${this.getUrl()}/updateOrCreate`\r\n        const res = await post(url, dto)\r\n    }\r\n\r\n    setFormatter() {\r\n        this.formatter = new Intl.NumberFormat(\"ru\", {\r\n            style: \"currency\",\r\n            currency: \"RUB\",\r\n            minimumFractionDigits: 2\r\n        });\r\n    }\r\n\r\n\r\n    rowDto(row) {\r\n        return {\r\n            count: row[qs]('input').value,\r\n            multiplier: row.dataset.multiplier,\r\n            sub_sum: row[qs]('.sub-sum'),\r\n        }\r\n    }\r\n\r\n    tableDTO(table) {\r\n        return {\r\n            unit_ids: this.unitIds(table),\r\n            product_id: this.sid,\r\n        }\r\n    }\r\n\r\n    unitIds(table) {\r\n        return [...table[qa]('[unit-row]')].map((unitRow) => {\r\n            return unitRow.dataset.unitid\r\n        })\r\n    }\r\n\r\n    dto(row) {\r\n        return {\r\n            count: row[qs]('input').value,\r\n            unit_id: row.dataset.unitid,\r\n            product_id: this.sid,\r\n        }\r\n    }\r\n\r\n}\r\n\r\n"],"names":["Category","constructor","this","category","document","qs","mapShippableTables","ael","handleClick","bind","_ref","target","classList","contains","closest","qa","forEach","table","shippableTable","blueButton","greenButtonWrap","price","dataset","sid","total","setFormatter","showButtons","renderSums","getTotalCount","style","display","targ","showGreenButton","window","location","href","row","increment","decrement","handleChange","value","rowSum","input","reduce","acc","el","count","showBlueButton","toServer","dto","i","rowDto","sub_sum","multiplier","innerText","formatter","format","deleteOrderItems","tableDTO","getUrl","isAuthed","url","post","Intl","NumberFormat","currency","minimumFractionDigits","unit_ids","unitIds","product_id","map","unitRow","unitid","unit_id"],"sourceRoot":""}