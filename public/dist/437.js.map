{"version":3,"file":"437.js","mappings":"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","sources":["webpack://my-webpack-project/./public/src/Promotions/Promotion.js","webpack://my-webpack-project/./public/src/components/select/SelectNew.js"],"sourcesContent":["import './promotion.scss'\r\nimport {$, post} from '../common'\r\nimport SelectNew from \"../components/select/SelectNew\";\r\n\r\nexport default class Promotion {\r\n  constructor() {\r\n    this.$promotion = $('.promotion-edit').first();\r\n    if (!this.$promotion) return;\r\n\r\n    this.id = $(this.$promotion).find(`[data-field='id']`).innerText;\r\n\r\n    this.$activeTill = $(`[data-field='active-till']`).first();\r\n    this.$activeTill.onchange = this.activetillChanged.bind(this);\r\n\r\n    this.$unit = $('[select-new].unit').first();\r\n    let unit = new SelectNew(this.$unit);\r\n    const u = $(`[data-field=\"unit\"]`).first()\r\n    u.addEventListener('customSelect.changed', this.unitChanged.bind(this));\r\n  }\r\n\r\n  unitChanged(customEvent) {\r\n    let data = this.dto(this);\r\n    data.unit_id= customEvent.detail.next.value;\r\n    let res = post('/adminsc/promotion/updateOrCreate', data);\r\n\r\n  }\r\n\r\n  activetillChanged({target}) {\r\n    let data = this.dto(this);\r\n    data.active_till = target.value;\r\n    let res = post('/adminsc/promotion/updateOrCreate', data);\r\n    if (res) {\r\n    }\r\n  }\r\n\r\n  dto(self) {\r\n    return {\r\n      id: self.id\r\n    }\r\n  }\r\n\r\n\r\n}","import './SelectNew.scss'\r\n\r\nimport {createElement, post} from \"../../common\";\r\n\r\nexport default class Select {\r\n\r\n  constructor(el) {\r\n    if (!el) return;\r\n\r\n    this.options = getFormattedOptions(el.querySelectorAll(\"option\"));\r\n\r\n    this.sel = (new createElement())\r\n      .tag(\"div\")\r\n      .className(el?.className)\r\n      .field(el.dataset.field)\r\n      .attr(\"select-new\", '')\r\n      .attr(\"data-value\", this?.selectedOption?.value ?? '')\r\n      .attr('tabindex', '0').get();\r\n\r\n    el.after(this.sel);\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.sel.append(this.label);\r\n\r\n    this.space = (new createElement()).tag(\"div\").attr('class', \"space\").text(this?.selectedOption?.label).get();\r\n    this.label.append(this.space);\r\n\r\n    this.arrow = (new createElement()).tag(\"div\").attr('class', \"arrow\").get();\r\n    this.label.append(this.arrow);\r\n\r\n    this.ul = (new createElement()).tag(\"ul\").attr('class', \"options\").get();\r\n\r\n    this.options.forEach(option => {\r\n      setOption(option, this)\r\n    });\r\n\r\n    this.sel.append(this.ul);\r\n\r\n    this.label.onclick = () => this.ul.classList.toggle(\"show\");\r\n    this.sel.onblur = () => this.ul.classList.remove(\"show\");\r\n    this.sel.onkeydown = this.keyDownhandler;\r\n\r\n    el.remove()\r\n  }\r\n\r\n  onchange(callback) {\r\n    this.callback = callback\r\n  }\r\n\r\n  keyDownhandler(e) {\r\n    let debounceTimeout;\r\n    let searchTerm = \"\";\r\n\r\n    if (e.code === \"Space\") {\r\n      select.ul.classList.toggle(\"show\");\r\n    } else if (e.code === \"ArrowUp\") {\r\n      const prevOption = select.options[select.selectedOptionIndex - 1];\r\n      if (prevOption) {\r\n        select.selectValue(prevOption.value)\r\n      }\r\n    } else if (e.code === \"ArrowDown\") {\r\n      const nextOption = select.options[select.selectedOptionIndex + 1];\r\n      if (nextOption) {\r\n        select.selectValue(nextOption.value)\r\n      }\r\n    } else if (e.code === \"Enter\" || e.code === \"Escape\") {\r\n      select.ul.classList.remove(\"show\");\r\n    } else {\r\n      clearTimeout(debounceTimeout);\r\n      searchTerm += e.key;\r\n      debounceTimeout = setTimeout(() => {\r\n        searchTerm = \"\"\r\n      }, 500);\r\n      const searchedOption = e.target.options.find(option => {\r\n        return option.label.toLowerCase().startsWith(searchTerm)\r\n      });\r\n      if (searchedOption) {\r\n        select.selectValue(searchedOption.value)\r\n      }\r\n    }\r\n  }\r\n\r\n  get selectedOption() {\r\n    return this.options.find(option => option.selected)\r\n  }\r\n\r\n  get selectedOptionIndex() {\r\n    return this.options.indexOf(this.selectedOption)\r\n  }\r\n\r\n  selectValue(value) {\r\n    const next = this.options.find(option => {\r\n      return option.value === value\r\n    });\r\n    const prev = this.selectedOption;\r\n\r\n    prev.selected = false;\r\n    next.selected = true;\r\n\r\n    this.space.innerText = next.label;\r\n\r\n    this.sel.dataset['value'] = next.value;\r\n    prev.element.classList.remove('selected');\r\n\r\n    next.element.classList.add('selected');\r\n    next.element.scrollIntoView({block: \"nearest\"});\r\n\r\n    this.sel.dispatchEvent(new CustomEvent('customSelect.changed', {\r\n      bubbles: true,\r\n      detail: {next, prev, target: this.sel}\r\n    }));\r\n    // if (this.callback) this.callback({next, prev, target: this.sel})\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction setOption(option, select) {\r\n  const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\r\n\r\n  if (option.selected) li.classList.add(\"selected\");\r\n  li.onclick = ({target}) => {\r\n    select.selectValue(option.value);\r\n    select.ul.classList.remove(\"show\");\r\n  };\r\n  select.ul.append(li)\r\n}\r\n\r\nfunction getFormattedOptions(options) {\r\n  return [...options].map(option => {\r\n    return {\r\n      value: option.value,\r\n      label: option.label,\r\n      selected: option.selected,\r\n      element: option,\r\n    }\r\n  })\r\n}\r\n\r\n"],"names":["Promotion","constructor","this","$promotion","$","first","id","find","innerText","$activeTill","onchange","activetillChanged","bind","$unit","SelectNew","addEventListener","unitChanged","customEvent","data","dto","unit_id","detail","next","value","post","target","active_till","self","Select","el","options","querySelectorAll","map","option","label","selected","element","sel","createElement","tag","className","field","dataset","attr","selectedOption","get","after","document","append","space","text","arrow","ul","forEach","select","li","classList","add","onclick","selectValue","remove","setOption","toggle","onblur","onkeydown","keyDownhandler","callback","e","debounceTimeout","searchTerm","code","prevOption","selectedOptionIndex","nextOption","clearTimeout","key","setTimeout","searchedOption","toLowerCase","startsWith","indexOf","prev","scrollIntoView","block","dispatchEvent","CustomEvent","bubbles"],"sourceRoot":""}