{"version":3,"file":"437.js","mappings":"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","sources":["webpack://my-webpack-project/./public/src/Promotions/Promotion.js","webpack://my-webpack-project/./public/src/components/select/SelectNew.js"],"sourcesContent":["import './promotion.scss'\r\nimport {$, post} from '../common'\r\nimport SelectNew from \"../components/select/SelectNew\";\r\n\r\nexport default class Promotion {\r\n  constructor() {\r\n    this.$promotion = $('.promotion-edit').first();\r\n    if (!this.$promotion) return;\r\n\r\n    this.id = $(this.$promotion).find(`[data-field='id']`).innerText;\r\n\r\n    this.$activeTill = $(`[data-field='active-till']`).first();\r\n    this.$activeTill.onchange = this.activetillChanged.bind(this);\r\n\r\n    this.$unit = $('[select-new].unit').first();\r\n    let unit = new SelectNew(this.$unit);\r\n    const u = $(`[data-field=\"unit\"]`).first()\r\n    u.addEventListener('customSelect.changed', this.unitChanged.bind(this));\r\n  }\r\n\r\n  unitChanged(customEvent) {\r\n    let data = this.dto(this);\r\n    data.unit_id= customEvent.detail.next.value;\r\n    let res = post('/adminsc/promotion/updateOrCreate', data);\r\n\r\n  }\r\n\r\n  activetillChanged({target}) {\r\n    let data = this.dto(this);\r\n    data.active_till = target.value;\r\n    let res = post('/adminsc/promotion/updateOrCreate', data);\r\n    if (res) {\r\n    }\r\n  }\r\n\r\n  dto(self) {\r\n    return {\r\n      id: self.id\r\n    }\r\n  }\r\n\r\n\r\n}","import './SelectNew.scss'\r\n\r\nimport {createElement, post} from \"../../common\";\r\n\r\nexport default class Select {\r\n\r\n  constructor(el) {\r\n    if (!el) return;\r\n\r\n    this.options = getFormattedOptions(el.querySelectorAll(\"option\"));\r\n\r\n    this.sel = (new createElement())\r\n      .tag(\"div\")\r\n      .className(el?.className)\r\n      .field(el.dataset.field)\r\n      .attr(\"select-new\", '')\r\n      .attr(\"data-value\", this?.selectedOption?.value ?? '')\r\n      .attr('tabindex', '0').get();\r\n\r\n    el.after(this.sel);\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.sel.append(this.label);\r\n\r\n    this.space = (new createElement()).tag(\"div\").attr('class', \"space\").text(this?.selectedOption?.label).get();\r\n    this.label.append(this.space);\r\n\r\n    this.arrow = (new createElement()).tag(\"div\").attr('class', \"arrow\").get();\r\n    this.label.append(this.arrow);\r\n\r\n    this.ul = (new createElement()).tag(\"ul\").attr('class', \"options\").get();\r\n\r\n    this.options.forEach(option => {\r\n      setOption(option, this)\r\n    });\r\n\r\n    this.sel.append(this.ul);\r\n\r\n    this.label.onclick = () => this.ul.classList.toggle(\"show\");\r\n    this.sel.onblur = () => this.ul.classList.remove(\"show\");\r\n    this.sel.onkeydown = this.keyDownhandler;\r\n\r\n    el.remove()\r\n  }\r\n\r\n  onchange(callback) {\r\n    this.callback = callback\r\n  }\r\n\r\n  keyDownhandler(e) {\r\n    let debounceTimeout;\r\n    let searchTerm = \"\";\r\n\r\n    if (e.code === \"Space\") {\r\n      select.ul.classList.toggle(\"show\");\r\n    } else if (e.code === \"ArrowUp\") {\r\n      const prevOption = select.options[select.selectedOptionIndex - 1];\r\n      if (prevOption) {\r\n        select.selectValue(prevOption.value)\r\n      }\r\n    } else if (e.code === \"ArrowDown\") {\r\n      const nextOption = select.options[select.selectedOptionIndex + 1];\r\n      if (nextOption) {\r\n        select.selectValue(nextOption.value)\r\n      }\r\n    } else if (e.code === \"Enter\" || e.code === \"Escape\") {\r\n      select.ul.classList.remove(\"show\");\r\n    } else {\r\n      clearTimeout(debounceTimeout);\r\n      searchTerm += e.key;\r\n      debounceTimeout = setTimeout(() => {\r\n        searchTerm = \"\"\r\n      }, 500);\r\n      const searchedOption = e.target.options.find(option => {\r\n        return option.label.toLowerCase().startsWith(searchTerm)\r\n      });\r\n      if (searchedOption) {\r\n        select.selectValue(searchedOption.value)\r\n      }\r\n    }\r\n  }\r\n\r\n  get selectedOption() {\r\n    return this.options.find(option => option.selected)\r\n  }\r\n\r\n  get selectedOptionIndex() {\r\n    return this.options.indexOf(this.selectedOption)\r\n  }\r\n\r\n  selectValue(value) {\r\n    const next = this.options.find(option => {\r\n      return option.value === value\r\n    });\r\n    const prev = this.selectedOption;\r\n\r\n    prev.selected = false;\r\n    next.selected = true;\r\n\r\n    this.space.innerText = next.label;\r\n\r\n    this.sel.dataset['value'] = next.value;\r\n    prev.element.classList.remove('selected');\r\n\r\n    next.element.classList.add('selected');\r\n    next.element.scrollIntoView({block: \"nearest\"});\r\n\r\n    this.sel.dispatchEvent(new CustomEvent('customSelect.changed', {\r\n      bubbles: true,\r\n      detail: {next, prev, target: this.sel}\r\n    }));\r\n    // if (this.callback) this.callback({next, prev, target: this.sel})\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction setOption(option, select) {\r\n  const li = (new createElement()).tag(\"li\").text(option.label).attr('data-value', option.value).get();\r\n\r\n  if (option.selected) li.classList.add(\"selected\");\r\n  li.onclick = ({target}) => {\r\n    select.selectValue(option.value);\r\n    select.ul.classList.remove(\"show\");\r\n  };\r\n  select.ul.append(li)\r\n}\r\n\r\nfunction getFormattedOptions(options) {\r\n  return [...options].map(option => {\r\n    return {\r\n      value: option.value,\r\n      label: option.label,\r\n      selected: option.selected,\r\n      element: option,\r\n    }\r\n  })\r\n}\r\n\r\n"],"names":["Promotion","constructor","this","$promotion","$","first","id","find","innerText","$activeTill","onchange","activetillChanged","bind","$unit","SelectNew","addEventListener","unitChanged","customEvent","data","dto","unit_id","detail","next","value","post","_ref","target","active_till","self","Select","el","_this$selectedOption","_this$selectedOption2","options","querySelectorAll","map","option","label","selected","element","sel","createElement","tag","className","field","dataset","attr","selectedOption","get","after","document","append","space","text","arrow","ul","forEach","select","li","classList","add","onclick","selectValue","remove","setOption","toggle","onblur","onkeydown","keyDownhandler","callback","e","debounceTimeout","searchTerm","code","prevOption","selectedOptionIndex","nextOption","clearTimeout","key","setTimeout","searchedOption","toLowerCase","startsWith","indexOf","prev","scrollIntoView","block","dispatchEvent","CustomEvent","bubbles"],"sourceRoot":""}